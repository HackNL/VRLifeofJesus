"use strict";var VR=VR||{};VR.get=function(){function t(t){var e="/",n=e+"media/thumbnails/"+t,i=e+"media/video/"+t,o=e+"data/"+t;return{base:e,tumbUrl:n,videoUrl:i,dataUrl:o}}function e(t){return document.querySelector(t)}function n(t){return document.querySelectorAll(t)}function i(t){return new Promise(function(e,n){var i=new XMLHttpRequest;i.open("GET",t),i.onloadstart=function(){o(!0)},i.onloadend=function(){o(!0)},i.onload=function(){var t=200;i.status==t?(o(!1),e(i.responseText)):(n(new Error("request failed!")),VR.ux.showErr("There went something wrong"))},i.send()})}function o(t){var e=1e3;t?VR.get.one(".loading").classList.remove("disabled"):setTimeout(function(){VR.get.one(".loading").classList.add("disabled")},e)}return{urls:t,one:e,all:n,data:i,loading:o}}(),VR.date=function(){function t(t){var n=new Date(t),i=e.months[n.getMonth()],o=n.getDate(),a=e.days[n.getDay()],r=n.getFullYear();return a+" "+o+" "+i+" "+r}var e={days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],months:["January","February","March","April","May","June","July","August","September","October","November","December"]};return{readableDate:t}}(),VR.router=function(){function t(t){var e=VR.get.all(".page"),n=VR.get.one(t);e.forEach(function(t){t.classList.add("disabled")}),n.classList.remove("disabled"),"#cardboard"===t?VR.V3d.init():"#landing"===t?VR.landing.init():"#video"===t?console.log("hiosd"):"#timeline"===t&&VR.timeline.init()}return{show:t}}(),VR.landing=function(){function t(t){n(),e(),VR.get.loading(!1)}function e(){function t(){i+=(e-i)*a,o+=(n-o)*a;var r="translate("+i+"px, "+o+"px) scale(1.1)",d=VR.get.one(".bg");d.style.webkitTransform=r,d.style.MozTransform=r,d.style.msTransform=r,d.style.OTransform=r,d.style.transform=r,window.requestAnimationFrame(t)}var e=0,n=0,i=0,o=0,a=1/30;window.addEventListener("mouseover",function(t){var i=Math.max(-100,Math.min(100,screen.width/2-t.clientX)),o=Math.max(-100,Math.min(100,screen.height/2-t.clientY));e=20*i/100,n=10*o/100}),t()}function n(){var t=VR.get.one("#landingbutton");t.addEventListener("click",function(){VR.router.show("#timeline")})}return{init:t}}(),VR.timeline=function(){function t(){e()}function e(){var t=VR.get.one(".video-list"),e=VR.get.urls("data.json").dataUrl;VR.get.data(e).then(function(e){l=JSON.parse(e),t.appendChild(n(l)),o()})}function n(t){var e=document.createElement("ul");return t.videos.forEach(function(t){var n=Object.keys(t)[0],o=i(t[n].thumbnail,t[n].title,t[n].description,n);e.innerHTML+=o}),e}function i(t,e,n,i){var o=VR.get.urls(t).tumbUrl,a=(VR.get.urls(t).tumbUrl,'<li><div class="video-wrapper">');return a+='\t\t\t\t\t<div class="thumbnail-wrapper">',a+='\t\t\t\t\t\t<img class="thumbnail" src="'+o+'">',a+='  \t\t\t\t\t<div class="media-caption">',a+='  \t\t\t\t\t\t<div class="caption-content">',a+="  \t\t\t\t\t\t\t<h2>"+e+"</h2>",a+="  \t\t\t\t\t\t\t<span>"+n+"</span>",a+="  \t\t\t\t\t\t</div>",a+="    \t\t\t\t</div>",a+='  \t\t\t\t\t<div class="video-play" data-video-id="'+i+'"">',a+="  \t\t\t\t\t</div>",a+="\t\t\t\t\t</div>",a+='\t\t\t\t\t<video autoplay controls style="display:none;">',a+="\t\t\t\t\tSorry, your browser doesnt support embedded videos",a+="\t\t\t\t\t</video>",a+="</div></li>"}function o(){VR.get.one(".video-list ul").addEventListener("click",function(t){if("video-play"==t.target.className){u=t.target.dataset.videoId;var e=s(u);console.log(e),e.id=u,console.log("Navigate to the meta video view"),VR.router.show("#video"),d(e)}})}function a(){VR.get.one("#meta-video-play").addEventListener("click",function(t){var e=t.target.dataset.videoId,n=s(e)[e];console.log("Play te video");var i=document.getElementById("meta-video");i.src="media/video/"+n.filename,i.style.display="block",document.getElementsByClassName("meta-thumbnail-wrapper")[0].style.display="none"})}function r(){VR.get.one(".close").addEventListener("click",function(t){VR.router.show("#timeline");var e=document.getElementById("meta-video");console.log("check"),console.log(e.pause()),console.log(e),e.pause(),e.currentTime=0})}function d(t){console.log(t),document.getElementById("meta-video-play").setAttribute("data-video-id",t.id),document.getElementById("video-title").innerHTML=t[t.id].title,document.getElementById("description").innerHTML=t[t.id].description,document.getElementById("date-alias").innerHTML=t[t.id].datealias,document.getElementById("meta-thumbnail").src="media/thumbnails/"+t[t.id].thumbnail,a(),r()}function s(t){var e;return console.log(l),l.videos.some(function(n,i){n[t]&&(e=n)}),e}var l=void 0,u=void 0;return{init:t}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsIlZSc3RhcnQuanMiLCJWUmhlbHBlci5qcyIsIlZSZGF0ZS5qcyIsIlZScm91dGVyLmpzIiwiVlJsYW5kaW5nLmpzIiwiVlJ0aW1lbGluZS5qcyJdLCJuYW1lcyI6WyJWUiIsImdldCIsInVybHMiLCJ1cmwiLCJiYXNlIiwidHVtYlVybCIsInZpZGVvVXJsIiwiZGF0YVVybCIsIm9uZSIsInNlbGVjdG9yIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiYWxsIiwicXVlcnlTZWxlY3RvckFsbCIsImRhdGEiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsInJlcXVlc3QiLCJYTUxIdHRwUmVxdWVzdCIsIm9wZW4iLCJvbmxvYWRzdGFydCIsImxvYWRpbmciLCJvbmxvYWRlbmQiLCJvbmxvYWQiLCJzdGF0dXNDb2RlIiwic3RhdHVzIiwicmVzcG9uc2VUZXh0IiwiRXJyb3IiLCJ1eCIsInNob3dFcnIiLCJzZW5kIiwic2hvdyIsImRlbGF5VGltZSIsImNsYXNzTGlzdCIsInJlbW92ZSIsInNldFRpbWVvdXQiLCJhZGQiLCJkYXRlIiwicmVhZGFibGVEYXRlIiwidW5mcm9tYXRlZERhdGUiLCJuZXdEYXRlIiwiRGF0ZSIsIm1vbnRoIiwiZGF0ZXMiLCJtb250aHMiLCJnZXRNb250aCIsImdldERhdGUiLCJkYXkiLCJkYXlzIiwiZ2V0RGF5IiwieWVhciIsImdldEZ1bGxZZWFyIiwicm91dGVyIiwiaWQiLCJwYWdlcyIsInNlbGVjdGVkUGFnZSIsImZvckVhY2giLCJwYWdlIiwiVjNkIiwiaW5pdCIsImxhbmRpbmciLCJjb25zb2xlIiwibG9nIiwidGltZWxpbmUiLCJfYnV0dG9uIiwiYmFja2dyb3VuZCIsIm1vdmVCYWNrZ3JvdW5kIiwieCIsImxGb2xsb3dYIiwiZnJpY3Rpb24iLCJ5IiwibEZvbGxvd1kiLCJ0cmFuc2xhdGUiLCJzdHlsZSIsIndlYmtpdFRyYW5zZm9ybSIsIk1velRyYW5zZm9ybSIsIm1zVHJhbnNmb3JtIiwiT1RyYW5zZm9ybSIsInRyYW5zZm9ybSIsIndpbmRvdyIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwibE1vdXNlWCIsIk1hdGgiLCJtYXgiLCJtaW4iLCJzY3JlZW4iLCJ3aWR0aCIsImNsaWVudFgiLCJsTW91c2VZIiwiaGVpZ2h0IiwiY2xpZW50WSIsImxhbmRpbmdidXR0b24iLCJfZ2V0RGF0YSIsInZpZGVvTGlzdCIsInRoZW4iLCJyZXNwb25zZSIsIl92aWRlb3MiLCJKU09OIiwicGFyc2UiLCJhcHBlbmRDaGlsZCIsIl9nZW5lcmF0ZVRpbWVsaW5lIiwiY2xpY2tWaWRlbyIsImNyZWF0ZUVsZW1lbnQiLCJ2aWRlb3MiLCJvYmoiLCJ2aWRlb0lkIiwiT2JqZWN0Iiwia2V5cyIsImVsZW1lbnQiLCJfY3JlYXRlVmlkZW9FbGVtZW50IiwidGh1bWJuYWlsIiwidGl0bGUiLCJkZXNjcmlwdGlvbiIsImlubmVySFRNTCIsInR1bWJVcmxHZW5lcmF0ZWQiLCJ2aWRlbyIsInRhcmdldCIsImNsYXNzTmFtZSIsIl9zZWxlY3RlZFZpZGVvSWQiLCJkYXRhc2V0Iiwic2VsZWN0ZWRWaWRlbyIsImdldFZpZGVvIiwicmVuZGVyVmlkZW9NZXRhRGF0YSIsImNsaWNrTWV0YVZpZGVvIiwic2VsZWN0ZWRWaWRlb0lkIiwibWV0YVZpZGVvRWxlbWVudCIsImdldEVsZW1lbnRCeUlkIiwic3JjIiwiZmlsZW5hbWUiLCJkaXNwbGF5IiwiZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSIsImNsaWNrQ2xvc2VNZXRhIiwidmlkZW9FbGVtZW50IiwicGF1c2UiLCJjdXJyZW50VGltZSIsInNldEF0dHJpYnV0ZSIsImRhdGVhbGlhcyIsInNvbWUiLCJlbG0iLCJpbmRleCJdLCJtYXBwaW5ncyI6IkFBQUEsWUNBQSxJQUFBQSxJQUFBQSxNQ0NBQSxJQUFBQyxJQUFBLFdBQ0EsUUFBQUMsR0FBQUMsR0FHQSxHQUFBQyxHQUFBLElBQ0FDLEVBQUFELEVBQUEsb0JBQUFELEVBQ0FHLEVBQUFGLEVB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WixHQUFBRixHQUNBN0QsUUFBQUMsSUFBQTRELEdBQ0FqSCxTQUFBdUgsZUFBQSxtQkFBQVMsYUFBQSxnQkFBQWYsRUFBQXJFLElBQ0E1QyxTQUFBdUgsZUFBQSxlQUFBYixVQUFBTyxFQUFBQSxFQUFBckUsSUFBQTRELE1BQ0F4RyxTQUFBdUgsZUFBQSxlQUFBYixVQUFBTyxFQUFBQSxFQUFBckUsSUFBQTZELFlBQ0F6RyxTQUFBdUgsZUFBQSxjQUFBYixVQUFBTyxFQUFBQSxFQUFBckUsSUFBQXFGLFVBQ0FqSSxTQUFBdUgsZUFBQSxrQkFBQUMsSUFBQSxvQkFBQVAsRUFBQUEsRUFBQXJFLElBQUEyRCxVQUNBYSxJQUNBUSxJQVNBLFFBQUFWLEdBQUFoQixHQUNBLEdBQUFlLEVBT0EsT0FOQTdELFNBQUFDLElBQUFvQyxHQUNBQSxFQUFBTyxPQUFBa0MsS0FBQSxTQUFBQyxFQUFBQyxHQUNBRCxFQUFBakMsS0FDQWUsRUFBQWtCLEtBR0FsQixFQXpJQSxHQUFBeEIsR0FBQUEsT0FDQXNCLEVBQUFBLE1BNElBLFFBQ0E3RCxLQUFBQSIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbnZhciBWUiA9IFZSIHx8IHt9O1xuJ3VzZSBzdHJpY3QnO1xuXG4vL1RvIGVhc2lseSBzZWxlY3Qgc29tZXRoaW5nIGZyb20gdGhlIERPTVxuVlIuZ2V0ID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiB1cmxzKHVybCkge1xuXG4gICAgLy8gbGV0IGJhc2UgPSAnL1ZSTGlmZW9mSmVzdXMvJztcbiAgICB2YXIgYmFzZSA9ICcvJztcbiAgICB2YXIgdHVtYlVybCA9IGJhc2UgKyAnbWVkaWEvdGh1bWJuYWlscy8nICsgdXJsO1xuICAgIHZhciB2aWRlb1VybCA9IGJhc2UgKyAnbWVkaWEvdmlkZW8vJyArIHVybDtcbiAgICB2YXIgZGF0YVVybCA9IGJhc2UgKyAnZGF0YS8nICsgdXJsO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGJhc2U6IGJhc2UsXG4gICAgICB0dW1iVXJsOiB0dW1iVXJsLFxuICAgICAgdmlkZW9Vcmw6IHZpZGVvVXJsLFxuICAgICAgZGF0YVVybDogZGF0YVVybFxuICAgIH07XG4gIH1cblxuICBmdW5jdGlvbiBvbmUoc2VsZWN0b3IpIHtcbiAgICAvL1RoaXMgaXMgYSBtZXRob2RcbiAgICByZXR1cm4gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7XG4gIH1cblxuICBmdW5jdGlvbiBhbGwoc2VsZWN0b3IpIHtcbiAgICByZXR1cm4gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7XG4gIH1cblxuICBmdW5jdGlvbiBkYXRhKHVybCkge1xuICAgIC8vIHJldHVybiBhIFByb21pc2Ugb2JqZWN0XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIHZhciByZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICAvL29wZW4gYW4gZ2V0IHJlcXVlc3RcbiAgICAgIHJlcXVlc3Qub3BlbignR0VUJywgdXJsKTtcbiAgICAgIHJlcXVlc3Qub25sb2Fkc3RhcnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxvYWRpbmcodHJ1ZSk7XG4gICAgICB9O1xuICAgICAgcmVxdWVzdC5vbmxvYWRlbmQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxvYWRpbmcodHJ1ZSk7XG4gICAgICB9O1xuXG4gICAgICAvL2lmIHRoZSByZXF1ZXN0IGlzIGRvbmVcbiAgICAgIHJlcXVlc3Qub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAvL29ueSBpZiByZXF1ZXN0IGlzIGRvbmVcbiAgICAgICAgdmFyIHN0YXR1c0NvZGUgPSAyMDA7XG4gICAgICAgIGlmIChyZXF1ZXN0LnN0YXR1cyA9PSBzdGF0dXNDb2RlKSB7XG4gICAgICAgICAgbG9hZGluZyhmYWxzZSk7XG5cbiAgICAgICAgICAvLyBzZW5kIHRleHQgZm9ybSByZXF1ZXN0XG4gICAgICAgICAgcmVzb2x2ZShyZXF1ZXN0LnJlc3BvbnNlVGV4dCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gcmVqZWN0IHRoZSBwcm9taXNlIGlmIHRoZXJlIGlzIGEgZXJyXG4gICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcigncmVxdWVzdCBmYWlsZWQhJykpO1xuICAgICAgICAgIFZSLnV4LnNob3dFcnIoJ1RoZXJlIHdlbnQgc29tZXRoaW5nIHdyb25nJyk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICAvL3NlbmQgdGhlIHJlcXVlc3RcbiAgICAgIHJlcXVlc3Quc2VuZCgpO1xuICAgIH0pO1xuICB9XG4gIC8vIHNob3cgb3IgaGlkZSB0aGUgbG9hZGluZyBzcGlubmVyXG4gIGZ1bmN0aW9uIGxvYWRpbmcoc2hvdykge1xuICAgIHZhciBkZWxheVRpbWUgPSAxMDAwO1xuICAgIGlmIChzaG93KSB7XG4gICAgICBWUi5nZXQub25lKCcubG9hZGluZycpLmNsYXNzTGlzdC5yZW1vdmUoJ2Rpc2FibGVkJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vc2hvdyBsb2FkaW5nXG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgVlIuZ2V0Lm9uZSgnLmxvYWRpbmcnKS5jbGFzc0xpc3QuYWRkKCdkaXNhYmxlZCcpO1xuICAgICAgfSwgZGVsYXlUaW1lKTsgLy9hZGQgYSBkZWxheSBiZWNhdXNlIHlvdSB3b24ndCBzZWUgaXQgd2l0aCBmYXN0IGludGVybmV0LlxuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7IC8vcmV0dXJuIG9ubHkgdGhlIGZ1bnRpb25zIHRoYXQgYXJlIG5lc3NlZXJpeVxuICAgIHVybHM6IHVybHMsXG4gICAgb25lOiBvbmUsXG4gICAgYWxsOiBhbGwsXG4gICAgZGF0YTogZGF0YSxcbiAgICBsb2FkaW5nOiBsb2FkaW5nXG4gIH07XG59KCk7XG5cbi8vVG8gZWFzaWx5IHNlbGVjdCBzb21ldGhpbmcgZnJvbSB0aGUgRE9NXG5WUi5kYXRlID0gZnVuY3Rpb24gKCkge1xuICB2YXIgZGF0ZXMgPSB7XG4gICAgZGF5czogWydTdW5kYXknLCAnTW9uZGF5JywgJ1R1ZXNkYXknLCAnV2VkbmVzZGF5JywgJ1RodXJzZGF5JywgJ0ZyaWRheScsICdTYXR1cmRheSddLFxuICAgIG1vbnRoczogWydKYW51YXJ5JywgJ0ZlYnJ1YXJ5JywgJ01hcmNoJywgJ0FwcmlsJywgJ01heScsICdKdW5lJywgJ0p1bHknLCAnQXVndXN0JywgJ1NlcHRlbWJlcicsICdPY3RvYmVyJywgJ05vdmVtYmVyJywgJ0RlY2VtYmVyJ11cbiAgfTtcblxuICBmdW5jdGlvbiByZWFkYWJsZURhdGUodW5mcm9tYXRlZERhdGUpIHtcbiAgICB2YXIgbmV3RGF0ZSA9IG5ldyBEYXRlKHVuZnJvbWF0ZWREYXRlKTtcbiAgICB2YXIgbW9udGggPSBkYXRlcy5tb250aHNbbmV3RGF0ZS5nZXRNb250aCgpXTtcbiAgICB2YXIgZGF0ZSA9IG5ld0RhdGUuZ2V0RGF0ZSgpO1xuICAgIHZhciBkYXkgPSBkYXRlcy5kYXlzW25ld0RhdGUuZ2V0RGF5KCldO1xuICAgIHZhciB5ZWFyID0gbmV3RGF0ZS5nZXRGdWxsWWVhcigpO1xuXG4gICAgcmV0dXJuIGRheSArICcgJyArIGRhdGUgKyAnICcgKyBtb250aCArICcgJyArIHllYXI7XG4gIH1cblxuICByZXR1cm4geyAvL3JldHVybiBvbmx5IHRoZSBmdW50aW9ucyB0aGF0IGFyZSBuZXNzZWVyaXlcbiAgICByZWFkYWJsZURhdGU6IHJlYWRhYmxlRGF0ZVxuICB9O1xufSgpO1xuXG5WUi5yb3V0ZXIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIHNob3coaWQpIHtcbiAgICB2YXIgcGFnZXMgPSBWUi5nZXQuYWxsKCcucGFnZScpO1xuICAgIHZhciBzZWxlY3RlZFBhZ2UgPSBWUi5nZXQub25lKGlkKTtcblxuICAgIC8vZGlzYWJsZSBhbGwgdGhlIHBhZ2VzXG4gICAgcGFnZXMuZm9yRWFjaChmdW5jdGlvbiAocGFnZSkge1xuICAgICAgcGFnZS5jbGFzc0xpc3QuYWRkKCdkaXNhYmxlZCcpO1xuICAgIH0pO1xuXG4gICAgc2VsZWN0ZWRQYWdlLmNsYXNzTGlzdC5yZW1vdmUoJ2Rpc2FibGVkJyk7XG5cbiAgICBpZiAoaWQgPT09ICcjY2FyZGJvYXJkJykge1xuICAgICAgVlIuVjNkLmluaXQoKTtcbiAgICB9IGVsc2UgaWYgKGlkID09PSAnI2xhbmRpbmcnKSB7XG5cbiAgICAgIFZSLmxhbmRpbmcuaW5pdCgpO1xuICAgIH0gZWxzZSBpZiAoaWQgPT09ICcjdmlkZW8nKSB7XG4gICAgICBjb25zb2xlLmxvZygnaGlvc2QnKTtcbiAgICAgIC8vIFZSLnJlbmRlci5pbml0KCk7XG4gICAgfSBlbHNlIGlmIChpZCA9PT0gJyN0aW1lbGluZScpIHtcbiAgICAgIFZSLnRpbWVsaW5lLmluaXQoKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHtcbiAgICBzaG93OiBzaG93XG4gIH07XG59KCk7XG5cblZSLmxhbmRpbmcgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIGluaXQoaWQpIHtcblxuICAgIF9idXR0b24oKTtcbiAgICBiYWNrZ3JvdW5kKCk7XG4gICAgVlIuZ2V0LmxvYWRpbmcoZmFsc2UpO1xuICB9XG5cbiAgZnVuY3Rpb24gYmFja2dyb3VuZCgpIHtcbiAgICB2YXIgbEZvbGxvd1ggPSAwLFxuICAgICAgICBsRm9sbG93WSA9IDAsXG4gICAgICAgIHggPSAwLFxuICAgICAgICB5ID0gMCxcbiAgICAgICAgZnJpY3Rpb24gPSAxIC8gMzA7XG5cbiAgICBmdW5jdGlvbiBtb3ZlQmFja2dyb3VuZCgpIHtcbiAgICAgIHggKz0gKGxGb2xsb3dYIC0geCkgKiBmcmljdGlvbjtcbiAgICAgIHkgKz0gKGxGb2xsb3dZIC0geSkgKiBmcmljdGlvbjtcblxuICAgICAgdmFyIHRyYW5zbGF0ZSA9ICd0cmFuc2xhdGUoJyArIHggKyAncHgsICcgKyB5ICsgJ3B4KSBzY2FsZSgxLjEpJztcblxuICAgICAgdmFyIGJhY2tncm91bmQgPSBWUi5nZXQub25lKCcuYmcnKTtcblxuICAgICAgLy8gYmFja2dyb3VuZC5zdHlsZVsnLXdlYml0LXRyYW5zZm9ybSddID0gdHJhbnNsYXRlO1xuICAgICAgLy8gYmFja2dyb3VuZC5zdHlsZVsnLW1vei10cmFuc2Zvcm0nXSA9IHRyYW5zbGF0ZTtcbiAgICAgIGJhY2tncm91bmQuc3R5bGUud2Via2l0VHJhbnNmb3JtID0gdHJhbnNsYXRlO1xuICAgICAgYmFja2dyb3VuZC5zdHlsZS5Nb3pUcmFuc2Zvcm0gPSB0cmFuc2xhdGU7XG4gICAgICBiYWNrZ3JvdW5kLnN0eWxlLm1zVHJhbnNmb3JtID0gdHJhbnNsYXRlO1xuICAgICAgYmFja2dyb3VuZC5zdHlsZS5PVHJhbnNmb3JtID0gdHJhbnNsYXRlO1xuICAgICAgYmFja2dyb3VuZC5zdHlsZS50cmFuc2Zvcm0gPSB0cmFuc2xhdGU7XG5cbiAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUobW92ZUJhY2tncm91bmQpO1xuICAgIH1cblxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW92ZXInLCBmdW5jdGlvbiAoZSkge1xuXG4gICAgICB2YXIgbE1vdXNlWCA9IE1hdGgubWF4KC0xMDAsIE1hdGgubWluKDEwMCwgc2NyZWVuLndpZHRoIC8gMiAtIGUuY2xpZW50WCkpO1xuICAgICAgdmFyIGxNb3VzZVkgPSBNYXRoLm1heCgtMTAwLCBNYXRoLm1pbigxMDAsIHNjcmVlbi5oZWlnaHQgLyAyIC0gZS5jbGllbnRZKSk7XG4gICAgICBsRm9sbG93WCA9IDIwICogbE1vdXNlWCAvIDEwMDsgLy8gMTAwIDogMTIgPSBsTW91eGVYIDogbEZvbGxvd1xuICAgICAgbEZvbGxvd1kgPSAxMCAqIGxNb3VzZVkgLyAxMDA7XG4gICAgfSk7XG4gICAgbW92ZUJhY2tncm91bmQoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9idXR0b24oKSB7XG4gICAgdmFyIGxhbmRpbmdidXR0b24gPSBWUi5nZXQub25lKCcjbGFuZGluZ2J1dHRvbicpO1xuICAgIGxhbmRpbmdidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICBWUi5yb3V0ZXIuc2hvdygnI3RpbWVsaW5lJyk7XG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIHtcbiAgICBpbml0OiBpbml0XG4gIH07XG59KCk7XG5cblZSLnRpbWVsaW5lID0gZnVuY3Rpb24gKCkge1xuICAvL2Z1bnRpb24gdG8gcmVuZGVyIGEgdGVtcGxhdGUuXG4gIC8vcmVuZGVyIHRoZSB0ZW1wbGF0ZVxuICB2YXIgX3ZpZGVvcyA9IHZvaWQgMDtcbiAgdmFyIF9zZWxlY3RlZFZpZGVvSWQgPSB2b2lkIDA7XG5cbiAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAvLyByLl9nZXREYXRhKCk7XG4gICAgX2dldERhdGEoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9nZXREYXRhKCkge1xuXG4gICAgdmFyIHZpZGVvTGlzdCA9IFZSLmdldC5vbmUoJy52aWRlby1saXN0Jyk7XG4gICAgdmFyIHVybCA9IFZSLmdldC51cmxzKCdkYXRhLmpzb24nKS5kYXRhVXJsO1xuXG4gICAgVlIuZ2V0LmRhdGEodXJsKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgX3ZpZGVvcyA9IEpTT04ucGFyc2UocmVzcG9uc2UpO1xuXG4gICAgICB2aWRlb0xpc3QuYXBwZW5kQ2hpbGQoX2dlbmVyYXRlVGltZWxpbmUoX3ZpZGVvcykpO1xuICAgICAgY2xpY2tWaWRlbygpO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gX2dlbmVyYXRlVGltZWxpbmUoZGF0YSkge1xuICAgIHZhciB2aWRlb0xpc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd1bCcpO1xuXG4gICAgZGF0YS52aWRlb3MuZm9yRWFjaChmdW5jdGlvbiAob2JqKSB7XG4gICAgICB2YXIgdmlkZW9JZCA9IE9iamVjdC5rZXlzKG9iailbMF07XG5cbiAgICAgIHZhciBlbGVtZW50ID0gX2NyZWF0ZVZpZGVvRWxlbWVudChvYmpbdmlkZW9JZF0udGh1bWJuYWlsLCBvYmpbdmlkZW9JZF0udGl0bGUsIG9ialt2aWRlb0lkXS5kZXNjcmlwdGlvbiwgdmlkZW9JZCk7XG5cbiAgICAgIHZpZGVvTGlzdC5pbm5lckhUTUwgKz0gZWxlbWVudDsgLy9hZGQgaXQgdG8gdGhlIHVsXG4gICAgfSk7XG4gICAgcmV0dXJuIHZpZGVvTGlzdDtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9jcmVhdGVWaWRlb0VsZW1lbnQodHVtYlVybCwgdGl0bGUsIGRlc2NyaXB0aW9uLCB2aWRlb0lkKSB7XG4gICAgdmFyIHR1bWJVcmxHZW5lcmF0ZWQgPSBWUi5nZXQudXJscyh0dW1iVXJsKS50dW1iVXJsO1xuICAgIHZhciB2aWRlb1VybCA9IFZSLmdldC51cmxzKHR1bWJVcmwpLnR1bWJVcmw7XG5cbiAgICB2YXIgdmlkZW8gPSAnPGxpPjxkaXYgY2xhc3M9XCJ2aWRlby13cmFwcGVyXCI+JztcbiAgICB2aWRlbyArPSAnXHRcdFx0XHRcdDxkaXYgY2xhc3M9XCJ0aHVtYm5haWwtd3JhcHBlclwiPic7XG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHRcdDxpbWcgY2xhc3M9XCJ0aHVtYm5haWxcIiBzcmM9XCInICsgdHVtYlVybEdlbmVyYXRlZCArICdcIj4nO1xuICAgIHZpZGVvICs9ICcgIFx0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwibWVkaWEtY2FwdGlvblwiPic7XG4gICAgdmlkZW8gKz0gJyAgXHRcdFx0XHRcdFx0PGRpdiBjbGFzcz1cImNhcHRpb24tY29udGVudFwiPic7XG4gICAgdmlkZW8gKz0gJyAgXHRcdFx0XHRcdFx0XHQ8aDI+JyArIHRpdGxlICsgJzwvaDI+JztcbiAgICB2aWRlbyArPSAnICBcdFx0XHRcdFx0XHRcdDxzcGFuPicgKyBkZXNjcmlwdGlvbiArICc8L3NwYW4+JztcbiAgICB2aWRlbyArPSAnICBcdFx0XHRcdFx0XHQ8L2Rpdj4nO1xuICAgIHZpZGVvICs9ICcgICAgXHRcdFx0XHQ8L2Rpdj4nO1xuICAgIHZpZGVvICs9ICcgIFx0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwidmlkZW8tcGxheVwiIGRhdGEtdmlkZW8taWQ9XCInICsgdmlkZW9JZCArICdcIlwiPic7XG4gICAgdmlkZW8gKz0gJyAgXHRcdFx0XHRcdDwvZGl2Pic7XG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHQ8L2Rpdj4nO1xuICAgIHZpZGVvICs9ICdcdFx0XHRcdFx0PHZpZGVvIGF1dG9wbGF5IGNvbnRyb2xzIHN0eWxlPVwiZGlzcGxheTpub25lO1wiPic7XG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHRTb3JyeSwgeW91ciBicm93c2VyIGRvZXNudCBzdXBwb3J0IGVtYmVkZGVkIHZpZGVvcyc7XG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHQ8L3ZpZGVvPic7XG4gICAgdmlkZW8gKz0gJzwvZGl2PjwvbGk+JztcbiAgICByZXR1cm4gdmlkZW87XG4gIH1cblxuICBmdW5jdGlvbiBjbGlja1ZpZGVvKCkge1xuICAgIFZSLmdldC5vbmUoJy52aWRlby1saXN0IHVsJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgICAgaWYgKGUudGFyZ2V0LmNsYXNzTmFtZSA9PSBcInZpZGVvLXBsYXlcIikge1xuXG4gICAgICAgIF9zZWxlY3RlZFZpZGVvSWQgPSBlLnRhcmdldC5kYXRhc2V0LnZpZGVvSWQ7XG4gICAgICAgIHZhciBzZWxlY3RlZFZpZGVvID0gZ2V0VmlkZW8oX3NlbGVjdGVkVmlkZW9JZCk7XG4gICAgICAgIGNvbnNvbGUubG9nKHNlbGVjdGVkVmlkZW8pO1xuICAgICAgICBzZWxlY3RlZFZpZGVvLmlkID0gX3NlbGVjdGVkVmlkZW9JZDtcblxuICAgICAgICAvLyBOYXZpZ2F0ZSB0byB0aGUgbWV0YSB2aWRlbyB2aWV3XG4gICAgICAgIGNvbnNvbGUubG9nKCdOYXZpZ2F0ZSB0byB0aGUgbWV0YSB2aWRlbyB2aWV3Jyk7XG5cbiAgICAgICAgLy8gZ290b1NlY3Rpb24oJ3ZpZGVvLW1ldGEnKTtcbiAgICAgICAgVlIucm91dGVyLnNob3coJyN2aWRlbycpO1xuICAgICAgICByZW5kZXJWaWRlb01ldGFEYXRhKHNlbGVjdGVkVmlkZW8pO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gY2xpY2tNZXRhVmlkZW8oKSB7XG4gICAgVlIuZ2V0Lm9uZSgnI21ldGEtdmlkZW8tcGxheScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgIHZhciBzZWxlY3RlZFZpZGVvSWQgPSBlLnRhcmdldC5kYXRhc2V0LnZpZGVvSWQ7XG4gICAgICB2YXIgc2VsZWN0ZWRWaWRlbyA9IGdldFZpZGVvKHNlbGVjdGVkVmlkZW9JZClbc2VsZWN0ZWRWaWRlb0lkXTtcblxuICAgICAgLy8gUGxheSB0aGUgdmlkZW9cbiAgICAgIGNvbnNvbGUubG9nKCdQbGF5IHRlIHZpZGVvJyk7XG5cbiAgICAgIHZhciBtZXRhVmlkZW9FbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldGEtdmlkZW8nKTtcbiAgICAgIG1ldGFWaWRlb0VsZW1lbnQuc3JjID0gJ21lZGlhL3ZpZGVvLycgKyBzZWxlY3RlZFZpZGVvLmZpbGVuYW1lO1xuICAgICAgbWV0YVZpZGVvRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcbiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ21ldGEtdGh1bWJuYWlsLXdyYXBwZXInKVswXS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gY2xpY2tDbG9zZU1ldGEoKSB7XG4gICAgVlIuZ2V0Lm9uZSgnLmNsb3NlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgICAgVlIucm91dGVyLnNob3coJyN0aW1lbGluZScpO1xuICAgICAgdmFyIHZpZGVvRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhLXZpZGVvJyk7XG4gICAgICBjb25zb2xlLmxvZygnY2hlY2snKTtcbiAgICAgIGNvbnNvbGUubG9nKHZpZGVvRWxlbWVudC5wYXVzZSgpKTtcbiAgICAgIGNvbnNvbGUubG9nKHZpZGVvRWxlbWVudCk7XG4gICAgICB2aWRlb0VsZW1lbnQucGF1c2UoKTtcbiAgICAgIHZpZGVvRWxlbWVudC5jdXJyZW50VGltZSA9IDA7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUmVuZGVycyB0aGUgdmlkZW8gbWV0YSBkYXRhIGluIHRoZSB2aWRlby1tZXRhIHNlY3Rpb25cbiAgICpcbiAgICogQHBhcmFtICAgICAge29ian0gIHNlbGVjdGVkVmlkZW8gIFRoZSBzZWxlY3RlZCB2aWRlb1xuICAgKi9cbiAgZnVuY3Rpb24gcmVuZGVyVmlkZW9NZXRhRGF0YShzZWxlY3RlZFZpZGVvKSB7XG4gICAgY29uc29sZS5sb2coc2VsZWN0ZWRWaWRlbyk7XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldGEtdmlkZW8tcGxheScpLnNldEF0dHJpYnV0ZSgnZGF0YS12aWRlby1pZCcsIHNlbGVjdGVkVmlkZW8uaWQpO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd2aWRlby10aXRsZScpLmlubmVySFRNTCA9IHNlbGVjdGVkVmlkZW9bc2VsZWN0ZWRWaWRlby5pZF0udGl0bGU7XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rlc2NyaXB0aW9uJykuaW5uZXJIVE1MID0gc2VsZWN0ZWRWaWRlb1tzZWxlY3RlZFZpZGVvLmlkXS5kZXNjcmlwdGlvbjtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGF0ZS1hbGlhcycpLmlubmVySFRNTCA9IHNlbGVjdGVkVmlkZW9bc2VsZWN0ZWRWaWRlby5pZF0uZGF0ZWFsaWFzO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhLXRodW1ibmFpbCcpLnNyYyA9ICdtZWRpYS90aHVtYm5haWxzLycgKyBzZWxlY3RlZFZpZGVvW3NlbGVjdGVkVmlkZW8uaWRdLnRodW1ibmFpbDtcbiAgICBjbGlja01ldGFWaWRlbygpO1xuICAgIGNsaWNrQ2xvc2VNZXRhKCk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgdmlkZW8uXG4gICAqXG4gICAqIEBwYXJhbSAgICAgIHN0cmluZyB2aWRlb0lkICBUaGUgdmlkZW8gaWRlbnRpZmllclxuICAgKiBAcmV0dXJuICAgICBvYmogIFRoZSB2aWRlby5cbiAgICovXG4gIGZ1bmN0aW9uIGdldFZpZGVvKHZpZGVvSWQpIHtcbiAgICB2YXIgc2VsZWN0ZWRWaWRlbztcbiAgICBjb25zb2xlLmxvZyhfdmlkZW9zKTtcbiAgICBfdmlkZW9zLnZpZGVvcy5zb21lKGZ1bmN0aW9uIChlbG0sIGluZGV4KSB7XG4gICAgICBpZiAoZWxtW3ZpZGVvSWRdKSB7XG4gICAgICAgIHNlbGVjdGVkVmlkZW8gPSBlbG07XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHNlbGVjdGVkVmlkZW87XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGluaXQ6IGluaXRcbiAgfTtcbn0oKTsiLCJ2YXIgVlIgPSBWUiB8fCB7fTtcbid1c2Ugc3RyaWN0JztcbiIsIi8vVG8gZWFzaWx5IHNlbGVjdCBzb21ldGhpbmcgZnJvbSB0aGUgRE9NXG5WUi5nZXQgPSAoZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiB1cmxzKHVybCkge1xuXG4gICAgLy8gbGV0IGJhc2UgPSAnL1ZSTGlmZW9mSmVzdXMvJztcbiAgICBsZXQgYmFzZSA9ICcvJztcbiAgICBsZXQgdHVtYlVybCA9IGJhc2UgKyAnbWVkaWEvdGh1bWJuYWlscy8nICsgdXJsO1xuICAgIGxldCB2aWRlb1VybCA9IGJhc2UgKyAnbWVkaWEvdmlkZW8vJyArIHVybDtcbiAgICBsZXQgZGF0YVVybCA9IGJhc2UgKyAnZGF0YS8nICsgdXJsO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGJhc2U6IGJhc2UsXG4gICAgICB0dW1iVXJsOiB0dW1iVXJsLFxuICAgICAgdmlkZW9Vcmw6IHZpZGVvVXJsLFxuICAgICAgZGF0YVVybFxuICAgIH07XG4gIH1cblxuICBmdW5jdGlvbiBvbmUoc2VsZWN0b3IpIHsgLy9UaGlzIGlzIGEgbWV0aG9kXG4gICAgcmV0dXJuIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpO1xuICB9XG5cbiAgZnVuY3Rpb24gYWxsKHNlbGVjdG9yKSB7XG4gICAgcmV0dXJuIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpO1xuICB9XG5cbiAgZnVuY3Rpb24gZGF0YSh1cmwpIHtcbiAgICAvLyByZXR1cm4gYSBQcm9taXNlIG9iamVjdFxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICB2YXIgcmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgLy9vcGVuIGFuIGdldCByZXF1ZXN0XG4gICAgICByZXF1ZXN0Lm9wZW4oJ0dFVCcsIHVybCk7XG4gICAgICByZXF1ZXN0Lm9ubG9hZHN0YXJ0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBsb2FkaW5nKHRydWUpO1xuICAgICAgfTtcbiAgICAgIHJlcXVlc3Qub25sb2FkZW5kID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBsb2FkaW5nKHRydWUpO1xuICAgICAgfTtcblxuICAgICAgLy9pZiB0aGUgcmVxdWVzdCBpcyBkb25lXG4gICAgICByZXF1ZXN0Lm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy9vbnkgaWYgcmVxdWVzdCBpcyBkb25lXG4gICAgICAgIGxldCBzdGF0dXNDb2RlID0gMjAwO1xuICAgICAgICBpZiAocmVxdWVzdC5zdGF0dXMgPT0gc3RhdHVzQ29kZSkge1xuICAgICAgICAgIGxvYWRpbmcoZmFsc2UpO1xuXG4gICAgICAgICAgLy8gc2VuZCB0ZXh0IGZvcm0gcmVxdWVzdFxuICAgICAgICAgIHJlc29sdmUocmVxdWVzdC5yZXNwb25zZVRleHQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIHJlamVjdCB0aGUgcHJvbWlzZSBpZiB0aGVyZSBpcyBhIGVyclxuICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoJ3JlcXVlc3QgZmFpbGVkIScpKTtcbiAgICAgICAgICBWUi51eC5zaG93RXJyKCdUaGVyZSB3ZW50IHNvbWV0aGluZyB3cm9uZycpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgLy9zZW5kIHRoZSByZXF1ZXN0XG4gICAgICByZXF1ZXN0LnNlbmQoKTtcbiAgICB9KTtcbiAgfVxuICAvLyBzaG93IG9yIGhpZGUgdGhlIGxvYWRpbmcgc3Bpbm5lclxuICBmdW5jdGlvbiBsb2FkaW5nKHNob3cpIHtcbiAgICBsZXQgZGVsYXlUaW1lID0gMTAwMDtcbiAgICBpZiAoc2hvdykge1xuICAgICAgVlIuZ2V0Lm9uZSgnLmxvYWRpbmcnKS5jbGFzc0xpc3QucmVtb3ZlKCdkaXNhYmxlZCcpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvL3Nob3cgbG9hZGluZ1xuICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgIFZSLmdldC5vbmUoJy5sb2FkaW5nJykuY2xhc3NMaXN0LmFkZCgnZGlzYWJsZWQnKTtcbiAgICAgIH0sIGRlbGF5VGltZSk7IC8vYWRkIGEgZGVsYXkgYmVjYXVzZSB5b3Ugd29uJ3Qgc2VlIGl0IHdpdGggZmFzdCBpbnRlcm5ldC5cbiAgICB9XG4gIH1cblxuICByZXR1cm4geyAvL3JldHVybiBvbmx5IHRoZSBmdW50aW9ucyB0aGF0IGFyZSBuZXNzZWVyaXlcbiAgICB1cmxzOiB1cmxzLFxuICAgIG9uZTogb25lLFxuICAgIGFsbDogYWxsLFxuICAgIGRhdGE6IGRhdGEsXG4gICAgbG9hZGluZzogbG9hZGluZ1xuICB9O1xufSkoKTtcbiIsIi8vVG8gZWFzaWx5IHNlbGVjdCBzb21ldGhpbmcgZnJvbSB0aGUgRE9NXG5WUi5kYXRlID0gKGZ1bmN0aW9uICgpIHtcbiAgbGV0IGRhdGVzID0ge1xuICAgIGRheXM6IFsnU3VuZGF5JywgJ01vbmRheScsICdUdWVzZGF5JywgJ1dlZG5lc2RheScsICdUaHVyc2RheScsICdGcmlkYXknLCAnU2F0dXJkYXknXSxcbiAgICBtb250aHM6IFsnSmFudWFyeScsICdGZWJydWFyeScsICdNYXJjaCcsICdBcHJpbCcsICdNYXknLCAnSnVuZScsICdKdWx5JywgJ0F1Z3VzdCcsICdTZXB0ZW1iZXInLCAnT2N0b2JlcicsICdOb3ZlbWJlcicsICdEZWNlbWJlciddLFxuICB9O1xuXG4gIGZ1bmN0aW9uIHJlYWRhYmxlRGF0ZSh1bmZyb21hdGVkRGF0ZSkge1xuICAgIGxldCBuZXdEYXRlID0gbmV3IERhdGUodW5mcm9tYXRlZERhdGUpO1xuICAgIGxldCBtb250aCA9IGRhdGVzLm1vbnRoc1tuZXdEYXRlLmdldE1vbnRoKCldO1xuICAgIGxldCBkYXRlID0gbmV3RGF0ZS5nZXREYXRlKCk7XG4gICAgbGV0IGRheSA9IGRhdGVzLmRheXNbbmV3RGF0ZS5nZXREYXkoKV07XG4gICAgbGV0IHllYXIgPSBuZXdEYXRlLmdldEZ1bGxZZWFyKCk7XG5cbiAgICByZXR1cm4gZGF5ICsgJyAnICsgZGF0ZSArICcgJyArIG1vbnRoICsgJyAnICsgeWVhcjtcbiAgfVxuXG5cbiAgcmV0dXJuIHsgLy9yZXR1cm4gb25seSB0aGUgZnVudGlvbnMgdGhhdCBhcmUgbmVzc2Vlcml5XG4gICAgcmVhZGFibGVEYXRlOiByZWFkYWJsZURhdGVcbiAgfTtcbn0pKCk7XG4iLCJWUi5yb3V0ZXIgPSAoZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBzaG93KGlkKSB7XG4gICAgdmFyIHBhZ2VzID0gVlIuZ2V0LmFsbCgnLnBhZ2UnKTtcbiAgICB2YXIgc2VsZWN0ZWRQYWdlID0gVlIuZ2V0Lm9uZShpZCk7XG5cbiAgICAvL2Rpc2FibGUgYWxsIHRoZSBwYWdlc1xuICAgIHBhZ2VzLmZvckVhY2goZnVuY3Rpb24gKHBhZ2UpIHtcbiAgICAgIHBhZ2UuY2xhc3NMaXN0LmFkZCgnZGlzYWJsZWQnKTtcbiAgICB9KTtcblxuICAgIHNlbGVjdGVkUGFnZS5jbGFzc0xpc3QucmVtb3ZlKCdkaXNhYmxlZCcpO1xuXG4gICAgaWYgKGlkID09PSAnI2NhcmRib2FyZCcpIHtcbiAgICAgIFZSLlYzZC5pbml0KCk7XG4gICAgfSBlbHNlIGlmIChpZCA9PT0gJyNsYW5kaW5nJykge1xuXG4gICAgICBWUi5sYW5kaW5nLmluaXQoKTtcbiAgICB9IGVsc2UgaWYgKGlkID09PSAnI3ZpZGVvJykge1xuICAgICAgY29uc29sZS5sb2coJ2hpb3NkJyk7XG4gICAgICAvLyBWUi5yZW5kZXIuaW5pdCgpO1xuICAgIH0gZWxzZSBpZiAoaWQgPT09ICcjdGltZWxpbmUnKSB7XG4gICAgICBWUi50aW1lbGluZS5pbml0KCk7XG4gICAgfVxuICB9XG4gIHJldHVybiB7XG4gICAgc2hvdzogc2hvd1xuICB9O1xufSkoKTtcbiIsIlZSLmxhbmRpbmcgPSAoZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBpbml0KGlkKSB7XG5cbiAgICBfYnV0dG9uKCk7XG4gICAgYmFja2dyb3VuZCgpO1xuICAgIFZSLmdldC5sb2FkaW5nKGZhbHNlKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGJhY2tncm91bmQoKSB7XG4gICAgdmFyIGxGb2xsb3dYID0gMCxcbiAgICAgIGxGb2xsb3dZID0gMCxcbiAgICAgIHggPSAwLFxuICAgICAgeSA9IDAsXG4gICAgICBmcmljdGlvbiA9IDEgLyAzMDtcblxuICAgIGZ1bmN0aW9uIG1vdmVCYWNrZ3JvdW5kKCkge1xuICAgICAgeCArPSAobEZvbGxvd1ggLSB4KSAqIGZyaWN0aW9uO1xuICAgICAgeSArPSAobEZvbGxvd1kgLSB5KSAqIGZyaWN0aW9uO1xuXG4gICAgICBsZXQgdHJhbnNsYXRlID0gJ3RyYW5zbGF0ZSgnICsgeCArICdweCwgJyArIHkgKyAncHgpIHNjYWxlKDEuMSknO1xuXG4gICAgICB2YXIgYmFja2dyb3VuZCA9IFZSLmdldC5vbmUoJy5iZycpO1xuXG4gICAgICAvLyBiYWNrZ3JvdW5kLnN0eWxlWyctd2ViaXQtdHJhbnNmb3JtJ10gPSB0cmFuc2xhdGU7XG4gICAgICAvLyBiYWNrZ3JvdW5kLnN0eWxlWyctbW96LXRyYW5zZm9ybSddID0gdHJhbnNsYXRlO1xuICAgICAgYmFja2dyb3VuZC5zdHlsZS53ZWJraXRUcmFuc2Zvcm0gPSB0cmFuc2xhdGU7XG4gICAgICBiYWNrZ3JvdW5kLnN0eWxlLk1velRyYW5zZm9ybSA9IHRyYW5zbGF0ZTtcbiAgICAgIGJhY2tncm91bmQuc3R5bGUubXNUcmFuc2Zvcm0gPSB0cmFuc2xhdGU7XG4gICAgICBiYWNrZ3JvdW5kLnN0eWxlLk9UcmFuc2Zvcm0gPSB0cmFuc2xhdGU7XG4gICAgICBiYWNrZ3JvdW5kLnN0eWxlLnRyYW5zZm9ybSA9IHRyYW5zbGF0ZTtcblxuICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShtb3ZlQmFja2dyb3VuZCk7XG4gICAgfVxuXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlb3ZlcicsIGZ1bmN0aW9uIChlKSB7XG5cbiAgICAgIHZhciBsTW91c2VYID0gTWF0aC5tYXgoLTEwMCwgTWF0aC5taW4oMTAwLCBzY3JlZW4ud2lkdGggLyAyIC0gZS5jbGllbnRYKSk7XG4gICAgICB2YXIgbE1vdXNlWSA9IE1hdGgubWF4KC0xMDAsIE1hdGgubWluKDEwMCwgc2NyZWVuLmhlaWdodCAvIDIgLSBlLmNsaWVudFkpKTtcbiAgICAgIGxGb2xsb3dYID0gKDIwICogbE1vdXNlWCkgLyAxMDA7IC8vIDEwMCA6IDEyID0gbE1vdXhlWCA6IGxGb2xsb3dcbiAgICAgIGxGb2xsb3dZID0gKDEwICogbE1vdXNlWSkgLyAxMDA7XG5cbiAgICB9KTtcbiAgICBtb3ZlQmFja2dyb3VuZCgpO1xuICB9XG5cbiAgZnVuY3Rpb24gX2J1dHRvbigpIHtcbiAgICB2YXIgbGFuZGluZ2J1dHRvbiA9IFZSLmdldC5vbmUoJyNsYW5kaW5nYnV0dG9uJyk7XG4gICAgbGFuZGluZ2J1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgIFZSLnJvdXRlci5zaG93KCcjdGltZWxpbmUnKVxuICAgIH0pO1xuICB9XG4gIHJldHVybiB7XG4gICAgaW5pdDogaW5pdFxuICB9O1xufSkoKTtcbiIsIlZSLnRpbWVsaW5lID0gKGZ1bmN0aW9uICgpIHsgLy9mdW50aW9uIHRvIHJlbmRlciBhIHRlbXBsYXRlLlxuICAvL3JlbmRlciB0aGUgdGVtcGxhdGVcbiAgbGV0IF92aWRlb3M7XG4gIGxldCBfc2VsZWN0ZWRWaWRlb0lkO1xuXG4gIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgLy8gci5fZ2V0RGF0YSgpO1xuICAgIF9nZXREYXRhKCk7XG4gIH1cblxuICBmdW5jdGlvbiBfZ2V0RGF0YSgpIHtcblxuICAgIGxldCB2aWRlb0xpc3QgPSBWUi5nZXQub25lKCcudmlkZW8tbGlzdCcpO1xuICAgIGxldCB1cmwgPSBWUi5nZXQudXJscygnZGF0YS5qc29uJykuZGF0YVVybDtcblxuICAgIFZSLmdldC5kYXRhKHVybCkudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICBfdmlkZW9zID0gSlNPTi5wYXJzZShyZXNwb25zZSk7XG5cbiAgICAgIHZpZGVvTGlzdC5hcHBlbmRDaGlsZChfZ2VuZXJhdGVUaW1lbGluZShfdmlkZW9zKSk7XG4gICAgICBjbGlja1ZpZGVvKCk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBfZ2VuZXJhdGVUaW1lbGluZShkYXRhKSB7XG4gICAgbGV0IHZpZGVvTGlzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3VsJyk7XG5cbiAgICBkYXRhLnZpZGVvcy5mb3JFYWNoKGZ1bmN0aW9uIChvYmopIHtcbiAgICAgIHZhciB2aWRlb0lkID0gT2JqZWN0LmtleXMob2JqKVswXTtcblxuICAgICAgbGV0IGVsZW1lbnQgPSBfY3JlYXRlVmlkZW9FbGVtZW50KG9ialt2aWRlb0lkXS50aHVtYm5haWwsIG9ialt2aWRlb0lkXS50aXRsZSwgb2JqW3ZpZGVvSWRdLmRlc2NyaXB0aW9uLCB2aWRlb0lkKTtcblxuICAgICAgdmlkZW9MaXN0LmlubmVySFRNTCArPSBlbGVtZW50OyAvL2FkZCBpdCB0byB0aGUgdWxcbiAgICB9KTtcbiAgICByZXR1cm4gdmlkZW9MaXN0O1xuXG4gIH1cblxuICBmdW5jdGlvbiBfY3JlYXRlVmlkZW9FbGVtZW50KHR1bWJVcmwsIHRpdGxlLCBkZXNjcmlwdGlvbiwgdmlkZW9JZCkge1xuICAgIGxldCB0dW1iVXJsR2VuZXJhdGVkID0gVlIuZ2V0LnVybHModHVtYlVybCkudHVtYlVybDtcbiAgICBsZXQgdmlkZW9VcmwgPSBWUi5nZXQudXJscyh0dW1iVXJsKS50dW1iVXJsO1xuXG4gICAgbGV0IHZpZGVvID0gJzxsaT48ZGl2IGNsYXNzPVwidmlkZW8td3JhcHBlclwiPic7XG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwidGh1bWJuYWlsLXdyYXBwZXJcIj4nXG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHRcdDxpbWcgY2xhc3M9XCJ0aHVtYm5haWxcIiBzcmM9XCInICsgdHVtYlVybEdlbmVyYXRlZCArICdcIj4nO1xuICAgIHZpZGVvICs9ICcgIFx0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwibWVkaWEtY2FwdGlvblwiPic7XG4gICAgdmlkZW8gKz0gJyAgXHRcdFx0XHRcdFx0PGRpdiBjbGFzcz1cImNhcHRpb24tY29udGVudFwiPic7XG4gICAgdmlkZW8gKz0gJyAgXHRcdFx0XHRcdFx0XHQ8aDI+JyArIHRpdGxlICsgJzwvaDI+JztcbiAgICB2aWRlbyArPSAnICBcdFx0XHRcdFx0XHRcdDxzcGFuPicgKyBkZXNjcmlwdGlvbiArICc8L3NwYW4+JztcbiAgICB2aWRlbyArPSAnICBcdFx0XHRcdFx0XHQ8L2Rpdj4nO1xuICAgIHZpZGVvICs9ICcgICAgXHRcdFx0XHQ8L2Rpdj4nO1xuICAgIHZpZGVvICs9ICcgIFx0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwidmlkZW8tcGxheVwiIGRhdGEtdmlkZW8taWQ9XCInICsgdmlkZW9JZCArICdcIlwiPic7XG4gICAgdmlkZW8gKz0gJyAgXHRcdFx0XHRcdDwvZGl2Pic7XG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHQ8L2Rpdj4nO1xuICAgIHZpZGVvICs9ICdcdFx0XHRcdFx0PHZpZGVvIGF1dG9wbGF5IGNvbnRyb2xzIHN0eWxlPVwiZGlzcGxheTpub25lO1wiPic7XG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHRTb3JyeSwgeW91ciBicm93c2VyIGRvZXNudCBzdXBwb3J0IGVtYmVkZGVkIHZpZGVvcyc7XG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHQ8L3ZpZGVvPic7XG4gICAgdmlkZW8gKz0gJzwvZGl2PjwvbGk+JztcbiAgICByZXR1cm4gdmlkZW87XG4gIH1cblxuICBmdW5jdGlvbiBjbGlja1ZpZGVvKCkge1xuICAgIFZSLmdldC5vbmUoJy52aWRlby1saXN0IHVsJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgICAgaWYgKGUudGFyZ2V0LmNsYXNzTmFtZSA9PSBcInZpZGVvLXBsYXlcIikge1xuXG4gICAgICAgIF9zZWxlY3RlZFZpZGVvSWQgPSBlLnRhcmdldC5kYXRhc2V0LnZpZGVvSWQ7XG4gICAgICAgIHZhciBzZWxlY3RlZFZpZGVvID0gZ2V0VmlkZW8oX3NlbGVjdGVkVmlkZW9JZCk7XG4gICAgICAgIGNvbnNvbGUubG9nKHNlbGVjdGVkVmlkZW8pO1xuICAgICAgICBzZWxlY3RlZFZpZGVvLmlkID0gX3NlbGVjdGVkVmlkZW9JZDtcblxuXG4gICAgICAgIC8vIE5hdmlnYXRlIHRvIHRoZSBtZXRhIHZpZGVvIHZpZXdcbiAgICAgICAgY29uc29sZS5sb2coJ05hdmlnYXRlIHRvIHRoZSBtZXRhIHZpZGVvIHZpZXcnKTtcblxuICAgICAgICAvLyBnb3RvU2VjdGlvbigndmlkZW8tbWV0YScpO1xuICAgICAgICBWUi5yb3V0ZXIuc2hvdygnI3ZpZGVvJyk7XG4gICAgICAgIHJlbmRlclZpZGVvTWV0YURhdGEoc2VsZWN0ZWRWaWRlbyk7XG5cbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNsaWNrTWV0YVZpZGVvKCkge1xuICAgIFZSLmdldC5vbmUoJyNtZXRhLXZpZGVvLXBsYXknKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICB2YXIgc2VsZWN0ZWRWaWRlb0lkID0gZS50YXJnZXQuZGF0YXNldC52aWRlb0lkO1xuICAgICAgdmFyIHNlbGVjdGVkVmlkZW8gPSBnZXRWaWRlbyhzZWxlY3RlZFZpZGVvSWQpW3NlbGVjdGVkVmlkZW9JZF07XG5cbiAgICAgIC8vIFBsYXkgdGhlIHZpZGVvXG4gICAgICBjb25zb2xlLmxvZygnUGxheSB0ZSB2aWRlbycpO1xuXG4gICAgICB2YXIgbWV0YVZpZGVvRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhLXZpZGVvJyk7XG4gICAgICBtZXRhVmlkZW9FbGVtZW50LnNyYyA9ICdtZWRpYS92aWRlby8nICsgc2VsZWN0ZWRWaWRlby5maWxlbmFtZTtcbiAgICAgIG1ldGFWaWRlb0VsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdtZXRhLXRodW1ibmFpbC13cmFwcGVyJylbMF0uc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICB9KTtcbiAgfVxuXG5cbiAgZnVuY3Rpb24gY2xpY2tDbG9zZU1ldGEoKSB7XG4gICAgVlIuZ2V0Lm9uZSgnLmNsb3NlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgICAgVlIucm91dGVyLnNob3coJyN0aW1lbGluZScpO1xuICAgICAgdmFyIHZpZGVvRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhLXZpZGVvJyk7XG4gICAgICBjb25zb2xlLmxvZygnY2hlY2snKVxuICAgICAgY29uc29sZS5sb2codmlkZW9FbGVtZW50LnBhdXNlKCkpXG4gICAgICBjb25zb2xlLmxvZyh2aWRlb0VsZW1lbnQpXG4gICAgICB2aWRlb0VsZW1lbnQucGF1c2UoKTtcbiAgICAgIHZpZGVvRWxlbWVudC5jdXJyZW50VGltZSA9IDA7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUmVuZGVycyB0aGUgdmlkZW8gbWV0YSBkYXRhIGluIHRoZSB2aWRlby1tZXRhIHNlY3Rpb25cbiAgICpcbiAgICogQHBhcmFtICAgICAge29ian0gIHNlbGVjdGVkVmlkZW8gIFRoZSBzZWxlY3RlZCB2aWRlb1xuICAgKi9cbiAgZnVuY3Rpb24gcmVuZGVyVmlkZW9NZXRhRGF0YShzZWxlY3RlZFZpZGVvKSB7XG4gICAgY29uc29sZS5sb2coc2VsZWN0ZWRWaWRlbyk7XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldGEtdmlkZW8tcGxheScpLnNldEF0dHJpYnV0ZSgnZGF0YS12aWRlby1pZCcsIHNlbGVjdGVkVmlkZW8uaWQpO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd2aWRlby10aXRsZScpLmlubmVySFRNTCA9IHNlbGVjdGVkVmlkZW9bc2VsZWN0ZWRWaWRlby5pZF0udGl0bGU7XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rlc2NyaXB0aW9uJykuaW5uZXJIVE1MID0gc2VsZWN0ZWRWaWRlb1tzZWxlY3RlZFZpZGVvLmlkXS5kZXNjcmlwdGlvbjtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGF0ZS1hbGlhcycpLmlubmVySFRNTCA9IHNlbGVjdGVkVmlkZW9bc2VsZWN0ZWRWaWRlby5pZF0uZGF0ZWFsaWFzO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhLXRodW1ibmFpbCcpLnNyYyA9ICdtZWRpYS90aHVtYm5haWxzLycgKyBzZWxlY3RlZFZpZGVvW3NlbGVjdGVkVmlkZW8uaWRdLnRodW1ibmFpbDtcbiAgICBjbGlja01ldGFWaWRlbygpO1xuICAgIGNsaWNrQ2xvc2VNZXRhKCk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgdmlkZW8uXG4gICAqXG4gICAqIEBwYXJhbSAgICAgIHN0cmluZyB2aWRlb0lkICBUaGUgdmlkZW8gaWRlbnRpZmllclxuICAgKiBAcmV0dXJuICAgICBvYmogIFRoZSB2aWRlby5cbiAgICovXG4gIGZ1bmN0aW9uIGdldFZpZGVvKHZpZGVvSWQpIHtcbiAgICB2YXIgc2VsZWN0ZWRWaWRlbztcbiAgICBjb25zb2xlLmxvZyhfdmlkZW9zKTtcbiAgICBfdmlkZW9zLnZpZGVvcy5zb21lKGZ1bmN0aW9uIChlbG0sIGluZGV4KSB7XG4gICAgICBpZiAoZWxtW3ZpZGVvSWRdKSB7XG4gICAgICAgIHNlbGVjdGVkVmlkZW8gPSBlbG07XG4gICAgICB9XG4gICAgfSlcbiAgICByZXR1cm4gc2VsZWN0ZWRWaWRlbztcbiAgfVxuXG5cbiAgcmV0dXJuIHtcbiAgICBpbml0OiBpbml0XG4gIH07XG5cbn0pKCk7XG4iXX0=
