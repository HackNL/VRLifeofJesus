"use strict";var VR=VR||{};VR.get=function(){function t(t){var e="/",n=e+"media/thumbnails/"+t,o=e+"media/video/"+t,i=e+"data/"+t;return{base:e,tumbUrl:n,videoUrl:o,dataUrl:i}}function e(t){return document.querySelector(t)}function n(t){return document.querySelectorAll(t)}function o(t){return new Promise(function(e,n){var o=new XMLHttpRequest;o.open("GET",t),o.onloadstart=function(){i(!0)},o.onloadend=function(){i(!0)},o.onload=function(){var t=200;o.status==t?(i(!1),e(o.responseText)):(n(new Error("request failed!")),VR.ux.showErr("There went something wrong"))},o.send()})}function i(t){var e=1e3;t?VR.get.one(".loading").classList.remove("disabled"):setTimeout(function(){VR.get.one(".loading").classList.add("disabled")},e)}return{urls:t,one:e,all:n,data:o,loading:i}}(),VR.date=function(){function t(t){var n=new Date(t),o=e.months[n.getMonth()],i=n.getDate(),a=e.days[n.getDay()],r=n.getFullYear();return a+" "+i+" "+o+" "+r}var e={days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],months:["January","February","March","April","May","June","July","August","September","October","November","December"]};return{readableDate:t}}(),VR.router=function(){function t(t){var e=VR.get.all(".page"),n=VR.get.one(t);e.forEach(function(t){t.classList.add("disabled")}),n.classList.remove("disabled"),"#cardboard"===t?VR.V3d.init():"#landing"===t?VR.landing.init():"#video"===t?console.log("hiosd"):"#timeline"===t&&VR.timeline.init()}return{show:t}}(),VR.landing=function(){function t(t){n(),e(),VR.get.loading(!1)}function e(){function t(){o+=(e-o)*a,i+=(n-i)*a;var r="translate("+o+"px, "+i+"px) scale(1.1)",d=VR.get.one(".bg");d.style.webkitTransform=r,d.style.MozTransform=r,d.style.msTransform=r,d.style.OTransform=r,d.style.transform=r,window.requestAnimationFrame(t)}var e=0,n=0,o=0,i=0,a=1/30;window.addEventListener("mouseover",function(t){var o=Math.max(-100,Math.min(100,screen.width/2-t.clientX)),i=Math.max(-100,Math.min(100,screen.height/2-t.clientY));e=20*o/100,n=10*i/100}),t()}function n(){var t=VR.get.one("#landingbutton");t.addEventListener("click",function(){VR.router.show("#timeline")})}return{init:t}}(),VR.timeline=function(){function t(){e()}function e(){var t=VR.get.one(".video-list"),e=VR.get.urls("data.json").dataUrl;VR.get.data(e).then(function(e){s=JSON.parse(e),t.appendChild(n(s)),i()})}function n(t){var e=document.createElement("ul");return t.videos.forEach(function(t){var n=Object.keys(t)[0],i=o(t.thumbnail,t.title,t.description,n);console.log(t),e.innerHTML+=i}),e}function o(t,e,n,o){var i=VR.get.urls(t).tumbUrl;VR.get.urls(t).tumbUrl;console.log(t);var a='<li><div class="video-wrapper">';return a+='\t\t\t\t\t<div class="thumbnail-wrapper">',a+='\t\t\t\t\t\t<img class="thumbnail" src="'+i+'">',a+='  \t\t\t\t\t<div class="media-caption">',a+='  \t\t\t\t\t\t<div class="caption-content">',a+="  \t\t\t\t\t\t\t<h2>"+e+"</h2>",a+="  \t\t\t\t\t\t\t<span>"+n+"</span>",a+="  \t\t\t\t\t\t</div>",a+="    \t\t\t\t</div>",a+='  \t\t\t\t\t<div class="video-play" data-video-id="'+o+'"">',a+="  \t\t\t\t\t</div>",a+="\t\t\t\t\t</div>",a+='\t\t\t\t\t<video autoplay controls style="display:none;">',a+="\t\t\t\t\tSorry, your browser doesnt support embedded videos",a+="\t\t\t\t\t</video>",a+="</div></li>"}function i(){VR.get.one(".video-list ul").addEventListener("click",function(t){if("video-play"==t.target.className){c=t.target.dataset.videoId,console.log(c);var e=l(c);console.log(e),e.id=c,console.log("Navigate to the meta video view"),VR.router.show("#video"),d(e)}})}function a(){VR.get.one("#meta-video-play").addEventListener("click",function(t){var e=t.target.dataset.videoId,n=l(e)[e];console.log("Play te video"),console.log(n);var o=document.getElementById("meta-video");o.src="media/video/"+n,o.style.display="block",document.getElementsByClassName("meta-thumbnail-wrapper")[0].style.display="none"})}function r(){VR.get.one(".close").addEventListener("click",function(t){VR.router.show("#timeline");var e=document.getElementById("meta-video");console.log("check"),console.log(e.pause()),console.log(e),e.pause(),e.currentTime=0})}function d(t){console.log(t),document.getElementById("meta-video-play").setAttribute("data-video-id",t.id),document.getElementById("video-title").innerHTML=t.title,document.getElementById("description").innerHTML=t.description,document.getElementById("date-alias").innerHTML=t.datealias,document.getElementById("meta-thumbnail").src="media/thumbnails/"+t.thumbnail,a(),r()}function l(t){var e;return console.log(s),s.videos.some(function(n,o){n[t]&&(e=n)}),e}var s=void 0,c=void 0;return{init:t}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsIlZSc3RhcnQuanMiLCJWUmhlbHBlci5qcyIsIlZSZGF0ZS5qcyIsIlZScm91dGVyLmpzIiwiVlJsYW5kaW5nLmpzIiwiVlJ0aW1lbGluZS5qcyJdLCJuYW1lcyI6WyJWUiIsImdldCIsInVybHMiLCJ1cmwiLCJiYXNlIiwidHVtYlVybCIsInZpZGVvVXJsIiwiZGF0YVVybCIsIm9uZSIsInNlbGVjdG9yIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiYWxsIiwicXVlcnlTZWxlY3RvckFsbCIsImRhdGEiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsInJlcXVlc3QiLCJYTUxIdHRwUmVxdWVzdCIsIm9wZW4iLCJvbmxvYWRzdGFydCIsImxvYWRpbmciLCJvbmxvYWRlbmQiLCJvbmxvYWQiLCJzdGF0dXNDb2RlIiwic3RhdHVzIiwicmVzcG9uc2VUZXh0IiwiRXJyb3IiLCJ1eCIsInNob3dFcnIiLCJzZW5kIiwic2hvdyIsImRlbGF5VGltZSIsImNsYXNzTGlzdCIsInJlbW92ZSIsInNldFRpbWVvdXQiLCJhZGQiLCJkYXRlIiwicmVhZGFibGVEYXRlIiwidW5mcm9tYXRlZERhdGUiLCJuZXdEYXRlIiwiRGF0ZSIsIm1vbnRoIiwiZGF0ZXMiLCJtb250aHMiLCJnZXRNb250aCIsImdldERhdGUiLCJkYXkiLCJkYXlzIiwiZ2V0RGF5IiwieWVhciIsImdldEZ1bGxZZWFyIiwicm91dGVyIiwiaWQiLCJwYWdlcyIsInNlbGVjdGVkUGFnZSIsImZvckVhY2giLCJwYWdlIiwiVjNkIiwiaW5pdCIsImxhbmRpbmciLCJjb25zb2xlIiwibG9nIiwidGltZWxpbmUiLCJfYnV0dG9uIiwiYmFja2dyb3VuZCIsIm1vdmVCYWNrZ3JvdW5kIiwieCIsImxGb2xsb3dYIiwiZnJpY3Rpb24iLCJ5IiwibEZvbGxvd1kiLCJ0cmFuc2xhdGUiLCJzdHlsZSIsIndlYmtpdFRyYW5zZm9ybSIsIk1velRyYW5zZm9ybSIsIm1zVHJhbnNmb3JtIiwiT1RyYW5zZm9ybSIsInRyYW5zZm9ybSIsIndpbmRvdyIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwibE1vdXNlWCIsIk1hdGgiLCJtYXgiLCJtaW4iLCJzY3JlZW4iLCJ3aWR0aCIsImNsaWVudFgiLCJsTW91c2VZIiwiaGVpZ2h0IiwiY2xpZW50WSIsImxhbmRpbmdidXR0b24iLCJfZ2V0RGF0YSIsInZpZGVvTGlzdCIsInRoZW4iLCJyZXNwb25zZSIsIl92aWRlb3MiLCJKU09OIiwicGFyc2UiLCJhcHBlbmRDaGlsZCIsIl9nZW5lcmF0ZVRpbWVsaW5lIiwiY2xpY2tWaWRlbyIsImNyZWF0ZUVsZW1lbnQiLCJ2aWRlb3MiLCJvYmoiLCJ2aWRlb0lkIiwiT2JqZWN0Iiwia2V5cyIsImVsZW1lbnQiLCJfY3JlYXRlVmlkZW9FbGVtZW50IiwidGh1bWJuYWlsIiwidGl0bGUiLCJkZXNjcmlwdGlvbiIsImlubmVySFRNTCIsInR1bWJVcmxHZW5lcmF0ZWQiLCJ2aWRlbyIsInRhcmdldCIsImNsYXNzTmFtZSIsIl9zZWxlY3RlZFZpZGVvSWQiLCJkYXRhc2V0Iiwic2VsZWN0ZWRWaWRlbyIsImdldFZpZGVvIiwicmVuZGVyVmlkZW9NZXRhRGF0YSIsImNsaWNrTWV0YVZpZGVvIiwic2VsZWN0ZWRWaWRlb0lkIiwibWV0YVZpZGVvRWxlbWVudCIsImdldEVsZW1lbnRCeUlkIiwic3JjIiwiZGlzcGxheSIsImdldEVsZW1lbnRzQnlDbGFzc05hbWUiLCJjbGlja0Nsb3NlTWV0YSIsInZpZGVvRWxlbWVudCIsInBhdXNlIiwiY3VycmVudFRpbWUiLCJzZXRBdHRyaWJ1dGUiLCJkYXRlYWxpYXMiLCJzb21lIiwiZWxtIiwiaW5kZXgiXSwibWFwcGluZ3MiOiJBQUFBLFlDQUEsSUFBQUEsSUFBQUEsTUNDQUEsSUFBQUMsSUFBQSxXQUNBLFFBQUFDLEdBQUFDLEdBR0EsR0FBQUMsR0FBQSxJQUNBQyxFQUFBRCxFQUFBLG9CQUFBRCxFQUNBRyxFQUFBRixFQUFBLGVBQUFELEVB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LElBQUF1RSxHQUNBQSxFQUFBQyxRQUNBRCxFQUFBRSxZQUFBLElBU0EsUUFBQVgsR0FBQUYsR0FDQTdELFFBQUFDLElBQUE0RCxHQUNBakgsU0FBQXVILGVBQUEsbUJBQUFRLGFBQUEsZ0JBQUFkLEVBQUFyRSxJQUNBNUMsU0FBQXVILGVBQUEsZUFBQWIsVUFBQU8sRUFBQVQsTUFDQXhHLFNBQUF1SCxlQUFBLGVBQUFiLFVBQUFPLEVBQUFSLFlBQ0F6RyxTQUFBdUgsZUFBQSxjQUFBYixVQUFBTyxFQUFBZSxVQUNBaEksU0FBQXVILGVBQUEsa0JBQUFDLElBQUEsb0JBQUFQLEVBQUFWLFVBQ0FhLElBQ0FPLElBU0EsUUFBQVQsR0FBQWhCLEdBQ0EsR0FBQWUsRUFPQSxPQU5BN0QsU0FBQUMsSUFBQW9DLEdBQ0FBLEVBQUFPLE9BQUFpQyxLQUFBLFNBQUFDLEVBQUFDLEdBQ0FELEVBQUFoQyxLQUNBZSxFQUFBaUIsS0FHQWpCLEVBMUlBLEdBQUF4QixHQUFBQSxPQUNBc0IsRUFBQUEsTUE2SUEsUUFDQTdELEtBQUFBIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxudmFyIFZSID0gVlIgfHwge307XG4ndXNlIHN0cmljdCc7XG5cbi8vVG8gZWFzaWx5IHNlbGVjdCBzb21ldGhpbmcgZnJvbSB0aGUgRE9NXG5WUi5nZXQgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIHVybHModXJsKSB7XG5cbiAgICAvLyBsZXQgYmFzZSA9ICcvVlJMaWZlb2ZKZXN1cy8nO1xuICAgIHZhciBiYXNlID0gJy8nO1xuICAgIHZhciB0dW1iVXJsID0gYmFzZSArICdtZWRpYS90aHVtYm5haWxzLycgKyB1cmw7XG4gICAgdmFyIHZpZGVvVXJsID0gYmFzZSArICdtZWRpYS92aWRlby8nICsgdXJsO1xuICAgIHZhciBkYXRhVXJsID0gYmFzZSArICdkYXRhLycgKyB1cmw7XG5cbiAgICByZXR1cm4ge1xuICAgICAgYmFzZTogYmFzZSxcbiAgICAgIHR1bWJVcmw6IHR1bWJVcmwsXG4gICAgICB2aWRlb1VybDogdmlkZW9VcmwsXG4gICAgICBkYXRhVXJsOiBkYXRhVXJsXG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG9uZShzZWxlY3Rvcikge1xuICAgIC8vVGhpcyBpcyBhIG1ldGhvZFxuICAgIHJldHVybiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGFsbChzZWxlY3Rvcikge1xuICAgIHJldHVybiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGRhdGEodXJsKSB7XG4gICAgLy8gcmV0dXJuIGEgUHJvbWlzZSBvYmplY3RcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgdmFyIHJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgIC8vb3BlbiBhbiBnZXQgcmVxdWVzdFxuICAgICAgcmVxdWVzdC5vcGVuKCdHRVQnLCB1cmwpO1xuICAgICAgcmVxdWVzdC5vbmxvYWRzdGFydCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbG9hZGluZyh0cnVlKTtcbiAgICAgIH07XG4gICAgICByZXF1ZXN0Lm9ubG9hZGVuZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbG9hZGluZyh0cnVlKTtcbiAgICAgIH07XG5cbiAgICAgIC8vaWYgdGhlIHJlcXVlc3QgaXMgZG9uZVxuICAgICAgcmVxdWVzdC5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vb255IGlmIHJlcXVlc3QgaXMgZG9uZVxuICAgICAgICB2YXIgc3RhdHVzQ29kZSA9IDIwMDtcbiAgICAgICAgaWYgKHJlcXVlc3Quc3RhdHVzID09IHN0YXR1c0NvZGUpIHtcbiAgICAgICAgICBsb2FkaW5nKGZhbHNlKTtcblxuICAgICAgICAgIC8vIHNlbmQgdGV4dCBmb3JtIHJlcXVlc3RcbiAgICAgICAgICByZXNvbHZlKHJlcXVlc3QucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyByZWplY3QgdGhlIHByb21pc2UgaWYgdGhlcmUgaXMgYSBlcnJcbiAgICAgICAgICByZWplY3QobmV3IEVycm9yKCdyZXF1ZXN0IGZhaWxlZCEnKSk7XG4gICAgICAgICAgVlIudXguc2hvd0VycignVGhlcmUgd2VudCBzb21ldGhpbmcgd3JvbmcnKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIC8vc2VuZCB0aGUgcmVxdWVzdFxuICAgICAgcmVxdWVzdC5zZW5kKCk7XG4gICAgfSk7XG4gIH1cbiAgLy8gc2hvdyBvciBoaWRlIHRoZSBsb2FkaW5nIHNwaW5uZXJcbiAgZnVuY3Rpb24gbG9hZGluZyhzaG93KSB7XG4gICAgdmFyIGRlbGF5VGltZSA9IDEwMDA7XG4gICAgaWYgKHNob3cpIHtcbiAgICAgIFZSLmdldC5vbmUoJy5sb2FkaW5nJykuY2xhc3NMaXN0LnJlbW92ZSgnZGlzYWJsZWQnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy9zaG93IGxvYWRpbmdcbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICBWUi5nZXQub25lKCcubG9hZGluZycpLmNsYXNzTGlzdC5hZGQoJ2Rpc2FibGVkJyk7XG4gICAgICB9LCBkZWxheVRpbWUpOyAvL2FkZCBhIGRlbGF5IGJlY2F1c2UgeW91IHdvbid0IHNlZSBpdCB3aXRoIGZhc3QgaW50ZXJuZXQuXG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHsgLy9yZXR1cm4gb25seSB0aGUgZnVudGlvbnMgdGhhdCBhcmUgbmVzc2Vlcml5XG4gICAgdXJsczogdXJscyxcbiAgICBvbmU6IG9uZSxcbiAgICBhbGw6IGFsbCxcbiAgICBkYXRhOiBkYXRhLFxuICAgIGxvYWRpbmc6IGxvYWRpbmdcbiAgfTtcbn0oKTtcblxuLy9UbyBlYXNpbHkgc2VsZWN0IHNvbWV0aGluZyBmcm9tIHRoZSBET01cblZSLmRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gIHZhciBkYXRlcyA9IHtcbiAgICBkYXlzOiBbJ1N1bmRheScsICdNb25kYXknLCAnVHVlc2RheScsICdXZWRuZXNkYXknLCAnVGh1cnNkYXknLCAnRnJpZGF5JywgJ1NhdHVyZGF5J10sXG4gICAgbW9udGhzOiBbJ0phbnVhcnknLCAnRmVicnVhcnknLCAnTWFyY2gnLCAnQXByaWwnLCAnTWF5JywgJ0p1bmUnLCAnSnVseScsICdBdWd1c3QnLCAnU2VwdGVtYmVyJywgJ09jdG9iZXInLCAnTm92ZW1iZXInLCAnRGVjZW1iZXInXVxuICB9O1xuXG4gIGZ1bmN0aW9uIHJlYWRhYmxlRGF0ZSh1bmZyb21hdGVkRGF0ZSkge1xuICAgIHZhciBuZXdEYXRlID0gbmV3IERhdGUodW5mcm9tYXRlZERhdGUpO1xuICAgIHZhciBtb250aCA9IGRhdGVzLm1vbnRoc1tuZXdEYXRlLmdldE1vbnRoKCldO1xuICAgIHZhciBkYXRlID0gbmV3RGF0ZS5nZXREYXRlKCk7XG4gICAgdmFyIGRheSA9IGRhdGVzLmRheXNbbmV3RGF0ZS5nZXREYXkoKV07XG4gICAgdmFyIHllYXIgPSBuZXdEYXRlLmdldEZ1bGxZZWFyKCk7XG5cbiAgICByZXR1cm4gZGF5ICsgJyAnICsgZGF0ZSArICcgJyArIG1vbnRoICsgJyAnICsgeWVhcjtcbiAgfVxuXG4gIHJldHVybiB7IC8vcmV0dXJuIG9ubHkgdGhlIGZ1bnRpb25zIHRoYXQgYXJlIG5lc3NlZXJpeVxuICAgIHJlYWRhYmxlRGF0ZTogcmVhZGFibGVEYXRlXG4gIH07XG59KCk7XG5cblZSLnJvdXRlciA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gc2hvdyhpZCkge1xuICAgIHZhciBwYWdlcyA9IFZSLmdldC5hbGwoJy5wYWdlJyk7XG4gICAgdmFyIHNlbGVjdGVkUGFnZSA9IFZSLmdldC5vbmUoaWQpO1xuXG4gICAgLy9kaXNhYmxlIGFsbCB0aGUgcGFnZXNcbiAgICBwYWdlcy5mb3JFYWNoKGZ1bmN0aW9uIChwYWdlKSB7XG4gICAgICBwYWdlLmNsYXNzTGlzdC5hZGQoJ2Rpc2FibGVkJyk7XG4gICAgfSk7XG5cbiAgICBzZWxlY3RlZFBhZ2UuY2xhc3NMaXN0LnJlbW92ZSgnZGlzYWJsZWQnKTtcblxuICAgIGlmIChpZCA9PT0gJyNjYXJkYm9hcmQnKSB7XG4gICAgICBWUi5WM2QuaW5pdCgpO1xuICAgIH0gZWxzZSBpZiAoaWQgPT09ICcjbGFuZGluZycpIHtcblxuICAgICAgVlIubGFuZGluZy5pbml0KCk7XG4gICAgfSBlbHNlIGlmIChpZCA9PT0gJyN2aWRlbycpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdoaW9zZCcpO1xuICAgICAgLy8gVlIucmVuZGVyLmluaXQoKTtcbiAgICB9IGVsc2UgaWYgKGlkID09PSAnI3RpbWVsaW5lJykge1xuICAgICAgVlIudGltZWxpbmUuaW5pdCgpO1xuICAgIH1cbiAgfVxuICByZXR1cm4ge1xuICAgIHNob3c6IHNob3dcbiAgfTtcbn0oKTtcblxuVlIubGFuZGluZyA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gaW5pdChpZCkge1xuXG4gICAgX2J1dHRvbigpO1xuICAgIGJhY2tncm91bmQoKTtcbiAgICBWUi5nZXQubG9hZGluZyhmYWxzZSk7XG4gIH1cblxuICBmdW5jdGlvbiBiYWNrZ3JvdW5kKCkge1xuICAgIHZhciBsRm9sbG93WCA9IDAsXG4gICAgICAgIGxGb2xsb3dZID0gMCxcbiAgICAgICAgeCA9IDAsXG4gICAgICAgIHkgPSAwLFxuICAgICAgICBmcmljdGlvbiA9IDEgLyAzMDtcblxuICAgIGZ1bmN0aW9uIG1vdmVCYWNrZ3JvdW5kKCkge1xuICAgICAgeCArPSAobEZvbGxvd1ggLSB4KSAqIGZyaWN0aW9uO1xuICAgICAgeSArPSAobEZvbGxvd1kgLSB5KSAqIGZyaWN0aW9uO1xuXG4gICAgICB2YXIgdHJhbnNsYXRlID0gJ3RyYW5zbGF0ZSgnICsgeCArICdweCwgJyArIHkgKyAncHgpIHNjYWxlKDEuMSknO1xuXG4gICAgICB2YXIgYmFja2dyb3VuZCA9IFZSLmdldC5vbmUoJy5iZycpO1xuXG4gICAgICAvLyBiYWNrZ3JvdW5kLnN0eWxlWyctd2ViaXQtdHJhbnNmb3JtJ10gPSB0cmFuc2xhdGU7XG4gICAgICAvLyBiYWNrZ3JvdW5kLnN0eWxlWyctbW96LXRyYW5zZm9ybSddID0gdHJhbnNsYXRlO1xuICAgICAgYmFja2dyb3VuZC5zdHlsZS53ZWJraXRUcmFuc2Zvcm0gPSB0cmFuc2xhdGU7XG4gICAgICBiYWNrZ3JvdW5kLnN0eWxlLk1velRyYW5zZm9ybSA9IHRyYW5zbGF0ZTtcbiAgICAgIGJhY2tncm91bmQuc3R5bGUubXNUcmFuc2Zvcm0gPSB0cmFuc2xhdGU7XG4gICAgICBiYWNrZ3JvdW5kLnN0eWxlLk9UcmFuc2Zvcm0gPSB0cmFuc2xhdGU7XG4gICAgICBiYWNrZ3JvdW5kLnN0eWxlLnRyYW5zZm9ybSA9IHRyYW5zbGF0ZTtcblxuICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShtb3ZlQmFja2dyb3VuZCk7XG4gICAgfVxuXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlb3ZlcicsIGZ1bmN0aW9uIChlKSB7XG5cbiAgICAgIHZhciBsTW91c2VYID0gTWF0aC5tYXgoLTEwMCwgTWF0aC5taW4oMTAwLCBzY3JlZW4ud2lkdGggLyAyIC0gZS5jbGllbnRYKSk7XG4gICAgICB2YXIgbE1vdXNlWSA9IE1hdGgubWF4KC0xMDAsIE1hdGgubWluKDEwMCwgc2NyZWVuLmhlaWdodCAvIDIgLSBlLmNsaWVudFkpKTtcbiAgICAgIGxGb2xsb3dYID0gMjAgKiBsTW91c2VYIC8gMTAwOyAvLyAxMDAgOiAxMiA9IGxNb3V4ZVggOiBsRm9sbG93XG4gICAgICBsRm9sbG93WSA9IDEwICogbE1vdXNlWSAvIDEwMDtcbiAgICB9KTtcbiAgICBtb3ZlQmFja2dyb3VuZCgpO1xuICB9XG5cbiAgZnVuY3Rpb24gX2J1dHRvbigpIHtcbiAgICB2YXIgbGFuZGluZ2J1dHRvbiA9IFZSLmdldC5vbmUoJyNsYW5kaW5nYnV0dG9uJyk7XG4gICAgbGFuZGluZ2J1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgIFZSLnJvdXRlci5zaG93KCcjdGltZWxpbmUnKTtcbiAgICB9KTtcbiAgfVxuICByZXR1cm4ge1xuICAgIGluaXQ6IGluaXRcbiAgfTtcbn0oKTtcblxuVlIudGltZWxpbmUgPSBmdW5jdGlvbiAoKSB7XG4gIC8vZnVudGlvbiB0byByZW5kZXIgYSB0ZW1wbGF0ZS5cbiAgLy9yZW5kZXIgdGhlIHRlbXBsYXRlXG4gIHZhciBfdmlkZW9zID0gdm9pZCAwO1xuICB2YXIgX3NlbGVjdGVkVmlkZW9JZCA9IHZvaWQgMDtcblxuICBmdW5jdGlvbiBpbml0KCkge1xuICAgIC8vIHIuX2dldERhdGEoKTtcbiAgICBfZ2V0RGF0YSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gX2dldERhdGEoKSB7XG5cbiAgICB2YXIgdmlkZW9MaXN0ID0gVlIuZ2V0Lm9uZSgnLnZpZGVvLWxpc3QnKTtcbiAgICB2YXIgdXJsID0gVlIuZ2V0LnVybHMoJ2RhdGEuanNvbicpLmRhdGFVcmw7XG5cbiAgICBWUi5nZXQuZGF0YSh1cmwpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICBfdmlkZW9zID0gSlNPTi5wYXJzZShyZXNwb25zZSk7XG5cbiAgICAgIHZpZGVvTGlzdC5hcHBlbmRDaGlsZChfZ2VuZXJhdGVUaW1lbGluZShfdmlkZW9zKSk7XG4gICAgICBjbGlja1ZpZGVvKCk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBfZ2VuZXJhdGVUaW1lbGluZShkYXRhKSB7XG4gICAgdmFyIHZpZGVvTGlzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3VsJyk7XG5cbiAgICBkYXRhLnZpZGVvcy5mb3JFYWNoKGZ1bmN0aW9uIChvYmopIHtcbiAgICAgIHZhciB2aWRlb0lkID0gT2JqZWN0LmtleXMob2JqKVswXTtcblxuICAgICAgdmFyIGVsZW1lbnQgPSBfY3JlYXRlVmlkZW9FbGVtZW50KG9iai50aHVtYm5haWwsIG9iai50aXRsZSwgb2JqLmRlc2NyaXB0aW9uLCB2aWRlb0lkKTtcbiAgICAgIGNvbnNvbGUubG9nKG9iaik7XG4gICAgICB2aWRlb0xpc3QuaW5uZXJIVE1MICs9IGVsZW1lbnQ7IC8vYWRkIGl0IHRvIHRoZSB1bFxuICAgIH0pO1xuICAgIHJldHVybiB2aWRlb0xpc3Q7XG4gIH1cblxuICBmdW5jdGlvbiBfY3JlYXRlVmlkZW9FbGVtZW50KHR1bWJVcmwsIHRpdGxlLCBkZXNjcmlwdGlvbiwgdmlkZW9JZCkge1xuICAgIHZhciB0dW1iVXJsR2VuZXJhdGVkID0gVlIuZ2V0LnVybHModHVtYlVybCkudHVtYlVybDtcbiAgICB2YXIgdmlkZW9VcmwgPSBWUi5nZXQudXJscyh0dW1iVXJsKS50dW1iVXJsO1xuICAgIGNvbnNvbGUubG9nKHR1bWJVcmwpO1xuICAgIHZhciB2aWRlbyA9ICc8bGk+PGRpdiBjbGFzcz1cInZpZGVvLXdyYXBwZXJcIj4nO1xuICAgIHZpZGVvICs9ICdcdFx0XHRcdFx0PGRpdiBjbGFzcz1cInRodW1ibmFpbC13cmFwcGVyXCI+JztcbiAgICB2aWRlbyArPSAnXHRcdFx0XHRcdFx0PGltZyBjbGFzcz1cInRodW1ibmFpbFwiIHNyYz1cIicgKyB0dW1iVXJsR2VuZXJhdGVkICsgJ1wiPic7XG4gICAgdmlkZW8gKz0gJyAgXHRcdFx0XHRcdDxkaXYgY2xhc3M9XCJtZWRpYS1jYXB0aW9uXCI+JztcbiAgICB2aWRlbyArPSAnICBcdFx0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwiY2FwdGlvbi1jb250ZW50XCI+JztcbiAgICB2aWRlbyArPSAnICBcdFx0XHRcdFx0XHRcdDxoMj4nICsgdGl0bGUgKyAnPC9oMj4nO1xuICAgIHZpZGVvICs9ICcgIFx0XHRcdFx0XHRcdFx0PHNwYW4+JyArIGRlc2NyaXB0aW9uICsgJzwvc3Bhbj4nO1xuICAgIHZpZGVvICs9ICcgIFx0XHRcdFx0XHRcdDwvZGl2Pic7XG4gICAgdmlkZW8gKz0gJyAgICBcdFx0XHRcdDwvZGl2Pic7XG4gICAgdmlkZW8gKz0gJyAgXHRcdFx0XHRcdDxkaXYgY2xhc3M9XCJ2aWRlby1wbGF5XCIgZGF0YS12aWRlby1pZD1cIicgKyB2aWRlb0lkICsgJ1wiXCI+JztcbiAgICB2aWRlbyArPSAnICBcdFx0XHRcdFx0PC9kaXY+JztcbiAgICB2aWRlbyArPSAnXHRcdFx0XHRcdDwvZGl2Pic7XG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHQ8dmlkZW8gYXV0b3BsYXkgY29udHJvbHMgc3R5bGU9XCJkaXNwbGF5Om5vbmU7XCI+JztcbiAgICB2aWRlbyArPSAnXHRcdFx0XHRcdFNvcnJ5LCB5b3VyIGJyb3dzZXIgZG9lc250IHN1cHBvcnQgZW1iZWRkZWQgdmlkZW9zJztcbiAgICB2aWRlbyArPSAnXHRcdFx0XHRcdDwvdmlkZW8+JztcbiAgICB2aWRlbyArPSAnPC9kaXY+PC9saT4nO1xuICAgIHJldHVybiB2aWRlbztcbiAgfVxuXG4gIGZ1bmN0aW9uIGNsaWNrVmlkZW8oKSB7XG4gICAgVlIuZ2V0Lm9uZSgnLnZpZGVvLWxpc3QgdWwnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICBpZiAoZS50YXJnZXQuY2xhc3NOYW1lID09IFwidmlkZW8tcGxheVwiKSB7XG5cbiAgICAgICAgX3NlbGVjdGVkVmlkZW9JZCA9IGUudGFyZ2V0LmRhdGFzZXQudmlkZW9JZDtcbiAgICAgICAgY29uc29sZS5sb2coX3NlbGVjdGVkVmlkZW9JZCk7XG4gICAgICAgIHZhciBzZWxlY3RlZFZpZGVvID0gZ2V0VmlkZW8oX3NlbGVjdGVkVmlkZW9JZCk7XG4gICAgICAgIGNvbnNvbGUubG9nKHNlbGVjdGVkVmlkZW8pO1xuICAgICAgICBzZWxlY3RlZFZpZGVvLmlkID0gX3NlbGVjdGVkVmlkZW9JZDtcblxuICAgICAgICAvLyBOYXZpZ2F0ZSB0byB0aGUgbWV0YSB2aWRlbyB2aWV3XG4gICAgICAgIGNvbnNvbGUubG9nKCdOYXZpZ2F0ZSB0byB0aGUgbWV0YSB2aWRlbyB2aWV3Jyk7XG5cbiAgICAgICAgLy8gZ290b1NlY3Rpb24oJ3ZpZGVvLW1ldGEnKTtcbiAgICAgICAgVlIucm91dGVyLnNob3coJyN2aWRlbycpO1xuICAgICAgICByZW5kZXJWaWRlb01ldGFEYXRhKHNlbGVjdGVkVmlkZW8pO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gY2xpY2tNZXRhVmlkZW8oKSB7XG4gICAgVlIuZ2V0Lm9uZSgnI21ldGEtdmlkZW8tcGxheScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgIHZhciBzZWxlY3RlZFZpZGVvSWQgPSBlLnRhcmdldC5kYXRhc2V0LnZpZGVvSWQ7XG4gICAgICB2YXIgc2VsZWN0ZWRWaWRlbyA9IGdldFZpZGVvKHNlbGVjdGVkVmlkZW9JZClbc2VsZWN0ZWRWaWRlb0lkXTtcblxuICAgICAgLy8gUGxheSB0aGUgdmlkZW9cbiAgICAgIGNvbnNvbGUubG9nKCdQbGF5IHRlIHZpZGVvJyk7XG4gICAgICBjb25zb2xlLmxvZyhzZWxlY3RlZFZpZGVvKTtcbiAgICAgIHZhciBtZXRhVmlkZW9FbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldGEtdmlkZW8nKTtcbiAgICAgIG1ldGFWaWRlb0VsZW1lbnQuc3JjID0gJ21lZGlhL3ZpZGVvLycgKyBzZWxlY3RlZFZpZGVvO1xuICAgICAgbWV0YVZpZGVvRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcbiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ21ldGEtdGh1bWJuYWlsLXdyYXBwZXInKVswXS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gY2xpY2tDbG9zZU1ldGEoKSB7XG4gICAgVlIuZ2V0Lm9uZSgnLmNsb3NlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgICAgVlIucm91dGVyLnNob3coJyN0aW1lbGluZScpO1xuICAgICAgdmFyIHZpZGVvRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhLXZpZGVvJyk7XG4gICAgICBjb25zb2xlLmxvZygnY2hlY2snKTtcbiAgICAgIGNvbnNvbGUubG9nKHZpZGVvRWxlbWVudC5wYXVzZSgpKTtcbiAgICAgIGNvbnNvbGUubG9nKHZpZGVvRWxlbWVudCk7XG4gICAgICB2aWRlb0VsZW1lbnQucGF1c2UoKTtcbiAgICAgIHZpZGVvRWxlbWVudC5jdXJyZW50VGltZSA9IDA7XG4gICAgfSk7XG4gIH1cblxuICAvKipcclxuICAgKiBSZW5kZXJzIHRoZSB2aWRlbyBtZXRhIGRhdGEgaW4gdGhlIHZpZGVvLW1ldGEgc2VjdGlvblxyXG4gICAqXHJcbiAgICogQHBhcmFtICAgICAge29ian0gIHNlbGVjdGVkVmlkZW8gIFRoZSBzZWxlY3RlZCB2aWRlb1xyXG4gICAqL1xuICBmdW5jdGlvbiByZW5kZXJWaWRlb01ldGFEYXRhKHNlbGVjdGVkVmlkZW8pIHtcbiAgICBjb25zb2xlLmxvZyhzZWxlY3RlZFZpZGVvKTtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YS12aWRlby1wbGF5Jykuc2V0QXR0cmlidXRlKCdkYXRhLXZpZGVvLWlkJywgc2VsZWN0ZWRWaWRlby5pZCk7XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZpZGVvLXRpdGxlJykuaW5uZXJIVE1MID0gc2VsZWN0ZWRWaWRlby50aXRsZTtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGVzY3JpcHRpb24nKS5pbm5lckhUTUwgPSBzZWxlY3RlZFZpZGVvLmRlc2NyaXB0aW9uO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkYXRlLWFsaWFzJykuaW5uZXJIVE1MID0gc2VsZWN0ZWRWaWRlby5kYXRlYWxpYXM7XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldGEtdGh1bWJuYWlsJykuc3JjID0gJ21lZGlhL3RodW1ibmFpbHMvJyArIHNlbGVjdGVkVmlkZW8udGh1bWJuYWlsO1xuICAgIGNsaWNrTWV0YVZpZGVvKCk7XG4gICAgY2xpY2tDbG9zZU1ldGEoKTtcbiAgfVxuXG4gIC8qKlxyXG4gICAqIEdldHMgdGhlIHZpZGVvLlxyXG4gICAqXHJcbiAgICogQHBhcmFtICAgICAgc3RyaW5nIHZpZGVvSWQgIFRoZSB2aWRlbyBpZGVudGlmaWVyXHJcbiAgICogQHJldHVybiAgICAgb2JqICBUaGUgdmlkZW8uXHJcbiAgICovXG4gIGZ1bmN0aW9uIGdldFZpZGVvKHZpZGVvSWQpIHtcbiAgICB2YXIgc2VsZWN0ZWRWaWRlbztcbiAgICBjb25zb2xlLmxvZyhfdmlkZW9zKTtcbiAgICBfdmlkZW9zLnZpZGVvcy5zb21lKGZ1bmN0aW9uIChlbG0sIGluZGV4KSB7XG4gICAgICBpZiAoZWxtW3ZpZGVvSWRdKSB7XG4gICAgICAgIHNlbGVjdGVkVmlkZW8gPSBlbG07XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHNlbGVjdGVkVmlkZW87XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGluaXQ6IGluaXRcbiAgfTtcbn0oKTsiLCJ2YXIgVlIgPSBWUiB8fCB7fTtcclxuJ3VzZSBzdHJpY3QnO1xyXG4iLCIvL1RvIGVhc2lseSBzZWxlY3Qgc29tZXRoaW5nIGZyb20gdGhlIERPTVxyXG5WUi5nZXQgPSAoZnVuY3Rpb24gKCkge1xyXG4gIGZ1bmN0aW9uIHVybHModXJsKSB7XHJcblxyXG4gICAgLy8gbGV0IGJhc2UgPSAnL1ZSTGlmZW9mSmVzdXMvJztcclxuICAgIGxldCBiYXNlID0gJy8nO1xyXG4gICAgbGV0IHR1bWJVcmwgPSBiYXNlICsgJ21lZGlhL3RodW1ibmFpbHMvJyArIHVybDtcclxuICAgIGxldCB2aWRlb1VybCA9IGJhc2UgKyAnbWVkaWEvdmlkZW8vJyArIHVybDtcclxuICAgIGxldCBkYXRhVXJsID0gYmFzZSArICdkYXRhLycgKyB1cmw7XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgYmFzZTogYmFzZSxcclxuICAgICAgdHVtYlVybDogdHVtYlVybCxcclxuICAgICAgdmlkZW9Vcmw6IHZpZGVvVXJsLFxyXG4gICAgICBkYXRhVXJsXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gb25lKHNlbGVjdG9yKSB7IC8vVGhpcyBpcyBhIG1ldGhvZFxyXG4gICAgcmV0dXJuIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gYWxsKHNlbGVjdG9yKSB7XHJcbiAgICByZXR1cm4gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBkYXRhKHVybCkge1xyXG4gICAgLy8gcmV0dXJuIGEgUHJvbWlzZSBvYmplY3RcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIHZhciByZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XHJcbiAgICAgIC8vb3BlbiBhbiBnZXQgcmVxdWVzdFxyXG4gICAgICByZXF1ZXN0Lm9wZW4oJ0dFVCcsIHVybCk7XHJcbiAgICAgIHJlcXVlc3Qub25sb2Fkc3RhcnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgbG9hZGluZyh0cnVlKTtcclxuICAgICAgfTtcclxuICAgICAgcmVxdWVzdC5vbmxvYWRlbmQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgbG9hZGluZyh0cnVlKTtcclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vaWYgdGhlIHJlcXVlc3QgaXMgZG9uZVxyXG4gICAgICByZXF1ZXN0Lm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAvL29ueSBpZiByZXF1ZXN0IGlzIGRvbmVcclxuICAgICAgICBsZXQgc3RhdHVzQ29kZSA9IDIwMDtcclxuICAgICAgICBpZiAocmVxdWVzdC5zdGF0dXMgPT0gc3RhdHVzQ29kZSkge1xyXG4gICAgICAgICAgbG9hZGluZyhmYWxzZSk7XHJcblxyXG4gICAgICAgICAgLy8gc2VuZCB0ZXh0IGZvcm0gcmVxdWVzdFxyXG4gICAgICAgICAgcmVzb2x2ZShyZXF1ZXN0LnJlc3BvbnNlVGV4dCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIC8vIHJlamVjdCB0aGUgcHJvbWlzZSBpZiB0aGVyZSBpcyBhIGVyclxyXG4gICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcigncmVxdWVzdCBmYWlsZWQhJykpO1xyXG4gICAgICAgICAgVlIudXguc2hvd0VycignVGhlcmUgd2VudCBzb21ldGhpbmcgd3JvbmcnKTtcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICAgIC8vc2VuZCB0aGUgcmVxdWVzdFxyXG4gICAgICByZXF1ZXN0LnNlbmQoKTtcclxuICAgIH0pO1xyXG4gIH1cclxuICAvLyBzaG93IG9yIGhpZGUgdGhlIGxvYWRpbmcgc3Bpbm5lclxyXG4gIGZ1bmN0aW9uIGxvYWRpbmcoc2hvdykge1xyXG4gICAgbGV0IGRlbGF5VGltZSA9IDEwMDA7XHJcbiAgICBpZiAoc2hvdykge1xyXG4gICAgICBWUi5nZXQub25lKCcubG9hZGluZycpLmNsYXNzTGlzdC5yZW1vdmUoJ2Rpc2FibGVkJyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvL3Nob3cgbG9hZGluZ1xyXG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBWUi5nZXQub25lKCcubG9hZGluZycpLmNsYXNzTGlzdC5hZGQoJ2Rpc2FibGVkJyk7XHJcbiAgICAgIH0sIGRlbGF5VGltZSk7IC8vYWRkIGEgZGVsYXkgYmVjYXVzZSB5b3Ugd29uJ3Qgc2VlIGl0IHdpdGggZmFzdCBpbnRlcm5ldC5cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJldHVybiB7IC8vcmV0dXJuIG9ubHkgdGhlIGZ1bnRpb25zIHRoYXQgYXJlIG5lc3NlZXJpeVxyXG4gICAgdXJsczogdXJscyxcclxuICAgIG9uZTogb25lLFxyXG4gICAgYWxsOiBhbGwsXHJcbiAgICBkYXRhOiBkYXRhLFxyXG4gICAgbG9hZGluZzogbG9hZGluZ1xyXG4gIH07XHJcbn0pKCk7XHJcbiIsIi8vVG8gZWFzaWx5IHNlbGVjdCBzb21ldGhpbmcgZnJvbSB0aGUgRE9NXHJcblZSLmRhdGUgPSAoZnVuY3Rpb24gKCkge1xyXG4gIGxldCBkYXRlcyA9IHtcclxuICAgIGRheXM6IFsnU3VuZGF5JywgJ01vbmRheScsICdUdWVzZGF5JywgJ1dlZG5lc2RheScsICdUaHVyc2RheScsICdGcmlkYXknLCAnU2F0dXJkYXknXSxcclxuICAgIG1vbnRoczogWydKYW51YXJ5JywgJ0ZlYnJ1YXJ5JywgJ01hcmNoJywgJ0FwcmlsJywgJ01heScsICdKdW5lJywgJ0p1bHknLCAnQXVndXN0JywgJ1NlcHRlbWJlcicsICdPY3RvYmVyJywgJ05vdmVtYmVyJywgJ0RlY2VtYmVyJ10sXHJcbiAgfTtcclxuXHJcbiAgZnVuY3Rpb24gcmVhZGFibGVEYXRlKHVuZnJvbWF0ZWREYXRlKSB7XHJcbiAgICBsZXQgbmV3RGF0ZSA9IG5ldyBEYXRlKHVuZnJvbWF0ZWREYXRlKTtcclxuICAgIGxldCBtb250aCA9IGRhdGVzLm1vbnRoc1tuZXdEYXRlLmdldE1vbnRoKCldO1xyXG4gICAgbGV0IGRhdGUgPSBuZXdEYXRlLmdldERhdGUoKTtcclxuICAgIGxldCBkYXkgPSBkYXRlcy5kYXlzW25ld0RhdGUuZ2V0RGF5KCldO1xyXG4gICAgbGV0IHllYXIgPSBuZXdEYXRlLmdldEZ1bGxZZWFyKCk7XHJcblxyXG4gICAgcmV0dXJuIGRheSArICcgJyArIGRhdGUgKyAnICcgKyBtb250aCArICcgJyArIHllYXI7XHJcbiAgfVxyXG5cclxuXHJcbiAgcmV0dXJuIHsgLy9yZXR1cm4gb25seSB0aGUgZnVudGlvbnMgdGhhdCBhcmUgbmVzc2Vlcml5XHJcbiAgICByZWFkYWJsZURhdGU6IHJlYWRhYmxlRGF0ZVxyXG4gIH07XHJcbn0pKCk7XHJcbiIsIlZSLnJvdXRlciA9IChmdW5jdGlvbiAoKSB7XHJcbiAgZnVuY3Rpb24gc2hvdyhpZCkge1xyXG4gICAgdmFyIHBhZ2VzID0gVlIuZ2V0LmFsbCgnLnBhZ2UnKTtcclxuICAgIHZhciBzZWxlY3RlZFBhZ2UgPSBWUi5nZXQub25lKGlkKTtcclxuXHJcbiAgICAvL2Rpc2FibGUgYWxsIHRoZSBwYWdlc1xyXG4gICAgcGFnZXMuZm9yRWFjaChmdW5jdGlvbiAocGFnZSkge1xyXG4gICAgICBwYWdlLmNsYXNzTGlzdC5hZGQoJ2Rpc2FibGVkJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBzZWxlY3RlZFBhZ2UuY2xhc3NMaXN0LnJlbW92ZSgnZGlzYWJsZWQnKTtcclxuXHJcbiAgICBpZiAoaWQgPT09ICcjY2FyZGJvYXJkJykge1xyXG4gICAgICBWUi5WM2QuaW5pdCgpO1xyXG4gICAgfSBlbHNlIGlmIChpZCA9PT0gJyNsYW5kaW5nJykge1xyXG5cclxuICAgICAgVlIubGFuZGluZy5pbml0KCk7XHJcbiAgICB9IGVsc2UgaWYgKGlkID09PSAnI3ZpZGVvJykge1xyXG4gICAgICBjb25zb2xlLmxvZygnaGlvc2QnKTtcclxuICAgICAgLy8gVlIucmVuZGVyLmluaXQoKTtcclxuICAgIH0gZWxzZSBpZiAoaWQgPT09ICcjdGltZWxpbmUnKSB7XHJcbiAgICAgIFZSLnRpbWVsaW5lLmluaXQoKTtcclxuICAgIH1cclxuICB9XHJcbiAgcmV0dXJuIHtcclxuICAgIHNob3c6IHNob3dcclxuICB9O1xyXG59KSgpO1xyXG4iLCJWUi5sYW5kaW5nID0gKGZ1bmN0aW9uICgpIHtcclxuICBmdW5jdGlvbiBpbml0KGlkKSB7XHJcblxyXG4gICAgX2J1dHRvbigpO1xyXG4gICAgYmFja2dyb3VuZCgpO1xyXG4gICAgVlIuZ2V0LmxvYWRpbmcoZmFsc2UpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gYmFja2dyb3VuZCgpIHtcclxuICAgIHZhciBsRm9sbG93WCA9IDAsXHJcbiAgICAgIGxGb2xsb3dZID0gMCxcclxuICAgICAgeCA9IDAsXHJcbiAgICAgIHkgPSAwLFxyXG4gICAgICBmcmljdGlvbiA9IDEgLyAzMDtcclxuXHJcbiAgICBmdW5jdGlvbiBtb3ZlQmFja2dyb3VuZCgpIHtcclxuICAgICAgeCArPSAobEZvbGxvd1ggLSB4KSAqIGZyaWN0aW9uO1xyXG4gICAgICB5ICs9IChsRm9sbG93WSAtIHkpICogZnJpY3Rpb247XHJcblxyXG4gICAgICBsZXQgdHJhbnNsYXRlID0gJ3RyYW5zbGF0ZSgnICsgeCArICdweCwgJyArIHkgKyAncHgpIHNjYWxlKDEuMSknO1xyXG5cclxuICAgICAgdmFyIGJhY2tncm91bmQgPSBWUi5nZXQub25lKCcuYmcnKTtcclxuXHJcbiAgICAgIC8vIGJhY2tncm91bmQuc3R5bGVbJy13ZWJpdC10cmFuc2Zvcm0nXSA9IHRyYW5zbGF0ZTtcclxuICAgICAgLy8gYmFja2dyb3VuZC5zdHlsZVsnLW1vei10cmFuc2Zvcm0nXSA9IHRyYW5zbGF0ZTtcclxuICAgICAgYmFja2dyb3VuZC5zdHlsZS53ZWJraXRUcmFuc2Zvcm0gPSB0cmFuc2xhdGU7XHJcbiAgICAgIGJhY2tncm91bmQuc3R5bGUuTW96VHJhbnNmb3JtID0gdHJhbnNsYXRlO1xyXG4gICAgICBiYWNrZ3JvdW5kLnN0eWxlLm1zVHJhbnNmb3JtID0gdHJhbnNsYXRlO1xyXG4gICAgICBiYWNrZ3JvdW5kLnN0eWxlLk9UcmFuc2Zvcm0gPSB0cmFuc2xhdGU7XHJcbiAgICAgIGJhY2tncm91bmQuc3R5bGUudHJhbnNmb3JtID0gdHJhbnNsYXRlO1xyXG5cclxuICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShtb3ZlQmFja2dyb3VuZCk7XHJcbiAgICB9XHJcblxyXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlb3ZlcicsIGZ1bmN0aW9uIChlKSB7XHJcblxyXG4gICAgICB2YXIgbE1vdXNlWCA9IE1hdGgubWF4KC0xMDAsIE1hdGgubWluKDEwMCwgc2NyZWVuLndpZHRoIC8gMiAtIGUuY2xpZW50WCkpO1xyXG4gICAgICB2YXIgbE1vdXNlWSA9IE1hdGgubWF4KC0xMDAsIE1hdGgubWluKDEwMCwgc2NyZWVuLmhlaWdodCAvIDIgLSBlLmNsaWVudFkpKTtcclxuICAgICAgbEZvbGxvd1ggPSAoMjAgKiBsTW91c2VYKSAvIDEwMDsgLy8gMTAwIDogMTIgPSBsTW91eGVYIDogbEZvbGxvd1xyXG4gICAgICBsRm9sbG93WSA9ICgxMCAqIGxNb3VzZVkpIC8gMTAwO1xyXG5cclxuICAgIH0pO1xyXG4gICAgbW92ZUJhY2tncm91bmQoKTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIF9idXR0b24oKSB7XHJcbiAgICB2YXIgbGFuZGluZ2J1dHRvbiA9IFZSLmdldC5vbmUoJyNsYW5kaW5nYnV0dG9uJyk7XHJcbiAgICBsYW5kaW5nYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICBWUi5yb3V0ZXIuc2hvdygnI3RpbWVsaW5lJylcclxuICAgIH0pO1xyXG4gIH1cclxuICByZXR1cm4ge1xyXG4gICAgaW5pdDogaW5pdFxyXG4gIH07XHJcbn0pKCk7XHJcbiIsIlZSLnRpbWVsaW5lID0gKGZ1bmN0aW9uICgpIHsgLy9mdW50aW9uIHRvIHJlbmRlciBhIHRlbXBsYXRlLlxyXG4gIC8vcmVuZGVyIHRoZSB0ZW1wbGF0ZVxyXG4gIGxldCBfdmlkZW9zO1xyXG4gIGxldCBfc2VsZWN0ZWRWaWRlb0lkO1xyXG5cclxuICBmdW5jdGlvbiBpbml0KCkge1xyXG4gICAgLy8gci5fZ2V0RGF0YSgpO1xyXG4gICAgX2dldERhdGEoKTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIF9nZXREYXRhKCkge1xyXG5cclxuICAgIGxldCB2aWRlb0xpc3QgPSBWUi5nZXQub25lKCcudmlkZW8tbGlzdCcpO1xyXG4gICAgbGV0IHVybCA9IFZSLmdldC51cmxzKCdkYXRhLmpzb24nKS5kYXRhVXJsO1xyXG5cclxuICAgIFZSLmdldC5kYXRhKHVybCkudGhlbihyZXNwb25zZSA9PiB7XHJcbiAgICAgIF92aWRlb3MgPSBKU09OLnBhcnNlKHJlc3BvbnNlKTtcclxuXHJcbiAgICAgIHZpZGVvTGlzdC5hcHBlbmRDaGlsZChfZ2VuZXJhdGVUaW1lbGluZShfdmlkZW9zKSk7XHJcbiAgICAgIGNsaWNrVmlkZW8oKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gX2dlbmVyYXRlVGltZWxpbmUoZGF0YSkge1xyXG4gICAgbGV0IHZpZGVvTGlzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3VsJyk7XHJcblxyXG4gICAgZGF0YS52aWRlb3MuZm9yRWFjaChmdW5jdGlvbiAob2JqKSB7XHJcbiAgICAgIHZhciB2aWRlb0lkID0gT2JqZWN0LmtleXMob2JqKVswXTtcclxuXHJcbiAgICAgIGxldCBlbGVtZW50ID0gX2NyZWF0ZVZpZGVvRWxlbWVudChvYmoudGh1bWJuYWlsLCBvYmoudGl0bGUsIG9iai5kZXNjcmlwdGlvbiwgdmlkZW9JZCk7XHJcbiAgICAgIGNvbnNvbGUubG9nKG9iaik7XHJcbiAgICAgIHZpZGVvTGlzdC5pbm5lckhUTUwgKz0gZWxlbWVudDsgLy9hZGQgaXQgdG8gdGhlIHVsXHJcbiAgICB9KTtcclxuICAgIHJldHVybiB2aWRlb0xpc3Q7XHJcblxyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gX2NyZWF0ZVZpZGVvRWxlbWVudCh0dW1iVXJsLCB0aXRsZSwgZGVzY3JpcHRpb24sIHZpZGVvSWQpIHtcclxuICAgIGxldCB0dW1iVXJsR2VuZXJhdGVkID0gVlIuZ2V0LnVybHModHVtYlVybCkudHVtYlVybDtcclxuICAgIGxldCB2aWRlb1VybCA9IFZSLmdldC51cmxzKHR1bWJVcmwpLnR1bWJVcmw7XHJcbiAgICBjb25zb2xlLmxvZyh0dW1iVXJsKTtcclxuICAgIGxldCB2aWRlbyA9ICc8bGk+PGRpdiBjbGFzcz1cInZpZGVvLXdyYXBwZXJcIj4nO1xyXG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwidGh1bWJuYWlsLXdyYXBwZXJcIj4nXHJcbiAgICB2aWRlbyArPSAnXHRcdFx0XHRcdFx0PGltZyBjbGFzcz1cInRodW1ibmFpbFwiIHNyYz1cIicgKyB0dW1iVXJsR2VuZXJhdGVkICsgJ1wiPic7XHJcbiAgICB2aWRlbyArPSAnICBcdFx0XHRcdFx0PGRpdiBjbGFzcz1cIm1lZGlhLWNhcHRpb25cIj4nO1xyXG4gICAgdmlkZW8gKz0gJyAgXHRcdFx0XHRcdFx0PGRpdiBjbGFzcz1cImNhcHRpb24tY29udGVudFwiPic7XHJcbiAgICB2aWRlbyArPSAnICBcdFx0XHRcdFx0XHRcdDxoMj4nICsgdGl0bGUgKyAnPC9oMj4nO1xyXG4gICAgdmlkZW8gKz0gJyAgXHRcdFx0XHRcdFx0XHQ8c3Bhbj4nICsgZGVzY3JpcHRpb24gKyAnPC9zcGFuPic7XHJcbiAgICB2aWRlbyArPSAnICBcdFx0XHRcdFx0XHQ8L2Rpdj4nO1xyXG4gICAgdmlkZW8gKz0gJyAgICBcdFx0XHRcdDwvZGl2Pic7XHJcbiAgICB2aWRlbyArPSAnICBcdFx0XHRcdFx0PGRpdiBjbGFzcz1cInZpZGVvLXBsYXlcIiBkYXRhLXZpZGVvLWlkPVwiJyArIHZpZGVvSWQgKyAnXCJcIj4nO1xyXG4gICAgdmlkZW8gKz0gJyAgXHRcdFx0XHRcdDwvZGl2Pic7XHJcbiAgICB2aWRlbyArPSAnXHRcdFx0XHRcdDwvZGl2Pic7XHJcbiAgICB2aWRlbyArPSAnXHRcdFx0XHRcdDx2aWRlbyBhdXRvcGxheSBjb250cm9scyBzdHlsZT1cImRpc3BsYXk6bm9uZTtcIj4nO1xyXG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHRTb3JyeSwgeW91ciBicm93c2VyIGRvZXNudCBzdXBwb3J0IGVtYmVkZGVkIHZpZGVvcyc7XHJcbiAgICB2aWRlbyArPSAnXHRcdFx0XHRcdDwvdmlkZW8+JztcclxuICAgIHZpZGVvICs9ICc8L2Rpdj48L2xpPic7XHJcbiAgICByZXR1cm4gdmlkZW87XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBjbGlja1ZpZGVvKCkge1xyXG4gICAgVlIuZ2V0Lm9uZSgnLnZpZGVvLWxpc3QgdWwnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgIGlmIChlLnRhcmdldC5jbGFzc05hbWUgPT0gXCJ2aWRlby1wbGF5XCIpIHtcclxuXHJcbiAgICAgICAgX3NlbGVjdGVkVmlkZW9JZCA9IGUudGFyZ2V0LmRhdGFzZXQudmlkZW9JZDtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKF9zZWxlY3RlZFZpZGVvSWQpO1xyXG4gICAgICAgIHZhciBzZWxlY3RlZFZpZGVvID0gZ2V0VmlkZW8oX3NlbGVjdGVkVmlkZW9JZCk7XHJcbiAgICAgICAgY29uc29sZS5sb2coc2VsZWN0ZWRWaWRlbyk7XHJcbiAgICAgICAgc2VsZWN0ZWRWaWRlby5pZCA9IF9zZWxlY3RlZFZpZGVvSWQ7XHJcblxyXG5cclxuICAgICAgICAvLyBOYXZpZ2F0ZSB0byB0aGUgbWV0YSB2aWRlbyB2aWV3XHJcbiAgICAgICAgY29uc29sZS5sb2coJ05hdmlnYXRlIHRvIHRoZSBtZXRhIHZpZGVvIHZpZXcnKTtcclxuXHJcbiAgICAgICAgLy8gZ290b1NlY3Rpb24oJ3ZpZGVvLW1ldGEnKTtcclxuICAgICAgICBWUi5yb3V0ZXIuc2hvdygnI3ZpZGVvJyk7XHJcbiAgICAgICAgcmVuZGVyVmlkZW9NZXRhRGF0YShzZWxlY3RlZFZpZGVvKTtcclxuXHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gY2xpY2tNZXRhVmlkZW8oKSB7XHJcbiAgICBWUi5nZXQub25lKCcjbWV0YS12aWRlby1wbGF5JykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICB2YXIgc2VsZWN0ZWRWaWRlb0lkID0gZS50YXJnZXQuZGF0YXNldC52aWRlb0lkO1xyXG4gICAgICB2YXIgc2VsZWN0ZWRWaWRlbyA9IGdldFZpZGVvKHNlbGVjdGVkVmlkZW9JZClbc2VsZWN0ZWRWaWRlb0lkXTtcclxuXHJcbiAgICAgIC8vIFBsYXkgdGhlIHZpZGVvXHJcbiAgICAgIGNvbnNvbGUubG9nKCdQbGF5IHRlIHZpZGVvJyk7XHJcbiAgICAgIGNvbnNvbGUubG9nKHNlbGVjdGVkVmlkZW8pO1xyXG4gICAgICB2YXIgbWV0YVZpZGVvRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhLXZpZGVvJyk7XHJcbiAgICAgIG1ldGFWaWRlb0VsZW1lbnQuc3JjID0gJ21lZGlhL3ZpZGVvLycgKyBzZWxlY3RlZFZpZGVvO1xyXG4gICAgICBtZXRhVmlkZW9FbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xyXG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdtZXRhLXRodW1ibmFpbC13cmFwcGVyJylbMF0uc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcblxyXG4gIGZ1bmN0aW9uIGNsaWNrQ2xvc2VNZXRhKCl7XHJcbiAgXHRWUi5nZXQub25lKCcuY2xvc2UnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgIFZSLnJvdXRlci5zaG93KCcjdGltZWxpbmUnKTtcclxuICAgICAgdmFyIHZpZGVvRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhLXZpZGVvJyk7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdjaGVjaycpXHJcbiAgICAgIGNvbnNvbGUubG9nKHZpZGVvRWxlbWVudC5wYXVzZSgpKVxyXG4gICAgICBjb25zb2xlLmxvZyh2aWRlb0VsZW1lbnQpXHJcbiAgICAgIHZpZGVvRWxlbWVudC5wYXVzZSgpO1xyXG4gICAgICB2aWRlb0VsZW1lbnQuY3VycmVudFRpbWUgPSAwO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZW5kZXJzIHRoZSB2aWRlbyBtZXRhIGRhdGEgaW4gdGhlIHZpZGVvLW1ldGEgc2VjdGlvblxyXG4gICAqXHJcbiAgICogQHBhcmFtICAgICAge29ian0gIHNlbGVjdGVkVmlkZW8gIFRoZSBzZWxlY3RlZCB2aWRlb1xyXG4gICAqL1xyXG4gIGZ1bmN0aW9uIHJlbmRlclZpZGVvTWV0YURhdGEoc2VsZWN0ZWRWaWRlbykge1xyXG4gICAgY29uc29sZS5sb2coc2VsZWN0ZWRWaWRlbyk7XHJcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YS12aWRlby1wbGF5Jykuc2V0QXR0cmlidXRlKCdkYXRhLXZpZGVvLWlkJywgc2VsZWN0ZWRWaWRlby5pZCk7XHJcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmlkZW8tdGl0bGUnKS5pbm5lckhUTUwgPSBzZWxlY3RlZFZpZGVvLnRpdGxlO1xyXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rlc2NyaXB0aW9uJykuaW5uZXJIVE1MID0gc2VsZWN0ZWRWaWRlby5kZXNjcmlwdGlvbjtcclxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkYXRlLWFsaWFzJykuaW5uZXJIVE1MID0gc2VsZWN0ZWRWaWRlby5kYXRlYWxpYXM7XHJcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YS10aHVtYm5haWwnKS5zcmMgPSAnbWVkaWEvdGh1bWJuYWlscy8nICsgc2VsZWN0ZWRWaWRlby50aHVtYm5haWw7XHJcbiAgICBjbGlja01ldGFWaWRlbygpO1xyXG4gICAgY2xpY2tDbG9zZU1ldGEoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldHMgdGhlIHZpZGVvLlxyXG4gICAqXHJcbiAgICogQHBhcmFtICAgICAgc3RyaW5nIHZpZGVvSWQgIFRoZSB2aWRlbyBpZGVudGlmaWVyXHJcbiAgICogQHJldHVybiAgICAgb2JqICBUaGUgdmlkZW8uXHJcbiAgICovXHJcbiAgZnVuY3Rpb24gZ2V0VmlkZW8odmlkZW9JZCkge1xyXG4gICAgdmFyIHNlbGVjdGVkVmlkZW87XHJcbiAgICBjb25zb2xlLmxvZyhfdmlkZW9zKTtcclxuICAgIF92aWRlb3MudmlkZW9zLnNvbWUoZnVuY3Rpb24gKGVsbSwgaW5kZXgpIHtcclxuICAgICAgaWYgKGVsbVt2aWRlb0lkXSkge1xyXG4gICAgICAgIHNlbGVjdGVkVmlkZW8gPSBlbG07XHJcbiAgICAgIH1cclxuICAgIH0pXHJcbiAgICByZXR1cm4gc2VsZWN0ZWRWaWRlbztcclxuICB9XHJcblxyXG5cclxuICByZXR1cm4ge1xyXG4gICAgaW5pdDogaW5pdFxyXG4gIH07XHJcblxyXG59KSgpO1xyXG4iXX0=
