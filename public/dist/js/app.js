"use strict";var VR=VR||{};VR.get=function(){function t(t){var e="",n=e+"media/thumbnails/"+t,a=e+"media/video/"+t,i=e+"data/"+t;return{base:e,tumbUrl:n,videoUrl:a,dataUrl:i}}function e(t){return document.querySelector(t)}function n(t){return document.querySelectorAll(t)}function a(t){return new Promise(function(e,n){var a=new XMLHttpRequest;a.open("GET",t),a.onloadstart=function(){i(!0)},a.onloadend=function(){i(!0)},a.onload=function(){var t=200;a.status==t?(i(!1),e(a.responseText)):(n(new Error("request failed!")),console.log("There went something wrong"))},a.send()})}function i(t){var e=1e3;t?VR.get.one(".loading").classList.remove("disabled"):setTimeout(function(){VR.get.one(".loading").classList.add("disabled")},e)}return{urls:t,one:e,all:n,data:a,loading:i}}(),VR.date=function(){function t(t){var n=new Date(t),a=e.months[n.getMonth()],i=n.getDate(),r=e.days[n.getDay()],o=n.getFullYear();return r+" "+i+" "+a+" "+o}var e={days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],months:["January","February","March","April","May","June","July","August","September","October","November","December"]};return{readableDate:t}}(),VR.router=function(){function t(t){var e=VR.get.all(".page"),n=VR.get.one(t);e.forEach(function(t){t.classList.add("disabled")}),n.classList.remove("disabled"),"#cardboard"===t?VR.V3d.init():"#landing"===t?VR.landing.init():"#video"===t?console.log("hiosd"):"#timeline"===t&&VR.timeline.init()}return{show:t}}(),VR.landing=function(){function t(t){n(),e(),VR.get.loading(!1)}function e(){function t(){a+=(e-a)*r,i+=(n-i)*r;var o="translate("+a+"px, "+i+"px) scale(1.1)",s=VR.get.one(".bg");s.style.webkitTransform=o,s.style.MozTransform=o,s.style.msTransform=o,s.style.OTransform=o,s.style.transform=o,window.requestAnimationFrame(t)}var e=0,n=0,a=0,i=0,r=1/30;window.addEventListener("mouseover",function(t){var a=Math.max(-100,Math.min(100,screen.width/2-t.clientX)),i=Math.max(-100,Math.min(100,screen.height/2-t.clientY));e=20*a/100,n=10*i/100}),t()}function n(){var t=VR.get.one("#landingbutton");t.addEventListener("click",function(){VR.router.show("#timeline")})}return{init:t}}(),VR.timeline=function(){function t(){e()}function e(){var t=VR.get.one(".video-list"),e=VR.get.urls("data.json").dataUrl;VR.get.data(e).then(function(e){var a=JSON.parse(e);i=a,t.appendChild(n(a))})}function n(t){var e=document.createElement("ul");return t.videos.forEach(function(t){var n=Object.keys(t)[0],i=a(t.thumbnail,t.title,t.description,n);e.innerHTML+=i}),e}function a(t,e,n,a){var i=VR.get.urls(t).tumbUrl,r=(VR.get.urls(t).tumbUrl,'<li><div class="video-wrapper">');return r+='\t\t\t\t\t<div class="thumbnail-wrapper">',r+='\t\t\t\t\t\t<img class="thumbnail" src="'+i+'">',r+='  \t\t\t\t\t<div class="media-caption">',r+='  \t\t\t\t\t\t<div class="caption-content">',r+="  \t\t\t\t\t\t\t<h2>"+e+"</h2>",r+="  \t\t\t\t\t\t\t<span>"+n+"</span>",r+="  \t\t\t\t\t\t</div>",r+="    \t\t\t\t</div>",r+='  \t\t\t\t\t<div class="video-play" data-video-id="'+a+'"">',r+="  \t\t\t\t\t</div>",r+="\t\t\t\t\t</div>",r+='\t\t\t\t\t<video autoplay controls style="display:none;">',r+="\t\t\t\t\tSorry, your browser doesnt support embedded videos",r+="\t\t\t\t\t</video>",r+="</div></li>"}var i={};return{init:t}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsIlZSc3RhcnQuanMiLCJWUmhlbHBlci5qcyIsIlZSZGF0ZS5qcyIsIlZScm91dGVyLmpzIiwiVlJsYW5kaW5nLmpzIiwiVlJ0aW1lbGluZS5qcyJdLCJuYW1lcyI6WyJWUiIsImdldCIsInVybHMiLCJ1cmwiLCJiYXNlIiwidHVtYlVybCIsInZpZGVvVXJsIiwiZGF0YVVybCIsIm9uZSIsInNlbGVjdG9yIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiYWxsIiwicXVlcnlTZWxlY3RvckFsbCIsImRhdGEiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsInJlcXVlc3QiLCJYTUxIdHRwUmVxdWVzdCIsIm9wZW4iLCJvbmxvYWRzdGFydCIsImxvYWRpbmciLCJvbmxvYWRlbmQiLCJvbmxvYWQiLCJzdGF0dXNDb2RlIiwic3RhdHVzIiwicmVzcG9uc2VUZXh0IiwiRXJyb3IiLCJjb25zb2xlIiwibG9nIiwic2VuZCIsInNob3ciLCJkZWxheVRpbWUiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJzZXRUaW1lb3V0IiwiYWRkIiwiZGF0ZSIsInJlYWRhYmxlRGF0ZSIsInVuZnJvbWF0ZWREYXRlIiwibmV3RGF0ZSIsIkRhdGUiLCJtb250aCIsImRhdGVzIiwibW9udGhzIiwiZ2V0TW9udGgiLCJnZXREYXRlIiwiZGF5IiwiZGF5cyIsImdldERheSIsInllYXIiLCJnZXRGdWxsWWVhciIsInJvdXRlciIsImlkIiwicGFnZXMiLCJzZWxlY3RlZFBhZ2UiLCJmb3JFYWNoIiwicGFnZSIsIlYzZCIsImluaXQiLCJsYW5kaW5nIiwidGltZWxpbmUiLCJfYnV0dG9uIiwiYmFja2dyb3VuZCIsIm1vdmVCYWNrZ3JvdW5kIiwieCIsImxGb2xsb3dYIiwiZnJpY3Rpb24iLCJ5IiwibEZvbGxvd1kiLCJ0cmFuc2xhdGUiLCJzdHlsZSIsIndlYmtpdFRyYW5zZm9ybSIsIk1velRyYW5zZm9ybSIsIm1zVHJhbnNmb3JtIiwiT1RyYW5zZm9ybSIsInRyYW5zZm9ybSIsIndpbmRvdyIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwibE1vdXNlWCIsIk1hdGgiLCJtYXgiLCJtaW4iLCJzY3JlZW4iLCJ3aWR0aCIsImNsaWVudFgiLCJsTW91c2VZIiwiaGVpZ2h0IiwiY2xpZW50WSIsImxhbmRpbmdidXR0b24iLCJfZ2V0RGF0YSIsInZpZGVvTGlzdCIsInRoZW4iLCJyZXNwb25zZSIsInBhcnNlZCIsIkpTT04iLCJwYXJzZSIsInRpbWVsaW5lRGF0YSIsImFwcGVuZENoaWxkIiwiX2dlbmVyYXRlVGltZWxpbmUiLCJjcmVhdGVFbGVtZW50IiwidmlkZW9zIiwib2JqIiwidmlkZW9JZCIsIk9iamVjdCIsImtleXMiLCJlbGVtZW50IiwiX2NyZWF0ZVZpZGVvRWxlbWVudCIsInRodW1ibmFpbCIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJpbm5lckhUTUwiLCJ0dW1iVXJsR2VuZXJhdGVkIiwidmlkZW8iXSwibWFwcGluZ3MiOiJBQUFBLFlDQUEsSUFBQUEsSUFBQUEsTUNDQUEsSUFBQUMsSUFBQSxXQUNBLFFBQUFDLEdBQUFDLEdBR0EsR0FBQUMsR0FBQSxHQUNBQyxFQUFBRCxFQUFBLG9CQUFBRCxFQUNBRyxFQUFBRixFQUFBLGVBQUFELEVBQ0FJLEVBQUFILEVBQUEsUUFBQUQsQ0FFQSxRQUNBQyxLQUFBQSxFQUNBQyxRQUFBQSxFQUNBQyxTQUFBQSxFQUNBQyxRQUFBQSxHQUlBLFFBQUFDLEdBQUFDLEdBQ0EsTUFBQUMsVUFBQUMsY0FBQUYsR0FHQSxRQUFBRyxHQUFBSCxHQUNBLE1BQUFDLFVBQUFHLGlCQUFBSixHQUdBLFFBQUFLLEdBQUFYLEdBRUEsTUFBQSxJQUFBWSxTQUFBLFNBQUFDLEVBQUFDLEdBQ0EsR0FBQUMsR0FBQSxHQUFBQyxlQUVBRCxHQUFBRSxLQUFBLE1BQUFqQixHQUNBZSxFQUFBRyxZQUFBLFdBQ0FDLEdBQUEsSUFFQUosRUFBQUssVUFBQSxXQUNBRCxHQUFBLElBSUFKLEVBQUFNLE9BQUEsV0FF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LEdBQUFDLElBQUFPLElBQUEsZUFDQUwsRUFBQUgsR0FBQUMsSUFBQUMsS0FBQSxhQUFBSyxPQUVBUCxJQUFBQyxJQUFBYSxLQUFBWCxHQUFBNEYsS0FBQSxTQUFBQyxHQUNBLEdBQUFDLEdBQUFDLEtBQUFDLE1BQUFILEVBQ0FJLEdBQUFILEVBQ0FILEVBQUFPLFlBQUFDLEVBQUFMLE1BSUEsUUFBQUssR0FBQXhGLEdBQ0EsR0FBQWdGLEdBQUFwRixTQUFBNkYsY0FBQSxLQVNBLE9BUEF6RixHQUFBMEYsT0FBQS9DLFFBQUEsU0FBQWdELEdBQ0EsR0FBQUMsR0FBQUMsT0FBQUMsS0FBQUgsR0FBQSxHQUVBSSxFQUFBQyxFQUFBTCxFQUFBTSxVQUFBTixFQUFBTyxNQUFBUCxFQUFBUSxZQUFBUCxFQUVBWixHQUFBb0IsV0FBQUwsSUFFQWYsRUFJQSxRQUFBZ0IsR0FBQXpHLEVBQUEyRyxFQUFBQyxFQUFBUCxHQUNBLEdBQUFTLEdBQUFuSCxHQUFBQyxJQUFBQyxLQUFBRyxHQUFBQSxRQUdBK0csR0FGQXBILEdBQUFDLElBQUFDLEtBQUFHLEdBQUFBLFFBRUEsa0NBZ0JBLE9BZkErRyxJQUFBLDRDQUNBQSxHQUFBLDJDQUFBRCxFQUFBLEtBQ0FDLEdBQUEsMENBQ0FBLEdBQUEsOENBQ0FBLEdBQUEsdUJBQUFKLEVBQUEsUUFDQUksR0FBQSx5QkFBQUgsRUFBQSxVQUNBRyxHQUFBLHVCQUNBQSxHQUFBLHFCQUNBQSxHQUFBLHNEQUFBVixFQUFBLE1BQ0FVLEdBQUEscUJBQ0FBLEdBQUEsbUJBQ0FBLEdBQUEsNERBQ0FBLEdBQUEsK0RBQ0FBLEdBQUEscUJBQ0FBLEdBQUEsY0F0REEsR0FFQWhCLEtBb0tBLFFBQ0F4QyxLQUFBQSIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbnZhciBWUiA9IFZSIHx8IHt9O1xuJ3VzZSBzdHJpY3QnO1xuXG4vL1RvIGVhc2lseSBzZWxlY3Qgc29tZXRoaW5nIGZyb20gdGhlIERPTVxuVlIuZ2V0ID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiB1cmxzKHVybCkge1xuXG4gICAgLy8gbGV0IGJhc2UgPSAnL1ZSTGlmZW9mSmVzdXMvJztcbiAgICB2YXIgYmFzZSA9ICcnO1xuICAgIHZhciB0dW1iVXJsID0gYmFzZSArICdtZWRpYS90aHVtYm5haWxzLycgKyB1cmw7XG4gICAgdmFyIHZpZGVvVXJsID0gYmFzZSArICdtZWRpYS92aWRlby8nICsgdXJsO1xuICAgIHZhciBkYXRhVXJsID0gYmFzZSArICdkYXRhLycgKyB1cmw7XG5cbiAgICByZXR1cm4ge1xuICAgICAgYmFzZTogYmFzZSxcbiAgICAgIHR1bWJVcmw6IHR1bWJVcmwsXG4gICAgICB2aWRlb1VybDogdmlkZW9VcmwsXG4gICAgICBkYXRhVXJsOiBkYXRhVXJsXG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG9uZShzZWxlY3Rvcikge1xuICAgIC8vVGhpcyBpcyBhIG1ldGhvZFxuICAgIHJldHVybiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGFsbChzZWxlY3Rvcikge1xuICAgIHJldHVybiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGRhdGEodXJsKSB7XG4gICAgLy8gcmV0dXJuIGEgUHJvbWlzZSBvYmplY3RcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgdmFyIHJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgIC8vb3BlbiBhbiBnZXQgcmVxdWVzdFxuICAgICAgcmVxdWVzdC5vcGVuKCdHRVQnLCB1cmwpO1xuICAgICAgcmVxdWVzdC5vbmxvYWRzdGFydCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbG9hZGluZyh0cnVlKTtcbiAgICAgIH07XG4gICAgICByZXF1ZXN0Lm9ubG9hZGVuZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbG9hZGluZyh0cnVlKTtcbiAgICAgIH07XG5cbiAgICAgIC8vaWYgdGhlIHJlcXVlc3QgaXMgZG9uZVxuICAgICAgcmVxdWVzdC5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vb255IGlmIHJlcXVlc3QgaXMgZG9uZVxuICAgICAgICB2YXIgc3RhdHVzQ29kZSA9IDIwMDtcbiAgICAgICAgaWYgKHJlcXVlc3Quc3RhdHVzID09IHN0YXR1c0NvZGUpIHtcbiAgICAgICAgICBsb2FkaW5nKGZhbHNlKTtcblxuICAgICAgICAgIC8vIHNlbmQgdGV4dCBmb3JtIHJlcXVlc3RcbiAgICAgICAgICByZXNvbHZlKHJlcXVlc3QucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyByZWplY3QgdGhlIHByb21pc2UgaWYgdGhlcmUgaXMgYSBlcnJcbiAgICAgICAgICByZWplY3QobmV3IEVycm9yKCdyZXF1ZXN0IGZhaWxlZCEnKSk7XG4gICAgICAgICAgY29uc29sZS5sb2coJ1RoZXJlIHdlbnQgc29tZXRoaW5nIHdyb25nJyk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICAvL3NlbmQgdGhlIHJlcXVlc3RcbiAgICAgIHJlcXVlc3Quc2VuZCgpO1xuICAgIH0pO1xuICB9XG4gIC8vIHNob3cgb3IgaGlkZSB0aGUgbG9hZGluZyBzcGlubmVyXG4gIGZ1bmN0aW9uIGxvYWRpbmcoc2hvdykge1xuICAgIHZhciBkZWxheVRpbWUgPSAxMDAwO1xuICAgIGlmIChzaG93KSB7XG4gICAgICBWUi5nZXQub25lKCcubG9hZGluZycpLmNsYXNzTGlzdC5yZW1vdmUoJ2Rpc2FibGVkJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vc2hvdyBsb2FkaW5nXG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgVlIuZ2V0Lm9uZSgnLmxvYWRpbmcnKS5jbGFzc0xpc3QuYWRkKCdkaXNhYmxlZCcpO1xuICAgICAgfSwgZGVsYXlUaW1lKTsgLy9hZGQgYSBkZWxheSBiZWNhdXNlIHlvdSB3b24ndCBzZWUgaXQgd2l0aCBmYXN0IGludGVybmV0LlxuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7IC8vcmV0dXJuIG9ubHkgdGhlIGZ1bnRpb25zIHRoYXQgYXJlIG5lc3NlZXJpeVxuICAgIHVybHM6IHVybHMsXG4gICAgb25lOiBvbmUsXG4gICAgYWxsOiBhbGwsXG4gICAgZGF0YTogZGF0YSxcbiAgICBsb2FkaW5nOiBsb2FkaW5nXG4gIH07XG59KCk7XG5cbi8vVG8gZWFzaWx5IHNlbGVjdCBzb21ldGhpbmcgZnJvbSB0aGUgRE9NXG5WUi5kYXRlID0gZnVuY3Rpb24gKCkge1xuICB2YXIgZGF0ZXMgPSB7XG4gICAgZGF5czogWydTdW5kYXknLCAnTW9uZGF5JywgJ1R1ZXNkYXknLCAnV2VkbmVzZGF5JywgJ1RodXJzZGF5JywgJ0ZyaWRheScsICdTYXR1cmRheSddLFxuICAgIG1vbnRoczogWydKYW51YXJ5JywgJ0ZlYnJ1YXJ5JywgJ01hcmNoJywgJ0FwcmlsJywgJ01heScsICdKdW5lJywgJ0p1bHknLCAnQXVndXN0JywgJ1NlcHRlbWJlcicsICdPY3RvYmVyJywgJ05vdmVtYmVyJywgJ0RlY2VtYmVyJ11cbiAgfTtcblxuICBmdW5jdGlvbiByZWFkYWJsZURhdGUodW5mcm9tYXRlZERhdGUpIHtcbiAgICB2YXIgbmV3RGF0ZSA9IG5ldyBEYXRlKHVuZnJvbWF0ZWREYXRlKTtcbiAgICB2YXIgbW9udGggPSBkYXRlcy5tb250aHNbbmV3RGF0ZS5nZXRNb250aCgpXTtcbiAgICB2YXIgZGF0ZSA9IG5ld0RhdGUuZ2V0RGF0ZSgpO1xuICAgIHZhciBkYXkgPSBkYXRlcy5kYXlzW25ld0RhdGUuZ2V0RGF5KCldO1xuICAgIHZhciB5ZWFyID0gbmV3RGF0ZS5nZXRGdWxsWWVhcigpO1xuXG4gICAgcmV0dXJuIGRheSArICcgJyArIGRhdGUgKyAnICcgKyBtb250aCArICcgJyArIHllYXI7XG4gIH1cblxuICByZXR1cm4geyAvL3JldHVybiBvbmx5IHRoZSBmdW50aW9ucyB0aGF0IGFyZSBuZXNzZWVyaXlcbiAgICByZWFkYWJsZURhdGU6IHJlYWRhYmxlRGF0ZVxuICB9O1xufSgpO1xuXG5WUi5yb3V0ZXIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIHNob3coaWQpIHtcbiAgICB2YXIgcGFnZXMgPSBWUi5nZXQuYWxsKCcucGFnZScpO1xuICAgIHZhciBzZWxlY3RlZFBhZ2UgPSBWUi5nZXQub25lKGlkKTtcblxuICAgIC8vZGlzYWJsZSBhbGwgdGhlIHBhZ2VzXG4gICAgcGFnZXMuZm9yRWFjaChmdW5jdGlvbiAocGFnZSkge1xuICAgICAgcGFnZS5jbGFzc0xpc3QuYWRkKCdkaXNhYmxlZCcpO1xuICAgIH0pO1xuXG4gICAgc2VsZWN0ZWRQYWdlLmNsYXNzTGlzdC5yZW1vdmUoJ2Rpc2FibGVkJyk7XG5cbiAgICBpZiAoaWQgPT09ICcjY2FyZGJvYXJkJykge1xuICAgICAgVlIuVjNkLmluaXQoKTtcbiAgICB9IGVsc2UgaWYgKGlkID09PSAnI2xhbmRpbmcnKSB7XG5cbiAgICAgIFZSLmxhbmRpbmcuaW5pdCgpO1xuICAgIH0gZWxzZSBpZiAoaWQgPT09ICcjdmlkZW8nKSB7XG4gICAgICBjb25zb2xlLmxvZygnaGlvc2QnKTtcbiAgICAgIC8vIFZSLnJlbmRlci5pbml0KCk7XG4gICAgfSBlbHNlIGlmIChpZCA9PT0gJyN0aW1lbGluZScpIHtcbiAgICAgIFZSLnRpbWVsaW5lLmluaXQoKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHtcbiAgICBzaG93OiBzaG93XG4gIH07XG59KCk7XG5cblZSLmxhbmRpbmcgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIGluaXQoaWQpIHtcblxuICAgIF9idXR0b24oKTtcbiAgICBiYWNrZ3JvdW5kKCk7XG4gICAgVlIuZ2V0LmxvYWRpbmcoZmFsc2UpO1xuICB9XG5cbiAgZnVuY3Rpb24gYmFja2dyb3VuZCgpIHtcbiAgICB2YXIgbEZvbGxvd1ggPSAwLFxuICAgICAgICBsRm9sbG93WSA9IDAsXG4gICAgICAgIHggPSAwLFxuICAgICAgICB5ID0gMCxcbiAgICAgICAgZnJpY3Rpb24gPSAxIC8gMzA7XG5cbiAgICBmdW5jdGlvbiBtb3ZlQmFja2dyb3VuZCgpIHtcbiAgICAgIHggKz0gKGxGb2xsb3dYIC0geCkgKiBmcmljdGlvbjtcbiAgICAgIHkgKz0gKGxGb2xsb3dZIC0geSkgKiBmcmljdGlvbjtcblxuICAgICAgdmFyIHRyYW5zbGF0ZSA9ICd0cmFuc2xhdGUoJyArIHggKyAncHgsICcgKyB5ICsgJ3B4KSBzY2FsZSgxLjEpJztcblxuICAgICAgdmFyIGJhY2tncm91bmQgPSBWUi5nZXQub25lKCcuYmcnKTtcblxuICAgICAgLy8gYmFja2dyb3VuZC5zdHlsZVsnLXdlYml0LXRyYW5zZm9ybSddID0gdHJhbnNsYXRlO1xuICAgICAgLy8gYmFja2dyb3VuZC5zdHlsZVsnLW1vei10cmFuc2Zvcm0nXSA9IHRyYW5zbGF0ZTtcbiAgICAgIGJhY2tncm91bmQuc3R5bGUud2Via2l0VHJhbnNmb3JtID0gdHJhbnNsYXRlO1xuICAgICAgYmFja2dyb3VuZC5zdHlsZS5Nb3pUcmFuc2Zvcm0gPSB0cmFuc2xhdGU7XG4gICAgICBiYWNrZ3JvdW5kLnN0eWxlLm1zVHJhbnNmb3JtID0gdHJhbnNsYXRlO1xuICAgICAgYmFja2dyb3VuZC5zdHlsZS5PVHJhbnNmb3JtID0gdHJhbnNsYXRlO1xuICAgICAgYmFja2dyb3VuZC5zdHlsZS50cmFuc2Zvcm0gPSB0cmFuc2xhdGU7XG5cbiAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUobW92ZUJhY2tncm91bmQpO1xuICAgIH1cblxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW92ZXInLCBmdW5jdGlvbiAoZSkge1xuXG4gICAgICB2YXIgbE1vdXNlWCA9IE1hdGgubWF4KC0xMDAsIE1hdGgubWluKDEwMCwgc2NyZWVuLndpZHRoIC8gMiAtIGUuY2xpZW50WCkpO1xuICAgICAgdmFyIGxNb3VzZVkgPSBNYXRoLm1heCgtMTAwLCBNYXRoLm1pbigxMDAsIHNjcmVlbi5oZWlnaHQgLyAyIC0gZS5jbGllbnRZKSk7XG4gICAgICBsRm9sbG93WCA9IDIwICogbE1vdXNlWCAvIDEwMDsgLy8gMTAwIDogMTIgPSBsTW91eGVYIDogbEZvbGxvd1xuICAgICAgbEZvbGxvd1kgPSAxMCAqIGxNb3VzZVkgLyAxMDA7XG4gICAgfSk7XG4gICAgbW92ZUJhY2tncm91bmQoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9idXR0b24oKSB7XG4gICAgdmFyIGxhbmRpbmdidXR0b24gPSBWUi5nZXQub25lKCcjbGFuZGluZ2J1dHRvbicpO1xuICAgIGxhbmRpbmdidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICBWUi5yb3V0ZXIuc2hvdygnI3RpbWVsaW5lJyk7XG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIHtcbiAgICBpbml0OiBpbml0XG4gIH07XG59KCk7XG5cblZSLnRpbWVsaW5lID0gZnVuY3Rpb24gKCkge1xuICAvL2Z1bnRpb24gdG8gcmVuZGVyIGEgdGVtcGxhdGUuXG4gIC8vcmVuZGVyIHRoZSB0ZW1wbGF0ZVxuICB2YXIgX3ZpZGVvcyA9IHZvaWQgMDtcbiAgdmFyIF9zZWxlY3RlZFZpZGVvSWQgPSB2b2lkIDAsXG4gICAgICB0aW1lbGluZURhdGEgPSB7fTtcblxuICAvL3JlbmRlciB0aGUgdGVtcGxhdGVcbiAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAvLyByLl9nZXREYXRhKCk7XG4gICAgX2dldERhdGEoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9nZXREYXRhKCkge1xuICAgIHZhciB2aWRlb0xpc3QgPSBWUi5nZXQub25lKCcudmlkZW8tbGlzdCcpO1xuICAgIHZhciB1cmwgPSBWUi5nZXQudXJscygnZGF0YS5qc29uJykuZGF0YVVybDtcblxuICAgIFZSLmdldC5kYXRhKHVybCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgIHZhciBwYXJzZWQgPSBKU09OLnBhcnNlKHJlc3BvbnNlKTtcbiAgICAgIHRpbWVsaW5lRGF0YSA9IHBhcnNlZDtcbiAgICAgIHZpZGVvTGlzdC5hcHBlbmRDaGlsZChfZ2VuZXJhdGVUaW1lbGluZShwYXJzZWQpKTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9nZW5lcmF0ZVRpbWVsaW5lKGRhdGEpIHtcbiAgICB2YXIgdmlkZW9MaXN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndWwnKTtcblxuICAgIGRhdGEudmlkZW9zLmZvckVhY2goZnVuY3Rpb24gKG9iaikge1xuICAgICAgdmFyIHZpZGVvSWQgPSBPYmplY3Qua2V5cyhvYmopWzBdO1xuXG4gICAgICB2YXIgZWxlbWVudCA9IF9jcmVhdGVWaWRlb0VsZW1lbnQob2JqLnRodW1ibmFpbCwgb2JqLnRpdGxlLCBvYmouZGVzY3JpcHRpb24sIHZpZGVvSWQpO1xuICAgICAgLy8gY29uc29sZS5sb2cob2JqKTtcbiAgICAgIHZpZGVvTGlzdC5pbm5lckhUTUwgKz0gZWxlbWVudDsgLy9hZGQgaXQgdG8gdGhlIHVsXG4gICAgfSk7XG4gICAgcmV0dXJuIHZpZGVvTGlzdDtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9jcmVhdGVWaWRlb0VsZW1lbnQodHVtYlVybCwgdGl0bGUsIGRlc2NyaXB0aW9uLCB2aWRlb0lkKSB7XG4gICAgdmFyIHR1bWJVcmxHZW5lcmF0ZWQgPSBWUi5nZXQudXJscyh0dW1iVXJsKS50dW1iVXJsO1xuICAgIHZhciB2aWRlb1VybCA9IFZSLmdldC51cmxzKHR1bWJVcmwpLnR1bWJVcmw7XG4gICAgLy8gY29uc29sZS5sb2codHVtYlVybCk7XG4gICAgdmFyIHZpZGVvID0gJzxsaT48ZGl2IGNsYXNzPVwidmlkZW8td3JhcHBlclwiPic7XG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwidGh1bWJuYWlsLXdyYXBwZXJcIj4nO1xuICAgIHZpZGVvICs9ICdcdFx0XHRcdFx0XHQ8aW1nIGNsYXNzPVwidGh1bWJuYWlsXCIgc3JjPVwiJyArIHR1bWJVcmxHZW5lcmF0ZWQgKyAnXCI+JztcbiAgICB2aWRlbyArPSAnICBcdFx0XHRcdFx0PGRpdiBjbGFzcz1cIm1lZGlhLWNhcHRpb25cIj4nO1xuICAgIHZpZGVvICs9ICcgIFx0XHRcdFx0XHRcdDxkaXYgY2xhc3M9XCJjYXB0aW9uLWNvbnRlbnRcIj4nO1xuICAgIHZpZGVvICs9ICcgIFx0XHRcdFx0XHRcdFx0PGgyPicgKyB0aXRsZSArICc8L2gyPic7XG4gICAgdmlkZW8gKz0gJyAgXHRcdFx0XHRcdFx0XHQ8c3Bhbj4nICsgZGVzY3JpcHRpb24gKyAnPC9zcGFuPic7XG4gICAgdmlkZW8gKz0gJyAgXHRcdFx0XHRcdFx0PC9kaXY+JztcbiAgICB2aWRlbyArPSAnICAgIFx0XHRcdFx0PC9kaXY+JztcbiAgICB2aWRlbyArPSAnICBcdFx0XHRcdFx0PGRpdiBjbGFzcz1cInZpZGVvLXBsYXlcIiBkYXRhLXZpZGVvLWlkPVwiJyArIHZpZGVvSWQgKyAnXCJcIj4nO1xuICAgIHZpZGVvICs9ICcgIFx0XHRcdFx0XHQ8L2Rpdj4nO1xuICAgIHZpZGVvICs9ICdcdFx0XHRcdFx0PC9kaXY+JztcbiAgICB2aWRlbyArPSAnXHRcdFx0XHRcdDx2aWRlbyBhdXRvcGxheSBjb250cm9scyBzdHlsZT1cImRpc3BsYXk6bm9uZTtcIj4nO1xuICAgIHZpZGVvICs9ICdcdFx0XHRcdFx0U29ycnksIHlvdXIgYnJvd3NlciBkb2VzbnQgc3VwcG9ydCBlbWJlZGRlZCB2aWRlb3MnO1xuICAgIHZpZGVvICs9ICdcdFx0XHRcdFx0PC92aWRlbz4nO1xuICAgIHZpZGVvICs9ICc8L2Rpdj48L2xpPic7XG4gICAgcmV0dXJuIHZpZGVvO1xuICB9XG5cbiAgZnVuY3Rpb24gY2xpY2tWaWRlbygpIHtcbiAgICBWUi5nZXQub25lKCcudmlkZW8tbGlzdCB1bCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgIGlmIChlLnRhcmdldC5jbGFzc05hbWUgPT0gXCJ2aWRlby1wbGF5XCIpIHtcblxuICAgICAgICBfc2VsZWN0ZWRWaWRlb0lkID0gZS50YXJnZXQuZGF0YXNldC52aWRlb0lkO1xuICAgICAgICBjb25zb2xlLmxvZyhfc2VsZWN0ZWRWaWRlb0lkKTtcbiAgICAgICAgdmFyIHNlbGVjdGVkVmlkZW8gPSBnZXRWaWRlbyhfc2VsZWN0ZWRWaWRlb0lkKTtcbiAgICAgICAgY29uc29sZS5sb2coc2VsZWN0ZWRWaWRlbyk7XG4gICAgICAgIHNlbGVjdGVkVmlkZW8uaWQgPSBfc2VsZWN0ZWRWaWRlb0lkO1xuXG4gICAgICAgIC8vIE5hdmlnYXRlIHRvIHRoZSBtZXRhIHZpZGVvIHZpZXdcbiAgICAgICAgY29uc29sZS5sb2coJ05hdmlnYXRlIHRvIHRoZSBtZXRhIHZpZGVvIHZpZXcnKTtcblxuICAgICAgICAvLyBnb3RvU2VjdGlvbigndmlkZW8tbWV0YScpO1xuICAgICAgICBWUi5yb3V0ZXIuc2hvdygnI3ZpZGVvJyk7XG4gICAgICAgIHJlbmRlclZpZGVvTWV0YURhdGEoc2VsZWN0ZWRWaWRlbyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvLyBmdW5jdGlvbiBfZHJhZ1Njcm9sbCgpIHtcbiAgLy8gICB2YXIgY3VyWVBvcyA9IDAsXG4gIC8vICAgICBjdXJYUG9zID0gMCxcbiAgLy8gICAgIGN1ckRvd24gPSBmYWxzZTtcbiAgLy9cbiAgLy8gICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgZnVuY3Rpb24gKGUpIHtcbiAgLy8gICAgIGlmIChjdXJEb3duID09PSB0cnVlKSB7XG4gIC8vICAgICAgIHZhciB0aW1lTGluZSA9IFZSLmdldC5vbmUoJyN0aW1lbGluZScpO1xuICAvL1xuICAvLyAgICAgfVxuICAvLyAgIH0pO1xuICAvL1xuICAvLyAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBmdW5jdGlvbiAoZSkge1xuICAvL1xuICAvLyAgICAgY3VyRG93biA9IHRydWU7XG4gIC8vICAgICBjdXJZUG9zID0gZS5wYWdlWTtcbiAgLy8gICAgIGN1clhQb3MgPSBlLnBhZ2VYO1xuICAvLyAgIH0pO1xuICAvL1xuICAvLyAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgZnVuY3Rpb24gKGUpIHtcbiAgLy8gICAgIGN1ckRvd24gPSBmYWxzZTtcbiAgLy8gICB9KTtcbiAgLy8gfVxuXG4gIGZ1bmN0aW9uIGNsaWNrTWV0YVZpZGVvKCkge1xuICAgIFZSLmdldC5vbmUoJyNtZXRhLXZpZGVvLXBsYXknKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICB2YXIgc2VsZWN0ZWRWaWRlb0lkID0gZS50YXJnZXQuZGF0YXNldC52aWRlb0lkO1xuICAgICAgdmFyIHNlbGVjdGVkVmlkZW8gPSBnZXRWaWRlbyhzZWxlY3RlZFZpZGVvSWQpW3NlbGVjdGVkVmlkZW9JZF07XG5cbiAgICAgIC8vIFBsYXkgdGhlIHZpZGVvXG4gICAgICBjb25zb2xlLmxvZygnUGxheSB0ZSB2aWRlbycpO1xuICAgICAgY29uc29sZS5sb2coc2VsZWN0ZWRWaWRlbyk7XG4gICAgICB2YXIgbWV0YVZpZGVvRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhLXZpZGVvJyk7XG4gICAgICBtZXRhVmlkZW9FbGVtZW50LnNyYyA9ICdtZWRpYS92aWRlby8nICsgc2VsZWN0ZWRWaWRlbztcbiAgICAgIG1ldGFWaWRlb0VsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdtZXRhLXRodW1ibmFpbC13cmFwcGVyJylbMF0uc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNsaWNrQ2xvc2VNZXRhKCkge1xuICAgIFZSLmdldC5vbmUoJy5jbG9zZScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgIFZSLnJvdXRlci5zaG93KCcjdGltZWxpbmUnKTtcbiAgICAgIHZhciB2aWRlb0VsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YS12aWRlbycpO1xuICAgICAgY29uc29sZS5sb2coJ2NoZWNrJyk7XG4gICAgICBjb25zb2xlLmxvZyh2aWRlb0VsZW1lbnQucGF1c2UoKSk7XG4gICAgICBjb25zb2xlLmxvZyh2aWRlb0VsZW1lbnQpO1xuICAgICAgdmlkZW9FbGVtZW50LnBhdXNlKCk7XG4gICAgICB2aWRlb0VsZW1lbnQuY3VycmVudFRpbWUgPSAwO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbmRlcnMgdGhlIHZpZGVvIG1ldGEgZGF0YSBpbiB0aGUgdmlkZW8tbWV0YSBzZWN0aW9uXG4gICAqXG4gICAqIEBwYXJhbSAgICAgIHtvYmp9ICBzZWxlY3RlZFZpZGVvICBUaGUgc2VsZWN0ZWQgdmlkZW9cbiAgICovXG4gIGZ1bmN0aW9uIHJlbmRlclZpZGVvTWV0YURhdGEoc2VsZWN0ZWRWaWRlbykge1xuICAgIGNvbnNvbGUubG9nKHNlbGVjdGVkVmlkZW8pO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhLXZpZGVvLXBsYXknKS5zZXRBdHRyaWJ1dGUoJ2RhdGEtdmlkZW8taWQnLCBzZWxlY3RlZFZpZGVvLmlkKTtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmlkZW8tdGl0bGUnKS5pbm5lckhUTUwgPSBzZWxlY3RlZFZpZGVvLnRpdGxlO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXNjcmlwdGlvbicpLmlubmVySFRNTCA9IHNlbGVjdGVkVmlkZW8uZGVzY3JpcHRpb247XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RhdGUtYWxpYXMnKS5pbm5lckhUTUwgPSBzZWxlY3RlZFZpZGVvLmRhdGVhbGlhcztcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YS10aHVtYm5haWwnKS5zcmMgPSAnbWVkaWEvdGh1bWJuYWlscy8nICsgc2VsZWN0ZWRWaWRlby50aHVtYm5haWw7XG4gICAgY2xpY2tNZXRhVmlkZW8oKTtcbiAgICBjbGlja0Nsb3NlTWV0YSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIHZpZGVvLlxuICAgKlxuICAgKiBAcGFyYW0gICAgICBzdHJpbmcgdmlkZW9JZCAgVGhlIHZpZGVvIGlkZW50aWZpZXJcbiAgICogQHJldHVybiAgICAgb2JqICBUaGUgdmlkZW8uXG4gICAqL1xuICBmdW5jdGlvbiBnZXRWaWRlbyh2aWRlb0lkKSB7XG4gICAgdmFyIHNlbGVjdGVkVmlkZW87XG4gICAgY29uc29sZS5sb2coX3ZpZGVvcyk7XG4gICAgX3ZpZGVvcy52aWRlb3Muc29tZShmdW5jdGlvbiAoZWxtLCBpbmRleCkge1xuICAgICAgaWYgKGVsbVt2aWRlb0lkXSkge1xuICAgICAgICBzZWxlY3RlZFZpZGVvID0gZWxtO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBzZWxlY3RlZFZpZGVvO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBpbml0OiBpbml0XG4gIH07XG59KCk7IiwidmFyIFZSID0gVlIgfHwge307XG4ndXNlIHN0cmljdCc7XG4iLCIvL1RvIGVhc2lseSBzZWxlY3Qgc29tZXRoaW5nIGZyb20gdGhlIERPTVxuVlIuZ2V0ID0gKGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gdXJscyh1cmwpIHtcblxuICAgIC8vIGxldCBiYXNlID0gJy9WUkxpZmVvZkplc3VzLyc7XG4gICAgbGV0IGJhc2UgPSAnJztcbiAgICBsZXQgdHVtYlVybCA9IGJhc2UgKyAnbWVkaWEvdGh1bWJuYWlscy8nICsgdXJsO1xuICAgIGxldCB2aWRlb1VybCA9IGJhc2UgKyAnbWVkaWEvdmlkZW8vJyArIHVybDtcbiAgICBsZXQgZGF0YVVybCA9IGJhc2UgKyAnZGF0YS8nICsgdXJsO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGJhc2U6IGJhc2UsXG4gICAgICB0dW1iVXJsOiB0dW1iVXJsLFxuICAgICAgdmlkZW9Vcmw6IHZpZGVvVXJsLFxuICAgICAgZGF0YVVybFxuICAgIH07XG4gIH1cblxuICBmdW5jdGlvbiBvbmUoc2VsZWN0b3IpIHsgLy9UaGlzIGlzIGEgbWV0aG9kXG4gICAgcmV0dXJuIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpO1xuICB9XG5cbiAgZnVuY3Rpb24gYWxsKHNlbGVjdG9yKSB7XG4gICAgcmV0dXJuIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpO1xuICB9XG5cbiAgZnVuY3Rpb24gZGF0YSh1cmwpIHtcbiAgICAvLyByZXR1cm4gYSBQcm9taXNlIG9iamVjdFxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICB2YXIgcmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgLy9vcGVuIGFuIGdldCByZXF1ZXN0XG4gICAgICByZXF1ZXN0Lm9wZW4oJ0dFVCcsIHVybCk7XG4gICAgICByZXF1ZXN0Lm9ubG9hZHN0YXJ0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBsb2FkaW5nKHRydWUpO1xuICAgICAgfTtcbiAgICAgIHJlcXVlc3Qub25sb2FkZW5kID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBsb2FkaW5nKHRydWUpO1xuICAgICAgfTtcblxuICAgICAgLy9pZiB0aGUgcmVxdWVzdCBpcyBkb25lXG4gICAgICByZXF1ZXN0Lm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy9vbnkgaWYgcmVxdWVzdCBpcyBkb25lXG4gICAgICAgIGxldCBzdGF0dXNDb2RlID0gMjAwO1xuICAgICAgICBpZiAocmVxdWVzdC5zdGF0dXMgPT0gc3RhdHVzQ29kZSkge1xuICAgICAgICAgIGxvYWRpbmcoZmFsc2UpO1xuXG4gICAgICAgICAgLy8gc2VuZCB0ZXh0IGZvcm0gcmVxdWVzdFxuICAgICAgICAgIHJlc29sdmUocmVxdWVzdC5yZXNwb25zZVRleHQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIHJlamVjdCB0aGUgcHJvbWlzZSBpZiB0aGVyZSBpcyBhIGVyclxuICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoJ3JlcXVlc3QgZmFpbGVkIScpKTtcbiAgICAgICAgICBjb25zb2xlLmxvZygnVGhlcmUgd2VudCBzb21ldGhpbmcgd3JvbmcnKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIC8vc2VuZCB0aGUgcmVxdWVzdFxuICAgICAgcmVxdWVzdC5zZW5kKCk7XG4gICAgfSk7XG4gIH1cbiAgLy8gc2hvdyBvciBoaWRlIHRoZSBsb2FkaW5nIHNwaW5uZXJcbiAgZnVuY3Rpb24gbG9hZGluZyhzaG93KSB7XG4gICAgbGV0IGRlbGF5VGltZSA9IDEwMDA7XG4gICAgaWYgKHNob3cpIHtcbiAgICAgIFZSLmdldC5vbmUoJy5sb2FkaW5nJykuY2xhc3NMaXN0LnJlbW92ZSgnZGlzYWJsZWQnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy9zaG93IGxvYWRpbmdcbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICBWUi5nZXQub25lKCcubG9hZGluZycpLmNsYXNzTGlzdC5hZGQoJ2Rpc2FibGVkJyk7XG4gICAgICB9LCBkZWxheVRpbWUpOyAvL2FkZCBhIGRlbGF5IGJlY2F1c2UgeW91IHdvbid0IHNlZSBpdCB3aXRoIGZhc3QgaW50ZXJuZXQuXG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHsgLy9yZXR1cm4gb25seSB0aGUgZnVudGlvbnMgdGhhdCBhcmUgbmVzc2Vlcml5XG4gICAgdXJsczogdXJscyxcbiAgICBvbmU6IG9uZSxcbiAgICBhbGw6IGFsbCxcbiAgICBkYXRhOiBkYXRhLFxuICAgIGxvYWRpbmc6IGxvYWRpbmdcbiAgfTtcbn0pKCk7XG4iLCIvL1RvIGVhc2lseSBzZWxlY3Qgc29tZXRoaW5nIGZyb20gdGhlIERPTVxuVlIuZGF0ZSA9IChmdW5jdGlvbiAoKSB7XG4gIGxldCBkYXRlcyA9IHtcbiAgICBkYXlzOiBbJ1N1bmRheScsICdNb25kYXknLCAnVHVlc2RheScsICdXZWRuZXNkYXknLCAnVGh1cnNkYXknLCAnRnJpZGF5JywgJ1NhdHVyZGF5J10sXG4gICAgbW9udGhzOiBbJ0phbnVhcnknLCAnRmVicnVhcnknLCAnTWFyY2gnLCAnQXByaWwnLCAnTWF5JywgJ0p1bmUnLCAnSnVseScsICdBdWd1c3QnLCAnU2VwdGVtYmVyJywgJ09jdG9iZXInLCAnTm92ZW1iZXInLCAnRGVjZW1iZXInXSxcbiAgfTtcblxuICBmdW5jdGlvbiByZWFkYWJsZURhdGUodW5mcm9tYXRlZERhdGUpIHtcbiAgICBsZXQgbmV3RGF0ZSA9IG5ldyBEYXRlKHVuZnJvbWF0ZWREYXRlKTtcbiAgICBsZXQgbW9udGggPSBkYXRlcy5tb250aHNbbmV3RGF0ZS5nZXRNb250aCgpXTtcbiAgICBsZXQgZGF0ZSA9IG5ld0RhdGUuZ2V0RGF0ZSgpO1xuICAgIGxldCBkYXkgPSBkYXRlcy5kYXlzW25ld0RhdGUuZ2V0RGF5KCldO1xuICAgIGxldCB5ZWFyID0gbmV3RGF0ZS5nZXRGdWxsWWVhcigpO1xuXG4gICAgcmV0dXJuIGRheSArICcgJyArIGRhdGUgKyAnICcgKyBtb250aCArICcgJyArIHllYXI7XG4gIH1cblxuXG4gIHJldHVybiB7IC8vcmV0dXJuIG9ubHkgdGhlIGZ1bnRpb25zIHRoYXQgYXJlIG5lc3NlZXJpeVxuICAgIHJlYWRhYmxlRGF0ZTogcmVhZGFibGVEYXRlXG4gIH07XG59KSgpO1xuIiwiVlIucm91dGVyID0gKGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gc2hvdyhpZCkge1xuICAgIHZhciBwYWdlcyA9IFZSLmdldC5hbGwoJy5wYWdlJyk7XG4gICAgdmFyIHNlbGVjdGVkUGFnZSA9IFZSLmdldC5vbmUoaWQpO1xuXG4gICAgLy9kaXNhYmxlIGFsbCB0aGUgcGFnZXNcbiAgICBwYWdlcy5mb3JFYWNoKGZ1bmN0aW9uIChwYWdlKSB7XG4gICAgICBwYWdlLmNsYXNzTGlzdC5hZGQoJ2Rpc2FibGVkJyk7XG4gICAgfSk7XG5cbiAgICBzZWxlY3RlZFBhZ2UuY2xhc3NMaXN0LnJlbW92ZSgnZGlzYWJsZWQnKTtcblxuICAgIGlmIChpZCA9PT0gJyNjYXJkYm9hcmQnKSB7XG4gICAgICBWUi5WM2QuaW5pdCgpO1xuICAgIH0gZWxzZSBpZiAoaWQgPT09ICcjbGFuZGluZycpIHtcblxuICAgICAgVlIubGFuZGluZy5pbml0KCk7XG4gICAgfSBlbHNlIGlmIChpZCA9PT0gJyN2aWRlbycpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdoaW9zZCcpO1xuICAgICAgLy8gVlIucmVuZGVyLmluaXQoKTtcbiAgICB9IGVsc2UgaWYgKGlkID09PSAnI3RpbWVsaW5lJykge1xuICAgICAgVlIudGltZWxpbmUuaW5pdCgpO1xuICAgIH1cbiAgfVxuICByZXR1cm4ge1xuICAgIHNob3c6IHNob3dcbiAgfTtcbn0pKCk7XG4iLCJWUi5sYW5kaW5nID0gKGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gaW5pdChpZCkge1xuXG4gICAgX2J1dHRvbigpO1xuICAgIGJhY2tncm91bmQoKTtcbiAgICBWUi5nZXQubG9hZGluZyhmYWxzZSk7XG4gIH1cblxuICBmdW5jdGlvbiBiYWNrZ3JvdW5kKCkge1xuICAgIHZhciBsRm9sbG93WCA9IDAsXG4gICAgICBsRm9sbG93WSA9IDAsXG4gICAgICB4ID0gMCxcbiAgICAgIHkgPSAwLFxuICAgICAgZnJpY3Rpb24gPSAxIC8gMzA7XG5cbiAgICBmdW5jdGlvbiBtb3ZlQmFja2dyb3VuZCgpIHtcbiAgICAgIHggKz0gKGxGb2xsb3dYIC0geCkgKiBmcmljdGlvbjtcbiAgICAgIHkgKz0gKGxGb2xsb3dZIC0geSkgKiBmcmljdGlvbjtcblxuICAgICAgbGV0IHRyYW5zbGF0ZSA9ICd0cmFuc2xhdGUoJyArIHggKyAncHgsICcgKyB5ICsgJ3B4KSBzY2FsZSgxLjEpJztcblxuICAgICAgdmFyIGJhY2tncm91bmQgPSBWUi5nZXQub25lKCcuYmcnKTtcblxuICAgICAgLy8gYmFja2dyb3VuZC5zdHlsZVsnLXdlYml0LXRyYW5zZm9ybSddID0gdHJhbnNsYXRlO1xuICAgICAgLy8gYmFja2dyb3VuZC5zdHlsZVsnLW1vei10cmFuc2Zvcm0nXSA9IHRyYW5zbGF0ZTtcbiAgICAgIGJhY2tncm91bmQuc3R5bGUud2Via2l0VHJhbnNmb3JtID0gdHJhbnNsYXRlO1xuICAgICAgYmFja2dyb3VuZC5zdHlsZS5Nb3pUcmFuc2Zvcm0gPSB0cmFuc2xhdGU7XG4gICAgICBiYWNrZ3JvdW5kLnN0eWxlLm1zVHJhbnNmb3JtID0gdHJhbnNsYXRlO1xuICAgICAgYmFja2dyb3VuZC5zdHlsZS5PVHJhbnNmb3JtID0gdHJhbnNsYXRlO1xuICAgICAgYmFja2dyb3VuZC5zdHlsZS50cmFuc2Zvcm0gPSB0cmFuc2xhdGU7XG5cbiAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUobW92ZUJhY2tncm91bmQpO1xuICAgIH1cblxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW92ZXInLCBmdW5jdGlvbiAoZSkge1xuXG4gICAgICB2YXIgbE1vdXNlWCA9IE1hdGgubWF4KC0xMDAsIE1hdGgubWluKDEwMCwgc2NyZWVuLndpZHRoIC8gMiAtIGUuY2xpZW50WCkpO1xuICAgICAgdmFyIGxNb3VzZVkgPSBNYXRoLm1heCgtMTAwLCBNYXRoLm1pbigxMDAsIHNjcmVlbi5oZWlnaHQgLyAyIC0gZS5jbGllbnRZKSk7XG4gICAgICBsRm9sbG93WCA9ICgyMCAqIGxNb3VzZVgpIC8gMTAwOyAvLyAxMDAgOiAxMiA9IGxNb3V4ZVggOiBsRm9sbG93XG4gICAgICBsRm9sbG93WSA9ICgxMCAqIGxNb3VzZVkpIC8gMTAwO1xuXG4gICAgfSk7XG4gICAgbW92ZUJhY2tncm91bmQoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9idXR0b24oKSB7XG4gICAgdmFyIGxhbmRpbmdidXR0b24gPSBWUi5nZXQub25lKCcjbGFuZGluZ2J1dHRvbicpO1xuICAgIGxhbmRpbmdidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICBWUi5yb3V0ZXIuc2hvdygnI3RpbWVsaW5lJylcbiAgICB9KTtcbiAgfVxuICByZXR1cm4ge1xuICAgIGluaXQ6IGluaXRcbiAgfTtcbn0pKCk7XG4iLCJWUi50aW1lbGluZSA9IChmdW5jdGlvbiAoKSB7IC8vZnVudGlvbiB0byByZW5kZXIgYSB0ZW1wbGF0ZS5cbiAgLy9yZW5kZXIgdGhlIHRlbXBsYXRlXG4gIGxldCBfdmlkZW9zO1xuICBsZXQgX3NlbGVjdGVkVmlkZW9JZCxcbiAgICB0aW1lbGluZURhdGEgPSB7fTtcblxuICAvL3JlbmRlciB0aGUgdGVtcGxhdGVcbiAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAvLyByLl9nZXREYXRhKCk7XG4gICAgX2dldERhdGEoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9nZXREYXRhKCkge1xuICAgIGxldCB2aWRlb0xpc3QgPSBWUi5nZXQub25lKCcudmlkZW8tbGlzdCcpO1xuICAgIGxldCB1cmwgPSBWUi5nZXQudXJscygnZGF0YS5qc29uJykuZGF0YVVybDtcblxuICAgIFZSLmdldC5kYXRhKHVybCkudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICB2YXIgcGFyc2VkID0gSlNPTi5wYXJzZShyZXNwb25zZSk7XG4gICAgICB0aW1lbGluZURhdGEgPSBwYXJzZWQ7XG4gICAgICB2aWRlb0xpc3QuYXBwZW5kQ2hpbGQoX2dlbmVyYXRlVGltZWxpbmUocGFyc2VkKSk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBfZ2VuZXJhdGVUaW1lbGluZShkYXRhKSB7XG4gICAgbGV0IHZpZGVvTGlzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3VsJyk7XG5cbiAgICBkYXRhLnZpZGVvcy5mb3JFYWNoKGZ1bmN0aW9uIChvYmopIHtcbiAgICAgIHZhciB2aWRlb0lkID0gT2JqZWN0LmtleXMob2JqKVswXTtcblxuICAgICAgbGV0IGVsZW1lbnQgPSBfY3JlYXRlVmlkZW9FbGVtZW50KG9iai50aHVtYm5haWwsIG9iai50aXRsZSwgb2JqLmRlc2NyaXB0aW9uLCB2aWRlb0lkKTtcbiAgICAgIC8vIGNvbnNvbGUubG9nKG9iaik7XG4gICAgICB2aWRlb0xpc3QuaW5uZXJIVE1MICs9IGVsZW1lbnQ7IC8vYWRkIGl0IHRvIHRoZSB1bFxuICAgIH0pO1xuICAgIHJldHVybiB2aWRlb0xpc3Q7XG5cbiAgfVxuXG4gIGZ1bmN0aW9uIF9jcmVhdGVWaWRlb0VsZW1lbnQodHVtYlVybCwgdGl0bGUsIGRlc2NyaXB0aW9uLCB2aWRlb0lkKSB7XG4gICAgbGV0IHR1bWJVcmxHZW5lcmF0ZWQgPSBWUi5nZXQudXJscyh0dW1iVXJsKS50dW1iVXJsO1xuICAgIGxldCB2aWRlb1VybCA9IFZSLmdldC51cmxzKHR1bWJVcmwpLnR1bWJVcmw7XG4gICAgLy8gY29uc29sZS5sb2codHVtYlVybCk7XG4gICAgbGV0IHZpZGVvID0gJzxsaT48ZGl2IGNsYXNzPVwidmlkZW8td3JhcHBlclwiPic7XG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwidGh1bWJuYWlsLXdyYXBwZXJcIj4nXG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHRcdDxpbWcgY2xhc3M9XCJ0aHVtYm5haWxcIiBzcmM9XCInICsgdHVtYlVybEdlbmVyYXRlZCArICdcIj4nO1xuICAgIHZpZGVvICs9ICcgIFx0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwibWVkaWEtY2FwdGlvblwiPic7XG4gICAgdmlkZW8gKz0gJyAgXHRcdFx0XHRcdFx0PGRpdiBjbGFzcz1cImNhcHRpb24tY29udGVudFwiPic7XG4gICAgdmlkZW8gKz0gJyAgXHRcdFx0XHRcdFx0XHQ8aDI+JyArIHRpdGxlICsgJzwvaDI+JztcbiAgICB2aWRlbyArPSAnICBcdFx0XHRcdFx0XHRcdDxzcGFuPicgKyBkZXNjcmlwdGlvbiArICc8L3NwYW4+JztcbiAgICB2aWRlbyArPSAnICBcdFx0XHRcdFx0XHQ8L2Rpdj4nO1xuICAgIHZpZGVvICs9ICcgICAgXHRcdFx0XHQ8L2Rpdj4nO1xuICAgIHZpZGVvICs9ICcgIFx0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwidmlkZW8tcGxheVwiIGRhdGEtdmlkZW8taWQ9XCInICsgdmlkZW9JZCArICdcIlwiPic7XG4gICAgdmlkZW8gKz0gJyAgXHRcdFx0XHRcdDwvZGl2Pic7XG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHQ8L2Rpdj4nO1xuICAgIHZpZGVvICs9ICdcdFx0XHRcdFx0PHZpZGVvIGF1dG9wbGF5IGNvbnRyb2xzIHN0eWxlPVwiZGlzcGxheTpub25lO1wiPic7XG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHRTb3JyeSwgeW91ciBicm93c2VyIGRvZXNudCBzdXBwb3J0IGVtYmVkZGVkIHZpZGVvcyc7XG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHQ8L3ZpZGVvPic7XG4gICAgdmlkZW8gKz0gJzwvZGl2PjwvbGk+JztcbiAgICByZXR1cm4gdmlkZW87XG4gIH1cblxuICBmdW5jdGlvbiBjbGlja1ZpZGVvKCkge1xuICAgIFZSLmdldC5vbmUoJy52aWRlby1saXN0IHVsJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgICAgaWYgKGUudGFyZ2V0LmNsYXNzTmFtZSA9PSBcInZpZGVvLXBsYXlcIikge1xuXG4gICAgICAgIF9zZWxlY3RlZFZpZGVvSWQgPSBlLnRhcmdldC5kYXRhc2V0LnZpZGVvSWQ7XG4gICAgICAgIGNvbnNvbGUubG9nKF9zZWxlY3RlZFZpZGVvSWQpO1xuICAgICAgICB2YXIgc2VsZWN0ZWRWaWRlbyA9IGdldFZpZGVvKF9zZWxlY3RlZFZpZGVvSWQpO1xuICAgICAgICBjb25zb2xlLmxvZyhzZWxlY3RlZFZpZGVvKTtcbiAgICAgICAgc2VsZWN0ZWRWaWRlby5pZCA9IF9zZWxlY3RlZFZpZGVvSWQ7XG5cblxuICAgICAgICAvLyBOYXZpZ2F0ZSB0byB0aGUgbWV0YSB2aWRlbyB2aWV3XG4gICAgICAgIGNvbnNvbGUubG9nKCdOYXZpZ2F0ZSB0byB0aGUgbWV0YSB2aWRlbyB2aWV3Jyk7XG5cbiAgICAgICAgLy8gZ290b1NlY3Rpb24oJ3ZpZGVvLW1ldGEnKTtcbiAgICAgICAgVlIucm91dGVyLnNob3coJyN2aWRlbycpO1xuICAgICAgICByZW5kZXJWaWRlb01ldGFEYXRhKHNlbGVjdGVkVmlkZW8pO1xuXG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvLyBmdW5jdGlvbiBfZHJhZ1Njcm9sbCgpIHtcbiAgLy8gICB2YXIgY3VyWVBvcyA9IDAsXG4gIC8vICAgICBjdXJYUG9zID0gMCxcbiAgLy8gICAgIGN1ckRvd24gPSBmYWxzZTtcbiAgLy9cbiAgLy8gICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgZnVuY3Rpb24gKGUpIHtcbiAgLy8gICAgIGlmIChjdXJEb3duID09PSB0cnVlKSB7XG4gIC8vICAgICAgIHZhciB0aW1lTGluZSA9IFZSLmdldC5vbmUoJyN0aW1lbGluZScpO1xuICAvL1xuICAvLyAgICAgfVxuICAvLyAgIH0pO1xuICAvL1xuICAvLyAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBmdW5jdGlvbiAoZSkge1xuICAvL1xuICAvLyAgICAgY3VyRG93biA9IHRydWU7XG4gIC8vICAgICBjdXJZUG9zID0gZS5wYWdlWTtcbiAgLy8gICAgIGN1clhQb3MgPSBlLnBhZ2VYO1xuICAvLyAgIH0pO1xuICAvL1xuICAvLyAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgZnVuY3Rpb24gKGUpIHtcbiAgLy8gICAgIGN1ckRvd24gPSBmYWxzZTtcbiAgLy8gICB9KTtcbiAgLy8gfVxuXG4gIGZ1bmN0aW9uIGNsaWNrTWV0YVZpZGVvKCkge1xuICAgIFZSLmdldC5vbmUoJyNtZXRhLXZpZGVvLXBsYXknKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICB2YXIgc2VsZWN0ZWRWaWRlb0lkID0gZS50YXJnZXQuZGF0YXNldC52aWRlb0lkO1xuICAgICAgdmFyIHNlbGVjdGVkVmlkZW8gPSBnZXRWaWRlbyhzZWxlY3RlZFZpZGVvSWQpW3NlbGVjdGVkVmlkZW9JZF07XG5cbiAgICAgIC8vIFBsYXkgdGhlIHZpZGVvXG4gICAgICBjb25zb2xlLmxvZygnUGxheSB0ZSB2aWRlbycpO1xuICAgICAgY29uc29sZS5sb2coc2VsZWN0ZWRWaWRlbyk7XG4gICAgICB2YXIgbWV0YVZpZGVvRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhLXZpZGVvJyk7XG4gICAgICBtZXRhVmlkZW9FbGVtZW50LnNyYyA9ICdtZWRpYS92aWRlby8nICsgc2VsZWN0ZWRWaWRlbztcbiAgICAgIG1ldGFWaWRlb0VsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdtZXRhLXRodW1ibmFpbC13cmFwcGVyJylbMF0uc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICB9KTtcbiAgfVxuXG5cbiAgZnVuY3Rpb24gY2xpY2tDbG9zZU1ldGEoKSB7XG4gICAgVlIuZ2V0Lm9uZSgnLmNsb3NlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgICAgVlIucm91dGVyLnNob3coJyN0aW1lbGluZScpO1xuICAgICAgdmFyIHZpZGVvRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhLXZpZGVvJyk7XG4gICAgICBjb25zb2xlLmxvZygnY2hlY2snKVxuICAgICAgY29uc29sZS5sb2codmlkZW9FbGVtZW50LnBhdXNlKCkpXG4gICAgICBjb25zb2xlLmxvZyh2aWRlb0VsZW1lbnQpXG4gICAgICB2aWRlb0VsZW1lbnQucGF1c2UoKTtcbiAgICAgIHZpZGVvRWxlbWVudC5jdXJyZW50VGltZSA9IDA7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUmVuZGVycyB0aGUgdmlkZW8gbWV0YSBkYXRhIGluIHRoZSB2aWRlby1tZXRhIHNlY3Rpb25cbiAgICpcbiAgICogQHBhcmFtICAgICAge29ian0gIHNlbGVjdGVkVmlkZW8gIFRoZSBzZWxlY3RlZCB2aWRlb1xuICAgKi9cbiAgZnVuY3Rpb24gcmVuZGVyVmlkZW9NZXRhRGF0YShzZWxlY3RlZFZpZGVvKSB7XG4gICAgY29uc29sZS5sb2coc2VsZWN0ZWRWaWRlbyk7XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldGEtdmlkZW8tcGxheScpLnNldEF0dHJpYnV0ZSgnZGF0YS12aWRlby1pZCcsIHNlbGVjdGVkVmlkZW8uaWQpO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd2aWRlby10aXRsZScpLmlubmVySFRNTCA9IHNlbGVjdGVkVmlkZW8udGl0bGU7XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rlc2NyaXB0aW9uJykuaW5uZXJIVE1MID0gc2VsZWN0ZWRWaWRlby5kZXNjcmlwdGlvbjtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGF0ZS1hbGlhcycpLmlubmVySFRNTCA9IHNlbGVjdGVkVmlkZW8uZGF0ZWFsaWFzO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhLXRodW1ibmFpbCcpLnNyYyA9ICdtZWRpYS90aHVtYm5haWxzLycgKyBzZWxlY3RlZFZpZGVvLnRodW1ibmFpbDtcbiAgICBjbGlja01ldGFWaWRlbygpO1xuICAgIGNsaWNrQ2xvc2VNZXRhKCk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgdmlkZW8uXG4gICAqXG4gICAqIEBwYXJhbSAgICAgIHN0cmluZyB2aWRlb0lkICBUaGUgdmlkZW8gaWRlbnRpZmllclxuICAgKiBAcmV0dXJuICAgICBvYmogIFRoZSB2aWRlby5cbiAgICovXG4gIGZ1bmN0aW9uIGdldFZpZGVvKHZpZGVvSWQpIHtcbiAgICB2YXIgc2VsZWN0ZWRWaWRlbztcbiAgICBjb25zb2xlLmxvZyhfdmlkZW9zKTtcbiAgICBfdmlkZW9zLnZpZGVvcy5zb21lKGZ1bmN0aW9uIChlbG0sIGluZGV4KSB7XG4gICAgICBpZiAoZWxtW3ZpZGVvSWRdKSB7XG4gICAgICAgIHNlbGVjdGVkVmlkZW8gPSBlbG07XG4gICAgICB9XG4gICAgfSlcbiAgICByZXR1cm4gc2VsZWN0ZWRWaWRlbztcbiAgfVxuXG5cbiAgcmV0dXJuIHtcbiAgICBpbml0OiBpbml0XG4gIH07XG5cbn0pKCk7XG4iXX0=
