"use strict";var VR=VR||{};VR.get=function(){function t(t){var e="/",n=e+"media/thumbnails/"+t,i=e+"media/video/"+t,o=e+"data/"+t;return{base:e,tumbUrl:n,videoUrl:i,dataUrl:o}}function e(t){return document.querySelector(t)}function n(t){return document.querySelectorAll(t)}function i(t){return new Promise(function(e,n){var i=new XMLHttpRequest;i.open("GET",t),i.onloadstart=function(){o(!0)},i.onloadend=function(){o(!0)},i.onload=function(){var t=200;i.status==t?(o(!1),e(i.responseText)):(n(new Error("request failed!")),VR.ux.showErr("There went something wrong"))},i.send()})}function o(t){var e=300;t?VR.get.one(".loading").classList.remove("disabled"):setTimeout(function(){VR.get.one(".loading").classList.add("disabled")},e)}return{urls:t,one:e,all:n,data:i,loading:o}}(),VR.date=function(){function t(t){var n=new Date(t),i=e.months[n.getMonth()],o=n.getDate(),a=e.days[n.getDay()],r=n.getFullYear();return a+" "+o+" "+i+" "+r}var e={days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],months:["January","February","March","April","May","June","July","August","September","October","November","December"]};return{readableDate:t}}(),VR.router=function(){function t(t){var e=VR.get.all(".page"),n=VR.get.one(t);e.forEach(function(t){t.classList.add("disabled")}),n.classList.remove("disabled"),"#cardboard"===t?VR.cardboard.init():"#landing"===t?VR.landing.init():"#video"===t?console.log("hiosd"):"#timeline"===t&&VR.timeline.init()}return{show:t}}(),VR.landing=function(){function t(t){function n(t,e){return Math.floor(Math.random()*(e-t+1))+t}var i=["#F0F082","#8CF08C","#8CF0F0","#8CA0FF","#F05050"],o=document.querySelector("body"),a=n(0,4);o.style.backgroundColor=i[a],VR.get.loading(!1),e()}function e(){var t=VR.get.one("#landingbutton");t.addEventListener("click",function(){VR.router.show("#timeline")})}return{init:t}}(),VR.timeline=function(){function t(){e()}function e(){var t=VR.get.one(".video-list"),e=VR.get.urls("data.json").dataUrl;VR.get.data(e).then(function(e){d=JSON.parse(e),t.appendChild(n(d)),o()})}function n(t){var e=document.createElement("ul");return t.videos.forEach(function(t){var n=Object.keys(t)[0],o=i(t[n].thumbnail,t[n].title,t[n].description,n);e.innerHTML+=o}),e}function i(t,e,n,i){var o=VR.get.urls(t).tumbUrl,a=(VR.get.urls(t).tumbUrl,'<ul><div class="video-wrapper">');return a+='\t\t\t\t\t<div class="thumbnail-wrapper">',a+='\t\t\t\t\t\t<img class="thumbnail" src="'+o+'">',a+='  \t\t\t\t\t<div class="media-caption">',a+='  \t\t\t\t\t\t<div class="caption-content">',a+="  \t\t\t\t\t\t\t<h2>"+e+"</h2>",a+="  \t\t\t\t\t\t\t<span>"+n+"</span>",a+="  \t\t\t\t\t\t</div>",a+="    \t\t\t\t</div>",a+='  \t\t\t\t\t<div class="video-play" data-video-id="'+i+'"">',a+="  \t\t\t\t\t</div>",a+="\t\t\t\t\t</div>",a+='\t\t\t\t\t<video autoplay controls style="display:none;">',a+="\t\t\t\t\tSorry, your browser doesnt support embedded videos",a+="\t\t\t\t\t</video>",a+="</div></ul>"}function o(){VR.get.one(".video-list ul").addEventListener("click",function(t){if("video-play"==t.target.className){var e=t.target.dataset.videoId,n=r(e);console.log(n),n.id=e,console.log("Navigate to the meta video view"),VR.router.show("#video"),a(n)}})}function a(t){console.log(t),document.getElementById("meta-video-play").setAttribute("data-video-id",t.id),document.getElementById("video-title").innerHTML=t[t.id].title,document.getElementById("description").innerHTML=t[t.id].description,document.getElementById("date-alias").innerHTML=t[t.id].datealias,document.getElementById("meta-thumbnail").src="media/thumbnails/"+t[t.id].thumbnail}function r(t){var e;return console.log(d),d.videos.some(function(n,i){n[t]&&(e=n)}),e}var d=void 0;return{init:t}}(),VR.start=function(){var t=function(){VR.router.show("#landing")};return{init:t}}(),VR.start.init();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsIlZSc3RhcnQuanMiLCJWUmhlbHBlci5qcyIsIlZSZGF0ZS5qcyIsIlZScm91dGVyLmpzIiwiVlJsYW5kaW5nLmpzIiwiVlJ0aW1lbGluZS5qcyIsIlZSaW5pdC5qcyJdLCJuYW1lcyI6WyJWUiIsImdldCIsInVybHMiLCJ1cmwiLCJiYXNlIiwidHVtYlVybCIsInZpZGVvVXJsIiwiZGF0YVVybCIsIm9uZSIsInNlbGVjdG9yIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiYWxsIiwicXVlcnlTZWxlY3RvckFsbCIsImRhdGEiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsInJlcXVlc3QiLCJYTUxIdHRwUmVxdWVzdCIsIm9wZW4iLCJvbmxvYWRzdGFydCIsImxvYWRpbmciLCJvbmxvYWRlbmQiLCJvbmxvYWQiLCJzdGF0dXNDb2RlIiwic3RhdHVzIiwicmVzcG9uc2VUZXh0IiwiRXJyb3IiLCJ1eCIsInNob3dFcnIiLCJzZW5kIiwic2hvdyIsImRlbGF5VGltZSIsImNsYXNzTGlzdCIsInJlbW92ZSIsInNldFRpbWVvdXQiLCJhZGQiLCJkYXRlIiwicmVhZGFibGVEYXRlIiwidW5mcm9tYXRlZERhdGUiLCJuZXdEYXRlIiwiRGF0ZSIsIm1vbnRoIiwiZGF0ZXMiLCJtb250aHMiLCJnZXRNb250aCIsImdldERhdGUiLCJkYXkiLCJkYXlzIiwiZ2V0RGF5IiwieWVhciIsImdldEZ1bGxZZWFyIiwicm91dGVyIiwiaWQiLCJwYWdlcyIsInNlbGVjdGVkUGFnZSIsImZvckVhY2giLCJwYWdlIiwiY2FyZGJvYXJkIiwiaW5pdCIsImxhbmRpbmciLCJjb25zb2xlIiwibG9nIiwidGltZWxpbmUiLCJnZXRSYW5kb21JbnQiLCJtaW4iLCJtYXgiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJjb2xvcnMiLCJib2R5IiwibnVtYmVyIiwic3R5bGUiLCJiYWNrZ3JvdW5kQ29sb3IiLCJfYnV0dG9uIiwibGFuZGluZ2J1dHRvbiIsImFkZEV2ZW50TGlzdGVuZXIiLCJfZ2V0RGF0YSIsInZpZGVvTGlzdCIsInRoZW4iLCJyZXNwb25zZSIsIl92aWRlb3MiLCJKU09OIiwicGFyc2UiLCJhcHBlbmRDaGlsZCIsIl9nZW5lcmF0ZVRpbWVsaW5lIiwiY2xpY2tWaWRlbyIsImNyZWF0ZUVsZW1lbnQiLCJ2aWRlb3MiLCJvYmoiLCJ2aWRlb0lkIiwiT2JqZWN0Iiwia2V5cyIsImVsZW1lbnQiLCJfY3JlYXRlVmlkZW9FbGVtZW50IiwidGh1bWJuYWlsIiwidGl0bGUiLCJkZXNjcmlwdGlvbiIsImlubmVySFRNTCIsInR1bWJVcmxHZW5lcmF0ZWQiLCJ2aWRlbyIsImUiLCJ0YXJnZXQiLCJjbGFzc05hbWUiLCJzZWxlY3RlZFZpZGVvSWQiLCJkYXRhc2V0Iiwic2VsZWN0ZWRWaWRlbyIsImdldFZpZGVvIiwicmVuZGVyVmlkZW9NZXRhRGF0YSIsImdldEVsZW1lbnRCeUlkIiwic2V0QXR0cmlidXRlIiwiZGF0ZWFsaWFzIiwic3JjIiwic29tZSIsImVsbSIsImluZGV4Iiwic3RhcnQiXSwibWFwcGluZ3MiOiJBQUFBLFlDQUEsSUFBQUEsSUFBQUEsTUNDQUEsSUFBQUMsSUFBQSxXQUNBLFFBQUFDLEdBQUFDLEdBR0EsR0FBQUMsR0FBQSxJQUNBQyxFQUFBRCxFQUFBLG9CQUFBRCxFQUNBRyxFQUFBRixFQUFBLGVBQUFELEVBQ0FJLEVBQUFILEVBQUEsUUFBQUQsQ0FFQSxRQUNBQyxLQUFBQSxFQUNBQyxRQUFBQSxFQUNBQyxTQUFBQSxFQUNBQyxRQUFBQSxHQUlBLFFBQUFDLEdBQUFDLEdBQ0EsTUFBQUMsVUFBQUMsY0FBQUYsR0FHQSxRQUFBRyxHQUFBSCxHQUNBLE1BQUFDLFVBQUFHLGlCQUFBSixHQUdBLFFBQUFLLEdBQUFYLEdBRUEsTUFBQSxJQUFBWSxTQUFBLFNBQUFDLEVBQUFDLEdBQ0EsR0FBQUMsR0FBQSxHQUFBQyxlQUVBRCxHQUFBRSxLQUFBLE1BQUFqQixHQUNBZSxFQUFBRyxZQUFBLFdBQ0FDLEdBQUEsSUFFQUosRUFBQUssVUFBQSxX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QUEsRUFBQXRELElBQUEyQyxVQVNBLFFBQUFZLEdBQUFqQixHQUNBLEdBQUFnQixFQU9BLE9BTkE5QyxTQUFBQyxJQUFBb0IsR0FDQUEsRUFBQU8sT0FBQXlCLEtBQUEsU0FBQUMsRUFBQUMsR0FDQUQsRUFBQXhCLEtBQ0FnQixFQUFBUSxLQUdBUixFQTlIQSxHQUFBekIsR0FBQUEsTUFrSUEsUUFDQXZCLEtBQUFBLE1DcklBNUQsR0FBQXNILE1BQUEsV0FFQSxHQUFBMUQsR0FBQSxXQUNBNUQsR0FBQXFELE9BQUFyQixLQUFBLFlBRUEsUUFDQTRCLEtBQUFBLE1BSUE1RCxHQUFBc0gsTUFBQTFEIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxudmFyIFZSID0gVlIgfHwge307XG4ndXNlIHN0cmljdCc7XG5cbi8vVG8gZWFzaWx5IHNlbGVjdCBzb21ldGhpbmcgZnJvbSB0aGUgRE9NXG5WUi5nZXQgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIHVybHModXJsKSB7XG5cbiAgICAvLyBsZXQgYmFzZSA9ICcvVlJMaWZlb2ZKZXN1cy8nO1xuICAgIHZhciBiYXNlID0gJy8nO1xuICAgIHZhciB0dW1iVXJsID0gYmFzZSArICdtZWRpYS90aHVtYm5haWxzLycgKyB1cmw7XG4gICAgdmFyIHZpZGVvVXJsID0gYmFzZSArICdtZWRpYS92aWRlby8nICsgdXJsO1xuICAgIHZhciBkYXRhVXJsID0gYmFzZSArICdkYXRhLycgKyB1cmw7XG5cbiAgICByZXR1cm4ge1xuICAgICAgYmFzZTogYmFzZSxcbiAgICAgIHR1bWJVcmw6IHR1bWJVcmwsXG4gICAgICB2aWRlb1VybDogdmlkZW9VcmwsXG4gICAgICBkYXRhVXJsOiBkYXRhVXJsXG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG9uZShzZWxlY3Rvcikge1xuICAgIC8vVGhpcyBpcyBhIG1ldGhvZFxuICAgIHJldHVybiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGFsbChzZWxlY3Rvcikge1xuICAgIHJldHVybiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGRhdGEodXJsKSB7XG4gICAgLy8gcmV0dXJuIGEgUHJvbWlzZSBvYmplY3RcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgdmFyIHJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgIC8vb3BlbiBhbiBnZXQgcmVxdWVzdFxuICAgICAgcmVxdWVzdC5vcGVuKCdHRVQnLCB1cmwpO1xuICAgICAgcmVxdWVzdC5vbmxvYWRzdGFydCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbG9hZGluZyh0cnVlKTtcbiAgICAgIH07XG4gICAgICByZXF1ZXN0Lm9ubG9hZGVuZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbG9hZGluZyh0cnVlKTtcbiAgICAgIH07XG5cbiAgICAgIC8vaWYgdGhlIHJlcXVlc3QgaXMgZG9uZVxuICAgICAgcmVxdWVzdC5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vb255IGlmIHJlcXVlc3QgaXMgZG9uZVxuICAgICAgICB2YXIgc3RhdHVzQ29kZSA9IDIwMDtcbiAgICAgICAgaWYgKHJlcXVlc3Quc3RhdHVzID09IHN0YXR1c0NvZGUpIHtcbiAgICAgICAgICBsb2FkaW5nKGZhbHNlKTtcblxuICAgICAgICAgIC8vIHNlbmQgdGV4dCBmb3JtIHJlcXVlc3RcbiAgICAgICAgICByZXNvbHZlKHJlcXVlc3QucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyByZWplY3QgdGhlIHByb21pc2UgaWYgdGhlcmUgaXMgYSBlcnJcbiAgICAgICAgICByZWplY3QobmV3IEVycm9yKCdyZXF1ZXN0IGZhaWxlZCEnKSk7XG4gICAgICAgICAgVlIudXguc2hvd0VycignVGhlcmUgd2VudCBzb21ldGhpbmcgd3JvbmcnKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIC8vc2VuZCB0aGUgcmVxdWVzdFxuICAgICAgcmVxdWVzdC5zZW5kKCk7XG4gICAgfSk7XG4gIH1cbiAgLy8gc2hvdyBvciBoaWRlIHRoZSBsb2FkaW5nIHNwaW5uZXJcbiAgZnVuY3Rpb24gbG9hZGluZyhzaG93KSB7XG4gICAgdmFyIGRlbGF5VGltZSA9IDMwMDtcbiAgICBpZiAoc2hvdykge1xuICAgICAgVlIuZ2V0Lm9uZSgnLmxvYWRpbmcnKS5jbGFzc0xpc3QucmVtb3ZlKCdkaXNhYmxlZCcpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvL3Nob3cgbG9hZGluZ1xuICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgIFZSLmdldC5vbmUoJy5sb2FkaW5nJykuY2xhc3NMaXN0LmFkZCgnZGlzYWJsZWQnKTtcbiAgICAgIH0sIGRlbGF5VGltZSk7IC8vYWRkIGEgZGVsYXkgYmVjYXVzZSB5b3Ugd29uJ3Qgc2VlIGl0IHdpdGggZmFzdCBpbnRlcm5ldC5cbiAgICB9XG4gIH1cblxuICByZXR1cm4geyAvL3JldHVybiBvbmx5IHRoZSBmdW50aW9ucyB0aGF0IGFyZSBuZXNzZWVyaXlcbiAgICB1cmxzOiB1cmxzLFxuICAgIG9uZTogb25lLFxuICAgIGFsbDogYWxsLFxuICAgIGRhdGE6IGRhdGEsXG4gICAgbG9hZGluZzogbG9hZGluZ1xuICB9O1xufSgpO1xuXG4vL1RvIGVhc2lseSBzZWxlY3Qgc29tZXRoaW5nIGZyb20gdGhlIERPTVxuVlIuZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgdmFyIGRhdGVzID0ge1xuICAgIGRheXM6IFsnU3VuZGF5JywgJ01vbmRheScsICdUdWVzZGF5JywgJ1dlZG5lc2RheScsICdUaHVyc2RheScsICdGcmlkYXknLCAnU2F0dXJkYXknXSxcbiAgICBtb250aHM6IFsnSmFudWFyeScsICdGZWJydWFyeScsICdNYXJjaCcsICdBcHJpbCcsICdNYXknLCAnSnVuZScsICdKdWx5JywgJ0F1Z3VzdCcsICdTZXB0ZW1iZXInLCAnT2N0b2JlcicsICdOb3ZlbWJlcicsICdEZWNlbWJlciddXG4gIH07XG5cbiAgZnVuY3Rpb24gcmVhZGFibGVEYXRlKHVuZnJvbWF0ZWREYXRlKSB7XG4gICAgdmFyIG5ld0RhdGUgPSBuZXcgRGF0ZSh1bmZyb21hdGVkRGF0ZSk7XG4gICAgdmFyIG1vbnRoID0gZGF0ZXMubW9udGhzW25ld0RhdGUuZ2V0TW9udGgoKV07XG4gICAgdmFyIGRhdGUgPSBuZXdEYXRlLmdldERhdGUoKTtcbiAgICB2YXIgZGF5ID0gZGF0ZXMuZGF5c1tuZXdEYXRlLmdldERheSgpXTtcbiAgICB2YXIgeWVhciA9IG5ld0RhdGUuZ2V0RnVsbFllYXIoKTtcblxuICAgIHJldHVybiBkYXkgKyAnICcgKyBkYXRlICsgJyAnICsgbW9udGggKyAnICcgKyB5ZWFyO1xuICB9XG5cbiAgcmV0dXJuIHsgLy9yZXR1cm4gb25seSB0aGUgZnVudGlvbnMgdGhhdCBhcmUgbmVzc2Vlcml5XG4gICAgcmVhZGFibGVEYXRlOiByZWFkYWJsZURhdGVcbiAgfTtcbn0oKTtcblxuVlIucm91dGVyID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBzaG93KGlkKSB7XG4gICAgdmFyIHBhZ2VzID0gVlIuZ2V0LmFsbCgnLnBhZ2UnKTtcbiAgICB2YXIgc2VsZWN0ZWRQYWdlID0gVlIuZ2V0Lm9uZShpZCk7XG5cbiAgICAvL2Rpc2FibGUgYWxsIHRoZSBwYWdlc1xuICAgIHBhZ2VzLmZvckVhY2goZnVuY3Rpb24gKHBhZ2UpIHtcbiAgICAgIHBhZ2UuY2xhc3NMaXN0LmFkZCgnZGlzYWJsZWQnKTtcbiAgICB9KTtcblxuICAgIHNlbGVjdGVkUGFnZS5jbGFzc0xpc3QucmVtb3ZlKCdkaXNhYmxlZCcpO1xuXG4gICAgaWYgKGlkID09PSAnI2NhcmRib2FyZCcpIHtcbiAgICAgIFZSLmNhcmRib2FyZC5pbml0KCk7XG4gICAgfSBlbHNlIGlmIChpZCA9PT0gJyNsYW5kaW5nJykge1xuXG4gICAgICBWUi5sYW5kaW5nLmluaXQoKTtcbiAgICB9IGVsc2UgaWYgKGlkID09PSAnI3ZpZGVvJykge1xuICAgICAgY29uc29sZS5sb2coJ2hpb3NkJyk7XG4gICAgICAvLyBWUi5yZW5kZXIuaW5pdCgpO1xuICAgIH0gZWxzZSBpZiAoaWQgPT09ICcjdGltZWxpbmUnKSB7XG4gICAgICBWUi50aW1lbGluZS5pbml0KCk7XG4gICAgfVxuICB9XG4gIHJldHVybiB7XG4gICAgc2hvdzogc2hvd1xuICB9O1xufSgpO1xuXG5WUi5sYW5kaW5nID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBpbml0KGlkKSB7XG4gICAgZnVuY3Rpb24gZ2V0UmFuZG9tSW50KG1pbiwgbWF4KSB7XG4gICAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbiArIDEpKSArIG1pbjtcbiAgICB9XG4gICAgdmFyIGNvbG9ycyA9IFsnI0YwRjA4MicsICcjOENGMDhDJywgJyM4Q0YwRjAnLCAnIzhDQTBGRicsICcjRjA1MDUwJ107XG4gICAgdmFyIGJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdib2R5Jyk7XG5cbiAgICB2YXIgbnVtYmVyID0gZ2V0UmFuZG9tSW50KDAsIDQpO1xuICAgIGJvZHkuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gY29sb3JzW251bWJlcl07XG4gICAgVlIuZ2V0LmxvYWRpbmcoZmFsc2UpO1xuICAgIF9idXR0b24oKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9idXR0b24oKSB7XG4gICAgdmFyIGxhbmRpbmdidXR0b24gPSBWUi5nZXQub25lKCcjbGFuZGluZ2J1dHRvbicpO1xuICAgIGxhbmRpbmdidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICBWUi5yb3V0ZXIuc2hvdygnI3RpbWVsaW5lJyk7XG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIHtcbiAgICBpbml0OiBpbml0XG4gIH07XG59KCk7XG5cblZSLnRpbWVsaW5lID0gZnVuY3Rpb24gKCkge1xuICAvL2Z1bnRpb24gdG8gcmVuZGVyIGEgdGVtcGxhdGUuXG4gIC8vcmVuZGVyIHRoZSB0ZW1wbGF0ZVxuICB2YXIgX3ZpZGVvcyA9IHZvaWQgMDtcblxuICBmdW5jdGlvbiBpbml0KCkge1xuICAgIC8vIHIuX2dldERhdGEoKTtcbiAgICBfZ2V0RGF0YSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gX2dldERhdGEoKSB7XG5cbiAgICB2YXIgdmlkZW9MaXN0ID0gVlIuZ2V0Lm9uZSgnLnZpZGVvLWxpc3QnKTtcbiAgICB2YXIgdXJsID0gVlIuZ2V0LnVybHMoJ2RhdGEuanNvbicpLmRhdGFVcmw7XG5cbiAgICBWUi5nZXQuZGF0YSh1cmwpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICBfdmlkZW9zID0gSlNPTi5wYXJzZShyZXNwb25zZSk7XG5cbiAgICAgIHZpZGVvTGlzdC5hcHBlbmRDaGlsZChfZ2VuZXJhdGVUaW1lbGluZShfdmlkZW9zKSk7XG4gICAgICBjbGlja1ZpZGVvKCk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBfZ2VuZXJhdGVUaW1lbGluZShkYXRhKSB7XG4gICAgdmFyIHZpZGVvTGlzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3VsJyk7XG5cbiAgICBkYXRhLnZpZGVvcy5mb3JFYWNoKGZ1bmN0aW9uIChvYmopIHtcbiAgICAgIHZhciB2aWRlb0lkID0gT2JqZWN0LmtleXMob2JqKVswXTtcblxuICAgICAgdmFyIGVsZW1lbnQgPSBfY3JlYXRlVmlkZW9FbGVtZW50KG9ialt2aWRlb0lkXS50aHVtYm5haWwsIG9ialt2aWRlb0lkXS50aXRsZSwgb2JqW3ZpZGVvSWRdLmRlc2NyaXB0aW9uLCB2aWRlb0lkKTtcblxuICAgICAgdmlkZW9MaXN0LmlubmVySFRNTCArPSBlbGVtZW50OyAvL2FkZCBpdCB0byB0aGUgdWxcbiAgICB9KTtcbiAgICByZXR1cm4gdmlkZW9MaXN0O1xuICB9XG5cbiAgZnVuY3Rpb24gX2NyZWF0ZVZpZGVvRWxlbWVudCh0dW1iVXJsLCB0aXRsZSwgZGVzY3JpcHRpb24sIHZpZGVvSWQpIHtcbiAgICB2YXIgdHVtYlVybEdlbmVyYXRlZCA9IFZSLmdldC51cmxzKHR1bWJVcmwpLnR1bWJVcmw7XG4gICAgdmFyIHZpZGVvVXJsID0gVlIuZ2V0LnVybHModHVtYlVybCkudHVtYlVybDtcblxuICAgIHZhciB2aWRlbyA9ICc8dWw+PGRpdiBjbGFzcz1cInZpZGVvLXdyYXBwZXJcIj4nO1xuICAgIHZpZGVvICs9ICdcdFx0XHRcdFx0PGRpdiBjbGFzcz1cInRodW1ibmFpbC13cmFwcGVyXCI+JztcbiAgICB2aWRlbyArPSAnXHRcdFx0XHRcdFx0PGltZyBjbGFzcz1cInRodW1ibmFpbFwiIHNyYz1cIicgKyB0dW1iVXJsR2VuZXJhdGVkICsgJ1wiPic7XG4gICAgdmlkZW8gKz0gJyAgXHRcdFx0XHRcdDxkaXYgY2xhc3M9XCJtZWRpYS1jYXB0aW9uXCI+JztcbiAgICB2aWRlbyArPSAnICBcdFx0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwiY2FwdGlvbi1jb250ZW50XCI+JztcbiAgICB2aWRlbyArPSAnICBcdFx0XHRcdFx0XHRcdDxoMj4nICsgdGl0bGUgKyAnPC9oMj4nO1xuICAgIHZpZGVvICs9ICcgIFx0XHRcdFx0XHRcdFx0PHNwYW4+JyArIGRlc2NyaXB0aW9uICsgJzwvc3Bhbj4nO1xuICAgIHZpZGVvICs9ICcgIFx0XHRcdFx0XHRcdDwvZGl2Pic7XG4gICAgdmlkZW8gKz0gJyAgICBcdFx0XHRcdDwvZGl2Pic7XG4gICAgdmlkZW8gKz0gJyAgXHRcdFx0XHRcdDxkaXYgY2xhc3M9XCJ2aWRlby1wbGF5XCIgZGF0YS12aWRlby1pZD1cIicgKyB2aWRlb0lkICsgJ1wiXCI+JztcbiAgICB2aWRlbyArPSAnICBcdFx0XHRcdFx0PC9kaXY+JztcbiAgICB2aWRlbyArPSAnXHRcdFx0XHRcdDwvZGl2Pic7XG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHQ8dmlkZW8gYXV0b3BsYXkgY29udHJvbHMgc3R5bGU9XCJkaXNwbGF5Om5vbmU7XCI+JztcbiAgICB2aWRlbyArPSAnXHRcdFx0XHRcdFNvcnJ5LCB5b3VyIGJyb3dzZXIgZG9lc250IHN1cHBvcnQgZW1iZWRkZWQgdmlkZW9zJztcbiAgICB2aWRlbyArPSAnXHRcdFx0XHRcdDwvdmlkZW8+JztcbiAgICB2aWRlbyArPSAnPC9kaXY+PC91bD4nO1xuICAgIHJldHVybiB2aWRlbztcbiAgfVxuXG4gIGZ1bmN0aW9uIGNsaWNrVmlkZW8oKSB7XG4gICAgVlIuZ2V0Lm9uZSgnLnZpZGVvLWxpc3QgdWwnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICBpZiAoZS50YXJnZXQuY2xhc3NOYW1lID09IFwidmlkZW8tcGxheVwiKSB7XG5cbiAgICAgICAgdmFyIHNlbGVjdGVkVmlkZW9JZCA9IGUudGFyZ2V0LmRhdGFzZXQudmlkZW9JZDtcbiAgICAgICAgdmFyIHNlbGVjdGVkVmlkZW8gPSBnZXRWaWRlbyhzZWxlY3RlZFZpZGVvSWQpO1xuICAgICAgICBjb25zb2xlLmxvZyhzZWxlY3RlZFZpZGVvKTtcbiAgICAgICAgc2VsZWN0ZWRWaWRlby5pZCA9IHNlbGVjdGVkVmlkZW9JZDtcblxuICAgICAgICAvLyBOYXZpZ2F0ZSB0byB0aGUgbWV0YSB2aWRlbyB2aWV3XG4gICAgICAgIGNvbnNvbGUubG9nKCdOYXZpZ2F0ZSB0byB0aGUgbWV0YSB2aWRlbyB2aWV3Jyk7XG5cbiAgICAgICAgLy8gZ290b1NlY3Rpb24oJ3ZpZGVvLW1ldGEnKTtcbiAgICAgICAgVlIucm91dGVyLnNob3coJyN2aWRlbycpO1xuICAgICAgICByZW5kZXJWaWRlb01ldGFEYXRhKHNlbGVjdGVkVmlkZW8pO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gY2xpY2tNZXRhVmlkZW8oKSB7XG4gICAgVlIuZ2V0Lm9uZSgnLnZpZGVvLW1ldGEnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICBpZiAoZS50YXJnZXQuaWQgPT0gXCJtZXRhLXZpZGVvLXBsYXlcIikge1xuICAgICAgICB2YXIgc2VsZWN0ZWRWaWRlb0lkID0gZS50YXJnZXQuZGF0YXNldC52aWRlb0lkO1xuICAgICAgICB2YXIgc2VsZWN0ZWRWaWRlbyA9IGdldFZpZGVvKHNlbGVjdGVkVmlkZW9JZClbc2VsZWN0ZWRWaWRlb0lkXTtcblxuICAgICAgICBpZiAoZ2V0QWN0aXZlU2VjdGlvbigpID09ICd2aWRlby1tZXRhJykge1xuICAgICAgICAgIC8vIFBsYXkgdGhlIHZpZGVvXG4gICAgICAgICAgY29uc29sZS5sb2coJ1BsYXkgdGUgdmlkZW8nKTtcblxuICAgICAgICAgIHZhciBtZXRhVmlkZW9FbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldGEtdmlkZW8nKTtcbiAgICAgICAgICBtZXRhVmlkZW9FbGVtZW50LnNyYyA9ICdtZWRpYS92aWRlby8nICsgc2VsZWN0ZWRWaWRlby5maWxlbmFtZTtcbiAgICAgICAgICBtZXRhVmlkZW9FbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xuICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ21ldGEtdGh1bWJuYWlsLXdyYXBwZXInKVswXS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUmVuZGVycyB0aGUgdmlkZW8gbWV0YSBkYXRhIGluIHRoZSB2aWRlby1tZXRhIHNlY3Rpb25cbiAgICpcbiAgICogQHBhcmFtICAgICAge29ian0gIHNlbGVjdGVkVmlkZW8gIFRoZSBzZWxlY3RlZCB2aWRlb1xuICAgKi9cbiAgZnVuY3Rpb24gcmVuZGVyVmlkZW9NZXRhRGF0YShzZWxlY3RlZFZpZGVvKSB7XG4gICAgY29uc29sZS5sb2coc2VsZWN0ZWRWaWRlbyk7XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldGEtdmlkZW8tcGxheScpLnNldEF0dHJpYnV0ZSgnZGF0YS12aWRlby1pZCcsIHNlbGVjdGVkVmlkZW8uaWQpO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd2aWRlby10aXRsZScpLmlubmVySFRNTCA9IHNlbGVjdGVkVmlkZW9bc2VsZWN0ZWRWaWRlby5pZF0udGl0bGU7XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rlc2NyaXB0aW9uJykuaW5uZXJIVE1MID0gc2VsZWN0ZWRWaWRlb1tzZWxlY3RlZFZpZGVvLmlkXS5kZXNjcmlwdGlvbjtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGF0ZS1hbGlhcycpLmlubmVySFRNTCA9IHNlbGVjdGVkVmlkZW9bc2VsZWN0ZWRWaWRlby5pZF0uZGF0ZWFsaWFzO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhLXRodW1ibmFpbCcpLnNyYyA9ICdtZWRpYS90aHVtYm5haWxzLycgKyBzZWxlY3RlZFZpZGVvW3NlbGVjdGVkVmlkZW8uaWRdLnRodW1ibmFpbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSB2aWRlby5cbiAgICpcbiAgICogQHBhcmFtICAgICAgc3RyaW5nIHZpZGVvSWQgIFRoZSB2aWRlbyBpZGVudGlmaWVyXG4gICAqIEByZXR1cm4gICAgIG9iaiAgVGhlIHZpZGVvLlxuICAgKi9cbiAgZnVuY3Rpb24gZ2V0VmlkZW8odmlkZW9JZCkge1xuICAgIHZhciBzZWxlY3RlZFZpZGVvO1xuICAgIGNvbnNvbGUubG9nKF92aWRlb3MpO1xuICAgIF92aWRlb3MudmlkZW9zLnNvbWUoZnVuY3Rpb24gKGVsbSwgaW5kZXgpIHtcbiAgICAgIGlmIChlbG1bdmlkZW9JZF0pIHtcbiAgICAgICAgc2VsZWN0ZWRWaWRlbyA9IGVsbTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gc2VsZWN0ZWRWaWRlbztcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgaW5pdDogaW5pdFxuICB9O1xufSgpO1xuXG5WUi5zdGFydCA9IGZ1bmN0aW9uICgpIHtcbiAgLy9ydW4gYWxsIHRoZSBmdW5jaXRvbnMgZm9yIHN0YXJ0aW5nIHRoZSBhcHBcbiAgdmFyIGluaXQgPSBmdW5jdGlvbiBpbml0KCkge1xuICAgIFZSLnJvdXRlci5zaG93KCcjbGFuZGluZycpO1xuICB9O1xuICByZXR1cm4ge1xuICAgIGluaXQ6IGluaXRcbiAgfTtcbn0oKTtcblxuVlIuc3RhcnQuaW5pdCgpOyIsInZhciBWUiA9IFZSIHx8IHt9O1xuJ3VzZSBzdHJpY3QnO1xuIiwiLy9UbyBlYXNpbHkgc2VsZWN0IHNvbWV0aGluZyBmcm9tIHRoZSBET01cblZSLmdldCA9IChmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIHVybHModXJsKSB7XG5cbiAgICAvLyBsZXQgYmFzZSA9ICcvVlJMaWZlb2ZKZXN1cy8nO1xuICAgIGxldCBiYXNlID0gJy8nO1xuICAgIGxldCB0dW1iVXJsID0gYmFzZSArICdtZWRpYS90aHVtYm5haWxzLycgKyB1cmw7XG4gICAgbGV0IHZpZGVvVXJsID0gYmFzZSArICdtZWRpYS92aWRlby8nICsgdXJsO1xuICAgIGxldCBkYXRhVXJsID0gYmFzZSArICdkYXRhLycgKyB1cmw7XG5cbiAgICByZXR1cm4ge1xuICAgICAgYmFzZTogYmFzZSxcbiAgICAgIHR1bWJVcmw6IHR1bWJVcmwsXG4gICAgICB2aWRlb1VybDogdmlkZW9VcmwsXG4gICAgICBkYXRhVXJsXG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG9uZShzZWxlY3RvcikgeyAvL1RoaXMgaXMgYSBtZXRob2RcbiAgICByZXR1cm4gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7XG4gIH1cblxuICBmdW5jdGlvbiBhbGwoc2VsZWN0b3IpIHtcbiAgICByZXR1cm4gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7XG4gIH1cblxuICBmdW5jdGlvbiBkYXRhKHVybCkge1xuICAgIC8vIHJldHVybiBhIFByb21pc2Ugb2JqZWN0XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIHZhciByZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICAvL29wZW4gYW4gZ2V0IHJlcXVlc3RcbiAgICAgIHJlcXVlc3Qub3BlbignR0VUJywgdXJsKTtcbiAgICAgIHJlcXVlc3Qub25sb2Fkc3RhcnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxvYWRpbmcodHJ1ZSk7XG4gICAgICB9O1xuICAgICAgcmVxdWVzdC5vbmxvYWRlbmQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxvYWRpbmcodHJ1ZSk7XG4gICAgICB9O1xuXG4gICAgICAvL2lmIHRoZSByZXF1ZXN0IGlzIGRvbmVcbiAgICAgIHJlcXVlc3Qub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAvL29ueSBpZiByZXF1ZXN0IGlzIGRvbmVcbiAgICAgICAgbGV0IHN0YXR1c0NvZGUgPSAyMDA7XG4gICAgICAgIGlmIChyZXF1ZXN0LnN0YXR1cyA9PSBzdGF0dXNDb2RlKSB7XG4gICAgICAgICAgbG9hZGluZyhmYWxzZSk7XG5cbiAgICAgICAgICAvLyBzZW5kIHRleHQgZm9ybSByZXF1ZXN0XG4gICAgICAgICAgcmVzb2x2ZShyZXF1ZXN0LnJlc3BvbnNlVGV4dCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gcmVqZWN0IHRoZSBwcm9taXNlIGlmIHRoZXJlIGlzIGEgZXJyXG4gICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcigncmVxdWVzdCBmYWlsZWQhJykpO1xuICAgICAgICAgIFZSLnV4LnNob3dFcnIoJ1RoZXJlIHdlbnQgc29tZXRoaW5nIHdyb25nJyk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICAvL3NlbmQgdGhlIHJlcXVlc3RcbiAgICAgIHJlcXVlc3Quc2VuZCgpO1xuICAgIH0pO1xuICB9XG4gIC8vIHNob3cgb3IgaGlkZSB0aGUgbG9hZGluZyBzcGlubmVyXG4gIGZ1bmN0aW9uIGxvYWRpbmcoc2hvdykge1xuICAgIGxldCBkZWxheVRpbWUgPSAzMDA7XG4gICAgaWYgKHNob3cpIHtcbiAgICAgIFZSLmdldC5vbmUoJy5sb2FkaW5nJykuY2xhc3NMaXN0LnJlbW92ZSgnZGlzYWJsZWQnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy9zaG93IGxvYWRpbmdcbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICBWUi5nZXQub25lKCcubG9hZGluZycpLmNsYXNzTGlzdC5hZGQoJ2Rpc2FibGVkJyk7XG4gICAgICB9LCBkZWxheVRpbWUpOyAvL2FkZCBhIGRlbGF5IGJlY2F1c2UgeW91IHdvbid0IHNlZSBpdCB3aXRoIGZhc3QgaW50ZXJuZXQuXG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHsgLy9yZXR1cm4gb25seSB0aGUgZnVudGlvbnMgdGhhdCBhcmUgbmVzc2Vlcml5XG4gICAgdXJsczogdXJscyxcbiAgICBvbmU6IG9uZSxcbiAgICBhbGw6IGFsbCxcbiAgICBkYXRhOiBkYXRhLFxuICAgIGxvYWRpbmc6IGxvYWRpbmdcbiAgfTtcbn0pKCk7XG4iLCIvL1RvIGVhc2lseSBzZWxlY3Qgc29tZXRoaW5nIGZyb20gdGhlIERPTVxuVlIuZGF0ZSA9IChmdW5jdGlvbiAoKSB7XG4gIGxldCBkYXRlcyA9IHtcbiAgICBkYXlzOiBbJ1N1bmRheScsICdNb25kYXknLCAnVHVlc2RheScsICdXZWRuZXNkYXknLCAnVGh1cnNkYXknLCAnRnJpZGF5JywgJ1NhdHVyZGF5J10sXG4gICAgbW9udGhzOiBbJ0phbnVhcnknLCAnRmVicnVhcnknLCAnTWFyY2gnLCAnQXByaWwnLCAnTWF5JywgJ0p1bmUnLCAnSnVseScsICdBdWd1c3QnLCAnU2VwdGVtYmVyJywgJ09jdG9iZXInLCAnTm92ZW1iZXInLCAnRGVjZW1iZXInXSxcbiAgfTtcblxuICBmdW5jdGlvbiByZWFkYWJsZURhdGUodW5mcm9tYXRlZERhdGUpIHtcbiAgICBsZXQgbmV3RGF0ZSA9IG5ldyBEYXRlKHVuZnJvbWF0ZWREYXRlKTtcbiAgICBsZXQgbW9udGggPSBkYXRlcy5tb250aHNbbmV3RGF0ZS5nZXRNb250aCgpXTtcbiAgICBsZXQgZGF0ZSA9IG5ld0RhdGUuZ2V0RGF0ZSgpO1xuICAgIGxldCBkYXkgPSBkYXRlcy5kYXlzW25ld0RhdGUuZ2V0RGF5KCldO1xuICAgIGxldCB5ZWFyID0gbmV3RGF0ZS5nZXRGdWxsWWVhcigpO1xuXG4gICAgcmV0dXJuIGRheSArICcgJyArIGRhdGUgKyAnICcgKyBtb250aCArICcgJyArIHllYXI7XG4gIH1cblxuXG4gIHJldHVybiB7IC8vcmV0dXJuIG9ubHkgdGhlIGZ1bnRpb25zIHRoYXQgYXJlIG5lc3NlZXJpeVxuICAgIHJlYWRhYmxlRGF0ZTogcmVhZGFibGVEYXRlXG4gIH07XG59KSgpO1xuIiwiVlIucm91dGVyID0gKGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gc2hvdyhpZCkge1xuICAgIHZhciBwYWdlcyA9IFZSLmdldC5hbGwoJy5wYWdlJyk7XG4gICAgdmFyIHNlbGVjdGVkUGFnZSA9IFZSLmdldC5vbmUoaWQpO1xuXG4gICAgLy9kaXNhYmxlIGFsbCB0aGUgcGFnZXNcbiAgICBwYWdlcy5mb3JFYWNoKGZ1bmN0aW9uIChwYWdlKSB7XG4gICAgICBwYWdlLmNsYXNzTGlzdC5hZGQoJ2Rpc2FibGVkJyk7XG4gICAgfSk7XG5cbiAgICBzZWxlY3RlZFBhZ2UuY2xhc3NMaXN0LnJlbW92ZSgnZGlzYWJsZWQnKTtcblxuICAgIGlmIChpZCA9PT0gJyNjYXJkYm9hcmQnKSB7XG4gICAgICBWUi5jYXJkYm9hcmQuaW5pdCgpO1xuICAgIH0gZWxzZSBpZiAoaWQgPT09ICcjbGFuZGluZycpIHtcblxuICAgICAgVlIubGFuZGluZy5pbml0KCk7XG4gICAgfSBlbHNlIGlmIChpZCA9PT0gJyN2aWRlbycpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdoaW9zZCcpO1xuICAgICAgLy8gVlIucmVuZGVyLmluaXQoKTtcbiAgICB9IGVsc2UgaWYgKGlkID09PSAnI3RpbWVsaW5lJykge1xuICAgICAgVlIudGltZWxpbmUuaW5pdCgpO1xuICAgIH1cbiAgfVxuICByZXR1cm4ge1xuICAgIHNob3c6IHNob3dcbiAgfTtcbn0pKCk7XG4iLCJWUi5sYW5kaW5nID0gKGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gaW5pdChpZCkge1xuICAgIGZ1bmN0aW9uIGdldFJhbmRvbUludChtaW4sIG1heCkge1xuICAgICAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChtYXggLSBtaW4gKyAxKSkgKyBtaW47XG4gICAgfVxuICAgIHZhciBjb2xvcnMgPSBbJyNGMEYwODInLFxuICAgICAgJyM4Q0YwOEMnLFxuICAgICAgJyM4Q0YwRjAnLFxuICAgICAgJyM4Q0EwRkYnLFxuICAgICAgJyNGMDUwNTAnLFxuICAgIF07XG4gICAgdmFyIGJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdib2R5Jyk7XG5cbiAgICB2YXIgbnVtYmVyID0gZ2V0UmFuZG9tSW50KDAsIDQpO1xuICAgIGJvZHkuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gY29sb3JzW251bWJlcl07XG4gICAgVlIuZ2V0LmxvYWRpbmcoZmFsc2UpO1xuICAgIF9idXR0b24oKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9idXR0b24oKSB7XG4gICAgdmFyIGxhbmRpbmdidXR0b24gPSBWUi5nZXQub25lKCcjbGFuZGluZ2J1dHRvbicpO1xuICAgIGxhbmRpbmdidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICBWUi5yb3V0ZXIuc2hvdygnI3RpbWVsaW5lJylcbiAgICB9KTtcbiAgfVxuICByZXR1cm4ge1xuICAgIGluaXQ6IGluaXRcbiAgfTtcbn0pKCk7XG4iLCJWUi50aW1lbGluZSA9IChmdW5jdGlvbiAoKSB7IC8vZnVudGlvbiB0byByZW5kZXIgYSB0ZW1wbGF0ZS5cbiAgLy9yZW5kZXIgdGhlIHRlbXBsYXRlXG4gIGxldCBfdmlkZW9zO1xuXG4gIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgLy8gci5fZ2V0RGF0YSgpO1xuICAgIF9nZXREYXRhKCk7XG4gIH1cblxuICBmdW5jdGlvbiBfZ2V0RGF0YSgpIHtcblxuICAgIGxldCB2aWRlb0xpc3QgPSBWUi5nZXQub25lKCcudmlkZW8tbGlzdCcpO1xuICAgIGxldCB1cmwgPSBWUi5nZXQudXJscygnZGF0YS5qc29uJykuZGF0YVVybDtcblxuICAgIFZSLmdldC5kYXRhKHVybCkudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICBfdmlkZW9zID0gSlNPTi5wYXJzZShyZXNwb25zZSk7XG5cbiAgICAgIHZpZGVvTGlzdC5hcHBlbmRDaGlsZChfZ2VuZXJhdGVUaW1lbGluZShfdmlkZW9zKSk7XG4gICAgICBjbGlja1ZpZGVvKCk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBfZ2VuZXJhdGVUaW1lbGluZShkYXRhKSB7XG4gICAgbGV0IHZpZGVvTGlzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3VsJyk7XG5cbiAgICBkYXRhLnZpZGVvcy5mb3JFYWNoKGZ1bmN0aW9uIChvYmopIHtcbiAgICAgIHZhciB2aWRlb0lkID0gT2JqZWN0LmtleXMob2JqKVswXTtcblxuICAgICAgbGV0IGVsZW1lbnQgPSBfY3JlYXRlVmlkZW9FbGVtZW50KG9ialt2aWRlb0lkXS50aHVtYm5haWwsIG9ialt2aWRlb0lkXS50aXRsZSwgb2JqW3ZpZGVvSWRdLmRlc2NyaXB0aW9uLCB2aWRlb0lkKTtcblxuICAgICAgdmlkZW9MaXN0LmlubmVySFRNTCArPSBlbGVtZW50OyAvL2FkZCBpdCB0byB0aGUgdWxcbiAgICB9KTtcbiAgICByZXR1cm4gdmlkZW9MaXN0O1xuXG4gIH1cblxuICBmdW5jdGlvbiBfY3JlYXRlVmlkZW9FbGVtZW50KHR1bWJVcmwsIHRpdGxlLCBkZXNjcmlwdGlvbiwgdmlkZW9JZCkge1xuICAgIGxldCB0dW1iVXJsR2VuZXJhdGVkID0gVlIuZ2V0LnVybHModHVtYlVybCkudHVtYlVybDtcbiAgICBsZXQgdmlkZW9VcmwgPSBWUi5nZXQudXJscyh0dW1iVXJsKS50dW1iVXJsO1xuXG4gICAgbGV0IHZpZGVvID0gJzx1bD48ZGl2IGNsYXNzPVwidmlkZW8td3JhcHBlclwiPic7XG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwidGh1bWJuYWlsLXdyYXBwZXJcIj4nXG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHRcdDxpbWcgY2xhc3M9XCJ0aHVtYm5haWxcIiBzcmM9XCInICsgdHVtYlVybEdlbmVyYXRlZCArICdcIj4nO1xuICAgIHZpZGVvICs9ICcgIFx0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwibWVkaWEtY2FwdGlvblwiPic7XG4gICAgdmlkZW8gKz0gJyAgXHRcdFx0XHRcdFx0PGRpdiBjbGFzcz1cImNhcHRpb24tY29udGVudFwiPic7XG4gICAgdmlkZW8gKz0gJyAgXHRcdFx0XHRcdFx0XHQ8aDI+JyArIHRpdGxlICsgJzwvaDI+JztcbiAgICB2aWRlbyArPSAnICBcdFx0XHRcdFx0XHRcdDxzcGFuPicgKyBkZXNjcmlwdGlvbiArICc8L3NwYW4+JztcbiAgICB2aWRlbyArPSAnICBcdFx0XHRcdFx0XHQ8L2Rpdj4nO1xuICAgIHZpZGVvICs9ICcgICAgXHRcdFx0XHQ8L2Rpdj4nO1xuICAgIHZpZGVvICs9ICcgIFx0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwidmlkZW8tcGxheVwiIGRhdGEtdmlkZW8taWQ9XCInICsgdmlkZW9JZCArICdcIlwiPic7XG4gICAgdmlkZW8gKz0gJyAgXHRcdFx0XHRcdDwvZGl2Pic7XG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHQ8L2Rpdj4nO1xuICAgIHZpZGVvICs9ICdcdFx0XHRcdFx0PHZpZGVvIGF1dG9wbGF5IGNvbnRyb2xzIHN0eWxlPVwiZGlzcGxheTpub25lO1wiPic7XG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHRTb3JyeSwgeW91ciBicm93c2VyIGRvZXNudCBzdXBwb3J0IGVtYmVkZGVkIHZpZGVvcyc7XG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHQ8L3ZpZGVvPic7XG4gICAgdmlkZW8gKz0gJzwvZGl2PjwvdWw+JztcbiAgICByZXR1cm4gdmlkZW87XG4gIH1cblxuICBmdW5jdGlvbiBjbGlja1ZpZGVvKCkge1xuICAgIFZSLmdldC5vbmUoJy52aWRlby1saXN0IHVsJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgICAgaWYgKGUudGFyZ2V0LmNsYXNzTmFtZSA9PSBcInZpZGVvLXBsYXlcIikge1xuXG4gICAgICAgIHZhciBzZWxlY3RlZFZpZGVvSWQgPSBlLnRhcmdldC5kYXRhc2V0LnZpZGVvSWQ7XG4gICAgICAgIHZhciBzZWxlY3RlZFZpZGVvID0gZ2V0VmlkZW8oc2VsZWN0ZWRWaWRlb0lkKTtcbiAgICAgICAgY29uc29sZS5sb2coc2VsZWN0ZWRWaWRlbyk7XG4gICAgICAgIHNlbGVjdGVkVmlkZW8uaWQgPSBzZWxlY3RlZFZpZGVvSWQ7XG5cblxuICAgICAgICAvLyBOYXZpZ2F0ZSB0byB0aGUgbWV0YSB2aWRlbyB2aWV3XG4gICAgICAgIGNvbnNvbGUubG9nKCdOYXZpZ2F0ZSB0byB0aGUgbWV0YSB2aWRlbyB2aWV3Jyk7XG5cbiAgICAgICAgLy8gZ290b1NlY3Rpb24oJ3ZpZGVvLW1ldGEnKTtcbiAgICAgICAgVlIucm91dGVyLnNob3coJyN2aWRlbycpO1xuICAgICAgICByZW5kZXJWaWRlb01ldGFEYXRhKHNlbGVjdGVkVmlkZW8pO1xuXG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBjbGlja01ldGFWaWRlbygpIHtcbiAgICBWUi5nZXQub25lKCcudmlkZW8tbWV0YScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgIGlmIChlLnRhcmdldC5pZCA9PSBcIm1ldGEtdmlkZW8tcGxheVwiKSB7XG4gICAgICAgIHZhciBzZWxlY3RlZFZpZGVvSWQgPSBlLnRhcmdldC5kYXRhc2V0LnZpZGVvSWQ7XG4gICAgICAgIHZhciBzZWxlY3RlZFZpZGVvID0gZ2V0VmlkZW8oc2VsZWN0ZWRWaWRlb0lkKVtzZWxlY3RlZFZpZGVvSWRdO1xuXG4gICAgICAgIGlmIChnZXRBY3RpdmVTZWN0aW9uKCkgPT0gJ3ZpZGVvLW1ldGEnKSB7XG4gICAgICAgICAgLy8gUGxheSB0aGUgdmlkZW9cbiAgICAgICAgICBjb25zb2xlLmxvZygnUGxheSB0ZSB2aWRlbycpO1xuXG4gICAgICAgICAgdmFyIG1ldGFWaWRlb0VsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YS12aWRlbycpO1xuICAgICAgICAgIG1ldGFWaWRlb0VsZW1lbnQuc3JjID0gJ21lZGlhL3ZpZGVvLycgKyBzZWxlY3RlZFZpZGVvLmZpbGVuYW1lO1xuICAgICAgICAgIG1ldGFWaWRlb0VsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnbWV0YS10aHVtYm5haWwtd3JhcHBlcicpWzBdLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG5cbiAgLyoqXG4gICAqIFJlbmRlcnMgdGhlIHZpZGVvIG1ldGEgZGF0YSBpbiB0aGUgdmlkZW8tbWV0YSBzZWN0aW9uXG4gICAqXG4gICAqIEBwYXJhbSAgICAgIHtvYmp9ICBzZWxlY3RlZFZpZGVvICBUaGUgc2VsZWN0ZWQgdmlkZW9cbiAgICovXG4gIGZ1bmN0aW9uIHJlbmRlclZpZGVvTWV0YURhdGEoc2VsZWN0ZWRWaWRlbykge1xuICAgIGNvbnNvbGUubG9nKHNlbGVjdGVkVmlkZW8pO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhLXZpZGVvLXBsYXknKS5zZXRBdHRyaWJ1dGUoJ2RhdGEtdmlkZW8taWQnLCBzZWxlY3RlZFZpZGVvLmlkKTtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmlkZW8tdGl0bGUnKS5pbm5lckhUTUwgPSBzZWxlY3RlZFZpZGVvW3NlbGVjdGVkVmlkZW8uaWRdLnRpdGxlO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXNjcmlwdGlvbicpLmlubmVySFRNTCA9IHNlbGVjdGVkVmlkZW9bc2VsZWN0ZWRWaWRlby5pZF0uZGVzY3JpcHRpb247XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RhdGUtYWxpYXMnKS5pbm5lckhUTUwgPSBzZWxlY3RlZFZpZGVvW3NlbGVjdGVkVmlkZW8uaWRdLmRhdGVhbGlhcztcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YS10aHVtYm5haWwnKS5zcmMgPSAnbWVkaWEvdGh1bWJuYWlscy8nICsgc2VsZWN0ZWRWaWRlb1tzZWxlY3RlZFZpZGVvLmlkXS50aHVtYm5haWw7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgdmlkZW8uXG4gICAqXG4gICAqIEBwYXJhbSAgICAgIHN0cmluZyB2aWRlb0lkICBUaGUgdmlkZW8gaWRlbnRpZmllclxuICAgKiBAcmV0dXJuICAgICBvYmogIFRoZSB2aWRlby5cbiAgICovXG4gIGZ1bmN0aW9uIGdldFZpZGVvKHZpZGVvSWQpIHtcbiAgICB2YXIgc2VsZWN0ZWRWaWRlbztcbiAgICBjb25zb2xlLmxvZyhfdmlkZW9zKTtcbiAgICBfdmlkZW9zLnZpZGVvcy5zb21lKGZ1bmN0aW9uIChlbG0sIGluZGV4KSB7XG4gICAgICBpZiAoZWxtW3ZpZGVvSWRdKSB7XG4gICAgICAgIHNlbGVjdGVkVmlkZW8gPSBlbG07XG4gICAgICB9XG4gICAgfSlcbiAgICByZXR1cm4gc2VsZWN0ZWRWaWRlbztcbiAgfVxuXG5cbiAgcmV0dXJuIHtcbiAgICBpbml0OiBpbml0XG4gIH07XG5cbn0pKCk7XG4iLCJWUi5zdGFydCA9IChmdW5jdGlvbiAoKSB7XG4gIC8vcnVuIGFsbCB0aGUgZnVuY2l0b25zIGZvciBzdGFydGluZyB0aGUgYXBwXG4gIHZhciBpbml0ID0gZnVuY3Rpb24gKCkge1xuICAgIFZSLnJvdXRlci5zaG93KCcjbGFuZGluZycpO1xuICB9O1xuICByZXR1cm4ge1xuICAgIGluaXQ6IGluaXRcbiAgfTtcbn0pKCk7XG5cblZSLnN0YXJ0LmluaXQoKTtcbiJdfQ==
