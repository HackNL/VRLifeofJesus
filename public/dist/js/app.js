"use strict";var VR=VR||{};VR.get=function(){function t(t){var e="",n=e+"media/thumbnails/"+t,i=e+"media/video/"+t,a=e+"data/"+t;return{base:e,tumbUrl:n,videoUrl:i,dataUrl:a}}function e(t){return document.querySelector(t)}function n(t){return document.querySelectorAll(t)}function i(t){return new Promise(function(e,n){var i=new XMLHttpRequest;i.open("GET",t),i.onloadstart=function(){a(!0)},i.onloadend=function(){a(!0)},i.onload=function(){var t=200;i.status==t?(a(!1),e(i.responseText)):(n(new Error("request failed!")),console.log("There went something wrong"))},i.send()})}function a(t){var e=1e3;t?VR.get.one(".loading").classList.remove("disabled"):setTimeout(function(){VR.get.one(".loading").classList.add("disabled")},e)}return{urls:t,one:e,all:n,data:i,loading:a}}(),VR.date=function(){function t(t){var n=new Date(t),i=e.months[n.getMonth()],a=n.getDate(),o=e.days[n.getDay()],r=n.getFullYear();return o+" "+a+" "+i+" "+r}var e={days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],months:["January","February","March","April","May","June","July","August","September","October","November","December"]};return{readableDate:t}}(),VR.router=function(){function t(t){var e=VR.get.all(".page"),n=VR.get.one(t);e.forEach(function(t){t.classList.add("disabled")}),n.classList.remove("disabled"),"#cardboard"===t?VR.V3d.init():"#landing"===t?VR.landing.init():"#video"===t?console.log("hiosd"):"#timeline"===t&&VR.timeline.init()}return{show:t}}(),VR.landing=function(){function t(t){n(),e(),VR.get.loading(!1)}function e(){function t(){i+=(e-i)*o,a+=(n-a)*o;var r="translate("+i+"px, "+a+"px) scale(1.1)",d=VR.get.one(".bg");d.style.webkitTransform=r,d.style.MozTransform=r,d.style.msTransform=r,d.style.OTransform=r,d.style.transform=r,window.requestAnimationFrame(t)}var e=0,n=0,i=0,a=0,o=1/30;window.addEventListener("mouseover",function(t){var i=Math.max(-100,Math.min(100,screen.width/2-t.clientX)),a=Math.max(-100,Math.min(100,screen.height/2-t.clientY));e=20*i/100,n=10*a/100}),t()}function n(){var t=VR.get.one("#landingbutton");t.addEventListener("click",function(){VR.router.show("#timeline")})}return{init:t}}(),VR.timeline=function(){function t(){e()}function e(){var t=VR.get.one(".video-list"),e=VR.get.urls("data.json").dataUrl;VR.get.data(e).then(function(t){var e=JSON.parse(t);return u=e,n(e)}).then(function(e){t.appendChild(e),a()})}function n(t){var e=document.createElement("ul");return t.videos.forEach(function(t){var n=i(t.thumbnail,t.title,t.description,t.id);e.innerHTML+=n}),e}function i(t,e,n,i){var a=VR.get.urls(t).tumbUrl,o=(VR.get.urls(t).tumbUrl,'<li><div class="video-wrapper">');return o+='\t\t\t\t\t<div class="thumbnail-wrapper">',o+='\t\t\t\t\t\t<img class="thumbnail" src="'+a+'">',o+='  \t\t\t\t\t<div class="media-caption">',o+='  \t\t\t\t\t\t<div class="caption-content">',o+="  \t\t\t\t\t\t\t<h2>"+e+"</h2>",o+="  \t\t\t\t\t\t\t<span>"+n+"</span>",o+="  \t\t\t\t\t\t</div>",o+="    \t\t\t\t</div>",o+='  \t\t\t\t\t<div class="video-play" data-video-id="'+i+'"">',o+="  \t\t\t\t\t</div>",o+="\t\t\t\t\t</div>",o+='\t\t\t\t\t<video autoplay controls style="display:none;">',o+="\t\t\t\t\tSorry, your browser doesnt support embedded videos",o+="\t\t\t\t\t</video>",o+="</div></li>"}function a(){document.querySelector(".video-list ul").addEventListener("click",function(t){if("video-play"===t.target.className){s=t.target.dataset.videoId;var e=l(s);console.log(e),e.id=s,console.log("Navigate to the meta video view"),VR.router.show("#video"),d(e)}})}function o(){VR.get.one("#meta-video-play").addEventListener("click",function(t){var e=t.target.dataset.videoId,n=l(e);console.log("Play te video");var i=document.getElementById("meta-video");i.src="media/video/"+n.filename,i.style.display="block",document.getElementsByClassName("meta-thumbnail-wrapper")[0].style.display="none"})}function r(){VR.get.one(".close").addEventListener("click",function(t){VR.router.show("#timeline");var e=document.getElementById("meta-video");console.log(e.pause()),e.pause(),e.currentTime=0})}function d(t){console.log(t),document.getElementById("meta-video-play").setAttribute("data-video-id",t.id),document.getElementById("video-title").innerHTML=t.title,document.getElementById("description").innerHTML=t.description,document.getElementById("date-alias").innerHTML=t.datealias,document.getElementById("meta-thumbnail").src="media/thumbnails/"+t.thumbnail,o(),r()}function l(t){var e;return u.videos.some(function(n,i){if(n.id===t)return e=n,!0}),e}var s=void 0,u={};return{init:t}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsIlZSc3RhcnQuanMiLCJWUmhlbHBlci5qcyIsIlZSZGF0ZS5qcyIsIlZScm91dGVyLmpzIiwiVlJsYW5kaW5nLmpzIiwiVlJ0aW1lbGluZS5qcyJdLCJuYW1lcyI6WyJWUiIsImdldCIsInVybHMiLCJ1cmwiLCJiYXNlIiwidHVtYlVybCIsInZpZGVvVXJsIiwiZGF0YVVybCIsIm9uZSIsInNlbGVjdG9yIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiYWxsIiwicXVlcnlTZWxlY3RvckFsbCIsImRhdGEiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsInJlcXVlc3QiLCJYTUxIdHRwUmVxdWVzdCIsIm9wZW4iLCJvbmxvYWRzdGFydCIsImxvYWRpbmciLCJvbmxvYWRlbmQiLCJvbmxvYWQiLCJzdGF0dXNDb2RlIiwic3RhdHVzIiwicmVzcG9uc2VUZXh0IiwiRXJyb3IiLCJjb25zb2xlIiwibG9nIiwic2VuZCIsInNob3ciLCJkZWxheVRpbWUiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJzZXRUaW1lb3V0IiwiYWRkIiwiZGF0ZSIsInJlYWRhYmxlRGF0ZSIsInVuZnJvbWF0ZWREYXRlIiwibmV3RGF0ZSIsIkRhdGUiLCJtb250aCIsImRhdGVzIiwibW9udGhzIiwiZ2V0TW9udGgiLCJnZXREYXRlIiwiZGF5IiwiZGF5cyIsImdldERheSIsInllYXIiLCJnZXRGdWxsWWVhciIsInJvdXRlciIsImlkIiwicGFnZXMiLCJzZWxlY3RlZFBhZ2UiLCJmb3JFYWNoIiwicGFnZSIsIlYzZCIsImluaXQiLCJsYW5kaW5nIiwidGltZWxpbmUiLCJfYnV0dG9uIiwiYmFja2dyb3VuZCIsIm1vdmVCYWNrZ3JvdW5kIiwieCIsImxGb2xsb3dYIiwiZnJpY3Rpb24iLCJ5IiwibEZvbGxvd1kiLCJ0cmFuc2xhdGUiLCJzdHlsZSIsIndlYmtpdFRyYW5zZm9ybSIsIk1velRyYW5zZm9ybSIsIm1zVHJhbnNmb3JtIiwiT1RyYW5zZm9ybSIsInRyYW5zZm9ybSIsIndpbmRvdyIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwibE1vdXNlWCIsIk1hdGgiLCJtYXgiLCJtaW4iLCJzY3JlZW4iLCJ3aWR0aCIsImNsaWVudFgiLCJsTW91c2VZIiwiaGVpZ2h0IiwiY2xpZW50WSIsImxhbmRpbmdidXR0b24iLCJfZ2V0RGF0YSIsInZpZGVvTGlzdCIsInRoZW4iLCJyZXNwb25zZSIsInBhcnNlZCIsIkpTT04iLCJwYXJzZSIsInRpbWVsaW5lRGF0YSIsIl9nZW5lcmF0ZVRpbWVsaW5lIiwidWwiLCJhcHBlbmRDaGlsZCIsImNsaWNrVmlkZW8iLCJjcmVhdGVFbGVtZW50IiwidmlkZW9zIiwibW92aWVPYmoiLCJlbGVtZW50IiwiX2NyZWF0ZVZpZGVvRWxlbWVudCIsInRodW1ibmFpbCIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJpbm5lckhUTUwiLCJ2aWRlb0lkIiwidHVtYlVybEdlbmVyYXRlZCIsInZpZGVvIiwidGFyZ2V0IiwiY2xhc3NOYW1lIiwiX3NlbGVjdGVkVmlkZW9JZCIsImRhdGFzZXQiLCJzZWxlY3RlZFZpZGVvIiwiZ2V0VmlkZW8iLCJyZW5kZXJWaWRlb01ldGFEYXRhIiwiY2xpY2tNZXRhVmlkZW8iLCJzZWxlY3RlZFZpZGVvSWQiLCJtZXRhVmlkZW9FbGVtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJzcmMiLCJmaWxlbmFtZSIsImRpc3BsYXkiLCJnZXRFbGVtZW50c0J5Q2xhc3NOYW1lIiwiY2xpY2tDbG9zZU1ldGEiLCJ2aWRlb0VsZW1lbnQiLCJwYXVzZSIsImN1cnJlbnRUaW1lIiwic2V0QXR0cmlidXRlIiwiZGF0ZWFsaWFzIiwidmlkZW9PYmoiLCJzb21lIiwiZWxtIiwiaW5kZXgiXSwibWFwcGluZ3MiOiJBQUFBLFlDQUEsSUFBQUEsSUFBQUEsTUNDQUEsSUFBQUMsSUFBQSxXQUNBLFFBQUFDLEdBQUFDLEdBR0EsR0FBQUMsR0FBQSxHQUNBQyxFQUFBRCxFQUFBLG9CQUFBRCxFQUNBRyxFQUFB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QSxtQkFBQVMsYUFBQSxnQkFBQWYsRUFBQW5FLElBQ0E1QyxTQUFBcUgsZUFBQSxlQUFBZCxVQUFBUSxFQUFBVixNQUNBckcsU0FBQXFILGVBQUEsZUFBQWQsVUFBQVEsRUFBQVQsWUFDQXRHLFNBQUFxSCxlQUFBLGNBQUFkLFVBQUFRLEVBQUFnQixVQUNBL0gsU0FBQXFILGVBQUEsa0JBQUFDLElBQUEsb0JBQUFQLEVBQUFYLFVBQ0FjLElBQ0FRLElBU0EsUUFBQVYsR0FBQVIsR0FDQSxHQUFBd0IsRUFPQSxPQU5BdEMsR0FBQU0sT0FBQWlDLEtBQUEsU0FBQUMsRUFBQUMsR0FDQSxHQUFBRCxFQUFBdEYsS0FBQTRELEVBRUEsTUFEQXdCLEdBQUFFLEdBQ0EsSUFHQUYsRUF2S0EsR0FBQW5CLEdBQUFBLE9BQ0FuQixJQTJLQSxRQUNBeEMsS0FBQUEiLCJmaWxlIjoiYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG52YXIgVlIgPSBWUiB8fCB7fTtcbid1c2Ugc3RyaWN0JztcblxuLy9UbyBlYXNpbHkgc2VsZWN0IHNvbWV0aGluZyBmcm9tIHRoZSBET01cblZSLmdldCA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gdXJscyh1cmwpIHtcblxuICAgIC8vIGxldCBiYXNlID0gJy9WUkxpZmVvZkplc3VzLyc7XG4gICAgdmFyIGJhc2UgPSAnJztcbiAgICB2YXIgdHVtYlVybCA9IGJhc2UgKyAnbWVkaWEvdGh1bWJuYWlscy8nICsgdXJsO1xuICAgIHZhciB2aWRlb1VybCA9IGJhc2UgKyAnbWVkaWEvdmlkZW8vJyArIHVybDtcbiAgICB2YXIgZGF0YVVybCA9IGJhc2UgKyAnZGF0YS8nICsgdXJsO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGJhc2U6IGJhc2UsXG4gICAgICB0dW1iVXJsOiB0dW1iVXJsLFxuICAgICAgdmlkZW9Vcmw6IHZpZGVvVXJsLFxuICAgICAgZGF0YVVybDogZGF0YVVybFxuICAgIH07XG4gIH1cblxuICBmdW5jdGlvbiBvbmUoc2VsZWN0b3IpIHtcbiAgICAvL1RoaXMgaXMgYSBtZXRob2RcbiAgICByZXR1cm4gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7XG4gIH1cblxuICBmdW5jdGlvbiBhbGwoc2VsZWN0b3IpIHtcbiAgICByZXR1cm4gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7XG4gIH1cblxuICBmdW5jdGlvbiBkYXRhKHVybCkge1xuICAgIC8vIHJldHVybiBhIFByb21pc2Ugb2JqZWN0XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIHZhciByZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICAvL29wZW4gYW4gZ2V0IHJlcXVlc3RcbiAgICAgIHJlcXVlc3Qub3BlbignR0VUJywgdXJsKTtcbiAgICAgIHJlcXVlc3Qub25sb2Fkc3RhcnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxvYWRpbmcodHJ1ZSk7XG4gICAgICB9O1xuICAgICAgcmVxdWVzdC5vbmxvYWRlbmQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxvYWRpbmcodHJ1ZSk7XG4gICAgICB9O1xuXG4gICAgICAvL2lmIHRoZSByZXF1ZXN0IGlzIGRvbmVcbiAgICAgIHJlcXVlc3Qub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAvL29ueSBpZiByZXF1ZXN0IGlzIGRvbmVcbiAgICAgICAgdmFyIHN0YXR1c0NvZGUgPSAyMDA7XG4gICAgICAgIGlmIChyZXF1ZXN0LnN0YXR1cyA9PSBzdGF0dXNDb2RlKSB7XG4gICAgICAgICAgbG9hZGluZyhmYWxzZSk7XG5cbiAgICAgICAgICAvLyBzZW5kIHRleHQgZm9ybSByZXF1ZXN0XG4gICAgICAgICAgcmVzb2x2ZShyZXF1ZXN0LnJlc3BvbnNlVGV4dCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gcmVqZWN0IHRoZSBwcm9taXNlIGlmIHRoZXJlIGlzIGEgZXJyXG4gICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcigncmVxdWVzdCBmYWlsZWQhJykpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdUaGVyZSB3ZW50IHNvbWV0aGluZyB3cm9uZycpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgLy9zZW5kIHRoZSByZXF1ZXN0XG4gICAgICByZXF1ZXN0LnNlbmQoKTtcbiAgICB9KTtcbiAgfVxuICAvLyBzaG93IG9yIGhpZGUgdGhlIGxvYWRpbmcgc3Bpbm5lclxuICBmdW5jdGlvbiBsb2FkaW5nKHNob3cpIHtcbiAgICB2YXIgZGVsYXlUaW1lID0gMTAwMDtcbiAgICBpZiAoc2hvdykge1xuICAgICAgVlIuZ2V0Lm9uZSgnLmxvYWRpbmcnKS5jbGFzc0xpc3QucmVtb3ZlKCdkaXNhYmxlZCcpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvL3Nob3cgbG9hZGluZ1xuICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgIFZSLmdldC5vbmUoJy5sb2FkaW5nJykuY2xhc3NMaXN0LmFkZCgnZGlzYWJsZWQnKTtcbiAgICAgIH0sIGRlbGF5VGltZSk7IC8vYWRkIGEgZGVsYXkgYmVjYXVzZSB5b3Ugd29uJ3Qgc2VlIGl0IHdpdGggZmFzdCBpbnRlcm5ldC5cbiAgICB9XG4gIH1cblxuICByZXR1cm4geyAvL3JldHVybiBvbmx5IHRoZSBmdW50aW9ucyB0aGF0IGFyZSBuZXNzZWVyaXlcbiAgICB1cmxzOiB1cmxzLFxuICAgIG9uZTogb25lLFxuICAgIGFsbDogYWxsLFxuICAgIGRhdGE6IGRhdGEsXG4gICAgbG9hZGluZzogbG9hZGluZ1xuICB9O1xufSgpO1xuXG4vL1RvIGVhc2lseSBzZWxlY3Qgc29tZXRoaW5nIGZyb20gdGhlIERPTVxuVlIuZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgdmFyIGRhdGVzID0ge1xuICAgIGRheXM6IFsnU3VuZGF5JywgJ01vbmRheScsICdUdWVzZGF5JywgJ1dlZG5lc2RheScsICdUaHVyc2RheScsICdGcmlkYXknLCAnU2F0dXJkYXknXSxcbiAgICBtb250aHM6IFsnSmFudWFyeScsICdGZWJydWFyeScsICdNYXJjaCcsICdBcHJpbCcsICdNYXknLCAnSnVuZScsICdKdWx5JywgJ0F1Z3VzdCcsICdTZXB0ZW1iZXInLCAnT2N0b2JlcicsICdOb3ZlbWJlcicsICdEZWNlbWJlciddXG4gIH07XG5cbiAgZnVuY3Rpb24gcmVhZGFibGVEYXRlKHVuZnJvbWF0ZWREYXRlKSB7XG4gICAgdmFyIG5ld0RhdGUgPSBuZXcgRGF0ZSh1bmZyb21hdGVkRGF0ZSk7XG4gICAgdmFyIG1vbnRoID0gZGF0ZXMubW9udGhzW25ld0RhdGUuZ2V0TW9udGgoKV07XG4gICAgdmFyIGRhdGUgPSBuZXdEYXRlLmdldERhdGUoKTtcbiAgICB2YXIgZGF5ID0gZGF0ZXMuZGF5c1tuZXdEYXRlLmdldERheSgpXTtcbiAgICB2YXIgeWVhciA9IG5ld0RhdGUuZ2V0RnVsbFllYXIoKTtcblxuICAgIHJldHVybiBkYXkgKyAnICcgKyBkYXRlICsgJyAnICsgbW9udGggKyAnICcgKyB5ZWFyO1xuICB9XG5cbiAgcmV0dXJuIHsgLy9yZXR1cm4gb25seSB0aGUgZnVudGlvbnMgdGhhdCBhcmUgbmVzc2Vlcml5XG4gICAgcmVhZGFibGVEYXRlOiByZWFkYWJsZURhdGVcbiAgfTtcbn0oKTtcblxuVlIucm91dGVyID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBzaG93KGlkKSB7XG4gICAgdmFyIHBhZ2VzID0gVlIuZ2V0LmFsbCgnLnBhZ2UnKTtcbiAgICB2YXIgc2VsZWN0ZWRQYWdlID0gVlIuZ2V0Lm9uZShpZCk7XG5cbiAgICAvL2Rpc2FibGUgYWxsIHRoZSBwYWdlc1xuICAgIHBhZ2VzLmZvckVhY2goZnVuY3Rpb24gKHBhZ2UpIHtcbiAgICAgIHBhZ2UuY2xhc3NMaXN0LmFkZCgnZGlzYWJsZWQnKTtcbiAgICB9KTtcblxuICAgIHNlbGVjdGVkUGFnZS5jbGFzc0xpc3QucmVtb3ZlKCdkaXNhYmxlZCcpO1xuXG4gICAgaWYgKGlkID09PSAnI2NhcmRib2FyZCcpIHtcbiAgICAgIFZSLlYzZC5pbml0KCk7XG4gICAgfSBlbHNlIGlmIChpZCA9PT0gJyNsYW5kaW5nJykge1xuXG4gICAgICBWUi5sYW5kaW5nLmluaXQoKTtcbiAgICB9IGVsc2UgaWYgKGlkID09PSAnI3ZpZGVvJykge1xuICAgICAgY29uc29sZS5sb2coJ2hpb3NkJyk7XG4gICAgICAvLyBWUi5yZW5kZXIuaW5pdCgpO1xuICAgIH0gZWxzZSBpZiAoaWQgPT09ICcjdGltZWxpbmUnKSB7XG4gICAgICBWUi50aW1lbGluZS5pbml0KCk7XG4gICAgfVxuICB9XG4gIHJldHVybiB7XG4gICAgc2hvdzogc2hvd1xuICB9O1xufSgpO1xuXG5WUi5sYW5kaW5nID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBpbml0KGlkKSB7XG5cbiAgICBfYnV0dG9uKCk7XG4gICAgYmFja2dyb3VuZCgpO1xuICAgIFZSLmdldC5sb2FkaW5nKGZhbHNlKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGJhY2tncm91bmQoKSB7XG4gICAgdmFyIGxGb2xsb3dYID0gMCxcbiAgICAgICAgbEZvbGxvd1kgPSAwLFxuICAgICAgICB4ID0gMCxcbiAgICAgICAgeSA9IDAsXG4gICAgICAgIGZyaWN0aW9uID0gMSAvIDMwO1xuXG4gICAgZnVuY3Rpb24gbW92ZUJhY2tncm91bmQoKSB7XG4gICAgICB4ICs9IChsRm9sbG93WCAtIHgpICogZnJpY3Rpb247XG4gICAgICB5ICs9IChsRm9sbG93WSAtIHkpICogZnJpY3Rpb247XG5cbiAgICAgIHZhciB0cmFuc2xhdGUgPSAndHJhbnNsYXRlKCcgKyB4ICsgJ3B4LCAnICsgeSArICdweCkgc2NhbGUoMS4xKSc7XG5cbiAgICAgIHZhciBiYWNrZ3JvdW5kID0gVlIuZ2V0Lm9uZSgnLmJnJyk7XG5cbiAgICAgIC8vIGJhY2tncm91bmQuc3R5bGVbJy13ZWJpdC10cmFuc2Zvcm0nXSA9IHRyYW5zbGF0ZTtcbiAgICAgIC8vIGJhY2tncm91bmQuc3R5bGVbJy1tb3otdHJhbnNmb3JtJ10gPSB0cmFuc2xhdGU7XG4gICAgICBiYWNrZ3JvdW5kLnN0eWxlLndlYmtpdFRyYW5zZm9ybSA9IHRyYW5zbGF0ZTtcbiAgICAgIGJhY2tncm91bmQuc3R5bGUuTW96VHJhbnNmb3JtID0gdHJhbnNsYXRlO1xuICAgICAgYmFja2dyb3VuZC5zdHlsZS5tc1RyYW5zZm9ybSA9IHRyYW5zbGF0ZTtcbiAgICAgIGJhY2tncm91bmQuc3R5bGUuT1RyYW5zZm9ybSA9IHRyYW5zbGF0ZTtcbiAgICAgIGJhY2tncm91bmQuc3R5bGUudHJhbnNmb3JtID0gdHJhbnNsYXRlO1xuXG4gICAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKG1vdmVCYWNrZ3JvdW5kKTtcbiAgICB9XG5cbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdmVyJywgZnVuY3Rpb24gKGUpIHtcblxuICAgICAgdmFyIGxNb3VzZVggPSBNYXRoLm1heCgtMTAwLCBNYXRoLm1pbigxMDAsIHNjcmVlbi53aWR0aCAvIDIgLSBlLmNsaWVudFgpKTtcbiAgICAgIHZhciBsTW91c2VZID0gTWF0aC5tYXgoLTEwMCwgTWF0aC5taW4oMTAwLCBzY3JlZW4uaGVpZ2h0IC8gMiAtIGUuY2xpZW50WSkpO1xuICAgICAgbEZvbGxvd1ggPSAyMCAqIGxNb3VzZVggLyAxMDA7IC8vIDEwMCA6IDEyID0gbE1vdXhlWCA6IGxGb2xsb3dcbiAgICAgIGxGb2xsb3dZID0gMTAgKiBsTW91c2VZIC8gMTAwO1xuICAgIH0pO1xuICAgIG1vdmVCYWNrZ3JvdW5kKCk7XG4gIH1cblxuICBmdW5jdGlvbiBfYnV0dG9uKCkge1xuICAgIHZhciBsYW5kaW5nYnV0dG9uID0gVlIuZ2V0Lm9uZSgnI2xhbmRpbmdidXR0b24nKTtcbiAgICBsYW5kaW5nYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgVlIucm91dGVyLnNob3coJyN0aW1lbGluZScpO1xuICAgIH0pO1xuICB9XG4gIHJldHVybiB7XG4gICAgaW5pdDogaW5pdFxuICB9O1xufSgpO1xuXG5WUi50aW1lbGluZSA9IGZ1bmN0aW9uICgpIHtcbiAgLy9mdW50aW9uIHRvIHJlbmRlciBhIHRlbXBsYXRlLlxuICAvL3JlbmRlciB0aGUgdGVtcGxhdGVcbiAgdmFyIF9zZWxlY3RlZFZpZGVvSWQgPSB2b2lkIDAsXG4gICAgICB0aW1lbGluZURhdGEgPSB7fTtcblxuICAvL3JlbmRlciB0aGUgdGVtcGxhdGVcbiAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAvLyByLl9nZXREYXRhKCk7XG4gICAgX2dldERhdGEoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9nZXREYXRhKCkge1xuICAgIHZhciB2aWRlb0xpc3QgPSBWUi5nZXQub25lKCcudmlkZW8tbGlzdCcpO1xuICAgIHZhciB1cmwgPSBWUi5nZXQudXJscygnZGF0YS5qc29uJykuZGF0YVVybDtcblxuICAgIFZSLmdldC5kYXRhKHVybCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgIHZhciBwYXJzZWQgPSBKU09OLnBhcnNlKHJlc3BvbnNlKTtcbiAgICAgIHRpbWVsaW5lRGF0YSA9IHBhcnNlZDtcblxuICAgICAgcmV0dXJuIF9nZW5lcmF0ZVRpbWVsaW5lKHBhcnNlZCk7XG4gICAgfSkudGhlbihmdW5jdGlvbiAodWwpIHtcbiAgICAgIHZpZGVvTGlzdC5hcHBlbmRDaGlsZCh1bCk7XG4gICAgICBjbGlja1ZpZGVvKCk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBfZ2VuZXJhdGVUaW1lbGluZShkYXRhKSB7XG4gICAgdmFyIHZpZGVvTGlzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3VsJyk7XG5cbiAgICBkYXRhLnZpZGVvcy5mb3JFYWNoKGZ1bmN0aW9uIChtb3ZpZU9iaikge1xuICAgICAgdmFyIHZpZGVvSWQgPSBtb3ZpZU9iajtcblxuICAgICAgdmFyIGVsZW1lbnQgPSBfY3JlYXRlVmlkZW9FbGVtZW50KG1vdmllT2JqLnRodW1ibmFpbCwgbW92aWVPYmoudGl0bGUsIG1vdmllT2JqLmRlc2NyaXB0aW9uLCBtb3ZpZU9iai5pZCk7XG4gICAgICAvLyBjb25zb2xlLmxvZyhvYmopO1xuICAgICAgdmlkZW9MaXN0LmlubmVySFRNTCArPSBlbGVtZW50OyAvL2FkZCBpdCB0byB0aGUgdWxcbiAgICB9KTtcbiAgICByZXR1cm4gdmlkZW9MaXN0O1xuICB9XG5cbiAgZnVuY3Rpb24gX2NyZWF0ZVZpZGVvRWxlbWVudCh0dW1iVXJsLCB0aXRsZSwgZGVzY3JpcHRpb24sIHZpZGVvSWQpIHtcbiAgICB2YXIgdHVtYlVybEdlbmVyYXRlZCA9IFZSLmdldC51cmxzKHR1bWJVcmwpLnR1bWJVcmw7XG4gICAgdmFyIHZpZGVvVXJsID0gVlIuZ2V0LnVybHModHVtYlVybCkudHVtYlVybDtcbiAgICAvLyBjb25zb2xlLmxvZyh0dW1iVXJsKTtcbiAgICB2YXIgdmlkZW8gPSAnPGxpPjxkaXYgY2xhc3M9XCJ2aWRlby13cmFwcGVyXCI+JztcbiAgICB2aWRlbyArPSAnXHRcdFx0XHRcdDxkaXYgY2xhc3M9XCJ0aHVtYm5haWwtd3JhcHBlclwiPic7XG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHRcdDxpbWcgY2xhc3M9XCJ0aHVtYm5haWxcIiBzcmM9XCInICsgdHVtYlVybEdlbmVyYXRlZCArICdcIj4nO1xuICAgIHZpZGVvICs9ICcgIFx0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwibWVkaWEtY2FwdGlvblwiPic7XG4gICAgdmlkZW8gKz0gJyAgXHRcdFx0XHRcdFx0PGRpdiBjbGFzcz1cImNhcHRpb24tY29udGVudFwiPic7XG4gICAgdmlkZW8gKz0gJyAgXHRcdFx0XHRcdFx0XHQ8aDI+JyArIHRpdGxlICsgJzwvaDI+JztcbiAgICB2aWRlbyArPSAnICBcdFx0XHRcdFx0XHRcdDxzcGFuPicgKyBkZXNjcmlwdGlvbiArICc8L3NwYW4+JztcbiAgICB2aWRlbyArPSAnICBcdFx0XHRcdFx0XHQ8L2Rpdj4nO1xuICAgIHZpZGVvICs9ICcgICAgXHRcdFx0XHQ8L2Rpdj4nO1xuICAgIHZpZGVvICs9ICcgIFx0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwidmlkZW8tcGxheVwiIGRhdGEtdmlkZW8taWQ9XCInICsgdmlkZW9JZCArICdcIlwiPic7XG4gICAgdmlkZW8gKz0gJyAgXHRcdFx0XHRcdDwvZGl2Pic7XG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHQ8L2Rpdj4nO1xuICAgIHZpZGVvICs9ICdcdFx0XHRcdFx0PHZpZGVvIGF1dG9wbGF5IGNvbnRyb2xzIHN0eWxlPVwiZGlzcGxheTpub25lO1wiPic7XG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHRTb3JyeSwgeW91ciBicm93c2VyIGRvZXNudCBzdXBwb3J0IGVtYmVkZGVkIHZpZGVvcyc7XG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHQ8L3ZpZGVvPic7XG4gICAgdmlkZW8gKz0gJzwvZGl2PjwvbGk+JztcbiAgICByZXR1cm4gdmlkZW87XG4gIH1cblxuICBmdW5jdGlvbiBjbGlja1ZpZGVvKCkge1xuXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnZpZGVvLWxpc3QgdWwnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG5cbiAgICAgIGlmIChlLnRhcmdldC5jbGFzc05hbWUgPT09IFwidmlkZW8tcGxheVwiKSB7XG5cbiAgICAgICAgX3NlbGVjdGVkVmlkZW9JZCA9IGUudGFyZ2V0LmRhdGFzZXQudmlkZW9JZDtcblxuICAgICAgICB2YXIgc2VsZWN0ZWRWaWRlbyA9IGdldFZpZGVvKF9zZWxlY3RlZFZpZGVvSWQpO1xuICAgICAgICBjb25zb2xlLmxvZyhzZWxlY3RlZFZpZGVvKTtcbiAgICAgICAgc2VsZWN0ZWRWaWRlby5pZCA9IF9zZWxlY3RlZFZpZGVvSWQ7XG5cbiAgICAgICAgLy8gTmF2aWdhdGUgdG8gdGhlIG1ldGEgdmlkZW8gdmlld1xuICAgICAgICBjb25zb2xlLmxvZygnTmF2aWdhdGUgdG8gdGhlIG1ldGEgdmlkZW8gdmlldycpO1xuXG4gICAgICAgIC8vIGdvdG9TZWN0aW9uKCd2aWRlby1tZXRhJyk7XG4gICAgICAgIFZSLnJvdXRlci5zaG93KCcjdmlkZW8nKTtcbiAgICAgICAgcmVuZGVyVmlkZW9NZXRhRGF0YShzZWxlY3RlZFZpZGVvKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8vIGZ1bmN0aW9uIF9kcmFnU2Nyb2xsKCkge1xuICAvLyAgIHZhciBjdXJZUG9zID0gMCxcbiAgLy8gICAgIGN1clhQb3MgPSAwLFxuICAvLyAgICAgY3VyRG93biA9IGZhbHNlO1xuICAvL1xuICAvLyAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCBmdW5jdGlvbiAoZSkge1xuICAvLyAgICAgaWYgKGN1ckRvd24gPT09IHRydWUpIHtcbiAgLy8gICAgICAgdmFyIHRpbWVMaW5lID0gVlIuZ2V0Lm9uZSgnI3RpbWVsaW5lJyk7XG4gIC8vXG4gIC8vICAgICB9XG4gIC8vICAgfSk7XG4gIC8vXG4gIC8vICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIGZ1bmN0aW9uIChlKSB7XG4gIC8vXG4gIC8vICAgICBjdXJEb3duID0gdHJ1ZTtcbiAgLy8gICAgIGN1cllQb3MgPSBlLnBhZ2VZO1xuICAvLyAgICAgY3VyWFBvcyA9IGUucGFnZVg7XG4gIC8vICAgfSk7XG4gIC8vXG4gIC8vICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBmdW5jdGlvbiAoZSkge1xuICAvLyAgICAgY3VyRG93biA9IGZhbHNlO1xuICAvLyAgIH0pO1xuICAvLyB9XG5cbiAgZnVuY3Rpb24gY2xpY2tNZXRhVmlkZW8oKSB7XG4gICAgVlIuZ2V0Lm9uZSgnI21ldGEtdmlkZW8tcGxheScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgIHZhciBzZWxlY3RlZFZpZGVvSWQgPSBlLnRhcmdldC5kYXRhc2V0LnZpZGVvSWQ7XG4gICAgICB2YXIgc2VsZWN0ZWRWaWRlbyA9IGdldFZpZGVvKHNlbGVjdGVkVmlkZW9JZCk7XG4gICAgICAvLyBQbGF5IHRoZSB2aWRlb1xuXG4gICAgICBjb25zb2xlLmxvZygnUGxheSB0ZSB2aWRlbycpO1xuXG4gICAgICB2YXIgbWV0YVZpZGVvRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhLXZpZGVvJyk7XG4gICAgICBtZXRhVmlkZW9FbGVtZW50LnNyYyA9ICdtZWRpYS92aWRlby8nICsgc2VsZWN0ZWRWaWRlby5maWxlbmFtZTtcbiAgICAgIG1ldGFWaWRlb0VsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdtZXRhLXRodW1ibmFpbC13cmFwcGVyJylbMF0uc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNsaWNrQ2xvc2VNZXRhKCkge1xuICAgIFZSLmdldC5vbmUoJy5jbG9zZScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgIFZSLnJvdXRlci5zaG93KCcjdGltZWxpbmUnKTtcbiAgICAgIHZhciB2aWRlb0VsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YS12aWRlbycpO1xuXG4gICAgICBjb25zb2xlLmxvZyh2aWRlb0VsZW1lbnQucGF1c2UoKSk7XG5cbiAgICAgIHZpZGVvRWxlbWVudC5wYXVzZSgpO1xuICAgICAgdmlkZW9FbGVtZW50LmN1cnJlbnRUaW1lID0gMDtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW5kZXJzIHRoZSB2aWRlbyBtZXRhIGRhdGEgaW4gdGhlIHZpZGVvLW1ldGEgc2VjdGlvblxuICAgKlxuICAgKiBAcGFyYW0gICAgICB7b2JqfSAgc2VsZWN0ZWRWaWRlbyAgVGhlIHNlbGVjdGVkIHZpZGVvXG4gICAqL1xuICBmdW5jdGlvbiByZW5kZXJWaWRlb01ldGFEYXRhKHNlbGVjdGVkVmlkZW8pIHtcbiAgICBjb25zb2xlLmxvZyhzZWxlY3RlZFZpZGVvKTtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YS12aWRlby1wbGF5Jykuc2V0QXR0cmlidXRlKCdkYXRhLXZpZGVvLWlkJywgc2VsZWN0ZWRWaWRlby5pZCk7XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZpZGVvLXRpdGxlJykuaW5uZXJIVE1MID0gc2VsZWN0ZWRWaWRlby50aXRsZTtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGVzY3JpcHRpb24nKS5pbm5lckhUTUwgPSBzZWxlY3RlZFZpZGVvLmRlc2NyaXB0aW9uO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkYXRlLWFsaWFzJykuaW5uZXJIVE1MID0gc2VsZWN0ZWRWaWRlby5kYXRlYWxpYXM7XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldGEtdGh1bWJuYWlsJykuc3JjID0gJ21lZGlhL3RodW1ibmFpbHMvJyArIHNlbGVjdGVkVmlkZW8udGh1bWJuYWlsO1xuICAgIGNsaWNrTWV0YVZpZGVvKCk7XG4gICAgY2xpY2tDbG9zZU1ldGEoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSB2aWRlby5cbiAgICpcbiAgICogQHBhcmFtICAgICAgc3RyaW5nIHZpZGVvSWQgIFRoZSB2aWRlbyBpZGVudGlmaWVyXG4gICAqIEByZXR1cm4gICAgIG9iaiAgVGhlIHZpZGVvLlxuICAgKi9cbiAgZnVuY3Rpb24gZ2V0VmlkZW8odmlkZW9JZCkge1xuICAgIHZhciB2aWRlb09iajtcbiAgICB0aW1lbGluZURhdGEudmlkZW9zLnNvbWUoZnVuY3Rpb24gKGVsbSwgaW5kZXgpIHtcbiAgICAgIGlmIChlbG0uaWQgPT09IHZpZGVvSWQpIHtcbiAgICAgICAgdmlkZW9PYmogPSBlbG07XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiB2aWRlb09iajtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgaW5pdDogaW5pdFxuICB9O1xufSgpOyIsInZhciBWUiA9IFZSIHx8IHt9O1xuJ3VzZSBzdHJpY3QnO1xuIiwiLy9UbyBlYXNpbHkgc2VsZWN0IHNvbWV0aGluZyBmcm9tIHRoZSBET01cblZSLmdldCA9IChmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIHVybHModXJsKSB7XG5cbiAgICAvLyBsZXQgYmFzZSA9ICcvVlJMaWZlb2ZKZXN1cy8nO1xuICAgIGxldCBiYXNlID0gJyc7XG4gICAgbGV0IHR1bWJVcmwgPSBiYXNlICsgJ21lZGlhL3RodW1ibmFpbHMvJyArIHVybDtcbiAgICBsZXQgdmlkZW9VcmwgPSBiYXNlICsgJ21lZGlhL3ZpZGVvLycgKyB1cmw7XG4gICAgbGV0IGRhdGFVcmwgPSBiYXNlICsgJ2RhdGEvJyArIHVybDtcblxuICAgIHJldHVybiB7XG4gICAgICBiYXNlOiBiYXNlLFxuICAgICAgdHVtYlVybDogdHVtYlVybCxcbiAgICAgIHZpZGVvVXJsOiB2aWRlb1VybCxcbiAgICAgIGRhdGFVcmxcbiAgICB9O1xuICB9XG5cbiAgZnVuY3Rpb24gb25lKHNlbGVjdG9yKSB7IC8vVGhpcyBpcyBhIG1ldGhvZFxuICAgIHJldHVybiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGFsbChzZWxlY3Rvcikge1xuICAgIHJldHVybiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGRhdGEodXJsKSB7XG4gICAgLy8gcmV0dXJuIGEgUHJvbWlzZSBvYmplY3RcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgdmFyIHJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgIC8vb3BlbiBhbiBnZXQgcmVxdWVzdFxuICAgICAgcmVxdWVzdC5vcGVuKCdHRVQnLCB1cmwpO1xuICAgICAgcmVxdWVzdC5vbmxvYWRzdGFydCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbG9hZGluZyh0cnVlKTtcbiAgICAgIH07XG4gICAgICByZXF1ZXN0Lm9ubG9hZGVuZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbG9hZGluZyh0cnVlKTtcbiAgICAgIH07XG5cbiAgICAgIC8vaWYgdGhlIHJlcXVlc3QgaXMgZG9uZVxuICAgICAgcmVxdWVzdC5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vb255IGlmIHJlcXVlc3QgaXMgZG9uZVxuICAgICAgICBsZXQgc3RhdHVzQ29kZSA9IDIwMDtcbiAgICAgICAgaWYgKHJlcXVlc3Quc3RhdHVzID09IHN0YXR1c0NvZGUpIHtcbiAgICAgICAgICBsb2FkaW5nKGZhbHNlKTtcblxuICAgICAgICAgIC8vIHNlbmQgdGV4dCBmb3JtIHJlcXVlc3RcbiAgICAgICAgICByZXNvbHZlKHJlcXVlc3QucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyByZWplY3QgdGhlIHByb21pc2UgaWYgdGhlcmUgaXMgYSBlcnJcbiAgICAgICAgICByZWplY3QobmV3IEVycm9yKCdyZXF1ZXN0IGZhaWxlZCEnKSk7XG4gICAgICAgICAgY29uc29sZS5sb2coJ1RoZXJlIHdlbnQgc29tZXRoaW5nIHdyb25nJyk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICAvL3NlbmQgdGhlIHJlcXVlc3RcbiAgICAgIHJlcXVlc3Quc2VuZCgpO1xuICAgIH0pO1xuICB9XG4gIC8vIHNob3cgb3IgaGlkZSB0aGUgbG9hZGluZyBzcGlubmVyXG4gIGZ1bmN0aW9uIGxvYWRpbmcoc2hvdykge1xuICAgIGxldCBkZWxheVRpbWUgPSAxMDAwO1xuICAgIGlmIChzaG93KSB7XG4gICAgICBWUi5nZXQub25lKCcubG9hZGluZycpLmNsYXNzTGlzdC5yZW1vdmUoJ2Rpc2FibGVkJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vc2hvdyBsb2FkaW5nXG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgVlIuZ2V0Lm9uZSgnLmxvYWRpbmcnKS5jbGFzc0xpc3QuYWRkKCdkaXNhYmxlZCcpO1xuICAgICAgfSwgZGVsYXlUaW1lKTsgLy9hZGQgYSBkZWxheSBiZWNhdXNlIHlvdSB3b24ndCBzZWUgaXQgd2l0aCBmYXN0IGludGVybmV0LlxuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7IC8vcmV0dXJuIG9ubHkgdGhlIGZ1bnRpb25zIHRoYXQgYXJlIG5lc3NlZXJpeVxuICAgIHVybHM6IHVybHMsXG4gICAgb25lOiBvbmUsXG4gICAgYWxsOiBhbGwsXG4gICAgZGF0YTogZGF0YSxcbiAgICBsb2FkaW5nOiBsb2FkaW5nXG4gIH07XG59KSgpO1xuIiwiLy9UbyBlYXNpbHkgc2VsZWN0IHNvbWV0aGluZyBmcm9tIHRoZSBET01cblZSLmRhdGUgPSAoZnVuY3Rpb24gKCkge1xuICBsZXQgZGF0ZXMgPSB7XG4gICAgZGF5czogWydTdW5kYXknLCAnTW9uZGF5JywgJ1R1ZXNkYXknLCAnV2VkbmVzZGF5JywgJ1RodXJzZGF5JywgJ0ZyaWRheScsICdTYXR1cmRheSddLFxuICAgIG1vbnRoczogWydKYW51YXJ5JywgJ0ZlYnJ1YXJ5JywgJ01hcmNoJywgJ0FwcmlsJywgJ01heScsICdKdW5lJywgJ0p1bHknLCAnQXVndXN0JywgJ1NlcHRlbWJlcicsICdPY3RvYmVyJywgJ05vdmVtYmVyJywgJ0RlY2VtYmVyJ10sXG4gIH07XG5cbiAgZnVuY3Rpb24gcmVhZGFibGVEYXRlKHVuZnJvbWF0ZWREYXRlKSB7XG4gICAgbGV0IG5ld0RhdGUgPSBuZXcgRGF0ZSh1bmZyb21hdGVkRGF0ZSk7XG4gICAgbGV0IG1vbnRoID0gZGF0ZXMubW9udGhzW25ld0RhdGUuZ2V0TW9udGgoKV07XG4gICAgbGV0IGRhdGUgPSBuZXdEYXRlLmdldERhdGUoKTtcbiAgICBsZXQgZGF5ID0gZGF0ZXMuZGF5c1tuZXdEYXRlLmdldERheSgpXTtcbiAgICBsZXQgeWVhciA9IG5ld0RhdGUuZ2V0RnVsbFllYXIoKTtcblxuICAgIHJldHVybiBkYXkgKyAnICcgKyBkYXRlICsgJyAnICsgbW9udGggKyAnICcgKyB5ZWFyO1xuICB9XG5cblxuICByZXR1cm4geyAvL3JldHVybiBvbmx5IHRoZSBmdW50aW9ucyB0aGF0IGFyZSBuZXNzZWVyaXlcbiAgICByZWFkYWJsZURhdGU6IHJlYWRhYmxlRGF0ZVxuICB9O1xufSkoKTtcbiIsIlZSLnJvdXRlciA9IChmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIHNob3coaWQpIHtcbiAgICB2YXIgcGFnZXMgPSBWUi5nZXQuYWxsKCcucGFnZScpO1xuICAgIHZhciBzZWxlY3RlZFBhZ2UgPSBWUi5nZXQub25lKGlkKTtcblxuICAgIC8vZGlzYWJsZSBhbGwgdGhlIHBhZ2VzXG4gICAgcGFnZXMuZm9yRWFjaChmdW5jdGlvbiAocGFnZSkge1xuICAgICAgcGFnZS5jbGFzc0xpc3QuYWRkKCdkaXNhYmxlZCcpO1xuICAgIH0pO1xuXG4gICAgc2VsZWN0ZWRQYWdlLmNsYXNzTGlzdC5yZW1vdmUoJ2Rpc2FibGVkJyk7XG5cbiAgICBpZiAoaWQgPT09ICcjY2FyZGJvYXJkJykge1xuICAgICAgVlIuVjNkLmluaXQoKTtcbiAgICB9IGVsc2UgaWYgKGlkID09PSAnI2xhbmRpbmcnKSB7XG5cbiAgICAgIFZSLmxhbmRpbmcuaW5pdCgpO1xuICAgIH0gZWxzZSBpZiAoaWQgPT09ICcjdmlkZW8nKSB7XG4gICAgICBjb25zb2xlLmxvZygnaGlvc2QnKTtcbiAgICAgIC8vIFZSLnJlbmRlci5pbml0KCk7XG4gICAgfSBlbHNlIGlmIChpZCA9PT0gJyN0aW1lbGluZScpIHtcbiAgICAgIFZSLnRpbWVsaW5lLmluaXQoKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHtcbiAgICBzaG93OiBzaG93XG4gIH07XG59KSgpO1xuIiwiVlIubGFuZGluZyA9IChmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIGluaXQoaWQpIHtcblxuICAgIF9idXR0b24oKTtcbiAgICBiYWNrZ3JvdW5kKCk7XG4gICAgVlIuZ2V0LmxvYWRpbmcoZmFsc2UpO1xuICB9XG5cbiAgZnVuY3Rpb24gYmFja2dyb3VuZCgpIHtcbiAgICB2YXIgbEZvbGxvd1ggPSAwLFxuICAgICAgbEZvbGxvd1kgPSAwLFxuICAgICAgeCA9IDAsXG4gICAgICB5ID0gMCxcbiAgICAgIGZyaWN0aW9uID0gMSAvIDMwO1xuXG4gICAgZnVuY3Rpb24gbW92ZUJhY2tncm91bmQoKSB7XG4gICAgICB4ICs9IChsRm9sbG93WCAtIHgpICogZnJpY3Rpb247XG4gICAgICB5ICs9IChsRm9sbG93WSAtIHkpICogZnJpY3Rpb247XG5cbiAgICAgIGxldCB0cmFuc2xhdGUgPSAndHJhbnNsYXRlKCcgKyB4ICsgJ3B4LCAnICsgeSArICdweCkgc2NhbGUoMS4xKSc7XG5cbiAgICAgIHZhciBiYWNrZ3JvdW5kID0gVlIuZ2V0Lm9uZSgnLmJnJyk7XG5cbiAgICAgIC8vIGJhY2tncm91bmQuc3R5bGVbJy13ZWJpdC10cmFuc2Zvcm0nXSA9IHRyYW5zbGF0ZTtcbiAgICAgIC8vIGJhY2tncm91bmQuc3R5bGVbJy1tb3otdHJhbnNmb3JtJ10gPSB0cmFuc2xhdGU7XG4gICAgICBiYWNrZ3JvdW5kLnN0eWxlLndlYmtpdFRyYW5zZm9ybSA9IHRyYW5zbGF0ZTtcbiAgICAgIGJhY2tncm91bmQuc3R5bGUuTW96VHJhbnNmb3JtID0gdHJhbnNsYXRlO1xuICAgICAgYmFja2dyb3VuZC5zdHlsZS5tc1RyYW5zZm9ybSA9IHRyYW5zbGF0ZTtcbiAgICAgIGJhY2tncm91bmQuc3R5bGUuT1RyYW5zZm9ybSA9IHRyYW5zbGF0ZTtcbiAgICAgIGJhY2tncm91bmQuc3R5bGUudHJhbnNmb3JtID0gdHJhbnNsYXRlO1xuXG4gICAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKG1vdmVCYWNrZ3JvdW5kKTtcbiAgICB9XG5cbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdmVyJywgZnVuY3Rpb24gKGUpIHtcblxuICAgICAgdmFyIGxNb3VzZVggPSBNYXRoLm1heCgtMTAwLCBNYXRoLm1pbigxMDAsIHNjcmVlbi53aWR0aCAvIDIgLSBlLmNsaWVudFgpKTtcbiAgICAgIHZhciBsTW91c2VZID0gTWF0aC5tYXgoLTEwMCwgTWF0aC5taW4oMTAwLCBzY3JlZW4uaGVpZ2h0IC8gMiAtIGUuY2xpZW50WSkpO1xuICAgICAgbEZvbGxvd1ggPSAoMjAgKiBsTW91c2VYKSAvIDEwMDsgLy8gMTAwIDogMTIgPSBsTW91eGVYIDogbEZvbGxvd1xuICAgICAgbEZvbGxvd1kgPSAoMTAgKiBsTW91c2VZKSAvIDEwMDtcblxuICAgIH0pO1xuICAgIG1vdmVCYWNrZ3JvdW5kKCk7XG4gIH1cblxuICBmdW5jdGlvbiBfYnV0dG9uKCkge1xuICAgIHZhciBsYW5kaW5nYnV0dG9uID0gVlIuZ2V0Lm9uZSgnI2xhbmRpbmdidXR0b24nKTtcbiAgICBsYW5kaW5nYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgVlIucm91dGVyLnNob3coJyN0aW1lbGluZScpXG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIHtcbiAgICBpbml0OiBpbml0XG4gIH07XG59KSgpO1xuIiwiVlIudGltZWxpbmUgPSAoZnVuY3Rpb24gKCkgeyAvL2Z1bnRpb24gdG8gcmVuZGVyIGEgdGVtcGxhdGUuXG4gIC8vcmVuZGVyIHRoZSB0ZW1wbGF0ZVxuICBsZXQgX3NlbGVjdGVkVmlkZW9JZCxcbiAgICB0aW1lbGluZURhdGEgPSB7fTtcblxuICAvL3JlbmRlciB0aGUgdGVtcGxhdGVcbiAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAvLyByLl9nZXREYXRhKCk7XG4gICAgX2dldERhdGEoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9nZXREYXRhKCkge1xuICAgIGxldCB2aWRlb0xpc3QgPSBWUi5nZXQub25lKCcudmlkZW8tbGlzdCcpO1xuICAgIGxldCB1cmwgPSBWUi5nZXQudXJscygnZGF0YS5qc29uJykuZGF0YVVybDtcblxuICAgIFZSLmdldC5kYXRhKHVybCkudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICB2YXIgcGFyc2VkID0gSlNPTi5wYXJzZShyZXNwb25zZSk7XG4gICAgICB0aW1lbGluZURhdGEgPSBwYXJzZWQ7XG5cbiAgICAgIHJldHVybiBfZ2VuZXJhdGVUaW1lbGluZShwYXJzZWQpO1xuICAgIH0pLnRoZW4odWwgPT4ge1xuICAgICAgdmlkZW9MaXN0LmFwcGVuZENoaWxkKHVsKTtcbiAgICAgIGNsaWNrVmlkZW8oKTtcbiAgICB9KTtcblxuICB9XG5cbiAgZnVuY3Rpb24gX2dlbmVyYXRlVGltZWxpbmUoZGF0YSkge1xuICAgIGxldCB2aWRlb0xpc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd1bCcpO1xuXG4gICAgZGF0YS52aWRlb3MuZm9yRWFjaChmdW5jdGlvbiAobW92aWVPYmopIHtcbiAgICAgIHZhciB2aWRlb0lkID0gbW92aWVPYmo7XG5cbiAgICAgIGxldCBlbGVtZW50ID0gX2NyZWF0ZVZpZGVvRWxlbWVudChtb3ZpZU9iai50aHVtYm5haWwsIG1vdmllT2JqLnRpdGxlLCBtb3ZpZU9iai5kZXNjcmlwdGlvbiwgbW92aWVPYmouaWQpO1xuICAgICAgLy8gY29uc29sZS5sb2cob2JqKTtcbiAgICAgIHZpZGVvTGlzdC5pbm5lckhUTUwgKz0gZWxlbWVudDsgLy9hZGQgaXQgdG8gdGhlIHVsXG4gICAgfSk7XG4gICAgcmV0dXJuIHZpZGVvTGlzdDtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9jcmVhdGVWaWRlb0VsZW1lbnQodHVtYlVybCwgdGl0bGUsIGRlc2NyaXB0aW9uLCB2aWRlb0lkKSB7XG4gICAgbGV0IHR1bWJVcmxHZW5lcmF0ZWQgPSBWUi5nZXQudXJscyh0dW1iVXJsKS50dW1iVXJsO1xuICAgIGxldCB2aWRlb1VybCA9IFZSLmdldC51cmxzKHR1bWJVcmwpLnR1bWJVcmw7XG4gICAgLy8gY29uc29sZS5sb2codHVtYlVybCk7XG4gICAgbGV0IHZpZGVvID0gJzxsaT48ZGl2IGNsYXNzPVwidmlkZW8td3JhcHBlclwiPic7XG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwidGh1bWJuYWlsLXdyYXBwZXJcIj4nXG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHRcdDxpbWcgY2xhc3M9XCJ0aHVtYm5haWxcIiBzcmM9XCInICsgdHVtYlVybEdlbmVyYXRlZCArICdcIj4nO1xuICAgIHZpZGVvICs9ICcgIFx0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwibWVkaWEtY2FwdGlvblwiPic7XG4gICAgdmlkZW8gKz0gJyAgXHRcdFx0XHRcdFx0PGRpdiBjbGFzcz1cImNhcHRpb24tY29udGVudFwiPic7XG4gICAgdmlkZW8gKz0gJyAgXHRcdFx0XHRcdFx0XHQ8aDI+JyArIHRpdGxlICsgJzwvaDI+JztcbiAgICB2aWRlbyArPSAnICBcdFx0XHRcdFx0XHRcdDxzcGFuPicgKyBkZXNjcmlwdGlvbiArICc8L3NwYW4+JztcbiAgICB2aWRlbyArPSAnICBcdFx0XHRcdFx0XHQ8L2Rpdj4nO1xuICAgIHZpZGVvICs9ICcgICAgXHRcdFx0XHQ8L2Rpdj4nO1xuICAgIHZpZGVvICs9ICcgIFx0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwidmlkZW8tcGxheVwiIGRhdGEtdmlkZW8taWQ9XCInICsgdmlkZW9JZCArICdcIlwiPic7XG4gICAgdmlkZW8gKz0gJyAgXHRcdFx0XHRcdDwvZGl2Pic7XG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHQ8L2Rpdj4nO1xuICAgIHZpZGVvICs9ICdcdFx0XHRcdFx0PHZpZGVvIGF1dG9wbGF5IGNvbnRyb2xzIHN0eWxlPVwiZGlzcGxheTpub25lO1wiPic7XG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHRTb3JyeSwgeW91ciBicm93c2VyIGRvZXNudCBzdXBwb3J0IGVtYmVkZGVkIHZpZGVvcyc7XG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHQ8L3ZpZGVvPic7XG4gICAgdmlkZW8gKz0gJzwvZGl2PjwvbGk+JztcbiAgICByZXR1cm4gdmlkZW87XG4gIH1cblxuICBmdW5jdGlvbiBjbGlja1ZpZGVvKCkge1xuXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnZpZGVvLWxpc3QgdWwnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG5cbiAgICAgIGlmIChlLnRhcmdldC5jbGFzc05hbWUgPT09IFwidmlkZW8tcGxheVwiKSB7XG5cbiAgICAgICAgX3NlbGVjdGVkVmlkZW9JZCA9IGUudGFyZ2V0LmRhdGFzZXQudmlkZW9JZDtcblxuICAgICAgICB2YXIgc2VsZWN0ZWRWaWRlbyA9IGdldFZpZGVvKF9zZWxlY3RlZFZpZGVvSWQpO1xuICAgICAgICBjb25zb2xlLmxvZyhzZWxlY3RlZFZpZGVvKTtcbiAgICAgICAgc2VsZWN0ZWRWaWRlby5pZCA9IF9zZWxlY3RlZFZpZGVvSWQ7XG5cblxuICAgICAgICAvLyBOYXZpZ2F0ZSB0byB0aGUgbWV0YSB2aWRlbyB2aWV3XG4gICAgICAgIGNvbnNvbGUubG9nKCdOYXZpZ2F0ZSB0byB0aGUgbWV0YSB2aWRlbyB2aWV3Jyk7XG5cbiAgICAgICAgLy8gZ290b1NlY3Rpb24oJ3ZpZGVvLW1ldGEnKTtcbiAgICAgICAgVlIucm91dGVyLnNob3coJyN2aWRlbycpO1xuICAgICAgICByZW5kZXJWaWRlb01ldGFEYXRhKHNlbGVjdGVkVmlkZW8pO1xuXG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvLyBmdW5jdGlvbiBfZHJhZ1Njcm9sbCgpIHtcbiAgLy8gICB2YXIgY3VyWVBvcyA9IDAsXG4gIC8vICAgICBjdXJYUG9zID0gMCxcbiAgLy8gICAgIGN1ckRvd24gPSBmYWxzZTtcbiAgLy9cbiAgLy8gICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgZnVuY3Rpb24gKGUpIHtcbiAgLy8gICAgIGlmIChjdXJEb3duID09PSB0cnVlKSB7XG4gIC8vICAgICAgIHZhciB0aW1lTGluZSA9IFZSLmdldC5vbmUoJyN0aW1lbGluZScpO1xuICAvL1xuICAvLyAgICAgfVxuICAvLyAgIH0pO1xuICAvL1xuICAvLyAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBmdW5jdGlvbiAoZSkge1xuICAvL1xuICAvLyAgICAgY3VyRG93biA9IHRydWU7XG4gIC8vICAgICBjdXJZUG9zID0gZS5wYWdlWTtcbiAgLy8gICAgIGN1clhQb3MgPSBlLnBhZ2VYO1xuICAvLyAgIH0pO1xuICAvL1xuICAvLyAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgZnVuY3Rpb24gKGUpIHtcbiAgLy8gICAgIGN1ckRvd24gPSBmYWxzZTtcbiAgLy8gICB9KTtcbiAgLy8gfVxuXG4gIGZ1bmN0aW9uIGNsaWNrTWV0YVZpZGVvKCkge1xuICAgIFZSLmdldC5vbmUoJyNtZXRhLXZpZGVvLXBsYXknKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICB2YXIgc2VsZWN0ZWRWaWRlb0lkID0gZS50YXJnZXQuZGF0YXNldC52aWRlb0lkO1xuICAgICAgdmFyIHNlbGVjdGVkVmlkZW8gPSBnZXRWaWRlbyhzZWxlY3RlZFZpZGVvSWQpO1xuICAgICAgLy8gUGxheSB0aGUgdmlkZW9cblxuICAgICAgY29uc29sZS5sb2coJ1BsYXkgdGUgdmlkZW8nKTtcblxuICAgICAgdmFyIG1ldGFWaWRlb0VsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YS12aWRlbycpO1xuICAgICAgbWV0YVZpZGVvRWxlbWVudC5zcmMgPSAnbWVkaWEvdmlkZW8vJyArIHNlbGVjdGVkVmlkZW8uZmlsZW5hbWU7XG4gICAgICBtZXRhVmlkZW9FbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xuICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnbWV0YS10aHVtYm5haWwtd3JhcHBlcicpWzBdLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgfSk7XG4gIH1cblxuXG4gIGZ1bmN0aW9uIGNsaWNrQ2xvc2VNZXRhKCkge1xuICAgIFZSLmdldC5vbmUoJy5jbG9zZScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgIFZSLnJvdXRlci5zaG93KCcjdGltZWxpbmUnKTtcbiAgICAgIHZhciB2aWRlb0VsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YS12aWRlbycpO1xuXG4gICAgICBjb25zb2xlLmxvZyh2aWRlb0VsZW1lbnQucGF1c2UoKSlcblxuICAgICAgdmlkZW9FbGVtZW50LnBhdXNlKCk7XG4gICAgICB2aWRlb0VsZW1lbnQuY3VycmVudFRpbWUgPSAwO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbmRlcnMgdGhlIHZpZGVvIG1ldGEgZGF0YSBpbiB0aGUgdmlkZW8tbWV0YSBzZWN0aW9uXG4gICAqXG4gICAqIEBwYXJhbSAgICAgIHtvYmp9ICBzZWxlY3RlZFZpZGVvICBUaGUgc2VsZWN0ZWQgdmlkZW9cbiAgICovXG4gIGZ1bmN0aW9uIHJlbmRlclZpZGVvTWV0YURhdGEoc2VsZWN0ZWRWaWRlbykge1xuICAgIGNvbnNvbGUubG9nKHNlbGVjdGVkVmlkZW8pO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhLXZpZGVvLXBsYXknKS5zZXRBdHRyaWJ1dGUoJ2RhdGEtdmlkZW8taWQnLCBzZWxlY3RlZFZpZGVvLmlkKTtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmlkZW8tdGl0bGUnKS5pbm5lckhUTUwgPSBzZWxlY3RlZFZpZGVvLnRpdGxlO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXNjcmlwdGlvbicpLmlubmVySFRNTCA9IHNlbGVjdGVkVmlkZW8uZGVzY3JpcHRpb247XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RhdGUtYWxpYXMnKS5pbm5lckhUTUwgPSBzZWxlY3RlZFZpZGVvLmRhdGVhbGlhcztcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YS10aHVtYm5haWwnKS5zcmMgPSAnbWVkaWEvdGh1bWJuYWlscy8nICsgc2VsZWN0ZWRWaWRlby50aHVtYm5haWw7XG4gICAgY2xpY2tNZXRhVmlkZW8oKTtcbiAgICBjbGlja0Nsb3NlTWV0YSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIHZpZGVvLlxuICAgKlxuICAgKiBAcGFyYW0gICAgICBzdHJpbmcgdmlkZW9JZCAgVGhlIHZpZGVvIGlkZW50aWZpZXJcbiAgICogQHJldHVybiAgICAgb2JqICBUaGUgdmlkZW8uXG4gICAqL1xuICBmdW5jdGlvbiBnZXRWaWRlbyh2aWRlb0lkKSB7XG4gICAgdmFyIHZpZGVvT2JqO1xuICAgIHRpbWVsaW5lRGF0YS52aWRlb3Muc29tZShmdW5jdGlvbiAoZWxtLCBpbmRleCkge1xuICAgICAgaWYgKGVsbS5pZCA9PT0gdmlkZW9JZCkge1xuICAgICAgICB2aWRlb09iaiA9IGVsbTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHZpZGVvT2JqO1xuXG4gIH1cblxuXG4gIHJldHVybiB7XG4gICAgaW5pdDogaW5pdFxuICB9O1xuXG59KSgpO1xuIl19
