"use strict";var VR=VR||{};VR.get=function(){function t(t){var e="",n=e+"media/thumbnails/"+t,i=e+"media/video/"+t,a=e+"data/"+t;return{base:e,tumbUrl:n,videoUrl:i,dataUrl:a}}function e(t){return document.querySelector(t)}function n(t){return document.querySelectorAll(t)}function i(t){return new Promise(function(e,n){var i=new XMLHttpRequest;i.open("GET",t),i.onloadstart=function(){a(!0)},i.onloadend=function(){a(!0)},i.onload=function(){var t=200;i.status==t?(a(!1),e(i.responseText)):(n(new Error("request failed!")),console.log("There went something wrong"))},i.send()})}function a(t){var e=1e3;t?VR.get.one(".loading").classList.remove("disabled"):setTimeout(function(){VR.get.one(".loading").classList.add("disabled")},e)}return{urls:t,one:e,all:n,data:i,loading:a}}(),VR.date=function(){function t(t){var n=new Date(t),i=e.months[n.getMonth()],a=n.getDate(),o=e.days[n.getDay()],r=n.getFullYear();return o+" "+a+" "+i+" "+r}var e={days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],months:["January","February","March","April","May","June","July","August","September","October","November","December"]};return{readableDate:t}}(),VR.router=function(){function t(t){var e=VR.get.all(".page"),n=VR.get.one(t);e.forEach(function(t){t.classList.add("disabled")}),n.classList.remove("disabled"),"#cardboard"===t?VR.V3d.init():"#landing"===t?VR.landing.init():"#video"===t?console.log("hiosd"):"#timeline"===t&&VR.timeline.init()}return{show:t}}(),VR.landing=function(){function t(t){n(),e(),VR.get.loading(!1)}function e(){function t(){i+=(e-i)*o,a+=(n-a)*o;var r="translate("+i+"px, "+a+"px) scale(1.1)",d=VR.get.one(".bg");d.style.webkitTransform=r,d.style.MozTransform=r,d.style.msTransform=r,d.style.OTransform=r,d.style.transform=r,window.requestAnimationFrame(t)}var e=0,n=0,i=0,a=0,o=1/30;window.addEventListener("mouseover",function(t){var i=Math.max(-100,Math.min(100,screen.width/2-t.clientX)),a=Math.max(-100,Math.min(100,screen.height/2-t.clientY));e=20*i/100,n=10*a/100}),t()}function n(){var t=VR.get.one("#landingbutton");t.addEventListener("click",function(){VR.router.show("#timeline")})}return{init:t}}(),VR.timeline=function(){function t(){e()}function e(){var t=VR.get.one(".video-list"),e=VR.get.urls("data.json").dataUrl;VR.get.data(e).then(function(t){var e=JSON.parse(t);return n(e)}).then(function(e){t.appendChild(e),a()})}function n(t){VR.timeline.timelineData=t;var e=document.createElement("ul");return t.videos.forEach(function(t){var n=i(t.thumbnail,t.title,t.description,t.id);e.innerHTML+=n}),e}function i(t,e,n,i){var a=VR.get.urls(t).tumbUrl,o=(VR.get.urls(t).tumbUrl,'<li><div class="video-wrapper">');return o+='\t\t\t\t\t<div class="thumbnail-wrapper">',o+='\t\t\t\t\t\t<img class="thumbnail" src="'+a+'">',o+='  \t\t\t\t\t<div class="media-caption">',o+='  \t\t\t\t\t\t<div class="caption-content">',o+="  \t\t\t\t\t\t\t<h2>"+e+"</h2>",o+="  \t\t\t\t\t\t\t<span>"+n+"</span>",o+="  \t\t\t\t\t\t</div>",o+="    \t\t\t\t</div>",o+='  \t\t\t\t\t<div class="video-play" data-video-id="'+i+'"">',o+="  \t\t\t\t\t</div>",o+="\t\t\t\t\t</div>",o+='\t\t\t\t\t<video autoplay controls style="display:none;">',o+="\t\t\t\t\tSorry, your browser doesnt support embedded videos",o+="\t\t\t\t\t</video>",o+="</div></li>"}function a(){document.querySelector(".video-list ul").addEventListener("click",function(t){if("video-play"===t.target.className){s=t.target.dataset.videoId;var e=l(s);console.log(e),e.id=s,console.log("Navigate to the meta video view"),VR.router.show("#video"),d(e)}})}function o(){VR.get.one("#meta-video-play").addEventListener("click",function(t){var e=t.target.dataset.videoId,n=l(e);console.log("Play te video");var i=document.getElementById("meta-video");i.src="media/video/"+n.filename,i.style.display="block",document.getElementsByClassName("meta-thumbnail-wrapper")[0].style.display="none"})}function r(){VR.get.one(".close").addEventListener("click",function(t){VR.router.show("#timeline");var e=document.getElementById("meta-video");console.log(e.pause()),e.pause(),e.currentTime=0})}function d(t){console.log(t),document.getElementById("meta-video-play").setAttribute("data-video-id",t.id),document.getElementById("video-title").innerHTML=t.title,document.getElementById("description").innerHTML=t.description,document.getElementById("date-alias").innerHTML=t.datealias,document.getElementById("meta-thumbnail").src="media/thumbnails/"+t.thumbnail,o(),r()}function l(t){var e;return u.videos.some(function(n,i){if(n.id===t)return e=n,!0}),e}var s=void 0,u={};return{init:t,timelineData:u}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsIlZSc3RhcnQuanMiLCJWUmhlbHBlci5qcyIsIlZSZGF0ZS5qcyIsIlZScm91dGVyLmpzIiwiVlJsYW5kaW5nLmpzIiwiVlJ0aW1lbGluZS5qcyJdLCJuYW1lcyI6WyJWUiIsImdldCIsInVybHMiLCJ1cmwiLCJiYXNlIiwidHVtYlVybCIsInZpZGVvVXJsIiwiZGF0YVVybCIsIm9uZSIsInNlbGVjdG9yIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiYWxsIiwicXVlcnlTZWxlY3RvckFsbCIsImRhdGEiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsInJlcXVlc3QiLCJYTUxIdHRwUmVxdWVzdCIsIm9wZW4iLCJvbmxvYWRzdGFydCIsImxvYWRpbmciLCJvbmxvYWRlbmQiLCJvbmxvYWQiLCJzdGF0dXNDb2RlIiwic3RhdHVzIiwicmVzcG9uc2VUZXh0IiwiRXJyb3IiLCJjb25zb2xlIiwibG9nIiwic2VuZCIsInNob3ciLCJkZWxheVRpbWUiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJzZXRUaW1lb3V0IiwiYWRkIiwiZGF0ZSIsInJlYWRhYmxlRGF0ZSIsInVuZnJvbWF0ZWREYXRlIiwibmV3RGF0ZSIsIkRhdGUiLCJtb250aCIsImRhdGVzIiwibW9udGhzIiwiZ2V0TW9udGgiLCJnZXREYXRlIiwiZGF5IiwiZGF5cyIsImdldERheSIsInllYXIiLCJnZXRGdWxsWWVhciIsInJvdXRlciIsImlkIiwicGFnZXMiLCJzZWxlY3RlZFBhZ2UiLCJmb3JFYWNoIiwicGFnZSIsIlYzZCIsImluaXQiLCJsYW5kaW5nIiwidGltZWxpbmUiLCJfYnV0dG9uIiwiYmFja2dyb3VuZCIsIm1vdmVCYWNrZ3JvdW5kIiwieCIsImxGb2xsb3dYIiwiZnJpY3Rpb24iLCJ5IiwibEZvbGxvd1kiLCJ0cmFuc2xhdGUiLCJzdHlsZSIsIndlYmtpdFRyYW5zZm9ybSIsIk1velRyYW5zZm9ybSIsIm1zVHJhbnNmb3JtIiwiT1RyYW5zZm9ybSIsInRyYW5zZm9ybSIsIndpbmRvdyIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwibE1vdXNlWCIsIk1hdGgiLCJtYXgiLCJtaW4iLCJzY3JlZW4iLCJ3aWR0aCIsImNsaWVudFgiLCJsTW91c2VZIiwiaGVpZ2h0IiwiY2xpZW50WSIsImxhbmRpbmdidXR0b24iLCJfZ2V0RGF0YSIsInZpZGVvTGlzdCIsInRoZW4iLCJyZXNwb25zZSIsInBhcnNlZCIsIkpTT04iLCJwYXJzZSIsIl9nZW5lcmF0ZVRpbWVsaW5lIiwidWwiLCJhcHBlbmRDaGlsZCIsImNsaWNrVmlkZW8iLCJfdGltZWxpbmVEYXRhIiwidGltZWxpbmVEYXRhIiwiY3JlYXRlRWxlbWVudCIsInZpZGVvcyIsIm1vdmllT2JqIiwiZWxlbWVudCIsIl9jcmVhdGVWaWRlb0VsZW1lbnQiLCJ0aHVtYm5haWwiLCJ0aXRsZSIsImRlc2NyaXB0aW9uIiwiaW5uZXJIVE1MIiwidmlkZW9JZCIsInR1bWJVcmxHZW5lcmF0ZWQiLCJ2aWRlbyIsInRhcmdldCIsImNsYXNzTmFtZSIsIl9zZWxlY3RlZFZpZGVvSWQiLCJkYXRhc2V0Iiwic2VsZWN0ZWRWaWRlbyIsImdldFZpZGVvIiwicmVuZGVyVmlkZW9NZXRhRGF0YSIsImNsaWNrTWV0YVZpZGVvIiwic2VsZWN0ZWRWaWRlb0lkIiwibWV0YVZpZGVvRWxlbWVudCIsImdldEVsZW1lbnRCeUlkIiwic3JjIiwiZmlsZW5hbWUiLCJkaXNwbGF5IiwiZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSIsImNsaWNrQ2xvc2VNZXRhIiwidmlkZW9FbGVtZW50IiwicGF1c2UiLCJjdXJyZW50VGltZSIsInNldEF0dHJpYnV0ZSIsImRhdGVhbGlhcyIsInZpZGVvT2JqIiwic29tZSIsImVsbSIsImluZGV4Il0sIm1hcHBpbmdzIjoiQUFBQSxZQ0FBLElBQUFBLElBQUFBLE1DQ0FBLElBQUFDLElBQUEsV0FDQSxRQUFBQyxHQUFBQyxHQUdBLEdBQUFDLEdBQUEsR0FDQUMsRUFBQUQsRUFBQSxv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QUFDLElBQUE0RixHQUNBaEgsU0FBQXNILGVBQUEsbUJBQUFTLGFBQUEsZ0JBQUFmLEVBQUFwRSxJQUNBNUMsU0FBQXNILGVBQUEsZUFBQWQsVUFBQVEsRUFBQVYsTUFDQXRHLFNBQUFzSCxlQUFBLGVBQUFkLFVBQUFRLEVBQUFULFlBQ0F2RyxTQUFBc0gsZUFBQSxjQUFBZCxVQUFBUSxFQUFBZ0IsVUFDQWhJLFNBQUFzSCxlQUFBLGtCQUFBQyxJQUFBLG9CQUFBUCxFQUFBWCxVQUNBYyxJQUNBUSxJQVNBLFFBQUFWLEdBQUFSLEdBQ0EsR0FBQXdCLEVBT0EsT0FOQWxDLEdBQUFFLE9BQUFpQyxLQUFBLFNBQUFDLEVBQUFDLEdBQ0EsR0FBQUQsRUFBQXZGLEtBQUE2RCxFQUVBLE1BREF3QixHQUFBRSxHQUNBLElBR0FGLEVBdktBLEdBQUFuQixHQUFBQSxPQUNBZixJQTJLQSxRQUNBN0MsS0FBQUEsRUFDQTZDLGFBQUFBIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxudmFyIFZSID0gVlIgfHwge307XG4ndXNlIHN0cmljdCc7XG5cbi8vVG8gZWFzaWx5IHNlbGVjdCBzb21ldGhpbmcgZnJvbSB0aGUgRE9NXG5WUi5nZXQgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIHVybHModXJsKSB7XG5cbiAgICAvLyBsZXQgYmFzZSA9ICcvVlJMaWZlb2ZKZXN1cy8nO1xuICAgIHZhciBiYXNlID0gJyc7XG4gICAgdmFyIHR1bWJVcmwgPSBiYXNlICsgJ21lZGlhL3RodW1ibmFpbHMvJyArIHVybDtcbiAgICB2YXIgdmlkZW9VcmwgPSBiYXNlICsgJ21lZGlhL3ZpZGVvLycgKyB1cmw7XG4gICAgdmFyIGRhdGFVcmwgPSBiYXNlICsgJ2RhdGEvJyArIHVybDtcblxuICAgIHJldHVybiB7XG4gICAgICBiYXNlOiBiYXNlLFxuICAgICAgdHVtYlVybDogdHVtYlVybCxcbiAgICAgIHZpZGVvVXJsOiB2aWRlb1VybCxcbiAgICAgIGRhdGFVcmw6IGRhdGFVcmxcbiAgICB9O1xuICB9XG5cbiAgZnVuY3Rpb24gb25lKHNlbGVjdG9yKSB7XG4gICAgLy9UaGlzIGlzIGEgbWV0aG9kXG4gICAgcmV0dXJuIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpO1xuICB9XG5cbiAgZnVuY3Rpb24gYWxsKHNlbGVjdG9yKSB7XG4gICAgcmV0dXJuIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpO1xuICB9XG5cbiAgZnVuY3Rpb24gZGF0YSh1cmwpIHtcbiAgICAvLyByZXR1cm4gYSBQcm9taXNlIG9iamVjdFxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICB2YXIgcmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgLy9vcGVuIGFuIGdldCByZXF1ZXN0XG4gICAgICByZXF1ZXN0Lm9wZW4oJ0dFVCcsIHVybCk7XG4gICAgICByZXF1ZXN0Lm9ubG9hZHN0YXJ0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBsb2FkaW5nKHRydWUpO1xuICAgICAgfTtcbiAgICAgIHJlcXVlc3Qub25sb2FkZW5kID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBsb2FkaW5nKHRydWUpO1xuICAgICAgfTtcblxuICAgICAgLy9pZiB0aGUgcmVxdWVzdCBpcyBkb25lXG4gICAgICByZXF1ZXN0Lm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy9vbnkgaWYgcmVxdWVzdCBpcyBkb25lXG4gICAgICAgIHZhciBzdGF0dXNDb2RlID0gMjAwO1xuICAgICAgICBpZiAocmVxdWVzdC5zdGF0dXMgPT0gc3RhdHVzQ29kZSkge1xuICAgICAgICAgIGxvYWRpbmcoZmFsc2UpO1xuXG4gICAgICAgICAgLy8gc2VuZCB0ZXh0IGZvcm0gcmVxdWVzdFxuICAgICAgICAgIHJlc29sdmUocmVxdWVzdC5yZXNwb25zZVRleHQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIHJlamVjdCB0aGUgcHJvbWlzZSBpZiB0aGVyZSBpcyBhIGVyclxuICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoJ3JlcXVlc3QgZmFpbGVkIScpKTtcbiAgICAgICAgICBjb25zb2xlLmxvZygnVGhlcmUgd2VudCBzb21ldGhpbmcgd3JvbmcnKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIC8vc2VuZCB0aGUgcmVxdWVzdFxuICAgICAgcmVxdWVzdC5zZW5kKCk7XG4gICAgfSk7XG4gIH1cbiAgLy8gc2hvdyBvciBoaWRlIHRoZSBsb2FkaW5nIHNwaW5uZXJcbiAgZnVuY3Rpb24gbG9hZGluZyhzaG93KSB7XG4gICAgdmFyIGRlbGF5VGltZSA9IDEwMDA7XG4gICAgaWYgKHNob3cpIHtcbiAgICAgIFZSLmdldC5vbmUoJy5sb2FkaW5nJykuY2xhc3NMaXN0LnJlbW92ZSgnZGlzYWJsZWQnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy9zaG93IGxvYWRpbmdcbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICBWUi5nZXQub25lKCcubG9hZGluZycpLmNsYXNzTGlzdC5hZGQoJ2Rpc2FibGVkJyk7XG4gICAgICB9LCBkZWxheVRpbWUpOyAvL2FkZCBhIGRlbGF5IGJlY2F1c2UgeW91IHdvbid0IHNlZSBpdCB3aXRoIGZhc3QgaW50ZXJuZXQuXG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHsgLy9yZXR1cm4gb25seSB0aGUgZnVudGlvbnMgdGhhdCBhcmUgbmVzc2Vlcml5XG4gICAgdXJsczogdXJscyxcbiAgICBvbmU6IG9uZSxcbiAgICBhbGw6IGFsbCxcbiAgICBkYXRhOiBkYXRhLFxuICAgIGxvYWRpbmc6IGxvYWRpbmdcbiAgfTtcbn0oKTtcblxuLy9UbyBlYXNpbHkgc2VsZWN0IHNvbWV0aGluZyBmcm9tIHRoZSBET01cblZSLmRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gIHZhciBkYXRlcyA9IHtcbiAgICBkYXlzOiBbJ1N1bmRheScsICdNb25kYXknLCAnVHVlc2RheScsICdXZWRuZXNkYXknLCAnVGh1cnNkYXknLCAnRnJpZGF5JywgJ1NhdHVyZGF5J10sXG4gICAgbW9udGhzOiBbJ0phbnVhcnknLCAnRmVicnVhcnknLCAnTWFyY2gnLCAnQXByaWwnLCAnTWF5JywgJ0p1bmUnLCAnSnVseScsICdBdWd1c3QnLCAnU2VwdGVtYmVyJywgJ09jdG9iZXInLCAnTm92ZW1iZXInLCAnRGVjZW1iZXInXVxuICB9O1xuXG4gIGZ1bmN0aW9uIHJlYWRhYmxlRGF0ZSh1bmZyb21hdGVkRGF0ZSkge1xuICAgIHZhciBuZXdEYXRlID0gbmV3IERhdGUodW5mcm9tYXRlZERhdGUpO1xuICAgIHZhciBtb250aCA9IGRhdGVzLm1vbnRoc1tuZXdEYXRlLmdldE1vbnRoKCldO1xuICAgIHZhciBkYXRlID0gbmV3RGF0ZS5nZXREYXRlKCk7XG4gICAgdmFyIGRheSA9IGRhdGVzLmRheXNbbmV3RGF0ZS5nZXREYXkoKV07XG4gICAgdmFyIHllYXIgPSBuZXdEYXRlLmdldEZ1bGxZZWFyKCk7XG5cbiAgICByZXR1cm4gZGF5ICsgJyAnICsgZGF0ZSArICcgJyArIG1vbnRoICsgJyAnICsgeWVhcjtcbiAgfVxuXG4gIHJldHVybiB7IC8vcmV0dXJuIG9ubHkgdGhlIGZ1bnRpb25zIHRoYXQgYXJlIG5lc3NlZXJpeVxuICAgIHJlYWRhYmxlRGF0ZTogcmVhZGFibGVEYXRlXG4gIH07XG59KCk7XG5cblZSLnJvdXRlciA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gc2hvdyhpZCkge1xuICAgIHZhciBwYWdlcyA9IFZSLmdldC5hbGwoJy5wYWdlJyk7XG4gICAgdmFyIHNlbGVjdGVkUGFnZSA9IFZSLmdldC5vbmUoaWQpO1xuXG4gICAgLy9kaXNhYmxlIGFsbCB0aGUgcGFnZXNcbiAgICBwYWdlcy5mb3JFYWNoKGZ1bmN0aW9uIChwYWdlKSB7XG4gICAgICBwYWdlLmNsYXNzTGlzdC5hZGQoJ2Rpc2FibGVkJyk7XG4gICAgfSk7XG5cbiAgICBzZWxlY3RlZFBhZ2UuY2xhc3NMaXN0LnJlbW92ZSgnZGlzYWJsZWQnKTtcblxuICAgIGlmIChpZCA9PT0gJyNjYXJkYm9hcmQnKSB7XG4gICAgICBWUi5WM2QuaW5pdCgpO1xuICAgIH0gZWxzZSBpZiAoaWQgPT09ICcjbGFuZGluZycpIHtcblxuICAgICAgVlIubGFuZGluZy5pbml0KCk7XG4gICAgfSBlbHNlIGlmIChpZCA9PT0gJyN2aWRlbycpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdoaW9zZCcpO1xuICAgICAgLy8gVlIucmVuZGVyLmluaXQoKTtcbiAgICB9IGVsc2UgaWYgKGlkID09PSAnI3RpbWVsaW5lJykge1xuICAgICAgVlIudGltZWxpbmUuaW5pdCgpO1xuICAgIH1cbiAgfVxuICByZXR1cm4ge1xuICAgIHNob3c6IHNob3dcbiAgfTtcbn0oKTtcblxuVlIubGFuZGluZyA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gaW5pdChpZCkge1xuXG4gICAgX2J1dHRvbigpO1xuICAgIGJhY2tncm91bmQoKTtcbiAgICBWUi5nZXQubG9hZGluZyhmYWxzZSk7XG4gIH1cblxuICBmdW5jdGlvbiBiYWNrZ3JvdW5kKCkge1xuICAgIHZhciBsRm9sbG93WCA9IDAsXG4gICAgICAgIGxGb2xsb3dZID0gMCxcbiAgICAgICAgeCA9IDAsXG4gICAgICAgIHkgPSAwLFxuICAgICAgICBmcmljdGlvbiA9IDEgLyAzMDtcblxuICAgIGZ1bmN0aW9uIG1vdmVCYWNrZ3JvdW5kKCkge1xuICAgICAgeCArPSAobEZvbGxvd1ggLSB4KSAqIGZyaWN0aW9uO1xuICAgICAgeSArPSAobEZvbGxvd1kgLSB5KSAqIGZyaWN0aW9uO1xuXG4gICAgICB2YXIgdHJhbnNsYXRlID0gJ3RyYW5zbGF0ZSgnICsgeCArICdweCwgJyArIHkgKyAncHgpIHNjYWxlKDEuMSknO1xuXG4gICAgICB2YXIgYmFja2dyb3VuZCA9IFZSLmdldC5vbmUoJy5iZycpO1xuXG4gICAgICAvLyBiYWNrZ3JvdW5kLnN0eWxlWyctd2ViaXQtdHJhbnNmb3JtJ10gPSB0cmFuc2xhdGU7XG4gICAgICAvLyBiYWNrZ3JvdW5kLnN0eWxlWyctbW96LXRyYW5zZm9ybSddID0gdHJhbnNsYXRlO1xuICAgICAgYmFja2dyb3VuZC5zdHlsZS53ZWJraXRUcmFuc2Zvcm0gPSB0cmFuc2xhdGU7XG4gICAgICBiYWNrZ3JvdW5kLnN0eWxlLk1velRyYW5zZm9ybSA9IHRyYW5zbGF0ZTtcbiAgICAgIGJhY2tncm91bmQuc3R5bGUubXNUcmFuc2Zvcm0gPSB0cmFuc2xhdGU7XG4gICAgICBiYWNrZ3JvdW5kLnN0eWxlLk9UcmFuc2Zvcm0gPSB0cmFuc2xhdGU7XG4gICAgICBiYWNrZ3JvdW5kLnN0eWxlLnRyYW5zZm9ybSA9IHRyYW5zbGF0ZTtcblxuICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShtb3ZlQmFja2dyb3VuZCk7XG4gICAgfVxuXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlb3ZlcicsIGZ1bmN0aW9uIChlKSB7XG5cbiAgICAgIHZhciBsTW91c2VYID0gTWF0aC5tYXgoLTEwMCwgTWF0aC5taW4oMTAwLCBzY3JlZW4ud2lkdGggLyAyIC0gZS5jbGllbnRYKSk7XG4gICAgICB2YXIgbE1vdXNlWSA9IE1hdGgubWF4KC0xMDAsIE1hdGgubWluKDEwMCwgc2NyZWVuLmhlaWdodCAvIDIgLSBlLmNsaWVudFkpKTtcbiAgICAgIGxGb2xsb3dYID0gMjAgKiBsTW91c2VYIC8gMTAwOyAvLyAxMDAgOiAxMiA9IGxNb3V4ZVggOiBsRm9sbG93XG4gICAgICBsRm9sbG93WSA9IDEwICogbE1vdXNlWSAvIDEwMDtcbiAgICB9KTtcbiAgICBtb3ZlQmFja2dyb3VuZCgpO1xuICB9XG5cbiAgZnVuY3Rpb24gX2J1dHRvbigpIHtcbiAgICB2YXIgbGFuZGluZ2J1dHRvbiA9IFZSLmdldC5vbmUoJyNsYW5kaW5nYnV0dG9uJyk7XG4gICAgbGFuZGluZ2J1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgIFZSLnJvdXRlci5zaG93KCcjdGltZWxpbmUnKTtcbiAgICB9KTtcbiAgfVxuICByZXR1cm4ge1xuICAgIGluaXQ6IGluaXRcbiAgfTtcbn0oKTtcblxuVlIudGltZWxpbmUgPSBmdW5jdGlvbiAoKSB7XG4gIC8vZnVudGlvbiB0byByZW5kZXIgYSB0ZW1wbGF0ZS5cbiAgLy9yZW5kZXIgdGhlIHRlbXBsYXRlXG4gIHZhciBfc2VsZWN0ZWRWaWRlb0lkID0gdm9pZCAwLFxuICAgICAgdGltZWxpbmVEYXRhID0ge307XG5cbiAgLy9yZW5kZXIgdGhlIHRlbXBsYXRlXG4gIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgLy8gci5fZ2V0RGF0YSgpO1xuICAgIF9nZXREYXRhKCk7XG4gIH1cblxuICBmdW5jdGlvbiBfZ2V0RGF0YSgpIHtcbiAgICB2YXIgdmlkZW9MaXN0ID0gVlIuZ2V0Lm9uZSgnLnZpZGVvLWxpc3QnKTtcbiAgICB2YXIgdXJsID0gVlIuZ2V0LnVybHMoJ2RhdGEuanNvbicpLmRhdGFVcmw7XG5cbiAgICBWUi5nZXQuZGF0YSh1cmwpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICB2YXIgcGFyc2VkID0gSlNPTi5wYXJzZShyZXNwb25zZSk7XG5cbiAgICAgIHJldHVybiBfZ2VuZXJhdGVUaW1lbGluZShwYXJzZWQpO1xuICAgIH0pLnRoZW4oZnVuY3Rpb24gKHVsKSB7XG4gICAgICB2aWRlb0xpc3QuYXBwZW5kQ2hpbGQodWwpO1xuICAgICAgY2xpY2tWaWRlbygpO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gX2dlbmVyYXRlVGltZWxpbmUoX3RpbWVsaW5lRGF0YSkge1xuICAgIFZSLnRpbWVsaW5lLnRpbWVsaW5lRGF0YSA9IF90aW1lbGluZURhdGE7XG4gICAgdmFyIHZpZGVvTGlzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3VsJyk7XG5cbiAgICBfdGltZWxpbmVEYXRhLnZpZGVvcy5mb3JFYWNoKGZ1bmN0aW9uIChtb3ZpZU9iaikge1xuICAgICAgdmFyIHZpZGVvSWQgPSBtb3ZpZU9iajtcblxuICAgICAgdmFyIGVsZW1lbnQgPSBfY3JlYXRlVmlkZW9FbGVtZW50KG1vdmllT2JqLnRodW1ibmFpbCwgbW92aWVPYmoudGl0bGUsIG1vdmllT2JqLmRlc2NyaXB0aW9uLCBtb3ZpZU9iai5pZCk7XG4gICAgICAvLyBjb25zb2xlLmxvZyhvYmopO1xuICAgICAgdmlkZW9MaXN0LmlubmVySFRNTCArPSBlbGVtZW50OyAvL2FkZCBpdCB0byB0aGUgdWxcbiAgICB9KTtcbiAgICByZXR1cm4gdmlkZW9MaXN0O1xuICB9XG5cbiAgZnVuY3Rpb24gX2NyZWF0ZVZpZGVvRWxlbWVudCh0dW1iVXJsLCB0aXRsZSwgZGVzY3JpcHRpb24sIHZpZGVvSWQpIHtcbiAgICB2YXIgdHVtYlVybEdlbmVyYXRlZCA9IFZSLmdldC51cmxzKHR1bWJVcmwpLnR1bWJVcmw7XG4gICAgdmFyIHZpZGVvVXJsID0gVlIuZ2V0LnVybHModHVtYlVybCkudHVtYlVybDtcbiAgICAvLyBjb25zb2xlLmxvZyh0dW1iVXJsKTtcbiAgICB2YXIgdmlkZW8gPSAnPGxpPjxkaXYgY2xhc3M9XCJ2aWRlby13cmFwcGVyXCI+JztcbiAgICB2aWRlbyArPSAnXHRcdFx0XHRcdDxkaXYgY2xhc3M9XCJ0aHVtYm5haWwtd3JhcHBlclwiPic7XG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHRcdDxpbWcgY2xhc3M9XCJ0aHVtYm5haWxcIiBzcmM9XCInICsgdHVtYlVybEdlbmVyYXRlZCArICdcIj4nO1xuICAgIHZpZGVvICs9ICcgIFx0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwibWVkaWEtY2FwdGlvblwiPic7XG4gICAgdmlkZW8gKz0gJyAgXHRcdFx0XHRcdFx0PGRpdiBjbGFzcz1cImNhcHRpb24tY29udGVudFwiPic7XG4gICAgdmlkZW8gKz0gJyAgXHRcdFx0XHRcdFx0XHQ8aDI+JyArIHRpdGxlICsgJzwvaDI+JztcbiAgICB2aWRlbyArPSAnICBcdFx0XHRcdFx0XHRcdDxzcGFuPicgKyBkZXNjcmlwdGlvbiArICc8L3NwYW4+JztcbiAgICB2aWRlbyArPSAnICBcdFx0XHRcdFx0XHQ8L2Rpdj4nO1xuICAgIHZpZGVvICs9ICcgICAgXHRcdFx0XHQ8L2Rpdj4nO1xuICAgIHZpZGVvICs9ICcgIFx0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwidmlkZW8tcGxheVwiIGRhdGEtdmlkZW8taWQ9XCInICsgdmlkZW9JZCArICdcIlwiPic7XG4gICAgdmlkZW8gKz0gJyAgXHRcdFx0XHRcdDwvZGl2Pic7XG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHQ8L2Rpdj4nO1xuICAgIHZpZGVvICs9ICdcdFx0XHRcdFx0PHZpZGVvIGF1dG9wbGF5IGNvbnRyb2xzIHN0eWxlPVwiZGlzcGxheTpub25lO1wiPic7XG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHRTb3JyeSwgeW91ciBicm93c2VyIGRvZXNudCBzdXBwb3J0IGVtYmVkZGVkIHZpZGVvcyc7XG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHQ8L3ZpZGVvPic7XG4gICAgdmlkZW8gKz0gJzwvZGl2PjwvbGk+JztcbiAgICByZXR1cm4gdmlkZW87XG4gIH1cblxuICBmdW5jdGlvbiBjbGlja1ZpZGVvKCkge1xuXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnZpZGVvLWxpc3QgdWwnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG5cbiAgICAgIGlmIChlLnRhcmdldC5jbGFzc05hbWUgPT09IFwidmlkZW8tcGxheVwiKSB7XG5cbiAgICAgICAgX3NlbGVjdGVkVmlkZW9JZCA9IGUudGFyZ2V0LmRhdGFzZXQudmlkZW9JZDtcblxuICAgICAgICB2YXIgc2VsZWN0ZWRWaWRlbyA9IGdldFZpZGVvKF9zZWxlY3RlZFZpZGVvSWQpO1xuICAgICAgICBjb25zb2xlLmxvZyhzZWxlY3RlZFZpZGVvKTtcbiAgICAgICAgc2VsZWN0ZWRWaWRlby5pZCA9IF9zZWxlY3RlZFZpZGVvSWQ7XG5cbiAgICAgICAgLy8gTmF2aWdhdGUgdG8gdGhlIG1ldGEgdmlkZW8gdmlld1xuICAgICAgICBjb25zb2xlLmxvZygnTmF2aWdhdGUgdG8gdGhlIG1ldGEgdmlkZW8gdmlldycpO1xuXG4gICAgICAgIC8vIGdvdG9TZWN0aW9uKCd2aWRlby1tZXRhJyk7XG4gICAgICAgIFZSLnJvdXRlci5zaG93KCcjdmlkZW8nKTtcbiAgICAgICAgcmVuZGVyVmlkZW9NZXRhRGF0YShzZWxlY3RlZFZpZGVvKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8vIGZ1bmN0aW9uIF9kcmFnU2Nyb2xsKCkge1xuICAvLyAgIHZhciBjdXJZUG9zID0gMCxcbiAgLy8gICAgIGN1clhQb3MgPSAwLFxuICAvLyAgICAgY3VyRG93biA9IGZhbHNlO1xuICAvL1xuICAvLyAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCBmdW5jdGlvbiAoZSkge1xuICAvLyAgICAgaWYgKGN1ckRvd24gPT09IHRydWUpIHtcbiAgLy8gICAgICAgdmFyIHRpbWVMaW5lID0gVlIuZ2V0Lm9uZSgnI3RpbWVsaW5lJyk7XG4gIC8vXG4gIC8vICAgICB9XG4gIC8vICAgfSk7XG4gIC8vXG4gIC8vICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIGZ1bmN0aW9uIChlKSB7XG4gIC8vXG4gIC8vICAgICBjdXJEb3duID0gdHJ1ZTtcbiAgLy8gICAgIGN1cllQb3MgPSBlLnBhZ2VZO1xuICAvLyAgICAgY3VyWFBvcyA9IGUucGFnZVg7XG4gIC8vICAgfSk7XG4gIC8vXG4gIC8vICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBmdW5jdGlvbiAoZSkge1xuICAvLyAgICAgY3VyRG93biA9IGZhbHNlO1xuICAvLyAgIH0pO1xuICAvLyB9XG5cbiAgZnVuY3Rpb24gY2xpY2tNZXRhVmlkZW8oKSB7XG4gICAgVlIuZ2V0Lm9uZSgnI21ldGEtdmlkZW8tcGxheScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgIHZhciBzZWxlY3RlZFZpZGVvSWQgPSBlLnRhcmdldC5kYXRhc2V0LnZpZGVvSWQ7XG4gICAgICB2YXIgc2VsZWN0ZWRWaWRlbyA9IGdldFZpZGVvKHNlbGVjdGVkVmlkZW9JZCk7XG4gICAgICAvLyBQbGF5IHRoZSB2aWRlb1xuXG4gICAgICBjb25zb2xlLmxvZygnUGxheSB0ZSB2aWRlbycpO1xuXG4gICAgICB2YXIgbWV0YVZpZGVvRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhLXZpZGVvJyk7XG4gICAgICBtZXRhVmlkZW9FbGVtZW50LnNyYyA9ICdtZWRpYS92aWRlby8nICsgc2VsZWN0ZWRWaWRlby5maWxlbmFtZTtcbiAgICAgIG1ldGFWaWRlb0VsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdtZXRhLXRodW1ibmFpbC13cmFwcGVyJylbMF0uc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNsaWNrQ2xvc2VNZXRhKCkge1xuICAgIFZSLmdldC5vbmUoJy5jbG9zZScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgIFZSLnJvdXRlci5zaG93KCcjdGltZWxpbmUnKTtcbiAgICAgIHZhciB2aWRlb0VsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YS12aWRlbycpO1xuXG4gICAgICBjb25zb2xlLmxvZyh2aWRlb0VsZW1lbnQucGF1c2UoKSk7XG5cbiAgICAgIHZpZGVvRWxlbWVudC5wYXVzZSgpO1xuICAgICAgdmlkZW9FbGVtZW50LmN1cnJlbnRUaW1lID0gMDtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxyXG4gICAqIFJlbmRlcnMgdGhlIHZpZGVvIG1ldGEgZGF0YSBpbiB0aGUgdmlkZW8tbWV0YSBzZWN0aW9uXHJcbiAgICpcclxuICAgKiBAcGFyYW0gICAgICB7b2JqfSAgc2VsZWN0ZWRWaWRlbyAgVGhlIHNlbGVjdGVkIHZpZGVvXHJcbiAgICovXG4gIGZ1bmN0aW9uIHJlbmRlclZpZGVvTWV0YURhdGEoc2VsZWN0ZWRWaWRlbykge1xuICAgIGNvbnNvbGUubG9nKHNlbGVjdGVkVmlkZW8pO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhLXZpZGVvLXBsYXknKS5zZXRBdHRyaWJ1dGUoJ2RhdGEtdmlkZW8taWQnLCBzZWxlY3RlZFZpZGVvLmlkKTtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmlkZW8tdGl0bGUnKS5pbm5lckhUTUwgPSBzZWxlY3RlZFZpZGVvLnRpdGxlO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXNjcmlwdGlvbicpLmlubmVySFRNTCA9IHNlbGVjdGVkVmlkZW8uZGVzY3JpcHRpb247XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RhdGUtYWxpYXMnKS5pbm5lckhUTUwgPSBzZWxlY3RlZFZpZGVvLmRhdGVhbGlhcztcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YS10aHVtYm5haWwnKS5zcmMgPSAnbWVkaWEvdGh1bWJuYWlscy8nICsgc2VsZWN0ZWRWaWRlby50aHVtYm5haWw7XG4gICAgY2xpY2tNZXRhVmlkZW8oKTtcbiAgICBjbGlja0Nsb3NlTWV0YSgpO1xuICB9XG5cbiAgLyoqXHJcbiAgICogR2V0cyB0aGUgdmlkZW8uXHJcbiAgICpcclxuICAgKiBAcGFyYW0gICAgICBzdHJpbmcgdmlkZW9JZCAgVGhlIHZpZGVvIGlkZW50aWZpZXJcclxuICAgKiBAcmV0dXJuICAgICBvYmogIFRoZSB2aWRlby5cclxuICAgKi9cbiAgZnVuY3Rpb24gZ2V0VmlkZW8odmlkZW9JZCkge1xuICAgIHZhciB2aWRlb09iajtcbiAgICB0aW1lbGluZURhdGEudmlkZW9zLnNvbWUoZnVuY3Rpb24gKGVsbSwgaW5kZXgpIHtcbiAgICAgIGlmIChlbG0uaWQgPT09IHZpZGVvSWQpIHtcbiAgICAgICAgdmlkZW9PYmogPSBlbG07XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiB2aWRlb09iajtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgaW5pdDogaW5pdCxcbiAgICB0aW1lbGluZURhdGE6IHRpbWVsaW5lRGF0YVxuICB9O1xufSgpOyIsInZhciBWUiA9IFZSIHx8IHt9O1xyXG4ndXNlIHN0cmljdCc7XHJcbiIsIi8vVG8gZWFzaWx5IHNlbGVjdCBzb21ldGhpbmcgZnJvbSB0aGUgRE9NXHJcblZSLmdldCA9IChmdW5jdGlvbiAoKSB7XHJcbiAgZnVuY3Rpb24gdXJscyh1cmwpIHtcclxuXHJcbiAgICAvLyBsZXQgYmFzZSA9ICcvVlJMaWZlb2ZKZXN1cy8nO1xyXG4gICAgbGV0IGJhc2UgPSAnJztcclxuICAgIGxldCB0dW1iVXJsID0gYmFzZSArICdtZWRpYS90aHVtYm5haWxzLycgKyB1cmw7XHJcbiAgICBsZXQgdmlkZW9VcmwgPSBiYXNlICsgJ21lZGlhL3ZpZGVvLycgKyB1cmw7XHJcbiAgICBsZXQgZGF0YVVybCA9IGJhc2UgKyAnZGF0YS8nICsgdXJsO1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIGJhc2U6IGJhc2UsXHJcbiAgICAgIHR1bWJVcmw6IHR1bWJVcmwsXHJcbiAgICAgIHZpZGVvVXJsOiB2aWRlb1VybCxcclxuICAgICAgZGF0YVVybFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIG9uZShzZWxlY3RvcikgeyAvL1RoaXMgaXMgYSBtZXRob2RcclxuICAgIHJldHVybiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGFsbChzZWxlY3Rvcikge1xyXG4gICAgcmV0dXJuIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gZGF0YSh1cmwpIHtcclxuICAgIC8vIHJldHVybiBhIFByb21pc2Ugb2JqZWN0XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICB2YXIgcmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xyXG4gICAgICAvL29wZW4gYW4gZ2V0IHJlcXVlc3RcclxuICAgICAgcmVxdWVzdC5vcGVuKCdHRVQnLCB1cmwpO1xyXG4gICAgICByZXF1ZXN0Lm9ubG9hZHN0YXJ0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGxvYWRpbmcodHJ1ZSk7XHJcbiAgICAgIH07XHJcbiAgICAgIHJlcXVlc3Qub25sb2FkZW5kID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGxvYWRpbmcodHJ1ZSk7XHJcbiAgICAgIH07XHJcblxyXG4gICAgICAvL2lmIHRoZSByZXF1ZXN0IGlzIGRvbmVcclxuICAgICAgcmVxdWVzdC5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgLy9vbnkgaWYgcmVxdWVzdCBpcyBkb25lXHJcbiAgICAgICAgbGV0IHN0YXR1c0NvZGUgPSAyMDA7XHJcbiAgICAgICAgaWYgKHJlcXVlc3Quc3RhdHVzID09IHN0YXR1c0NvZGUpIHtcclxuICAgICAgICAgIGxvYWRpbmcoZmFsc2UpO1xyXG5cclxuICAgICAgICAgIC8vIHNlbmQgdGV4dCBmb3JtIHJlcXVlc3RcclxuICAgICAgICAgIHJlc29sdmUocmVxdWVzdC5yZXNwb25zZVRleHQpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAvLyByZWplY3QgdGhlIHByb21pc2UgaWYgdGhlcmUgaXMgYSBlcnJcclxuICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoJ3JlcXVlc3QgZmFpbGVkIScpKTtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKCdUaGVyZSB3ZW50IHNvbWV0aGluZyB3cm9uZycpO1xyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuICAgICAgLy9zZW5kIHRoZSByZXF1ZXN0XHJcbiAgICAgIHJlcXVlc3Quc2VuZCgpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIC8vIHNob3cgb3IgaGlkZSB0aGUgbG9hZGluZyBzcGlubmVyXHJcbiAgZnVuY3Rpb24gbG9hZGluZyhzaG93KSB7XHJcbiAgICBsZXQgZGVsYXlUaW1lID0gMTAwMDtcclxuICAgIGlmIChzaG93KSB7XHJcbiAgICAgIFZSLmdldC5vbmUoJy5sb2FkaW5nJykuY2xhc3NMaXN0LnJlbW92ZSgnZGlzYWJsZWQnKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIC8vc2hvdyBsb2FkaW5nXHJcbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIFZSLmdldC5vbmUoJy5sb2FkaW5nJykuY2xhc3NMaXN0LmFkZCgnZGlzYWJsZWQnKTtcclxuICAgICAgfSwgZGVsYXlUaW1lKTsgLy9hZGQgYSBkZWxheSBiZWNhdXNlIHlvdSB3b24ndCBzZWUgaXQgd2l0aCBmYXN0IGludGVybmV0LlxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHsgLy9yZXR1cm4gb25seSB0aGUgZnVudGlvbnMgdGhhdCBhcmUgbmVzc2Vlcml5XHJcbiAgICB1cmxzOiB1cmxzLFxyXG4gICAgb25lOiBvbmUsXHJcbiAgICBhbGw6IGFsbCxcclxuICAgIGRhdGE6IGRhdGEsXHJcbiAgICBsb2FkaW5nOiBsb2FkaW5nXHJcbiAgfTtcclxufSkoKTtcclxuIiwiLy9UbyBlYXNpbHkgc2VsZWN0IHNvbWV0aGluZyBmcm9tIHRoZSBET01cclxuVlIuZGF0ZSA9IChmdW5jdGlvbiAoKSB7XHJcbiAgbGV0IGRhdGVzID0ge1xyXG4gICAgZGF5czogWydTdW5kYXknLCAnTW9uZGF5JywgJ1R1ZXNkYXknLCAnV2VkbmVzZGF5JywgJ1RodXJzZGF5JywgJ0ZyaWRheScsICdTYXR1cmRheSddLFxyXG4gICAgbW9udGhzOiBbJ0phbnVhcnknLCAnRmVicnVhcnknLCAnTWFyY2gnLCAnQXByaWwnLCAnTWF5JywgJ0p1bmUnLCAnSnVseScsICdBdWd1c3QnLCAnU2VwdGVtYmVyJywgJ09jdG9iZXInLCAnTm92ZW1iZXInLCAnRGVjZW1iZXInXSxcclxuICB9O1xyXG5cclxuICBmdW5jdGlvbiByZWFkYWJsZURhdGUodW5mcm9tYXRlZERhdGUpIHtcclxuICAgIGxldCBuZXdEYXRlID0gbmV3IERhdGUodW5mcm9tYXRlZERhdGUpO1xyXG4gICAgbGV0IG1vbnRoID0gZGF0ZXMubW9udGhzW25ld0RhdGUuZ2V0TW9udGgoKV07XHJcbiAgICBsZXQgZGF0ZSA9IG5ld0RhdGUuZ2V0RGF0ZSgpO1xyXG4gICAgbGV0IGRheSA9IGRhdGVzLmRheXNbbmV3RGF0ZS5nZXREYXkoKV07XHJcbiAgICBsZXQgeWVhciA9IG5ld0RhdGUuZ2V0RnVsbFllYXIoKTtcclxuXHJcbiAgICByZXR1cm4gZGF5ICsgJyAnICsgZGF0ZSArICcgJyArIG1vbnRoICsgJyAnICsgeWVhcjtcclxuICB9XHJcblxyXG5cclxuICByZXR1cm4geyAvL3JldHVybiBvbmx5IHRoZSBmdW50aW9ucyB0aGF0IGFyZSBuZXNzZWVyaXlcclxuICAgIHJlYWRhYmxlRGF0ZTogcmVhZGFibGVEYXRlXHJcbiAgfTtcclxufSkoKTtcclxuIiwiVlIucm91dGVyID0gKGZ1bmN0aW9uICgpIHtcclxuICBmdW5jdGlvbiBzaG93KGlkKSB7XHJcbiAgICB2YXIgcGFnZXMgPSBWUi5nZXQuYWxsKCcucGFnZScpO1xyXG4gICAgdmFyIHNlbGVjdGVkUGFnZSA9IFZSLmdldC5vbmUoaWQpO1xyXG5cclxuICAgIC8vZGlzYWJsZSBhbGwgdGhlIHBhZ2VzXHJcbiAgICBwYWdlcy5mb3JFYWNoKGZ1bmN0aW9uIChwYWdlKSB7XHJcbiAgICAgIHBhZ2UuY2xhc3NMaXN0LmFkZCgnZGlzYWJsZWQnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHNlbGVjdGVkUGFnZS5jbGFzc0xpc3QucmVtb3ZlKCdkaXNhYmxlZCcpO1xyXG5cclxuICAgIGlmIChpZCA9PT0gJyNjYXJkYm9hcmQnKSB7XHJcbiAgICAgIFZSLlYzZC5pbml0KCk7XHJcbiAgICB9IGVsc2UgaWYgKGlkID09PSAnI2xhbmRpbmcnKSB7XHJcblxyXG4gICAgICBWUi5sYW5kaW5nLmluaXQoKTtcclxuICAgIH0gZWxzZSBpZiAoaWQgPT09ICcjdmlkZW8nKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdoaW9zZCcpO1xyXG4gICAgICAvLyBWUi5yZW5kZXIuaW5pdCgpO1xyXG4gICAgfSBlbHNlIGlmIChpZCA9PT0gJyN0aW1lbGluZScpIHtcclxuICAgICAgVlIudGltZWxpbmUuaW5pdCgpO1xyXG4gICAgfVxyXG4gIH1cclxuICByZXR1cm4ge1xyXG4gICAgc2hvdzogc2hvd1xyXG4gIH07XHJcbn0pKCk7XHJcbiIsIlZSLmxhbmRpbmcgPSAoZnVuY3Rpb24gKCkge1xyXG4gIGZ1bmN0aW9uIGluaXQoaWQpIHtcclxuXHJcbiAgICBfYnV0dG9uKCk7XHJcbiAgICBiYWNrZ3JvdW5kKCk7XHJcbiAgICBWUi5nZXQubG9hZGluZyhmYWxzZSk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBiYWNrZ3JvdW5kKCkge1xyXG4gICAgdmFyIGxGb2xsb3dYID0gMCxcclxuICAgICAgbEZvbGxvd1kgPSAwLFxyXG4gICAgICB4ID0gMCxcclxuICAgICAgeSA9IDAsXHJcbiAgICAgIGZyaWN0aW9uID0gMSAvIDMwO1xyXG5cclxuICAgIGZ1bmN0aW9uIG1vdmVCYWNrZ3JvdW5kKCkge1xyXG4gICAgICB4ICs9IChsRm9sbG93WCAtIHgpICogZnJpY3Rpb247XHJcbiAgICAgIHkgKz0gKGxGb2xsb3dZIC0geSkgKiBmcmljdGlvbjtcclxuXHJcbiAgICAgIGxldCB0cmFuc2xhdGUgPSAndHJhbnNsYXRlKCcgKyB4ICsgJ3B4LCAnICsgeSArICdweCkgc2NhbGUoMS4xKSc7XHJcblxyXG4gICAgICB2YXIgYmFja2dyb3VuZCA9IFZSLmdldC5vbmUoJy5iZycpO1xyXG5cclxuICAgICAgLy8gYmFja2dyb3VuZC5zdHlsZVsnLXdlYml0LXRyYW5zZm9ybSddID0gdHJhbnNsYXRlO1xyXG4gICAgICAvLyBiYWNrZ3JvdW5kLnN0eWxlWyctbW96LXRyYW5zZm9ybSddID0gdHJhbnNsYXRlO1xyXG4gICAgICBiYWNrZ3JvdW5kLnN0eWxlLndlYmtpdFRyYW5zZm9ybSA9IHRyYW5zbGF0ZTtcclxuICAgICAgYmFja2dyb3VuZC5zdHlsZS5Nb3pUcmFuc2Zvcm0gPSB0cmFuc2xhdGU7XHJcbiAgICAgIGJhY2tncm91bmQuc3R5bGUubXNUcmFuc2Zvcm0gPSB0cmFuc2xhdGU7XHJcbiAgICAgIGJhY2tncm91bmQuc3R5bGUuT1RyYW5zZm9ybSA9IHRyYW5zbGF0ZTtcclxuICAgICAgYmFja2dyb3VuZC5zdHlsZS50cmFuc2Zvcm0gPSB0cmFuc2xhdGU7XHJcblxyXG4gICAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKG1vdmVCYWNrZ3JvdW5kKTtcclxuICAgIH1cclxuXHJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdmVyJywgZnVuY3Rpb24gKGUpIHtcclxuXHJcbiAgICAgIHZhciBsTW91c2VYID0gTWF0aC5tYXgoLTEwMCwgTWF0aC5taW4oMTAwLCBzY3JlZW4ud2lkdGggLyAyIC0gZS5jbGllbnRYKSk7XHJcbiAgICAgIHZhciBsTW91c2VZID0gTWF0aC5tYXgoLTEwMCwgTWF0aC5taW4oMTAwLCBzY3JlZW4uaGVpZ2h0IC8gMiAtIGUuY2xpZW50WSkpO1xyXG4gICAgICBsRm9sbG93WCA9ICgyMCAqIGxNb3VzZVgpIC8gMTAwOyAvLyAxMDAgOiAxMiA9IGxNb3V4ZVggOiBsRm9sbG93XHJcbiAgICAgIGxGb2xsb3dZID0gKDEwICogbE1vdXNlWSkgLyAxMDA7XHJcblxyXG4gICAgfSk7XHJcbiAgICBtb3ZlQmFja2dyb3VuZCgpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gX2J1dHRvbigpIHtcclxuICAgIHZhciBsYW5kaW5nYnV0dG9uID0gVlIuZ2V0Lm9uZSgnI2xhbmRpbmdidXR0b24nKTtcclxuICAgIGxhbmRpbmdidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIFZSLnJvdXRlci5zaG93KCcjdGltZWxpbmUnKVxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIHJldHVybiB7XHJcbiAgICBpbml0OiBpbml0XHJcbiAgfTtcclxufSkoKTtcclxuIiwiVlIudGltZWxpbmUgPSAoZnVuY3Rpb24gKCkgeyAvL2Z1bnRpb24gdG8gcmVuZGVyIGEgdGVtcGxhdGUuXHJcbiAgLy9yZW5kZXIgdGhlIHRlbXBsYXRlXHJcbiAgbGV0IF9zZWxlY3RlZFZpZGVvSWQsXHJcbiAgICB0aW1lbGluZURhdGEgPSB7fTtcclxuXHJcbiAgLy9yZW5kZXIgdGhlIHRlbXBsYXRlXHJcbiAgZnVuY3Rpb24gaW5pdCgpIHtcclxuICAgIC8vIHIuX2dldERhdGEoKTtcclxuICAgIF9nZXREYXRhKCk7XHJcbiAgfVxyXG4gIFxyXG4gIGZ1bmN0aW9uIF9nZXREYXRhKCkge1xyXG4gICAgbGV0IHZpZGVvTGlzdCA9IFZSLmdldC5vbmUoJy52aWRlby1saXN0Jyk7XHJcbiAgICBsZXQgdXJsID0gVlIuZ2V0LnVybHMoJ2RhdGEuanNvbicpLmRhdGFVcmw7XHJcbiBcclxuICAgIFZSLmdldC5kYXRhKHVybCkudGhlbihyZXNwb25zZSA9PiB7XHJcbiAgICAgIHZhciBwYXJzZWQgPSBKU09OLnBhcnNlKHJlc3BvbnNlKTtcclxuXHJcbiAgICAgIHJldHVybiBfZ2VuZXJhdGVUaW1lbGluZShwYXJzZWQpO1xyXG4gICAgfSkudGhlbih1bCA9PiB7XHJcbiAgICAgIHZpZGVvTGlzdC5hcHBlbmRDaGlsZCh1bCk7XHJcbiAgICAgIGNsaWNrVmlkZW8oKTtcclxuICAgIH0pO1xyXG5cclxuICB9XHJcbiAgXHJcbiAgZnVuY3Rpb24gX2dlbmVyYXRlVGltZWxpbmUoX3RpbWVsaW5lRGF0YSkge1xyXG4gICAgVlIudGltZWxpbmUudGltZWxpbmVEYXRhID0gX3RpbWVsaW5lRGF0YTtcclxuICAgIGxldCB2aWRlb0xpc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd1bCcpO1xyXG5cclxuICAgIF90aW1lbGluZURhdGEudmlkZW9zLmZvckVhY2goZnVuY3Rpb24gKG1vdmllT2JqKSB7XHJcbiAgICAgIHZhciB2aWRlb0lkID0gbW92aWVPYmo7XHJcblxyXG4gICAgICBsZXQgZWxlbWVudCA9IF9jcmVhdGVWaWRlb0VsZW1lbnQobW92aWVPYmoudGh1bWJuYWlsLCBtb3ZpZU9iai50aXRsZSwgbW92aWVPYmouZGVzY3JpcHRpb24sIG1vdmllT2JqLmlkKTtcclxuICAgICAgLy8gY29uc29sZS5sb2cob2JqKTtcclxuICAgICAgdmlkZW9MaXN0LmlubmVySFRNTCArPSBlbGVtZW50OyAvL2FkZCBpdCB0byB0aGUgdWxcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHZpZGVvTGlzdDtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIF9jcmVhdGVWaWRlb0VsZW1lbnQodHVtYlVybCwgdGl0bGUsIGRlc2NyaXB0aW9uLCB2aWRlb0lkKSB7XHJcbiAgICBsZXQgdHVtYlVybEdlbmVyYXRlZCA9IFZSLmdldC51cmxzKHR1bWJVcmwpLnR1bWJVcmw7XHJcbiAgICBsZXQgdmlkZW9VcmwgPSBWUi5nZXQudXJscyh0dW1iVXJsKS50dW1iVXJsO1xyXG4gICAgLy8gY29uc29sZS5sb2codHVtYlVybCk7XHJcbiAgICBsZXQgdmlkZW8gPSAnPGxpPjxkaXYgY2xhc3M9XCJ2aWRlby13cmFwcGVyXCI+JztcclxuICAgIHZpZGVvICs9ICdcdFx0XHRcdFx0PGRpdiBjbGFzcz1cInRodW1ibmFpbC13cmFwcGVyXCI+J1xyXG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHRcdDxpbWcgY2xhc3M9XCJ0aHVtYm5haWxcIiBzcmM9XCInICsgdHVtYlVybEdlbmVyYXRlZCArICdcIj4nO1xyXG4gICAgdmlkZW8gKz0gJyAgXHRcdFx0XHRcdDxkaXYgY2xhc3M9XCJtZWRpYS1jYXB0aW9uXCI+JztcclxuICAgIHZpZGVvICs9ICcgIFx0XHRcdFx0XHRcdDxkaXYgY2xhc3M9XCJjYXB0aW9uLWNvbnRlbnRcIj4nO1xyXG4gICAgdmlkZW8gKz0gJyAgXHRcdFx0XHRcdFx0XHQ8aDI+JyArIHRpdGxlICsgJzwvaDI+JztcclxuICAgIHZpZGVvICs9ICcgIFx0XHRcdFx0XHRcdFx0PHNwYW4+JyArIGRlc2NyaXB0aW9uICsgJzwvc3Bhbj4nO1xyXG4gICAgdmlkZW8gKz0gJyAgXHRcdFx0XHRcdFx0PC9kaXY+JztcclxuICAgIHZpZGVvICs9ICcgICAgXHRcdFx0XHQ8L2Rpdj4nO1xyXG4gICAgdmlkZW8gKz0gJyAgXHRcdFx0XHRcdDxkaXYgY2xhc3M9XCJ2aWRlby1wbGF5XCIgZGF0YS12aWRlby1pZD1cIicgKyB2aWRlb0lkICsgJ1wiXCI+JztcclxuICAgIHZpZGVvICs9ICcgIFx0XHRcdFx0XHQ8L2Rpdj4nO1xyXG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHQ8L2Rpdj4nO1xyXG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHQ8dmlkZW8gYXV0b3BsYXkgY29udHJvbHMgc3R5bGU9XCJkaXNwbGF5Om5vbmU7XCI+JztcclxuICAgIHZpZGVvICs9ICdcdFx0XHRcdFx0U29ycnksIHlvdXIgYnJvd3NlciBkb2VzbnQgc3VwcG9ydCBlbWJlZGRlZCB2aWRlb3MnO1xyXG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHQ8L3ZpZGVvPic7XHJcbiAgICB2aWRlbyArPSAnPC9kaXY+PC9saT4nO1xyXG4gICAgcmV0dXJuIHZpZGVvO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gY2xpY2tWaWRlbygpIHtcclxuXHJcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudmlkZW8tbGlzdCB1bCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcclxuXHJcbiAgICAgIGlmIChlLnRhcmdldC5jbGFzc05hbWUgPT09IFwidmlkZW8tcGxheVwiKSB7XHJcblxyXG4gICAgICAgIF9zZWxlY3RlZFZpZGVvSWQgPSBlLnRhcmdldC5kYXRhc2V0LnZpZGVvSWQ7XHJcblxyXG4gICAgICAgIHZhciBzZWxlY3RlZFZpZGVvID0gZ2V0VmlkZW8oX3NlbGVjdGVkVmlkZW9JZCk7XHJcbiAgICAgICAgY29uc29sZS5sb2coc2VsZWN0ZWRWaWRlbyk7XHJcbiAgICAgICAgc2VsZWN0ZWRWaWRlby5pZCA9IF9zZWxlY3RlZFZpZGVvSWQ7XHJcblxyXG5cclxuICAgICAgICAvLyBOYXZpZ2F0ZSB0byB0aGUgbWV0YSB2aWRlbyB2aWV3XHJcbiAgICAgICAgY29uc29sZS5sb2coJ05hdmlnYXRlIHRvIHRoZSBtZXRhIHZpZGVvIHZpZXcnKTtcclxuXHJcbiAgICAgICAgLy8gZ290b1NlY3Rpb24oJ3ZpZGVvLW1ldGEnKTtcclxuICAgICAgICBWUi5yb3V0ZXIuc2hvdygnI3ZpZGVvJyk7XHJcbiAgICAgICAgcmVuZGVyVmlkZW9NZXRhRGF0YShzZWxlY3RlZFZpZGVvKTtcclxuXHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLy8gZnVuY3Rpb24gX2RyYWdTY3JvbGwoKSB7XHJcbiAgLy8gICB2YXIgY3VyWVBvcyA9IDAsXHJcbiAgLy8gICAgIGN1clhQb3MgPSAwLFxyXG4gIC8vICAgICBjdXJEb3duID0gZmFsc2U7XHJcbiAgLy9cclxuICAvLyAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCBmdW5jdGlvbiAoZSkge1xyXG4gIC8vICAgICBpZiAoY3VyRG93biA9PT0gdHJ1ZSkge1xyXG4gIC8vICAgICAgIHZhciB0aW1lTGluZSA9IFZSLmdldC5vbmUoJyN0aW1lbGluZScpO1xyXG4gIC8vXHJcbiAgLy8gICAgIH1cclxuICAvLyAgIH0pO1xyXG4gIC8vXHJcbiAgLy8gICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgZnVuY3Rpb24gKGUpIHtcclxuICAvL1xyXG4gIC8vICAgICBjdXJEb3duID0gdHJ1ZTtcclxuICAvLyAgICAgY3VyWVBvcyA9IGUucGFnZVk7XHJcbiAgLy8gICAgIGN1clhQb3MgPSBlLnBhZ2VYO1xyXG4gIC8vICAgfSk7XHJcbiAgLy9cclxuICAvLyAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgZnVuY3Rpb24gKGUpIHtcclxuICAvLyAgICAgY3VyRG93biA9IGZhbHNlO1xyXG4gIC8vICAgfSk7XHJcbiAgLy8gfVxyXG5cclxuICBmdW5jdGlvbiBjbGlja01ldGFWaWRlbygpIHtcclxuICAgIFZSLmdldC5vbmUoJyNtZXRhLXZpZGVvLXBsYXknKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgIHZhciBzZWxlY3RlZFZpZGVvSWQgPSBlLnRhcmdldC5kYXRhc2V0LnZpZGVvSWQ7XHJcbiAgICAgIHZhciBzZWxlY3RlZFZpZGVvID0gZ2V0VmlkZW8oc2VsZWN0ZWRWaWRlb0lkKTtcclxuICAgICAgLy8gUGxheSB0aGUgdmlkZW9cclxuXHJcbiAgICAgIGNvbnNvbGUubG9nKCdQbGF5IHRlIHZpZGVvJyk7XHJcblxyXG4gICAgICB2YXIgbWV0YVZpZGVvRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhLXZpZGVvJyk7XHJcbiAgICAgIG1ldGFWaWRlb0VsZW1lbnQuc3JjID0gJ21lZGlhL3ZpZGVvLycgKyBzZWxlY3RlZFZpZGVvLmZpbGVuYW1lO1xyXG4gICAgICBtZXRhVmlkZW9FbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xyXG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdtZXRhLXRodW1ibmFpbC13cmFwcGVyJylbMF0uc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcblxyXG4gIGZ1bmN0aW9uIGNsaWNrQ2xvc2VNZXRhKCkge1xyXG4gICAgVlIuZ2V0Lm9uZSgnLmNsb3NlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICBWUi5yb3V0ZXIuc2hvdygnI3RpbWVsaW5lJyk7XHJcbiAgICAgIHZhciB2aWRlb0VsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YS12aWRlbycpO1xyXG5cclxuICAgICAgY29uc29sZS5sb2codmlkZW9FbGVtZW50LnBhdXNlKCkpXHJcblxyXG4gICAgICB2aWRlb0VsZW1lbnQucGF1c2UoKTtcclxuICAgICAgdmlkZW9FbGVtZW50LmN1cnJlbnRUaW1lID0gMDtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVuZGVycyB0aGUgdmlkZW8gbWV0YSBkYXRhIGluIHRoZSB2aWRlby1tZXRhIHNlY3Rpb25cclxuICAgKlxyXG4gICAqIEBwYXJhbSAgICAgIHtvYmp9ICBzZWxlY3RlZFZpZGVvICBUaGUgc2VsZWN0ZWQgdmlkZW9cclxuICAgKi9cclxuICBmdW5jdGlvbiByZW5kZXJWaWRlb01ldGFEYXRhKHNlbGVjdGVkVmlkZW8pIHtcclxuICAgIGNvbnNvbGUubG9nKHNlbGVjdGVkVmlkZW8pO1xyXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldGEtdmlkZW8tcGxheScpLnNldEF0dHJpYnV0ZSgnZGF0YS12aWRlby1pZCcsIHNlbGVjdGVkVmlkZW8uaWQpO1xyXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZpZGVvLXRpdGxlJykuaW5uZXJIVE1MID0gc2VsZWN0ZWRWaWRlby50aXRsZTtcclxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXNjcmlwdGlvbicpLmlubmVySFRNTCA9IHNlbGVjdGVkVmlkZW8uZGVzY3JpcHRpb247XHJcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGF0ZS1hbGlhcycpLmlubmVySFRNTCA9IHNlbGVjdGVkVmlkZW8uZGF0ZWFsaWFzO1xyXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldGEtdGh1bWJuYWlsJykuc3JjID0gJ21lZGlhL3RodW1ibmFpbHMvJyArIHNlbGVjdGVkVmlkZW8udGh1bWJuYWlsO1xyXG4gICAgY2xpY2tNZXRhVmlkZW8oKTtcclxuICAgIGNsaWNrQ2xvc2VNZXRhKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXRzIHRoZSB2aWRlby5cclxuICAgKlxyXG4gICAqIEBwYXJhbSAgICAgIHN0cmluZyB2aWRlb0lkICBUaGUgdmlkZW8gaWRlbnRpZmllclxyXG4gICAqIEByZXR1cm4gICAgIG9iaiAgVGhlIHZpZGVvLlxyXG4gICAqL1xyXG4gIGZ1bmN0aW9uIGdldFZpZGVvKHZpZGVvSWQpIHtcclxuICAgIHZhciB2aWRlb09iajtcclxuICAgIHRpbWVsaW5lRGF0YS52aWRlb3Muc29tZShmdW5jdGlvbiAoZWxtLCBpbmRleCkge1xyXG4gICAgICBpZiAoZWxtLmlkID09PSB2aWRlb0lkKSB7XHJcbiAgICAgICAgdmlkZW9PYmogPSBlbG07XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHZpZGVvT2JqO1xyXG5cclxuICB9XHJcblxyXG5cclxuICByZXR1cm4ge1xyXG4gICAgaW5pdDogaW5pdCxcclxuICAgIHRpbWVsaW5lRGF0YTp0aW1lbGluZURhdGFcclxuICB9O1xyXG5cclxufSkoKTtcclxuIl19
