"use strict";var VR=VR||{};VR.get=function(){function t(t){var e="/",n=e+"media/thumbnails/"+t,i=e+"media/video/"+t,a=e+"data/"+t;return{base:e,tumbUrl:n,videoUrl:i,dataUrl:a}}function e(t){return document.querySelector(t)}function n(t){return document.querySelectorAll(t)}function i(t){return new Promise(function(e,n){var i=new XMLHttpRequest;i.open("GET",t),i.onloadstart=function(){a(!0)},i.onloadend=function(){a(!0)},i.onload=function(){var t=200;i.status==t?(a(!1),e(i.responseText)):(n(new Error("request failed!")),VR.ux.showErr("There went something wrong"))},i.send()})}function a(t){var e=1e3;t?VR.get.one(".loading").classList.remove("disabled"):setTimeout(function(){VR.get.one(".loading").classList.add("disabled")},e)}return{urls:t,one:e,all:n,data:i,loading:a}}(),VR.date=function(){function t(t){var n=new Date(t),i=e.months[n.getMonth()],a=n.getDate(),o=e.days[n.getDay()],r=n.getFullYear();return o+" "+a+" "+i+" "+r}var e={days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],months:["January","February","March","April","May","June","July","August","September","October","November","December"]};return{readableDate:t}}(),VR.router=function(){function t(t){var e=VR.get.all(".page"),n=VR.get.one(t);e.forEach(function(t){t.classList.add("disabled")}),n.classList.remove("disabled"),"#cardboard"===t?VR.V3d.init():"#landing"===t?VR.landing.init():"#video"===t?console.log("hiosd"):"#timeline"===t&&VR.timeline.init()}return{show:t}}(),VR.landing=function(){function t(t){n(),e(),VR.get.loading(!1)}function e(){function t(){i+=(e-i)*o,a+=(n-a)*o;var r="translate("+i+"px, "+a+"px) scale(1.1)",d=VR.get.one(".bg");d.style.webkitTransform=r,d.style.MozTransform=r,d.style.msTransform=r,d.style.OTransform=r,d.style.transform=r,window.requestAnimationFrame(t)}var e=0,n=0,i=0,a=0,o=1/30;window.addEventListener("mouseover",function(t){var i=Math.max(-100,Math.min(100,screen.width/2-t.clientX)),a=Math.max(-100,Math.min(100,screen.height/2-t.clientY));e=20*i/100,n=10*a/100}),t()}function n(){var t=VR.get.one("#landingbutton");t.addEventListener("click",function(){VR.router.show("#timeline")})}return{init:t}}(),VR.timeline=function(){function t(){e()}function e(){var t=VR.get.one(".video-list"),e=VR.get.urls("data.json").dataUrl;VR.get.data(e).then(function(e){d=JSON.parse(e),t.appendChild(n(d)),a()})}function n(t){var e=document.createElement("ul");return t.videos.forEach(function(t){var n=Object.keys(t)[0],a=i(t[n].thumbnail,t[n].title,t[n].description,n);e.innerHTML+=a}),e}function i(t,e,n,i){var a=VR.get.urls(t).tumbUrl,o=(VR.get.urls(t).tumbUrl,'<ul><div class="video-wrapper">');return o+='\t\t\t\t\t<div class="thumbnail-wrapper">',o+='\t\t\t\t\t\t<img class="thumbnail" src="'+a+'">',o+='  \t\t\t\t\t<div class="media-caption">',o+='  \t\t\t\t\t\t<div class="caption-content">',o+="  \t\t\t\t\t\t\t<h2>"+e+"</h2>",o+="  \t\t\t\t\t\t\t<span>"+n+"</span>",o+="  \t\t\t\t\t\t</div>",o+="    \t\t\t\t</div>",o+='  \t\t\t\t\t<div class="video-play" data-video-id="'+i+'"">',o+="  \t\t\t\t\t</div>",o+="\t\t\t\t\t</div>",o+='\t\t\t\t\t<video autoplay controls style="display:none;">',o+="\t\t\t\t\tSorry, your browser doesnt support embedded videos",o+="\t\t\t\t\t</video>",o+="</div></ul>"}function a(){VR.get.one(".video-list ul").addEventListener("click",function(t){if("video-play"==t.target.className){var e=t.target.dataset.videoId,n=r(e);console.log(n),n.id=e,console.log("Navigate to the meta video view"),VR.router.show("#video"),o(n)}})}function o(t){console.log(t),document.getElementById("meta-video-play").setAttribute("data-video-id",t.id),document.getElementById("video-title").innerHTML=t[t.id].title,document.getElementById("description").innerHTML=t[t.id].description,document.getElementById("date-alias").innerHTML=t[t.id].datealias,document.getElementById("meta-thumbnail").src="media/thumbnails/"+t[t.id].thumbnail}function r(t){var e;return console.log(d),d.videos.some(function(n,i){n[t]&&(e=n)}),e}var d=void 0;return{init:t}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsIlZSc3RhcnQuanMiLCJWUmhlbHBlci5qcyIsIlZSZGF0ZS5qcyIsIlZScm91dGVyLmpzIiwiVlJsYW5kaW5nLmpzIiwiVlJ0aW1lbGluZS5qcyJdLCJuYW1lcyI6WyJWUiIsImdldCIsInVybHMiLCJ1cmwiLCJiYXNlIiwidHVtYlVybCIsInZpZGVvVXJsIiwiZGF0YVVybCIsIm9uZSIsInNlbGVjdG9yIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiYWxsIiwicXVlcnlTZWxlY3RvckFsbCIsImRhdGEiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsInJlcXVlc3QiLCJYTUxIdHRwUmVxdWVzdCIsIm9wZW4iLCJvbmxvYWRzdGFydCIsImxvYWRpbmciLCJvbmxvYWRlbmQiLCJvbmxvYWQiLCJzdGF0dXNDb2RlIiwic3RhdHVzIiwicmVzcG9uc2VUZXh0IiwiRXJyb3IiLCJ1eCIsInNob3dFcnIiLCJzZW5kIiwic2hvdyIsImRlbGF5VGltZSIsImNsYXNzTGlzdCIsInJlbW92ZSIsInNldFRpbWVvdXQiLCJhZGQiLCJkYXRlIiwicmVhZGFibGVEYXRlIiwidW5mcm9tYXRlZERhdGUiLCJuZXdEYXRlIiwiRGF0ZSIsIm1vbnRoIiwiZGF0ZXMiLCJtb250aHMiLCJnZXRNb250aCIsImdldERhdGUiLCJkYXkiLCJkYXlzIiwiZ2V0RGF5IiwieWVhciIsImdldEZ1bGxZZWFyIiwicm91dGVyIiwiaWQiLCJwYWdlcyIsInNlbGVjdGVkUGFnZSIsImZvckVhY2giLCJwYWdlIiwiVjNkIiwiaW5pdCIsImxhbmRpbmciLCJjb25zb2xlIiwibG9nIiwidGltZWxpbmUiLCJfYnV0dG9uIiwiYmFja2dyb3VuZCIsIm1vdmVCYWNrZ3JvdW5kIiwieCIsImxGb2xsb3dYIiwiZnJpY3Rpb24iLCJ5IiwibEZvbGxvd1kiLCJ0cmFuc2xhdGUiLCJzdHlsZSIsIndlYmtpdFRyYW5zZm9ybSIsIk1velRyYW5zZm9ybSIsIm1zVHJhbnNmb3JtIiwiT1RyYW5zZm9ybSIsInRyYW5zZm9ybSIsIndpbmRvdyIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwibE1vdXNlWCIsIk1hdGgiLCJtYXgiLCJtaW4iLCJzY3JlZW4iLCJ3aWR0aCIsImNsaWVudFgiLCJsTW91c2VZIiwiaGVpZ2h0IiwiY2xpZW50WSIsImxhbmRpbmdidXR0b24iLCJfZ2V0RGF0YSIsInZpZGVvTGlzdCIsInRoZW4iLCJyZXNwb25zZSIsIl92aWRlb3MiLCJKU09OIiwicGFyc2UiLCJhcHBlbmRDaGlsZCIsIl9nZW5lcmF0ZVRpbWVsaW5lIiwiY2xpY2tWaWRlbyIsImNyZWF0ZUVsZW1lbnQiLCJ2aWRlb3MiLCJvYmoiLCJ2aWRlb0lkIiwiT2JqZWN0Iiwia2V5cyIsImVsZW1lbnQiLCJfY3JlYXRlVmlkZW9FbGVtZW50IiwidGh1bWJuYWlsIiwidGl0bGUiLCJkZXNjcmlwdGlvbiIsImlubmVySFRNTCIsInR1bWJVcmxHZW5lcmF0ZWQiLCJ2aWRlbyIsInRhcmdldCIsImNsYXNzTmFtZSIsInNlbGVjdGVkVmlkZW9JZCIsImRhdGFzZXQiLCJzZWxlY3RlZFZpZGVvIiwiZ2V0VmlkZW8iLCJyZW5kZXJWaWRlb01ldGFEYXRhIiwiZ2V0RWxlbWVudEJ5SWQiLCJzZXRBdHRyaWJ1dGUiLCJkYXRlYWxpYXMiLCJzcmMiLCJzb21lIiwiZWxtIiwiaW5kZXgiXSwibWFwcGluZ3MiOiJBQUFBLFlDQUEsSUFBQUEsSUFBQUEsTUNDQUEsSUFBQUMsSUFBQSxXQUNBLFFBQUFDLEdBQUFDLEdBR0EsR0FBQUMsR0FBQSxJQUNBQyxFQUFBRCxFQUFBLG9CQUFBRCxFQUNBRyxFQUFBRixFQUFBLGVBQUFELEVBQ0FJLEVBQUFILEVBQUEsUUFBQUQsQ0FFQSxRQUNBQyxLQUFBQSxFQUNBQyxRQUFBQSxFQUNBQyxTQUFBQSxFQUNBQyxRQUFBQSxHQUlBLFFBQUFDLEdBQUFDLEdBQ0EsTUFBQUMsVUFBQUMsY0FBQUYsR0FHQSxRQUFBRyxHQUFBSCxHQUNBLE1BQUFDLFVB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QUNBQSxHQUFBLGNBSUEsUUFBQWQsS0FDQXhHLEdBQUFDLElBQUFPLElBQUEsa0JBQUEwRSxpQkFBQSxRQUFBLFNBQUFDLEdBQ0EsR0FBQSxjQUFBQSxFQUFBb0MsT0FBQUMsVUFBQSxDQUVBLEdBQUFDLEdBQUF0QyxFQUFBb0MsT0FBQUcsUUFBQWQsUUFDQWUsRUFBQUMsRUFBQUgsRUFDQTNELFNBQUFDLElBQUE0RCxHQUNBQSxFQUFBckUsR0FBQW1FLEVBSUEzRCxRQUFBQyxJQUFBLG1DQUdBL0QsR0FBQXFELE9BQUFyQixLQUFBLFVBQ0E2RixFQUFBRixNQStCQSxRQUFBRSxHQUFBRixHQUNBN0QsUUFBQUMsSUFBQTRELEdBQ0FqSCxTQUFBb0gsZUFBQSxtQkFBQUMsYUFBQSxnQkFBQUosRUFBQXJFLElBQ0E1QyxTQUFBb0gsZUFBQSxlQUFBVixVQUFBTyxFQUFBQSxFQUFBckUsSUFBQTRELE1BQ0F4RyxTQUFBb0gsZUFBQSxlQUFBVixVQUFBTyxFQUFBQSxFQUFBckUsSUFBQTZELFlBQ0F6RyxTQUFBb0gsZUFBQSxjQUFBVixVQUFBTyxFQUFBQSxFQUFBckUsSUFBQTBFLFVBQ0F0SCxTQUFBb0gsZUFBQSxrQkFBQUcsSUFBQSxvQkFBQU4sRUFBQUEsRUFBQXJFLElBQUEyRCxVQVNBLFFBQUFXLEdBQUFoQixHQUNBLEdBQUFlLEVBT0EsT0FOQTdELFNBQUFDLElBQUFvQyxHQUNBQSxFQUFBTyxPQUFBd0IsS0FBQSxTQUFBQyxFQUFBQyxHQUNBRCxFQUFBdkIsS0FDQWUsRUFBQVEsS0FHQVIsRUE5SEEsR0FBQXhCLEdBQUFBLE1Ba0lBLFFBQ0F2QyxLQUFBQSIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbnZhciBWUiA9IFZSIHx8IHt9O1xuJ3VzZSBzdHJpY3QnO1xuXG4vL1RvIGVhc2lseSBzZWxlY3Qgc29tZXRoaW5nIGZyb20gdGhlIERPTVxuVlIuZ2V0ID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiB1cmxzKHVybCkge1xuXG4gICAgLy8gbGV0IGJhc2UgPSAnL1ZSTGlmZW9mSmVzdXMvJztcbiAgICB2YXIgYmFzZSA9ICcvJztcbiAgICB2YXIgdHVtYlVybCA9IGJhc2UgKyAnbWVkaWEvdGh1bWJuYWlscy8nICsgdXJsO1xuICAgIHZhciB2aWRlb1VybCA9IGJhc2UgKyAnbWVkaWEvdmlkZW8vJyArIHVybDtcbiAgICB2YXIgZGF0YVVybCA9IGJhc2UgKyAnZGF0YS8nICsgdXJsO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGJhc2U6IGJhc2UsXG4gICAgICB0dW1iVXJsOiB0dW1iVXJsLFxuICAgICAgdmlkZW9Vcmw6IHZpZGVvVXJsLFxuICAgICAgZGF0YVVybDogZGF0YVVybFxuICAgIH07XG4gIH1cblxuICBmdW5jdGlvbiBvbmUoc2VsZWN0b3IpIHtcbiAgICAvL1RoaXMgaXMgYSBtZXRob2RcbiAgICByZXR1cm4gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7XG4gIH1cblxuICBmdW5jdGlvbiBhbGwoc2VsZWN0b3IpIHtcbiAgICByZXR1cm4gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7XG4gIH1cblxuICBmdW5jdGlvbiBkYXRhKHVybCkge1xuICAgIC8vIHJldHVybiBhIFByb21pc2Ugb2JqZWN0XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIHZhciByZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICAvL29wZW4gYW4gZ2V0IHJlcXVlc3RcbiAgICAgIHJlcXVlc3Qub3BlbignR0VUJywgdXJsKTtcbiAgICAgIHJlcXVlc3Qub25sb2Fkc3RhcnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxvYWRpbmcodHJ1ZSk7XG4gICAgICB9O1xuICAgICAgcmVxdWVzdC5vbmxvYWRlbmQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxvYWRpbmcodHJ1ZSk7XG4gICAgICB9O1xuXG4gICAgICAvL2lmIHRoZSByZXF1ZXN0IGlzIGRvbmVcbiAgICAgIHJlcXVlc3Qub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAvL29ueSBpZiByZXF1ZXN0IGlzIGRvbmVcbiAgICAgICAgdmFyIHN0YXR1c0NvZGUgPSAyMDA7XG4gICAgICAgIGlmIChyZXF1ZXN0LnN0YXR1cyA9PSBzdGF0dXNDb2RlKSB7XG4gICAgICAgICAgbG9hZGluZyhmYWxzZSk7XG5cbiAgICAgICAgICAvLyBzZW5kIHRleHQgZm9ybSByZXF1ZXN0XG4gICAgICAgICAgcmVzb2x2ZShyZXF1ZXN0LnJlc3BvbnNlVGV4dCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gcmVqZWN0IHRoZSBwcm9taXNlIGlmIHRoZXJlIGlzIGEgZXJyXG4gICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcigncmVxdWVzdCBmYWlsZWQhJykpO1xuICAgICAgICAgIFZSLnV4LnNob3dFcnIoJ1RoZXJlIHdlbnQgc29tZXRoaW5nIHdyb25nJyk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICAvL3NlbmQgdGhlIHJlcXVlc3RcbiAgICAgIHJlcXVlc3Quc2VuZCgpO1xuICAgIH0pO1xuICB9XG4gIC8vIHNob3cgb3IgaGlkZSB0aGUgbG9hZGluZyBzcGlubmVyXG4gIGZ1bmN0aW9uIGxvYWRpbmcoc2hvdykge1xuICAgIHZhciBkZWxheVRpbWUgPSAxMDAwO1xuICAgIGlmIChzaG93KSB7XG4gICAgICBWUi5nZXQub25lKCcubG9hZGluZycpLmNsYXNzTGlzdC5yZW1vdmUoJ2Rpc2FibGVkJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vc2hvdyBsb2FkaW5nXG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgVlIuZ2V0Lm9uZSgnLmxvYWRpbmcnKS5jbGFzc0xpc3QuYWRkKCdkaXNhYmxlZCcpO1xuICAgICAgfSwgZGVsYXlUaW1lKTsgLy9hZGQgYSBkZWxheSBiZWNhdXNlIHlvdSB3b24ndCBzZWUgaXQgd2l0aCBmYXN0IGludGVybmV0LlxuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7IC8vcmV0dXJuIG9ubHkgdGhlIGZ1bnRpb25zIHRoYXQgYXJlIG5lc3NlZXJpeVxuICAgIHVybHM6IHVybHMsXG4gICAgb25lOiBvbmUsXG4gICAgYWxsOiBhbGwsXG4gICAgZGF0YTogZGF0YSxcbiAgICBsb2FkaW5nOiBsb2FkaW5nXG4gIH07XG59KCk7XG5cbi8vVG8gZWFzaWx5IHNlbGVjdCBzb21ldGhpbmcgZnJvbSB0aGUgRE9NXG5WUi5kYXRlID0gZnVuY3Rpb24gKCkge1xuICB2YXIgZGF0ZXMgPSB7XG4gICAgZGF5czogWydTdW5kYXknLCAnTW9uZGF5JywgJ1R1ZXNkYXknLCAnV2VkbmVzZGF5JywgJ1RodXJzZGF5JywgJ0ZyaWRheScsICdTYXR1cmRheSddLFxuICAgIG1vbnRoczogWydKYW51YXJ5JywgJ0ZlYnJ1YXJ5JywgJ01hcmNoJywgJ0FwcmlsJywgJ01heScsICdKdW5lJywgJ0p1bHknLCAnQXVndXN0JywgJ1NlcHRlbWJlcicsICdPY3RvYmVyJywgJ05vdmVtYmVyJywgJ0RlY2VtYmVyJ11cbiAgfTtcblxuICBmdW5jdGlvbiByZWFkYWJsZURhdGUodW5mcm9tYXRlZERhdGUpIHtcbiAgICB2YXIgbmV3RGF0ZSA9IG5ldyBEYXRlKHVuZnJvbWF0ZWREYXRlKTtcbiAgICB2YXIgbW9udGggPSBkYXRlcy5tb250aHNbbmV3RGF0ZS5nZXRNb250aCgpXTtcbiAgICB2YXIgZGF0ZSA9IG5ld0RhdGUuZ2V0RGF0ZSgpO1xuICAgIHZhciBkYXkgPSBkYXRlcy5kYXlzW25ld0RhdGUuZ2V0RGF5KCldO1xuICAgIHZhciB5ZWFyID0gbmV3RGF0ZS5nZXRGdWxsWWVhcigpO1xuXG4gICAgcmV0dXJuIGRheSArICcgJyArIGRhdGUgKyAnICcgKyBtb250aCArICcgJyArIHllYXI7XG4gIH1cblxuICByZXR1cm4geyAvL3JldHVybiBvbmx5IHRoZSBmdW50aW9ucyB0aGF0IGFyZSBuZXNzZWVyaXlcbiAgICByZWFkYWJsZURhdGU6IHJlYWRhYmxlRGF0ZVxuICB9O1xufSgpO1xuXG5WUi5yb3V0ZXIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIHNob3coaWQpIHtcbiAgICB2YXIgcGFnZXMgPSBWUi5nZXQuYWxsKCcucGFnZScpO1xuICAgIHZhciBzZWxlY3RlZFBhZ2UgPSBWUi5nZXQub25lKGlkKTtcblxuICAgIC8vZGlzYWJsZSBhbGwgdGhlIHBhZ2VzXG4gICAgcGFnZXMuZm9yRWFjaChmdW5jdGlvbiAocGFnZSkge1xuICAgICAgcGFnZS5jbGFzc0xpc3QuYWRkKCdkaXNhYmxlZCcpO1xuICAgIH0pO1xuXG4gICAgc2VsZWN0ZWRQYWdlLmNsYXNzTGlzdC5yZW1vdmUoJ2Rpc2FibGVkJyk7XG5cbiAgICBpZiAoaWQgPT09ICcjY2FyZGJvYXJkJykge1xuICAgICAgVlIuVjNkLmluaXQoKTtcbiAgICB9IGVsc2UgaWYgKGlkID09PSAnI2xhbmRpbmcnKSB7XG5cbiAgICAgIFZSLmxhbmRpbmcuaW5pdCgpO1xuICAgIH0gZWxzZSBpZiAoaWQgPT09ICcjdmlkZW8nKSB7XG4gICAgICBjb25zb2xlLmxvZygnaGlvc2QnKTtcbiAgICAgIC8vIFZSLnJlbmRlci5pbml0KCk7XG4gICAgfSBlbHNlIGlmIChpZCA9PT0gJyN0aW1lbGluZScpIHtcbiAgICAgIFZSLnRpbWVsaW5lLmluaXQoKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHtcbiAgICBzaG93OiBzaG93XG4gIH07XG59KCk7XG5cblZSLmxhbmRpbmcgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIGluaXQoaWQpIHtcblxuICAgIF9idXR0b24oKTtcbiAgICBiYWNrZ3JvdW5kKCk7XG4gICAgVlIuZ2V0LmxvYWRpbmcoZmFsc2UpO1xuICB9XG5cbiAgZnVuY3Rpb24gYmFja2dyb3VuZCgpIHtcbiAgICB2YXIgbEZvbGxvd1ggPSAwLFxuICAgICAgICBsRm9sbG93WSA9IDAsXG4gICAgICAgIHggPSAwLFxuICAgICAgICB5ID0gMCxcbiAgICAgICAgZnJpY3Rpb24gPSAxIC8gMzA7XG5cbiAgICBmdW5jdGlvbiBtb3ZlQmFja2dyb3VuZCgpIHtcbiAgICAgIHggKz0gKGxGb2xsb3dYIC0geCkgKiBmcmljdGlvbjtcbiAgICAgIHkgKz0gKGxGb2xsb3dZIC0geSkgKiBmcmljdGlvbjtcblxuICAgICAgdmFyIHRyYW5zbGF0ZSA9ICd0cmFuc2xhdGUoJyArIHggKyAncHgsICcgKyB5ICsgJ3B4KSBzY2FsZSgxLjEpJztcblxuICAgICAgdmFyIGJhY2tncm91bmQgPSBWUi5nZXQub25lKCcuYmcnKTtcblxuICAgICAgLy8gYmFja2dyb3VuZC5zdHlsZVsnLXdlYml0LXRyYW5zZm9ybSddID0gdHJhbnNsYXRlO1xuICAgICAgLy8gYmFja2dyb3VuZC5zdHlsZVsnLW1vei10cmFuc2Zvcm0nXSA9IHRyYW5zbGF0ZTtcbiAgICAgIGJhY2tncm91bmQuc3R5bGUud2Via2l0VHJhbnNmb3JtID0gdHJhbnNsYXRlO1xuICAgICAgYmFja2dyb3VuZC5zdHlsZS5Nb3pUcmFuc2Zvcm0gPSB0cmFuc2xhdGU7XG4gICAgICBiYWNrZ3JvdW5kLnN0eWxlLm1zVHJhbnNmb3JtID0gdHJhbnNsYXRlO1xuICAgICAgYmFja2dyb3VuZC5zdHlsZS5PVHJhbnNmb3JtID0gdHJhbnNsYXRlO1xuICAgICAgYmFja2dyb3VuZC5zdHlsZS50cmFuc2Zvcm0gPSB0cmFuc2xhdGU7XG5cbiAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUobW92ZUJhY2tncm91bmQpO1xuICAgIH1cblxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW92ZXInLCBmdW5jdGlvbiAoZSkge1xuXG4gICAgICB2YXIgbE1vdXNlWCA9IE1hdGgubWF4KC0xMDAsIE1hdGgubWluKDEwMCwgc2NyZWVuLndpZHRoIC8gMiAtIGUuY2xpZW50WCkpO1xuICAgICAgdmFyIGxNb3VzZVkgPSBNYXRoLm1heCgtMTAwLCBNYXRoLm1pbigxMDAsIHNjcmVlbi5oZWlnaHQgLyAyIC0gZS5jbGllbnRZKSk7XG4gICAgICBsRm9sbG93WCA9IDIwICogbE1vdXNlWCAvIDEwMDsgLy8gMTAwIDogMTIgPSBsTW91eGVYIDogbEZvbGxvd1xuICAgICAgbEZvbGxvd1kgPSAxMCAqIGxNb3VzZVkgLyAxMDA7XG4gICAgfSk7XG4gICAgbW92ZUJhY2tncm91bmQoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9idXR0b24oKSB7XG4gICAgdmFyIGxhbmRpbmdidXR0b24gPSBWUi5nZXQub25lKCcjbGFuZGluZ2J1dHRvbicpO1xuICAgIGxhbmRpbmdidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICBWUi5yb3V0ZXIuc2hvdygnI3RpbWVsaW5lJyk7XG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIHtcbiAgICBpbml0OiBpbml0XG4gIH07XG59KCk7XG5cblZSLnRpbWVsaW5lID0gZnVuY3Rpb24gKCkge1xuICAvL2Z1bnRpb24gdG8gcmVuZGVyIGEgdGVtcGxhdGUuXG4gIC8vcmVuZGVyIHRoZSB0ZW1wbGF0ZVxuICB2YXIgX3ZpZGVvcyA9IHZvaWQgMDtcblxuICBmdW5jdGlvbiBpbml0KCkge1xuICAgIC8vIHIuX2dldERhdGEoKTtcbiAgICBfZ2V0RGF0YSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gX2dldERhdGEoKSB7XG5cbiAgICB2YXIgdmlkZW9MaXN0ID0gVlIuZ2V0Lm9uZSgnLnZpZGVvLWxpc3QnKTtcbiAgICB2YXIgdXJsID0gVlIuZ2V0LnVybHMoJ2RhdGEuanNvbicpLmRhdGFVcmw7XG5cbiAgICBWUi5nZXQuZGF0YSh1cmwpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICBfdmlkZW9zID0gSlNPTi5wYXJzZShyZXNwb25zZSk7XG5cbiAgICAgIHZpZGVvTGlzdC5hcHBlbmRDaGlsZChfZ2VuZXJhdGVUaW1lbGluZShfdmlkZW9zKSk7XG4gICAgICBjbGlja1ZpZGVvKCk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBfZ2VuZXJhdGVUaW1lbGluZShkYXRhKSB7XG4gICAgdmFyIHZpZGVvTGlzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3VsJyk7XG5cbiAgICBkYXRhLnZpZGVvcy5mb3JFYWNoKGZ1bmN0aW9uIChvYmopIHtcbiAgICAgIHZhciB2aWRlb0lkID0gT2JqZWN0LmtleXMob2JqKVswXTtcblxuICAgICAgdmFyIGVsZW1lbnQgPSBfY3JlYXRlVmlkZW9FbGVtZW50KG9ialt2aWRlb0lkXS50aHVtYm5haWwsIG9ialt2aWRlb0lkXS50aXRsZSwgb2JqW3ZpZGVvSWRdLmRlc2NyaXB0aW9uLCB2aWRlb0lkKTtcblxuICAgICAgdmlkZW9MaXN0LmlubmVySFRNTCArPSBlbGVtZW50OyAvL2FkZCBpdCB0byB0aGUgdWxcbiAgICB9KTtcbiAgICByZXR1cm4gdmlkZW9MaXN0O1xuICB9XG5cbiAgZnVuY3Rpb24gX2NyZWF0ZVZpZGVvRWxlbWVudCh0dW1iVXJsLCB0aXRsZSwgZGVzY3JpcHRpb24sIHZpZGVvSWQpIHtcbiAgICB2YXIgdHVtYlVybEdlbmVyYXRlZCA9IFZSLmdldC51cmxzKHR1bWJVcmwpLnR1bWJVcmw7XG4gICAgdmFyIHZpZGVvVXJsID0gVlIuZ2V0LnVybHModHVtYlVybCkudHVtYlVybDtcblxuICAgIHZhciB2aWRlbyA9ICc8dWw+PGRpdiBjbGFzcz1cInZpZGVvLXdyYXBwZXJcIj4nO1xuICAgIHZpZGVvICs9ICdcdFx0XHRcdFx0PGRpdiBjbGFzcz1cInRodW1ibmFpbC13cmFwcGVyXCI+JztcbiAgICB2aWRlbyArPSAnXHRcdFx0XHRcdFx0PGltZyBjbGFzcz1cInRodW1ibmFpbFwiIHNyYz1cIicgKyB0dW1iVXJsR2VuZXJhdGVkICsgJ1wiPic7XG4gICAgdmlkZW8gKz0gJyAgXHRcdFx0XHRcdDxkaXYgY2xhc3M9XCJtZWRpYS1jYXB0aW9uXCI+JztcbiAgICB2aWRlbyArPSAnICBcdFx0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwiY2FwdGlvbi1jb250ZW50XCI+JztcbiAgICB2aWRlbyArPSAnICBcdFx0XHRcdFx0XHRcdDxoMj4nICsgdGl0bGUgKyAnPC9oMj4nO1xuICAgIHZpZGVvICs9ICcgIFx0XHRcdFx0XHRcdFx0PHNwYW4+JyArIGRlc2NyaXB0aW9uICsgJzwvc3Bhbj4nO1xuICAgIHZpZGVvICs9ICcgIFx0XHRcdFx0XHRcdDwvZGl2Pic7XG4gICAgdmlkZW8gKz0gJyAgICBcdFx0XHRcdDwvZGl2Pic7XG4gICAgdmlkZW8gKz0gJyAgXHRcdFx0XHRcdDxkaXYgY2xhc3M9XCJ2aWRlby1wbGF5XCIgZGF0YS12aWRlby1pZD1cIicgKyB2aWRlb0lkICsgJ1wiXCI+JztcbiAgICB2aWRlbyArPSAnICBcdFx0XHRcdFx0PC9kaXY+JztcbiAgICB2aWRlbyArPSAnXHRcdFx0XHRcdDwvZGl2Pic7XG4gICAgdmlkZW8gKz0gJ1x0XHRcdFx0XHQ8dmlkZW8gYXV0b3BsYXkgY29udHJvbHMgc3R5bGU9XCJkaXNwbGF5Om5vbmU7XCI+JztcbiAgICB2aWRlbyArPSAnXHRcdFx0XHRcdFNvcnJ5LCB5b3VyIGJyb3dzZXIgZG9lc250IHN1cHBvcnQgZW1iZWRkZWQgdmlkZW9zJztcbiAgICB2aWRlbyArPSAnXHRcdFx0XHRcdDwvdmlkZW8+JztcbiAgICB2aWRlbyArPSAnPC9kaXY+PC91bD4nO1xuICAgIHJldHVybiB2aWRlbztcbiAgfVxuXG4gIGZ1bmN0aW9uIGNsaWNrVmlkZW8oKSB7XG4gICAgVlIuZ2V0Lm9uZSgnLnZpZGVvLWxpc3QgdWwnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICBpZiAoZS50YXJnZXQuY2xhc3NOYW1lID09IFwidmlkZW8tcGxheVwiKSB7XG5cbiAgICAgICAgdmFyIHNlbGVjdGVkVmlkZW9JZCA9IGUudGFyZ2V0LmRhdGFzZXQudmlkZW9JZDtcbiAgICAgICAgdmFyIHNlbGVjdGVkVmlkZW8gPSBnZXRWaWRlbyhzZWxlY3RlZFZpZGVvSWQpO1xuICAgICAgICBjb25zb2xlLmxvZyhzZWxlY3RlZFZpZGVvKTtcbiAgICAgICAgc2VsZWN0ZWRWaWRlby5pZCA9IHNlbGVjdGVkVmlkZW9JZDtcblxuICAgICAgICAvLyBOYXZpZ2F0ZSB0byB0aGUgbWV0YSB2aWRlbyB2aWV3XG4gICAgICAgIGNvbnNvbGUubG9nKCdOYXZpZ2F0ZSB0byB0aGUgbWV0YSB2aWRlbyB2aWV3Jyk7XG5cbiAgICAgICAgLy8gZ290b1NlY3Rpb24oJ3ZpZGVvLW1ldGEnKTtcbiAgICAgICAgVlIucm91dGVyLnNob3coJyN2aWRlbycpO1xuICAgICAgICByZW5kZXJWaWRlb01ldGFEYXRhKHNlbGVjdGVkVmlkZW8pO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gY2xpY2tNZXRhVmlkZW8oKSB7XG4gICAgVlIuZ2V0Lm9uZSgnLnZpZGVvLW1ldGEnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICBpZiAoZS50YXJnZXQuaWQgPT0gXCJtZXRhLXZpZGVvLXBsYXlcIikge1xuICAgICAgICB2YXIgc2VsZWN0ZWRWaWRlb0lkID0gZS50YXJnZXQuZGF0YXNldC52aWRlb0lkO1xuICAgICAgICB2YXIgc2VsZWN0ZWRWaWRlbyA9IGdldFZpZGVvKHNlbGVjdGVkVmlkZW9JZClbc2VsZWN0ZWRWaWRlb0lkXTtcblxuICAgICAgICBpZiAoZ2V0QWN0aXZlU2VjdGlvbigpID09ICd2aWRlby1tZXRhJykge1xuICAgICAgICAgIC8vIFBsYXkgdGhlIHZpZGVvXG4gICAgICAgICAgY29uc29sZS5sb2coJ1BsYXkgdGUgdmlkZW8nKTtcblxuICAgICAgICAgIHZhciBtZXRhVmlkZW9FbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldGEtdmlkZW8nKTtcbiAgICAgICAgICBtZXRhVmlkZW9FbGVtZW50LnNyYyA9ICdtZWRpYS92aWRlby8nICsgc2VsZWN0ZWRWaWRlby5maWxlbmFtZTtcbiAgICAgICAgICBtZXRhVmlkZW9FbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xuICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ21ldGEtdGh1bWJuYWlsLXdyYXBwZXInKVswXS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUmVuZGVycyB0aGUgdmlkZW8gbWV0YSBkYXRhIGluIHRoZSB2aWRlby1tZXRhIHNlY3Rpb25cbiAgICpcbiAgICogQHBhcmFtICAgICAge29ian0gIHNlbGVjdGVkVmlkZW8gIFRoZSBzZWxlY3RlZCB2aWRlb1xuICAgKi9cbiAgZnVuY3Rpb24gcmVuZGVyVmlkZW9NZXRhRGF0YShzZWxlY3RlZFZpZGVvKSB7XG4gICAgY29uc29sZS5sb2coc2VsZWN0ZWRWaWRlbyk7XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldGEtdmlkZW8tcGxheScpLnNldEF0dHJpYnV0ZSgnZGF0YS12aWRlby1pZCcsIHNlbGVjdGVkVmlkZW8uaWQpO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd2aWRlby10aXRsZScpLmlubmVySFRNTCA9IHNlbGVjdGVkVmlkZW9bc2VsZWN0ZWRWaWRlby5pZF0udGl0bGU7XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rlc2NyaXB0aW9uJykuaW5uZXJIVE1MID0gc2VsZWN0ZWRWaWRlb1tzZWxlY3RlZFZpZGVvLmlkXS5kZXNjcmlwdGlvbjtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGF0ZS1hbGlhcycpLmlubmVySFRNTCA9IHNlbGVjdGVkVmlkZW9bc2VsZWN0ZWRWaWRlby5pZF0uZGF0ZWFsaWFzO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhLXRodW1ibmFpbCcpLnNyYyA9ICdtZWRpYS90aHVtYm5haWxzLycgKyBzZWxlY3RlZFZpZGVvW3NlbGVjdGVkVmlkZW8uaWRdLnRodW1ibmFpbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSB2aWRlby5cbiAgICpcbiAgICogQHBhcmFtICAgICAgc3RyaW5nIHZpZGVvSWQgIFRoZSB2aWRlbyBpZGVudGlmaWVyXG4gICAqIEByZXR1cm4gICAgIG9iaiAgVGhlIHZpZGVvLlxuICAgKi9cbiAgZnVuY3Rpb24gZ2V0VmlkZW8odmlkZW9JZCkge1xuICAgIHZhciBzZWxlY3RlZFZpZGVvO1xuICAgIGNvbnNvbGUubG9nKF92aWRlb3MpO1xuICAgIF92aWRlb3MudmlkZW9zLnNvbWUoZnVuY3Rpb24gKGVsbSwgaW5kZXgpIHtcbiAgICAgIGlmIChlbG1bdmlkZW9JZF0pIHtcbiAgICAgICAgc2VsZWN0ZWRWaWRlbyA9IGVsbTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gc2VsZWN0ZWRWaWRlbztcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgaW5pdDogaW5pdFxuICB9O1xufSgpOyIsInZhciBWUiA9IFZSIHx8IHt9O1xuJ3VzZSBzdHJpY3QnO1xuIiwiLy9UbyBlYXNpbHkgc2VsZWN0IHNvbWV0aGluZyBmcm9tIHRoZSBET01cblZSLmdldCA9IChmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIHVybHModXJsKSB7XG5cbiAgICAvLyBsZXQgYmFzZSA9ICcvVlJMaWZlb2ZKZXN1cy8nO1xuICAgIGxldCBiYXNlID0gJy8nO1xuICAgIGxldCB0dW1iVXJsID0gYmFzZSArICdtZWRpYS90aHVtYm5haWxzLycgKyB1cmw7XG4gICAgbGV0IHZpZGVvVXJsID0gYmFzZSArICdtZWRpYS92aWRlby8nICsgdXJsO1xuICAgIGxldCBkYXRhVXJsID0gYmFzZSArICdkYXRhLycgKyB1cmw7XG5cbiAgICByZXR1cm4ge1xuICAgICAgYmFzZTogYmFzZSxcbiAgICAgIHR1bWJVcmw6IHR1bWJVcmwsXG4gICAgICB2aWRlb1VybDogdmlkZW9VcmwsXG4gICAgICBkYXRhVXJsXG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG9uZShzZWxlY3RvcikgeyAvL1RoaXMgaXMgYSBtZXRob2RcbiAgICByZXR1cm4gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7XG4gIH1cblxuICBmdW5jdGlvbiBhbGwoc2VsZWN0b3IpIHtcbiAgICByZXR1cm4gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7XG4gIH1cblxuICBmdW5jdGlvbiBkYXRhKHVybCkge1xuICAgIC8vIHJldHVybiBhIFByb21pc2Ugb2JqZWN0XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIHZhciByZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICAvL29wZW4gYW4gZ2V0IHJlcXVlc3RcbiAgICAgIHJlcXVlc3Qub3BlbignR0VUJywgdXJsKTtcbiAgICAgIHJlcXVlc3Qub25sb2Fkc3RhcnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxvYWRpbmcodHJ1ZSk7XG4gICAgICB9O1xuICAgICAgcmVxdWVzdC5vbmxvYWRlbmQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxvYWRpbmcodHJ1ZSk7XG4gICAgICB9O1xuXG4gICAgICAvL2lmIHRoZSByZXF1ZXN0IGlzIGRvbmVcbiAgICAgIHJlcXVlc3Qub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAvL29ueSBpZiByZXF1ZXN0IGlzIGRvbmVcbiAgICAgICAgbGV0IHN0YXR1c0NvZGUgPSAyMDA7XG4gICAgICAgIGlmIChyZXF1ZXN0LnN0YXR1cyA9PSBzdGF0dXNDb2RlKSB7XG4gICAgICAgICAgbG9hZGluZyhmYWxzZSk7XG5cbiAgICAgICAgICAvLyBzZW5kIHRleHQgZm9ybSByZXF1ZXN0XG4gICAgICAgICAgcmVzb2x2ZShyZXF1ZXN0LnJlc3BvbnNlVGV4dCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gcmVqZWN0IHRoZSBwcm9taXNlIGlmIHRoZXJlIGlzIGEgZXJyXG4gICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcigncmVxdWVzdCBmYWlsZWQhJykpO1xuICAgICAgICAgIFZSLnV4LnNob3dFcnIoJ1RoZXJlIHdlbnQgc29tZXRoaW5nIHdyb25nJyk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICAvL3NlbmQgdGhlIHJlcXVlc3RcbiAgICAgIHJlcXVlc3Quc2VuZCgpO1xuICAgIH0pO1xuICB9XG4gIC8vIHNob3cgb3IgaGlkZSB0aGUgbG9hZGluZyBzcGlubmVyXG4gIGZ1bmN0aW9uIGxvYWRpbmcoc2hvdykge1xuICAgIGxldCBkZWxheVRpbWUgPSAxMDAwO1xuICAgIGlmIChzaG93KSB7XG4gICAgICBWUi5nZXQub25lKCcubG9hZGluZycpLmNsYXNzTGlzdC5yZW1vdmUoJ2Rpc2FibGVkJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vc2hvdyBsb2FkaW5nXG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgVlIuZ2V0Lm9uZSgnLmxvYWRpbmcnKS5jbGFzc0xpc3QuYWRkKCdkaXNhYmxlZCcpO1xuICAgICAgfSwgZGVsYXlUaW1lKTsgLy9hZGQgYSBkZWxheSBiZWNhdXNlIHlvdSB3b24ndCBzZWUgaXQgd2l0aCBmYXN0IGludGVybmV0LlxuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7IC8vcmV0dXJuIG9ubHkgdGhlIGZ1bnRpb25zIHRoYXQgYXJlIG5lc3NlZXJpeVxuICAgIHVybHM6IHVybHMsXG4gICAgb25lOiBvbmUsXG4gICAgYWxsOiBhbGwsXG4gICAgZGF0YTogZGF0YSxcbiAgICBsb2FkaW5nOiBsb2FkaW5nXG4gIH07XG59KSgpO1xuIiwiLy9UbyBlYXNpbHkgc2VsZWN0IHNvbWV0aGluZyBmcm9tIHRoZSBET01cblZSLmRhdGUgPSAoZnVuY3Rpb24gKCkge1xuICBsZXQgZGF0ZXMgPSB7XG4gICAgZGF5czogWydTdW5kYXknLCAnTW9uZGF5JywgJ1R1ZXNkYXknLCAnV2VkbmVzZGF5JywgJ1RodXJzZGF5JywgJ0ZyaWRheScsICdTYXR1cmRheSddLFxuICAgIG1vbnRoczogWydKYW51YXJ5JywgJ0ZlYnJ1YXJ5JywgJ01hcmNoJywgJ0FwcmlsJywgJ01heScsICdKdW5lJywgJ0p1bHknLCAnQXVndXN0JywgJ1NlcHRlbWJlcicsICdPY3RvYmVyJywgJ05vdmVtYmVyJywgJ0RlY2VtYmVyJ10sXG4gIH07XG5cbiAgZnVuY3Rpb24gcmVhZGFibGVEYXRlKHVuZnJvbWF0ZWREYXRlKSB7XG4gICAgbGV0IG5ld0RhdGUgPSBuZXcgRGF0ZSh1bmZyb21hdGVkRGF0ZSk7XG4gICAgbGV0IG1vbnRoID0gZGF0ZXMubW9udGhzW25ld0RhdGUuZ2V0TW9udGgoKV07XG4gICAgbGV0IGRhdGUgPSBuZXdEYXRlLmdldERhdGUoKTtcbiAgICBsZXQgZGF5ID0gZGF0ZXMuZGF5c1tuZXdEYXRlLmdldERheSgpXTtcbiAgICBsZXQgeWVhciA9IG5ld0RhdGUuZ2V0RnVsbFllYXIoKTtcblxuICAgIHJldHVybiBkYXkgKyAnICcgKyBkYXRlICsgJyAnICsgbW9udGggKyAnICcgKyB5ZWFyO1xuICB9XG5cblxuICByZXR1cm4geyAvL3JldHVybiBvbmx5IHRoZSBmdW50aW9ucyB0aGF0IGFyZSBuZXNzZWVyaXlcbiAgICByZWFkYWJsZURhdGU6IHJlYWRhYmxlRGF0ZVxuICB9O1xufSkoKTtcbiIsIlZSLnJvdXRlciA9IChmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIHNob3coaWQpIHtcbiAgICB2YXIgcGFnZXMgPSBWUi5nZXQuYWxsKCcucGFnZScpO1xuICAgIHZhciBzZWxlY3RlZFBhZ2UgPSBWUi5nZXQub25lKGlkKTtcblxuICAgIC8vZGlzYWJsZSBhbGwgdGhlIHBhZ2VzXG4gICAgcGFnZXMuZm9yRWFjaChmdW5jdGlvbiAocGFnZSkge1xuICAgICAgcGFnZS5jbGFzc0xpc3QuYWRkKCdkaXNhYmxlZCcpO1xuICAgIH0pO1xuXG4gICAgc2VsZWN0ZWRQYWdlLmNsYXNzTGlzdC5yZW1vdmUoJ2Rpc2FibGVkJyk7XG5cbiAgICBpZiAoaWQgPT09ICcjY2FyZGJvYXJkJykge1xuICAgICAgVlIuVjNkLmluaXQoKTtcbiAgICB9IGVsc2UgaWYgKGlkID09PSAnI2xhbmRpbmcnKSB7XG5cbiAgICAgIFZSLmxhbmRpbmcuaW5pdCgpO1xuICAgIH0gZWxzZSBpZiAoaWQgPT09ICcjdmlkZW8nKSB7XG4gICAgICBjb25zb2xlLmxvZygnaGlvc2QnKTtcbiAgICAgIC8vIFZSLnJlbmRlci5pbml0KCk7XG4gICAgfSBlbHNlIGlmIChpZCA9PT0gJyN0aW1lbGluZScpIHtcbiAgICAgIFZSLnRpbWVsaW5lLmluaXQoKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHtcbiAgICBzaG93OiBzaG93XG4gIH07XG59KSgpO1xuIiwiVlIubGFuZGluZyA9IChmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIGluaXQoaWQpIHtcblxuICAgIF9idXR0b24oKTtcbiAgICBiYWNrZ3JvdW5kKCk7XG4gICAgVlIuZ2V0LmxvYWRpbmcoZmFsc2UpO1xuICB9XG5cbiAgZnVuY3Rpb24gYmFja2dyb3VuZCgpIHtcbiAgICB2YXIgbEZvbGxvd1ggPSAwLFxuICAgICAgbEZvbGxvd1kgPSAwLFxuICAgICAgeCA9IDAsXG4gICAgICB5ID0gMCxcbiAgICAgIGZyaWN0aW9uID0gMSAvIDMwO1xuXG4gICAgZnVuY3Rpb24gbW92ZUJhY2tncm91bmQoKSB7XG4gICAgICB4ICs9IChsRm9sbG93WCAtIHgpICogZnJpY3Rpb247XG4gICAgICB5ICs9IChsRm9sbG93WSAtIHkpICogZnJpY3Rpb247XG5cbiAgICAgIGxldCB0cmFuc2xhdGUgPSAndHJhbnNsYXRlKCcgKyB4ICsgJ3B4LCAnICsgeSArICdweCkgc2NhbGUoMS4xKSc7XG5cbiAgICAgIHZhciBiYWNrZ3JvdW5kID0gVlIuZ2V0Lm9uZSgnLmJnJyk7XG5cbiAgICAgIC8vIGJhY2tncm91bmQuc3R5bGVbJy13ZWJpdC10cmFuc2Zvcm0nXSA9IHRyYW5zbGF0ZTtcbiAgICAgIC8vIGJhY2tncm91bmQuc3R5bGVbJy1tb3otdHJhbnNmb3JtJ10gPSB0cmFuc2xhdGU7XG4gICAgICBiYWNrZ3JvdW5kLnN0eWxlLndlYmtpdFRyYW5zZm9ybSA9IHRyYW5zbGF0ZTtcbiAgICAgIGJhY2tncm91bmQuc3R5bGUuTW96VHJhbnNmb3JtID0gdHJhbnNsYXRlO1xuICAgICAgYmFja2dyb3VuZC5zdHlsZS5tc1RyYW5zZm9ybSA9IHRyYW5zbGF0ZTtcbiAgICAgIGJhY2tncm91bmQuc3R5bGUuT1RyYW5zZm9ybSA9IHRyYW5zbGF0ZTtcbiAgICAgIGJhY2tncm91bmQuc3R5bGUudHJhbnNmb3JtID0gdHJhbnNsYXRlO1xuXG4gICAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKG1vdmVCYWNrZ3JvdW5kKTtcbiAgICB9XG5cbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdmVyJywgZnVuY3Rpb24gKGUpIHtcblxuICAgICAgdmFyIGxNb3VzZVggPSBNYXRoLm1heCgtMTAwLCBNYXRoLm1pbigxMDAsIHNjcmVlbi53aWR0aCAvIDIgLSBlLmNsaWVudFgpKTtcbiAgICAgIHZhciBsTW91c2VZID0gTWF0aC5tYXgoLTEwMCwgTWF0aC5taW4oMTAwLCBzY3JlZW4uaGVpZ2h0IC8gMiAtIGUuY2xpZW50WSkpO1xuICAgICAgbEZvbGxvd1ggPSAoMjAgKiBsTW91c2VYKSAvIDEwMDsgLy8gMTAwIDogMTIgPSBsTW91eGVYIDogbEZvbGxvd1xuICAgICAgbEZvbGxvd1kgPSAoMTAgKiBsTW91c2VZKSAvIDEwMDtcblxuICAgIH0pO1xuICAgIG1vdmVCYWNrZ3JvdW5kKCk7XG4gIH1cblxuICBmdW5jdGlvbiBfYnV0dG9uKCkge1xuICAgIHZhciBsYW5kaW5nYnV0dG9uID0gVlIuZ2V0Lm9uZSgnI2xhbmRpbmdidXR0b24nKTtcbiAgICBsYW5kaW5nYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgVlIucm91dGVyLnNob3coJyN0aW1lbGluZScpXG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIHtcbiAgICBpbml0OiBpbml0XG4gIH07XG59KSgpO1xuIiwiVlIudGltZWxpbmUgPSAoZnVuY3Rpb24gKCkgeyAvL2Z1bnRpb24gdG8gcmVuZGVyIGEgdGVtcGxhdGUuXG4gIC8vcmVuZGVyIHRoZSB0ZW1wbGF0ZVxuICBsZXQgX3ZpZGVvcztcblxuICBmdW5jdGlvbiBpbml0KCkge1xuICAgIC8vIHIuX2dldERhdGEoKTtcbiAgICBfZ2V0RGF0YSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gX2dldERhdGEoKSB7XG5cbiAgICBsZXQgdmlkZW9MaXN0ID0gVlIuZ2V0Lm9uZSgnLnZpZGVvLWxpc3QnKTtcbiAgICBsZXQgdXJsID0gVlIuZ2V0LnVybHMoJ2RhdGEuanNvbicpLmRhdGFVcmw7XG5cbiAgICBWUi5nZXQuZGF0YSh1cmwpLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgX3ZpZGVvcyA9IEpTT04ucGFyc2UocmVzcG9uc2UpO1xuXG4gICAgICB2aWRlb0xpc3QuYXBwZW5kQ2hpbGQoX2dlbmVyYXRlVGltZWxpbmUoX3ZpZGVvcykpO1xuICAgICAgY2xpY2tWaWRlbygpO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gX2dlbmVyYXRlVGltZWxpbmUoZGF0YSkge1xuICAgIGxldCB2aWRlb0xpc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd1bCcpO1xuXG4gICAgZGF0YS52aWRlb3MuZm9yRWFjaChmdW5jdGlvbiAob2JqKSB7XG4gICAgICB2YXIgdmlkZW9JZCA9IE9iamVjdC5rZXlzKG9iailbMF07XG5cbiAgICAgIGxldCBlbGVtZW50ID0gX2NyZWF0ZVZpZGVvRWxlbWVudChvYmpbdmlkZW9JZF0udGh1bWJuYWlsLCBvYmpbdmlkZW9JZF0udGl0bGUsIG9ialt2aWRlb0lkXS5kZXNjcmlwdGlvbiwgdmlkZW9JZCk7XG5cbiAgICAgIHZpZGVvTGlzdC5pbm5lckhUTUwgKz0gZWxlbWVudDsgLy9hZGQgaXQgdG8gdGhlIHVsXG4gICAgfSk7XG4gICAgcmV0dXJuIHZpZGVvTGlzdDtcblxuICB9XG5cbiAgZnVuY3Rpb24gX2NyZWF0ZVZpZGVvRWxlbWVudCh0dW1iVXJsLCB0aXRsZSwgZGVzY3JpcHRpb24sIHZpZGVvSWQpIHtcbiAgICBsZXQgdHVtYlVybEdlbmVyYXRlZCA9IFZSLmdldC51cmxzKHR1bWJVcmwpLnR1bWJVcmw7XG4gICAgbGV0IHZpZGVvVXJsID0gVlIuZ2V0LnVybHModHVtYlVybCkudHVtYlVybDtcblxuICAgIGxldCB2aWRlbyA9ICc8dWw+PGRpdiBjbGFzcz1cInZpZGVvLXdyYXBwZXJcIj4nO1xuICAgIHZpZGVvICs9ICdcdFx0XHRcdFx0PGRpdiBjbGFzcz1cInRodW1ibmFpbC13cmFwcGVyXCI+J1xuICAgIHZpZGVvICs9ICdcdFx0XHRcdFx0XHQ8aW1nIGNsYXNzPVwidGh1bWJuYWlsXCIgc3JjPVwiJyArIHR1bWJVcmxHZW5lcmF0ZWQgKyAnXCI+JztcbiAgICB2aWRlbyArPSAnICBcdFx0XHRcdFx0PGRpdiBjbGFzcz1cIm1lZGlhLWNhcHRpb25cIj4nO1xuICAgIHZpZGVvICs9ICcgIFx0XHRcdFx0XHRcdDxkaXYgY2xhc3M9XCJjYXB0aW9uLWNvbnRlbnRcIj4nO1xuICAgIHZpZGVvICs9ICcgIFx0XHRcdFx0XHRcdFx0PGgyPicgKyB0aXRsZSArICc8L2gyPic7XG4gICAgdmlkZW8gKz0gJyAgXHRcdFx0XHRcdFx0XHQ8c3Bhbj4nICsgZGVzY3JpcHRpb24gKyAnPC9zcGFuPic7XG4gICAgdmlkZW8gKz0gJyAgXHRcdFx0XHRcdFx0PC9kaXY+JztcbiAgICB2aWRlbyArPSAnICAgIFx0XHRcdFx0PC9kaXY+JztcbiAgICB2aWRlbyArPSAnICBcdFx0XHRcdFx0PGRpdiBjbGFzcz1cInZpZGVvLXBsYXlcIiBkYXRhLXZpZGVvLWlkPVwiJyArIHZpZGVvSWQgKyAnXCJcIj4nO1xuICAgIHZpZGVvICs9ICcgIFx0XHRcdFx0XHQ8L2Rpdj4nO1xuICAgIHZpZGVvICs9ICdcdFx0XHRcdFx0PC9kaXY+JztcbiAgICB2aWRlbyArPSAnXHRcdFx0XHRcdDx2aWRlbyBhdXRvcGxheSBjb250cm9scyBzdHlsZT1cImRpc3BsYXk6bm9uZTtcIj4nO1xuICAgIHZpZGVvICs9ICdcdFx0XHRcdFx0U29ycnksIHlvdXIgYnJvd3NlciBkb2VzbnQgc3VwcG9ydCBlbWJlZGRlZCB2aWRlb3MnO1xuICAgIHZpZGVvICs9ICdcdFx0XHRcdFx0PC92aWRlbz4nO1xuICAgIHZpZGVvICs9ICc8L2Rpdj48L3VsPic7XG4gICAgcmV0dXJuIHZpZGVvO1xuICB9XG5cbiAgZnVuY3Rpb24gY2xpY2tWaWRlbygpIHtcbiAgICBWUi5nZXQub25lKCcudmlkZW8tbGlzdCB1bCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgIGlmIChlLnRhcmdldC5jbGFzc05hbWUgPT0gXCJ2aWRlby1wbGF5XCIpIHtcblxuICAgICAgICB2YXIgc2VsZWN0ZWRWaWRlb0lkID0gZS50YXJnZXQuZGF0YXNldC52aWRlb0lkO1xuICAgICAgICB2YXIgc2VsZWN0ZWRWaWRlbyA9IGdldFZpZGVvKHNlbGVjdGVkVmlkZW9JZCk7XG4gICAgICAgIGNvbnNvbGUubG9nKHNlbGVjdGVkVmlkZW8pO1xuICAgICAgICBzZWxlY3RlZFZpZGVvLmlkID0gc2VsZWN0ZWRWaWRlb0lkO1xuXG5cbiAgICAgICAgLy8gTmF2aWdhdGUgdG8gdGhlIG1ldGEgdmlkZW8gdmlld1xuICAgICAgICBjb25zb2xlLmxvZygnTmF2aWdhdGUgdG8gdGhlIG1ldGEgdmlkZW8gdmlldycpO1xuXG4gICAgICAgIC8vIGdvdG9TZWN0aW9uKCd2aWRlby1tZXRhJyk7XG4gICAgICAgIFZSLnJvdXRlci5zaG93KCcjdmlkZW8nKTtcbiAgICAgICAgcmVuZGVyVmlkZW9NZXRhRGF0YShzZWxlY3RlZFZpZGVvKTtcblxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gY2xpY2tNZXRhVmlkZW8oKSB7XG4gICAgVlIuZ2V0Lm9uZSgnLnZpZGVvLW1ldGEnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICBpZiAoZS50YXJnZXQuaWQgPT0gXCJtZXRhLXZpZGVvLXBsYXlcIikge1xuICAgICAgICB2YXIgc2VsZWN0ZWRWaWRlb0lkID0gZS50YXJnZXQuZGF0YXNldC52aWRlb0lkO1xuICAgICAgICB2YXIgc2VsZWN0ZWRWaWRlbyA9IGdldFZpZGVvKHNlbGVjdGVkVmlkZW9JZClbc2VsZWN0ZWRWaWRlb0lkXTtcblxuICAgICAgICBpZiAoZ2V0QWN0aXZlU2VjdGlvbigpID09ICd2aWRlby1tZXRhJykge1xuICAgICAgICAgIC8vIFBsYXkgdGhlIHZpZGVvXG4gICAgICAgICAgY29uc29sZS5sb2coJ1BsYXkgdGUgdmlkZW8nKTtcblxuICAgICAgICAgIHZhciBtZXRhVmlkZW9FbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldGEtdmlkZW8nKTtcbiAgICAgICAgICBtZXRhVmlkZW9FbGVtZW50LnNyYyA9ICdtZWRpYS92aWRlby8nICsgc2VsZWN0ZWRWaWRlby5maWxlbmFtZTtcbiAgICAgICAgICBtZXRhVmlkZW9FbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xuICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ21ldGEtdGh1bWJuYWlsLXdyYXBwZXInKVswXS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuXG4gIC8qKlxuICAgKiBSZW5kZXJzIHRoZSB2aWRlbyBtZXRhIGRhdGEgaW4gdGhlIHZpZGVvLW1ldGEgc2VjdGlvblxuICAgKlxuICAgKiBAcGFyYW0gICAgICB7b2JqfSAgc2VsZWN0ZWRWaWRlbyAgVGhlIHNlbGVjdGVkIHZpZGVvXG4gICAqL1xuICBmdW5jdGlvbiByZW5kZXJWaWRlb01ldGFEYXRhKHNlbGVjdGVkVmlkZW8pIHtcbiAgICBjb25zb2xlLmxvZyhzZWxlY3RlZFZpZGVvKTtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YS12aWRlby1wbGF5Jykuc2V0QXR0cmlidXRlKCdkYXRhLXZpZGVvLWlkJywgc2VsZWN0ZWRWaWRlby5pZCk7XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZpZGVvLXRpdGxlJykuaW5uZXJIVE1MID0gc2VsZWN0ZWRWaWRlb1tzZWxlY3RlZFZpZGVvLmlkXS50aXRsZTtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGVzY3JpcHRpb24nKS5pbm5lckhUTUwgPSBzZWxlY3RlZFZpZGVvW3NlbGVjdGVkVmlkZW8uaWRdLmRlc2NyaXB0aW9uO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkYXRlLWFsaWFzJykuaW5uZXJIVE1MID0gc2VsZWN0ZWRWaWRlb1tzZWxlY3RlZFZpZGVvLmlkXS5kYXRlYWxpYXM7XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldGEtdGh1bWJuYWlsJykuc3JjID0gJ21lZGlhL3RodW1ibmFpbHMvJyArIHNlbGVjdGVkVmlkZW9bc2VsZWN0ZWRWaWRlby5pZF0udGh1bWJuYWlsO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIHZpZGVvLlxuICAgKlxuICAgKiBAcGFyYW0gICAgICBzdHJpbmcgdmlkZW9JZCAgVGhlIHZpZGVvIGlkZW50aWZpZXJcbiAgICogQHJldHVybiAgICAgb2JqICBUaGUgdmlkZW8uXG4gICAqL1xuICBmdW5jdGlvbiBnZXRWaWRlbyh2aWRlb0lkKSB7XG4gICAgdmFyIHNlbGVjdGVkVmlkZW87XG4gICAgY29uc29sZS5sb2coX3ZpZGVvcyk7XG4gICAgX3ZpZGVvcy52aWRlb3Muc29tZShmdW5jdGlvbiAoZWxtLCBpbmRleCkge1xuICAgICAgaWYgKGVsbVt2aWRlb0lkXSkge1xuICAgICAgICBzZWxlY3RlZFZpZGVvID0gZWxtO1xuICAgICAgfVxuICAgIH0pXG4gICAgcmV0dXJuIHNlbGVjdGVkVmlkZW87XG4gIH1cblxuXG4gIHJldHVybiB7XG4gICAgaW5pdDogaW5pdFxuICB9O1xuXG59KSgpO1xuIl19
